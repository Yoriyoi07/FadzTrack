/*! For license information please see hr.bd981ce8.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkfadz_web_frontend=self.webpackChunkfadz_web_frontend||[]).push([[965],{64:()=>{},599:(e,a,s)=>{s.r(a),s.d(a,{default:()=>o});var t=s(5043),n=s(3216),r=(s(4786),s(411)),i=s(8818),l=s(3204),c=s(579);const o=e=>{let{forceUserUpdate:a}=e;const s=(0,n.Zp)(),[o,d]=(0,t.useState)((()=>{const e=localStorage.getItem("user");return e?JSON.parse(e):null})),[m,u]=(0,t.useState)((()=>localStorage.getItem("token")||"")),[h,p]=(0,t.useState)((()=>null===o||void 0===o?void 0:o._id));(0,t.useEffect)((()=>{const e=()=>{const e=localStorage.getItem("user");d(e?JSON.parse(e):null),p(e?JSON.parse(e)._id:void 0),u(localStorage.getItem("token")||"")};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}),[]);const[j,v]=(0,t.useState)([]),[x,g]=(0,t.useState)(!0),[N,f]=(0,t.useState)(null),[w,b]=(0,t.useState)(0),[y,S]=(0,t.useState)(""),[A,k]=(0,t.useState)(""),[C,D]=(0,t.useState)(""),[q,P]=(0,t.useState)("generatedAt"),[L,R]=(0,t.useState)("desc"),[M,E]=(0,t.useState)(!1),[B,_]=(0,t.useState)([]),[T,F]=(0,t.useState)(""),[I,z]=(0,t.useState)("");(0,t.useEffect)((()=>{m&&h||s("/")}),[m,h,s]);const U=(0,t.useCallback)((async()=>{if(m)try{const{data:e}=await r.Ay.get("/projects",{headers:{Authorization:"Bearer ".concat(m)}});_(e||[])}catch(N){console.error("Error fetching projects:",N)}}),[m]),O=(0,t.useCallback)((async()=>{if(m){g(!0),f(null);try{const e=new URLSearchParams;y&&e.append("search",y),A&&e.append("dateFrom",A),C&&e.append("dateTo",C),T&&e.append("projectId",T),e.append("sortBy",q),e.append("sortOrder",L),console.log("Fetching attendance reports from:","/hr-site-attendance/all-reports?".concat(e)),console.log("Token:",m?"Present":"Missing");const{data:a}=await r.Ay.get("/hr-site-attendance/all-reports?".concat(e),{headers:{Authorization:"Bearer ".concat(m)}});console.log("API Response:",a),v(a.reports||[]),b(a.total||0)}catch(N){var e;console.error("Error fetching attendance reports:",N),console.error("Error details:",(null===(e=N.response)||void 0===e?void 0:e.data)||N.message),f("Failed to load attendance reports"),v([])}finally{g(!1)}}}),[m,y,A,C,T,q,L]);(0,t.useEffect)((()=>{console.log("HrAttendance component mounted, fetching reports..."),U(),O()}),[U,O]);const V=e=>{q===e?R("asc"===L?"desc":"asc"):(P(e),R("desc"))},W=()=>{S(""),k(""),D(""),F(""),z(""),P("generatedAt"),R("desc")},H=e=>{P("generatedAt"),R(e)},J=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown",X=e=>q!==e?(0,c.jsx)(l.MjW,{className:"sort-icon"}):"asc"===L?(0,c.jsx)(l.XhJ,{className:"sort-icon"}):(0,c.jsx)(l.GOR,{className:"sort-icon"}),Z=(0,t.useCallback)((()=>{r.Ay.post("/auth/logout",{},{headers:{Authorization:"Bearer ".concat(m)}}).finally((()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),d(null),p(void 0),u(""),a&&a(),window.dispatchEvent(new Event("storage")),s("/")}))}),[m,a,s]);return(0,c.jsxs)("div",{className:"hr-dashboard dashboard-container",children:[(0,c.jsx)(i.A,{roleSegment:"hr",onLogout:Z,overrideNav:[{to:"/hr/dash",label:"Dashboard",icon:(0,c.jsx)(l.$BV,{}),match:"/hr/dash"},{to:"/hr/chat",label:"Chat",icon:(0,c.jsx)(l.uN,{}),match:"/hr/chat"},{to:"/hr/mlist",label:"Manpower",icon:(0,c.jsx)(l.YXz,{}),match:"/hr/mlist"},{to:"/hr/movement",label:"Movement",icon:(0,c.jsx)(l.yk7,{}),match:"/hr/movement"},{to:"/hr/project-records",label:"Projects",icon:(0,c.jsx)(l.yd7,{}),match:"/hr/project-records"},{to:"/hr/attendance",label:"Attendance",icon:(0,c.jsx)(l.bfZ,{}),match:"/hr/attendance"}]}),(0,c.jsx)("main",{className:"dashboard-main",children:(0,c.jsxs)("div",{className:"dashboard-content",children:[(0,c.jsxs)("div",{className:"page-header",children:[(0,c.jsxs)("div",{className:"header-content",children:[(0,c.jsxs)("h1",{className:"page-title",children:[(0,c.jsx)(l.bfZ,{className:"title-icon"}),"Attendance Reports"]}),(0,c.jsx)("p",{className:"page-subtitle",children:"View and manage attendance reports across all projects"})]}),(0,c.jsx)("div",{className:"header-stats",children:(0,c.jsxs)("div",{className:"stat-card",children:[(0,c.jsx)("div",{className:"stat-value",children:w}),(0,c.jsx)("div",{className:"stat-label",children:"Total Reports"})]})})]}),(0,c.jsxs)("div",{className:"filters-section",children:[(0,c.jsxs)("div",{className:"filters-row",children:[(0,c.jsxs)("div",{className:"search-bar",children:[(0,c.jsx)(l.KSO,{className:"search-icon"}),(0,c.jsx)("input",{type:"text",placeholder:"Search anything in the list...",value:y,onChange:e=>{S(e.target.value)},className:"search-input"})]}),(0,c.jsxs)("div",{className:"filter-controls",children:[(0,c.jsxs)("div",{className:"date-sort-buttons",children:[(0,c.jsx)("button",{className:"sort-btn ".concat("generatedAt"===q&&"desc"===L?"active":""),onClick:()=>H("desc"),title:"Most Recent",children:"Recent"}),(0,c.jsx)("button",{className:"sort-btn ".concat("generatedAt"===q&&"asc"===L?"active":""),onClick:()=>H("asc"),title:"Oldest First",children:"Oldest"})]}),(0,c.jsxs)("select",{className:"project-filter",value:T,onChange:e=>F(e.target.value),children:[(0,c.jsx)("option",{value:"",children:"All Projects"}),B.map((e=>(0,c.jsx)("option",{value:e._id,children:e.projectName},e._id)))]}),(0,c.jsx)("div",{className:"date-filter-dropdown",children:(0,c.jsxs)("select",{className:"date-filter-select",value:I,onChange:e=>(e=>{z(e);const a=new Date;switch(e){case"today":k(a.toISOString().split("T")[0]),D(a.toISOString().split("T")[0]);break;case"week":const e=new Date(a.getTime()-6048e5);k(e.toISOString().split("T")[0]),D(a.toISOString().split("T")[0]);break;case"month":const s=new Date(a.getTime()-2592e6);k(s.toISOString().split("T")[0]),D(a.toISOString().split("T")[0]);break;case"custom":break;default:k(""),D("")}})(e.target.value),children:[(0,c.jsx)("option",{value:"",children:"All Time"}),(0,c.jsx)("option",{value:"today",children:"Today"}),(0,c.jsx)("option",{value:"week",children:"Last 7 Days"}),(0,c.jsx)("option",{value:"month",children:"Last 30 Days"}),(0,c.jsx)("option",{value:"custom",children:"Custom Range"})]})}),(0,c.jsx)("button",{className:"clear-filters",onClick:W,children:"Clear All"})]})]}),"custom"===I&&(0,c.jsxs)("div",{className:"custom-date-range",children:[(0,c.jsx)("input",{type:"date",value:A,onChange:e=>k(e.target.value),className:"date-input",placeholder:"From"}),(0,c.jsx)("span",{children:"to"}),(0,c.jsx)("input",{type:"date",value:C,onChange:e=>D(e.target.value),className:"date-input",placeholder:"To"})]})]}),(0,c.jsx)("div",{className:"reports-table-container",children:x?(0,c.jsxs)("div",{className:"loading-state",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("span",{children:"Loading attendance reports..."})]}):N?(0,c.jsxs)("div",{className:"error-state",children:[(0,c.jsxs)("span",{children:["\u26a0\ufe0f ",N]}),(0,c.jsx)("button",{onClick:O,className:"retry-btn",children:"Try Again"})]}):0===j.length?(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)(l.Ru,{className:"empty-icon"}),(0,c.jsx)("h3",{children:"No Attendance Reports Found"}),(0,c.jsx)("p",{children:"No attendance reports match your current filters."}),(0,c.jsx)("button",{onClick:W,className:"clear-filters-btn",children:"Clear Filters"})]}):(0,c.jsx)("div",{className:"table-wrapper",children:(0,c.jsxs)("table",{className:"reports-table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsxs)("th",{className:"sortable",onClick:()=>V("projectName"),children:["Project Name ",X("projectName")]}),(0,c.jsxs)("th",{className:"sortable",onClick:()=>V("originalName"),children:["File Name ",X("originalName")]}),(0,c.jsxs)("th",{className:"sortable",onClick:()=>V("uploadedByName"),children:["Uploaded By ",X("uploadedByName")]}),(0,c.jsxs)("th",{className:"sortable",onClick:()=>V("generatedAt"),children:["Generated At ",X("generatedAt")]}),(0,c.jsx)("th",{children:"Actions"})]})}),(0,c.jsx)("tbody",{children:j.map((e=>(0,c.jsxs)("tr",{className:"report-row",children:[(0,c.jsx)("td",{className:"project-name",children:(0,c.jsxs)("div",{className:"project-info",children:[(0,c.jsx)("span",{className:"project-title",children:e.projectName}),(0,c.jsx)("div",{className:"project-dates",children:(0,c.jsxs)("small",{children:[J(e.projectStartDate)," - ",J(e.projectEndDate)]})})]})}),(0,c.jsx)("td",{className:"file-name",children:(0,c.jsxs)("div",{className:"file-info",children:[(0,c.jsx)(l.Ru,{className:"file-icon"}),(0,c.jsx)("span",{children:e.originalName})]})}),(0,c.jsx)("td",{className:"uploaded-by",children:(0,c.jsxs)("div",{className:"user-info",children:[(0,c.jsx)(l.x$1,{className:"user-icon"}),(0,c.jsx)("span",{children:e.uploadedByName||"Unknown"})]})}),(0,c.jsx)("td",{className:"generated-at",children:(0,c.jsxs)("div",{className:"date-info",children:[(0,c.jsx)(l.w_X,{className:"date-icon"}),(0,c.jsx)("span",{children:J(e.generatedAt)})]})}),(0,c.jsx)("td",{className:"actions",children:(0,c.jsx)("div",{className:"action-buttons",children:(0,c.jsx)("button",{className:"action-btn download-btn",title:"Download AI Attendance Report",onClick:async()=>{try{const{data:a}=await r.Ay.get("/projects/".concat(e.projectId,"/attendance-signed-url"),{params:{path:e.outputPath},headers:{Authorization:"Bearer ".concat(m)}});null!==a&&void 0!==a&&a.signedUrl&&window.open(a.signedUrl,"_blank")}catch(N){console.error("Error downloading report:",N),alert("Failed to download report")}},children:(0,c.jsx)(l.WCW,{})})})})]},e._id)))})]})})})]})})]})}},892:(e,a,s)=>{s.r(a),s.d(a,{default:()=>j});var t=s(9379),n=s(5043),r=s(3216),i=s(411),l=s(8818),c=s(3204),o=s(579);const d=function(e){return{background:e,color:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#111827",padding:"4px 10px",borderRadius:20,fontSize:12,fontWeight:600,display:"inline-flex",alignItems:"center",gap:6}},m={display:"block",fontWeight:600,marginBottom:6,fontSize:13,letterSpacing:".25px",color:"#374151"},u={padding:"12px 14px",border:"1px solid #e5e7eb",borderRadius:8,background:"#fff",fontSize:14,minHeight:44,display:"flex",alignItems:"center"},h=e=>{const a={display:"inline-flex",alignItems:"center",gap:8,padding:"10px 18px",fontSize:14,fontWeight:600,borderRadius:8,border:"none",cursor:"pointer"};switch(e){case"primary":return(0,t.A)((0,t.A)({},a),{},{background:"#2563eb",color:"#fff"});case"danger":return(0,t.A)((0,t.A)({},a),{},{background:"#dc2626",color:"#fff"});case"neutral":return(0,t.A)((0,t.A)({},a),{},{background:"#6b7280",color:"#fff"});default:return(0,t.A)((0,t.A)({},a),{},{background:"#e5e7eb",color:"#111827"})}},p=e=>{let{requestId:a}=e;const[s,r]=n.useState([]),[l,c]=n.useState(!1),d=localStorage.getItem("token");return(0,n.useEffect)((()=>{if(!l)return;(async()=>{try{const{data:e}=await i.Ay.get("/audit-logs",{headers:{Authorization:"Bearer ".concat(d)}}),s=e.filter((e=>{var s;return(null===(s=e.meta)||void 0===s?void 0:s.requestId)===a}));r(s)}catch(e){console.error("Audit fetch failed",e)}})()}),[l,a,d]),(0,o.jsxs)("div",{style:{marginTop:48},children:[(0,o.jsxs)("button",{onClick:()=>c((e=>!e)),style:(0,t.A)((0,t.A)({},h("neutral")),{},{background:"#f3f4f6",color:"#111827"}),children:[l?"Hide":"Show"," Audit Log"]}),l&&(0,o.jsxs)("div",{style:{marginTop:16,maxHeight:260,overflowY:"auto",border:"1px solid #e5e7eb",borderRadius:12,padding:16,background:"#fafafa"},children:[0===s.length&&(0,o.jsx)("div",{style:{fontSize:13,color:"#6b7280"},children:"No audit entries for this request."}),s.map((e=>{var a;return(0,o.jsxs)("div",{style:{padding:"10px 12px",borderBottom:"1px solid #e5e7eb",fontSize:13,lineHeight:1.4},children:[(0,o.jsx)("div",{style:{fontWeight:600},children:e.action}),(0,o.jsx)("div",{style:{color:"#374151"},children:e.description}),(0,o.jsxs)("div",{style:{color:"#6b7280",fontSize:12,marginTop:4},children:[new Date(e.timestamp).toLocaleString()," \u2022 ",null===(a=e.performedBy)||void 0===a?void 0:a.name," (",e.performedByRole,")"]})]},e._id||e.timestamp)}))]})]})},j=()=>{var e,a,s,j,v,x,g,N,f,w;const{id:b}=(0,r.g)(),y=(0,r.Zp)(),S=localStorage.getItem("token"),A=localStorage.getItem("user"),k=A?JSON.parse(A):null,[C]=((null===k||void 0===k?void 0:k._id)||(null===k||void 0===k||k.id),null===k||void 0===k||k.role,(0,n.useState)((()=>(null===k||void 0===k?void 0:k.name)||"HR Manager"))),[D,q]=(0,n.useState)(null),[P,L]=(0,n.useState)(!0),[R,M]=(0,n.useState)(""),[E,B]=(0,n.useState)(!1),[_,T]=(0,n.useState)(!1),[F,I]=(0,n.useState)(!1),[z,U]=(0,n.useState)("");(0,n.useEffect)((()=>{(async()=>{L(!0),M("");try{const{data:a}=await i.Ay.get("/manpower-requests/".concat(b),{headers:{Authorization:"Bearer ".concat(S)}});if(q(a),!a.isViewed)try{await i.Ay.put("/manpower-requests/".concat(b),{isViewed:!0},{headers:{Authorization:"Bearer ".concat(S)}})}catch(e){console.error("Failed to mark as viewed:",e)}}catch(e){M("Failed to load request details"),console.error("Error fetching request:",e)}finally{L(!1)}})()}),[b,S]);const O=async()=>{if(window.confirm("Are you sure you want to delete this request? This action cannot be undone.")){B(!0);try{await i.Ay.delete("/manpower-requests/".concat(b),{headers:{Authorization:"Bearer ".concat(S)}}),alert("\ud83d\uddd1\ufe0f Request deleted successfully"),y("/hr/dash")}catch(e){console.error("Error deleting request:",e),alert("\u274c Failed to delete request")}finally{B(!1)}}},V="approved"===((null===D||void 0===D?void 0:D.status)||"").toLowerCase();return P?(0,o.jsx)("div",{className:"dashboard-container",children:(0,o.jsxs)("div",{className:"loading-container",children:[(0,o.jsx)("div",{className:"loading-spinner"}),(0,o.jsx)("p",{children:"Loading manpower request details..."})]})}):R||!D?(0,o.jsx)("div",{className:"dashboard-container",children:(0,o.jsxs)("div",{className:"error-container",children:[(0,o.jsx)(c.BS8,{className:"error-icon"}),(0,o.jsx)("p",{children:R||"Request not found."})]})}):(0,o.jsxs)("div",{className:"dashboard-container",children:[(0,o.jsx)(l.A,{roleSegment:"hr",onLogout:()=>{i.Ay.post("/auth/logout",{},{headers:{Authorization:"Bearer ".concat(S)}}).finally((()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),y("/")}))},overrideNav:[{to:"/hr/dash",label:"Dashboard",icon:(0,o.jsx)(c.$BV,{}),match:"/hr/dash"},{to:"/hr/chat",label:"Chat",icon:(0,o.jsx)(c.uN,{}),match:"/hr/chat"},{to:"/hr/mlist",label:"Manpower",icon:(0,o.jsx)(c.YXz,{}),match:"/hr/mlist"},{to:"/hr/movement",label:"Movement",icon:(0,o.jsx)(c.yk7,{}),match:"/hr/movement"},{to:"/hr/project-records",label:"Projects",icon:(0,o.jsx)(c.yd7,{}),match:"/hr/project-records"},{to:"/hr/attendance",label:"Attendance",icon:(0,o.jsx)(c.bfZ,{}),match:"/hr/attendance"}]}),(0,o.jsx)("main",{className:"dashboard-main",children:(0,o.jsxs)("div",{className:"form-container",style:{maxWidth:900,margin:"40px auto",background:"#fff",borderRadius:16,padding:"32px 40px",boxShadow:"0 4px 16px rgba(0,0,0,0.06)"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:24},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h2",{style:{margin:0,fontSize:30,fontWeight:700},children:"Manpower Request"}),(0,o.jsxs)("div",{style:{marginTop:8,fontSize:14,color:"#4b5563"},children:["Project: ",(0,o.jsx)("strong",{children:(null===(e=D.project)||void 0===e?void 0:e.projectName)||"N/A"})," \xa0\u2022\xa0 Requested by ",null===(a=D.createdBy)||void 0===a?void 0:a.name]}),(0,o.jsx)("div",{style:{marginTop:12},children:(0,o.jsx)("span",{style:(W=D.status,{Pending:d("#fef3c7","#92400e"),Approved:d("#dcfce7","#065f46"),Overdue:d("#fee2e2","#991b1b"),Completed:d("#e0f2fe","#075985"),Rejected:d("#fee2e2","#991b1b")}[W]||d("#e5e7eb")),children:D.status})})]}),(0,o.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[(0,o.jsx)("button",{onClick:()=>y("/hr/movement"),style:h("secondary"),children:"Back"}),(0,o.jsx)("button",{disabled:E,onClick:O,style:h("danger"),children:E?"Deleting...":"Delete"})]})]}),(0,o.jsxs)("div",{style:{marginTop:32,display:"grid",gap:32,gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{style:m,children:"Target Acquisition Date"}),(0,o.jsx)("div",{style:u,children:D.acquisitionDate?new Date(D.acquisitionDate).toLocaleDateString():"\u2014"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{style:m,children:"Duration (days)"}),(0,o.jsxs)("div",{style:u,children:[D.duration," days"]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{style:m,children:"Project"}),(0,o.jsx)("div",{style:(0,t.A)((0,t.A)({},u),{},{background:"#f3f4f6"}),children:(null===(s=D.project)||void 0===s?void 0:s.projectName)||"\u2014"})]})]}),(0,o.jsxs)("div",{style:{marginTop:40},children:[(0,o.jsx)("label",{style:m,children:"Manpower Needed"}),(0,o.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:12},children:null!==(j=D.manpowers)&&void 0!==j&&j.length?D.manpowers.map(((e,a)=>(0,o.jsxs)("span",{style:d("#eef2ff","#3730a3"),children:[e.quantity," ",e.type]},a))):(0,o.jsx)("span",{style:{color:"#6b7280"},children:"No manpower entries"})})]}),(0,o.jsxs)("div",{style:{marginTop:40},children:[(0,o.jsx)("label",{style:m,children:"Description / Purpose"}),(0,o.jsx)("div",{style:(0,t.A)((0,t.A)({},u),{},{minHeight:80}),children:D.description||"No description provided"})]}),(0,o.jsxs)("div",{className:"request-details-container",children:[(0,o.jsxs)("div",{className:"status-banner ".concat(null===(v=D.status)||void 0===v?void 0:v.toLowerCase()),children:["pending"===(null===(x=D.status)||void 0===x?void 0:x.toLowerCase())&&D.acquisitionDate&&new Date(D.acquisitionDate)<new Date&&(0,o.jsx)("div",{className:"overdue-ribbon",children:(0,o.jsx)("span",{children:"OVERDUE"})}),(0,o.jsxs)("div",{className:"status-content",children:[(e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"approved":return(0,o.jsx)(c.A7C,{className:"status-icon approved"});case"rejected":return(0,o.jsx)(c.BS8,{className:"status-icon rejected"});default:return(0,o.jsx)(c.lhZ,{className:"status-icon pending"})}})(D.status),(0,o.jsxs)("div",{className:"status-info",children:[(0,o.jsxs)("h3",{className:"status-title",children:[D.status||"Pending"," Request"]}),(0,o.jsx)("p",{className:"status-description",children:"approved"===(null===(g=D.status)||void 0===g?void 0:g.toLowerCase())?"This request has been approved and manpower assigned":"rejected"===(null===(N=D.status)||void 0===N?void 0:N.toLowerCase())?"This request has been rejected":"Waiting for HR approval"})]})]}),V&&(0,o.jsx)("div",{className:"received-toggle",children:(0,o.jsxs)("label",{className:"toggle-label",children:[(0,o.jsx)("input",{type:"checkbox",checked:_,onChange:async()=>{T(!_)},className:"toggle-input"}),(0,o.jsx)("span",{className:"toggle-text",children:"Mark as Received"})]})})]}),(0,o.jsxs)("div",{className:"info-grid",children:[(0,o.jsxs)("div",{className:"info-card",children:[(0,o.jsxs)("div",{className:"card-header",children:[(0,o.jsx)(c.t69,{className:"card-icon"}),(0,o.jsx)("h3",{children:"Request Information"})]}),(0,o.jsxs)("div",{className:"card-content",children:[(0,o.jsxs)("div",{className:"info-row",children:[(0,o.jsx)("span",{className:"info-label",children:"Request Number:"}),(0,o.jsxs)("span",{className:"info-value",children:["#",D.requestNumber||(null===b||void 0===b?void 0:b.slice(-3))]})]}),(0,o.jsxs)("div",{className:"info-row",children:[(0,o.jsx)("span",{className:"info-label",children:"Created By:"}),(0,o.jsxs)("span",{className:"info-value",children:[(0,o.jsx)(c.p7b,{className:"inline-icon"}),(null===(f=D.createdBy)||void 0===f?void 0:f.name)||"Unknown"]})]}),(0,o.jsxs)("div",{className:"info-row",children:[(0,o.jsx)("span",{className:"info-label",children:"Project:"}),(0,o.jsxs)("span",{className:"info-value",children:[(0,o.jsx)(c.yd7,{className:"inline-icon"}),(null===(w=D.project)||void 0===w?void 0:w.projectName)||"Unknown Project"]})]})]})]}),(0,o.jsxs)("div",{className:"info-card",children:[(0,o.jsxs)("div",{className:"card-header",children:[(0,o.jsx)(c.w_X,{className:"card-icon"}),(0,o.jsx)("h3",{children:"Timeline"})]}),(0,o.jsxs)("div",{className:"card-content",children:[(0,o.jsxs)("div",{className:"info-row",children:[(0,o.jsx)("span",{className:"info-label",children:"Target Date:"}),(0,o.jsx)("span",{className:"info-value",children:D.acquisitionDate?new Date(D.acquisitionDate).toLocaleDateString():"Not set"})]}),(0,o.jsxs)("div",{className:"info-row",children:[(0,o.jsx)("span",{className:"info-label",children:"Duration:"}),(0,o.jsxs)("span",{className:"info-value",children:[D.duration," days"]})]}),D.returnDate&&(0,o.jsxs)("div",{className:"info-row",children:[(0,o.jsx)("span",{className:"info-label",children:"Return Date:"}),(0,o.jsx)("span",{className:"info-value",children:new Date(D.returnDate).toLocaleDateString()})]})]})]})]}),(0,o.jsxs)("div",{className:"requirements-card",children:[(0,o.jsxs)("div",{className:"card-header",children:[(0,o.jsx)(c.YXz,{className:"card-icon"}),(0,o.jsx)("h3",{children:"Manpower Requirements"})]}),(0,o.jsx)("div",{className:"card-content",children:Array.isArray(null===D||void 0===D?void 0:D.manpowers)&&D.manpowers.length>0?(0,o.jsx)("div",{className:"manpower-grid",children:D.manpowers.map(((e,a)=>(0,o.jsxs)("div",{className:"manpower-item",children:[(0,o.jsx)("div",{className:"manpower-quantity",children:e.quantity}),(0,o.jsx)("div",{className:"manpower-type",children:e.type})]},a)))}):(0,o.jsx)("div",{className:"no-manpower",children:(0,o.jsx)("p",{children:"No manpower types listed"})})})]}),(0,o.jsxs)("div",{className:"description-card",children:[(0,o.jsxs)("div",{className:"card-header",children:[(0,o.jsx)(c.t69,{className:"card-icon"}),(0,o.jsx)("h3",{children:"Request Description"})]}),(0,o.jsx)("div",{className:"card-content",children:(0,o.jsx)("div",{className:"description-text",children:D.description||"No description provided"})})]}),(0,o.jsx)("div",{className:"creator-actions",children:(0,o.jsxs)("button",{onClick:O,className:"cancel-btn",children:[(0,o.jsx)(c.qbC,{}),(0,o.jsx)("span",{children:"Delete Request"})]})}),(0,o.jsxs)("div",{className:"bottom-actions",children:[(0,o.jsxs)("button",{onClick:()=>y(-1),className:"back-btn",children:[(0,o.jsx)(c.QVr,{}),(0,o.jsx)("span",{children:"Go Back"})]}),V&&!D.returnDate&&(0,o.jsxs)("button",{onClick:()=>I(!0),disabled:!_,className:"schedule-btn ".concat(_?"":"disabled"),children:[(0,o.jsx)(c.W5v,{}),(0,o.jsx)("span",{children:"Schedule Return"})]})]})]}),F&&(0,o.jsx)("div",{className:"modal-overlay",children:(0,o.jsxs)("div",{className:"calendar-modal",children:[(0,o.jsx)("div",{className:"modal-header",children:(0,o.jsx)("h3",{children:"Schedule Return Date"})}),(0,o.jsx)("div",{className:"modal-content",children:(0,o.jsx)("input",{type:"date",value:z,min:(new Date).toISOString().split("T")[0],onChange:e=>U(e.target.value),className:"date-input"})}),(0,o.jsxs)("div",{className:"modal-actions",children:[(0,o.jsx)("button",{className:"confirm-btn",disabled:!z,onClick:async()=>{if(z)try{await i.Ay.put("/manpower-requests/".concat(b,"/return"),{returnDate:z}),I(!1);const{data:e}=await i.Ay.get("/manpower-requests/".concat(b),{headers:{Authorization:"Bearer ".concat(S)}});q(e),alert("Return scheduled for ".concat(z))}catch(e){alert("Failed to set return date")}},children:"Confirm"}),(0,o.jsx)("button",{className:"cancel-modal-btn",onClick:()=>I(!1),children:"Cancel"})]})]})}),(0,o.jsx)(p,{requestId:D._id})]})})]});var W}},1254:()=>{},1301:(e,a,s)=>{s.d(a,{k:()=>o});var t=s(7762),n=s(4857);function r(e,a,s,t){return new Promise((n=>{try{const r="".concat("","/fonts/").concat(a);fetch(r).then((e=>e.arrayBuffer())).then((r=>{try{e.addFileToVFS(a,r),e.addFont(a,s,t),n(!0)}catch(i){n(!1)}})).catch((()=>n(!1)))}catch(r){n(!1)}}))}function i(e,a,s){try{const t=e.getFontList();return t&&t[a]&&t[a][s]}catch(t){return!1}}function l(e){if(!e)return"N/A";const a=new Date(e);return Number.isNaN(a.getTime())?"N/A":a.toLocaleString()}function c(e){return String(e).padStart(2,"0")}async function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{companyName:s="FadzTrack",logoPath:o="".concat("","/images/Fadz-logo.png"),exporterName:d="Unknown",exporterRole:m="",filters:u={},reportTitle:h="Manpower Requests Export"}=a,p=new t.Ay({unit:"pt",format:"a4"}),j="NotoSans",v=await r(p,"NotoSans-Regular.ttf",j,"normal"),x=await r(p,"NotoSans-Bold.ttf",j,"bold"),g=v&&i(p,j,"normal"),N=x&&i(p,j,"bold"),f=g?j:"helvetica",w=N?"bold":"normal",b=40;let y=40;const S=await(A=o,new Promise((e=>{if(!A)return e(null);try{const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{const s=document.createElement("canvas");s.width=a.naturalWidth,s.height=a.naturalHeight,s.getContext("2d").drawImage(a,0,0),e({dataUrl:s.toDataURL("image/png"),w:a.naturalWidth,h:a.naturalHeight})},a.onerror=()=>e(null),a.src=A}catch(a){e(null)}})));var A;let k=b;if(null!==S&&void 0!==S&&S.dataUrl){const{w:e,h:a}=function(e,a,s,t){if(!e||!a)return{w:s,h:t};const n=Math.min(s/e,t/a,1);return{w:e*n,h:a*n}}(S.w,S.h,180,60);p.addImage(S.dataUrl,"PNG",b,y-12,e,a,void 0,"FAST"),k=b+e+16}p.setFont(f,w),p.setFontSize(20),p.setTextColor(20),p.text(String(s),k,y+16),p.setFont(f,"normal"),p.setFontSize(12),p.setTextColor(90),p.text(h,k,y+26),p.setDrawColor(220),p.setLineWidth(1),p.line(b,y+38,555,y+38),y+=54,p.setFont(f,w),p.setFontSize(12),p.setTextColor(20),p.text("Export Details",b,y),p.setFont(f,"normal"),p.setTextColor(60);const C=["Exported by: ".concat(d).concat(m?" (".concat(m,")"):""),"Date exported: ".concat(l(new Date))],D=function(e){const a=[];return e.status&&"all"!==e.status&&a.push("Status: ".concat(e.status)),e.search&&a.push('Search: "'.concat(e.search,'"')),e.dateFrom&&a.push("From: ".concat(e.dateFrom)),e.dateTo&&a.push("To: ".concat(e.dateTo)),a.length?a.join(", "):null}(u);D&&C.push("Filters: ".concat(D));let q=y+16;C.forEach((e=>{p.text(e,b,q),q+=16}));const P=q+6,L=e.map((e=>{var a,s;const t=Array.isArray(e.manpowerRequested)?e.manpowerRequested.map((e=>"".concat(e.name||"").concat(e.position?" (".concat(e.position,")"):""))).join(", "):"";return[e.createdAt?new Date(e.createdAt).toLocaleDateString():"",String((null===(a=e.createdBy)||void 0===a?void 0:a.name)||""),String((null===(s=e.project)||void 0===s?void 0:s.projectName)||""),t,(n=e,"Approved"===n.status?"Approved":"Pending"===n.status?"Pending":"Rejected"===n.status?"Rejected":"Completed"===n.status?"Completed":"In Progress"===n.status?"In Progress":"Unknown"),e.acquisitionDate?new Date(e.acquisitionDate).toLocaleDateString():""];var n}));(0,n.Ay)(p,{startY:P,head:[["Date","Requester","Project","Manpower Requested","Status","Acquisition Date"]],body:L,styles:{font:f,fontStyle:"normal",fontSize:10,cellPadding:5,halign:"left",overflow:"linebreak"},headStyles:{font:f,fontStyle:w,fillColor:[59,130,246],textColor:255},theme:"grid",margin:{left:b,right:b},columnStyles:{3:{cellWidth:180}},didDrawPage:()=>{const e="Generated: ".concat(l(new Date));p.setFont(f,"normal"),p.setFontSize(9),p.setTextColor(120),p.text(e,b,818);const a=p.getCurrentPageInfo().pageNumber||1,s=p.getNumberOfPages(),t="Page ".concat(a," of ").concat(s),n=p.getTextWidth(t);p.text(t,555-n,818)}}),p.save(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Manpower-Requests-Export";const a=new Date,s="_".concat(c(a.getHours())).concat(c(a.getMinutes()));return"".concat(e,"-").concat(s,".pdf")}())}},1509:(e,a,s)=>{s.r(a),s.d(a,{default:()=>d});var t=s(5043),n=s(3216),r=s(5475),i=(s(2660),s(64),s(411)),l=s(3204),c=s(8818),o=s(579);const d=()=>{const e=(0,n.Zp)(),a=(0,t.useRef)(null);if(null===a.current){const e=localStorage.getItem("user");a.current=e?JSON.parse(e):null}const s=a.current,[d,m]=(0,t.useState)([]),[u,h]=(0,t.useState)(!0),[p,j]=(0,t.useState)(""),[v,x]=(0,t.useState)("All"),[g,N]=(0,t.useState)(""),[f,w]=(0,t.useState)(1),[b,y]=(0,t.useState)("cards");(0,t.useEffect)((()=>{if(!s||"HR"!==s.role)return;let e=!0;return(async()=>{h(!0),j("");try{const{data:a}=await i.Ay.get("/manpower-requests");if(!e)return;m(Array.isArray(a)?a:[])}catch(a){if(!e)return;console.error("Failed to load manpower requests:",a),!a.response||401!==a.response.status&&403!==a.response.status?j("Failed to load manpower requests"):j("Session expired or unauthorized. Please login.")}finally{e&&(h(!1),w(1))}})(),()=>{e=!1}}),[s]);const S=(0,t.useMemo)((()=>{let e=d;if(e="All"!==v?"Archived"===v?e.filter((e=>(e.status||"Pending").toLowerCase().includes("archived"))):e.filter((e=>(e.status||"Pending").toLowerCase().includes(v.toLowerCase()))):e.filter((e=>!(e.status||"Pending").toLowerCase().includes("archived"))),g){const a=g.toLowerCase();e=e.filter((e=>{var s,t;const n=(null===(s=e.project)||void 0===s?void 0:s.projectName)||"",r=(null===(t=e.createdBy)||void 0===t?void 0:t.name)||"",i=(e.manpowers||[]).map((e=>"".concat(e.quantity," ").concat(e.type))).join(", ");return n.toLowerCase().includes(a)||r.toLowerCase().includes(a)||i.toLowerCase().includes(a)||(e.description||"").toLowerCase().includes(a)}))}return e}),[d,v,g]),A=Math.max(1,Math.ceil(S.length/8)),k=(0,t.useMemo)((()=>{const e=8*(f-1);return S.slice(e,e+8)}),[S,f]),C=(0,t.useMemo)((()=>{let e=0,a=0,s=0,t=0,n=0,r=0;return d.forEach((i=>{const l=(i.status||"Pending").toLowerCase(),c="pending"===l&&i.acquisitionDate&&new Date(i.acquisitionDate)<new Date;l.includes("archived")?r++:l.includes("completed")?s++:l.includes("approved")?a++:l.includes("reject")||l.includes("denied")||l.includes("cancel")?t++:c||l.includes("overdue")?n++:e++})),{total:d.length,pending:e,approved:a,rejected:t,overdue:n,completed:s,archived:r}}),[d]),D=(0,t.useMemo)((()=>({All:C.total-C.archived,Pending:C.pending,Overdue:C.overdue,Approved:C.approved,Completed:C.completed,Rejected:C.rejected,Archived:C.archived})),[C]);return s&&"HR"===s.role?(0,o.jsxs)("div",{className:"dashboard-container ceo-manpower-requests-page",children:[(0,o.jsx)(c.A,{roleSegment:"hr"}),(0,o.jsx)("main",{className:"dashboard-main",children:(0,o.jsxs)("div",{className:"page-container",children:[(0,o.jsxs)("div",{className:"dashboard-card ceo-mr-header-card",children:[(0,o.jsxs)("div",{className:"card-header mr-header-row",children:[(0,o.jsxs)("div",{className:"mr-header-texts",children:[(0,o.jsx)("h1",{className:"card-title",children:"Movement Tracking"}),(0,o.jsx)("p",{className:"card-subtitle",children:"Monitor and manage staff movements and transfers across projects"})]}),(0,o.jsx)("div",{className:"layout-toggle-wrapper",children:(0,o.jsx)("button",{onClick:()=>y((e=>"cards"===e?"table":"cards")),className:"btn-secondary toggle-layout-btn",children:"cards"===b?"Table View":"Card View"})})]}),(0,o.jsxs)("div",{className:"card-body mr-filters-row",children:[(0,o.jsx)("div",{className:"filter-tabs compact",children:["All","Pending","Overdue","Approved","Completed","Rejected","Archived"].map((e=>{var a;return(0,o.jsxs)("button",{className:"filter-tab ".concat(v===e?"active":""),onClick:()=>{x(e),w(1)},children:[(0,o.jsx)("span",{children:e}),(0,o.jsx)("span",{className:"count",children:null!==(a=D[e])&&void 0!==a?a:0})]},e)}))}),(0,o.jsxs)("div",{className:"search-wrapper stretch",children:[(0,o.jsx)(l.KSO,{className:"search-icon"}),(0,o.jsx)("input",{type:"text",placeholder:"Search requests...",value:g,onChange:e=>{N(e.target.value),w(1)},className:"search-input"})]})]})]}),(0,o.jsxs)("div",{className:"dashboard-card ceo-mr-summary-card",children:[(0,o.jsx)("div",{className:"card-header",children:(0,o.jsx)("h3",{className:"card-title-sm",children:"Summary"})}),(0,o.jsx)("div",{className:"mr-summary-grid",children:[{label:"Total",value:C.total,color:"#334155"},{label:"Pending",value:C.pending,color:"#f59e0b"},{label:"Overdue",value:C.overdue,color:"#d97706"},{label:"Approved",value:C.approved,color:"#10b981"},{label:"Completed",value:C.completed,color:"#059669"},{label:"Rejected",value:C.rejected,color:"#ef4444"},{label:"Archived",value:C.archived,color:"#8b5cf6"}].map((e=>(0,o.jsxs)("div",{className:"mr-summary-item",children:[(0,o.jsx)("span",{className:"mr-summary-label",children:e.label}),(0,o.jsx)("span",{className:"mr-summary-value",style:{color:e.color},children:e.value}),(0,o.jsx)("div",{className:"mr-summary-bar",style:{background:e.color}})]},e.label)))})]}),(0,o.jsxs)("div",{className:"dashboard-card ceo-mr-list-card",children:[(0,o.jsx)("div",{className:"card-header list-header",children:(0,o.jsxs)("h3",{className:"card-title-sm",children:["Requests ",(0,o.jsxs)("span",{className:"muted",children:["(",S.length,")"]})]})}),(0,o.jsx)("div",{className:"requests-grid ceo-mr-grid ".concat("table"===b?"table-view":""),children:u?(0,o.jsxs)("div",{className:"loading-state",children:[(0,o.jsx)("div",{className:"loading-spinner"}),(0,o.jsx)("p",{children:"Loading manpower requests..."})]}):p?(0,o.jsx)("div",{className:"error-state",children:(0,o.jsx)("p",{children:p})}):0===k.length?(0,o.jsxs)("div",{className:"empty-state",children:[(0,o.jsx)("div",{className:"empty-icon",children:"\ud83d\udc65"}),(0,o.jsx)("h3",{children:"No manpower requests found"}),(0,o.jsx)("p",{children:"No requests match your current filters. Try adjusting your search criteria."})]}):(0,o.jsxs)(o.Fragment,{children:["table"===b&&(0,o.jsxs)("div",{className:"mr-table-header",role:"row","aria-label":"Table Header",children:[(0,o.jsx)("div",{children:"Project"}),(0,o.jsx)("div",{children:"Requester"}),(0,o.jsx)("div",{children:"Description"}),(0,o.jsx)("div",{children:"Manpower"}),(0,o.jsx)("div",{children:"Target"}),(0,o.jsx)("div",{children:"Dur"}),(0,o.jsx)("div",{children:"Created"}),(0,o.jsx)("div",{children:"Status"})]}),k.map((a=>{var s,t,n,i;const l=(a.manpowers||[]).map((e=>"".concat(e.quantity," ").concat(e.type))).join(", "),c=(e=>{const a=(e.status||"Pending").toLowerCase();return"pending"===a&&e.acquisitionDate&&new Date(e.acquisitionDate)<new Date?"Overdue":a.includes("archived")?"Archived":a.includes("completed")?"Completed":a.includes("approved")?"Approved":a.includes("pending")?"Pending":a.includes("reject")||a.includes("denied")||a.includes("cancel")?"Rejected":a.includes("overdue")?"Overdue":"Unknown"})(a);(e=>{const a=(e.status||"Pending").toLowerCase();"pending"===a&&e.acquisitionDate&&new Date(e.acquisitionDate)<new Date||(a.includes("archived")||(a.includes("completed")||(a.includes("approved")||(a.includes("pending")||(a.includes("reject")||a.includes("denied")||a.includes("cancel")||a.includes("overdue"))))))})(a);var d,m,u,h;return"table"===b?(0,o.jsxs)("div",{className:"mr-table-row",role:"row",onClick:()=>e("/hr/manpower-request/".concat(a._id)),style:{cursor:"pointer"},title:"View details",children:[(0,o.jsx)("div",{className:"rt-title",title:(null===(d=a.project)||void 0===d?void 0:d.projectName)||"(No Project Name)",children:(null===(m=a.project)||void 0===m?void 0:m.projectName)||"(No Project Name)"}),(0,o.jsx)("div",{className:"rt-req",title:(null===(u=a.createdBy)||void 0===u?void 0:u.name)||"Unknown",children:(null===(h=a.createdBy)||void 0===h?void 0:h.name)||"Unknown"}),(0,o.jsx)("div",{className:"rt-desc",title:a.description||"No description",children:a.description||"No description"}),(0,o.jsx)("div",{className:"rt-man",title:l||"\u2014",children:l||"\u2014"}),(0,o.jsx)("div",{className:"rt-date",title:"Target Date",children:a.acquisitionDate?new Date(a.acquisitionDate).toLocaleDateString():"\u2014"}),(0,o.jsxs)("div",{className:"rt-date",title:"Duration",children:[a.duration||"\u2014","d"]}),(0,o.jsx)("div",{className:"rt-date",title:"Created",children:a.createdAt?new Date(a.createdAt).toLocaleDateString():"\u2014"}),(0,o.jsx)("div",{className:"rt-btn",children:(0,o.jsx)("span",{className:"status-chip ".concat(c.toLowerCase()),children:c})})]},a._id):(0,o.jsxs)("div",{className:"request-card ceo-mr-card",children:[(0,o.jsxs)("div",{className:"card-body",children:[(0,o.jsxs)("div",{className:"mr-card-top-row",children:[(0,o.jsx)("h3",{className:"request-title",title:(null===(s=a.project)||void 0===s?void 0:s.projectName)||"(No Project Name)",children:(null===(t=a.project)||void 0===t?void 0:t.projectName)||"(No Project Name)"}),(0,o.jsx)("span",{className:"status-chip ".concat(c.toLowerCase()),children:c})]}),(0,o.jsx)("p",{className:"request-description",title:a.description||"No description provided",children:a.description||"No description provided"}),(0,o.jsxs)("div",{className:"request-meta",children:[(0,o.jsxs)("div",{className:"meta-item",children:[(0,o.jsx)("span",{className:"meta-label",children:"Requested by:"}),(0,o.jsx)("span",{className:"meta-value",title:(null===(n=a.createdBy)||void 0===n?void 0:n.name)||"Unknown",children:(null===(i=a.createdBy)||void 0===i?void 0:i.name)||"Unknown"})]}),(0,o.jsxs)("div",{className:"meta-item",children:[(0,o.jsx)("span",{className:"meta-label",children:"Manpower:"}),(0,o.jsx)("span",{className:"meta-value",title:l||"\u2014",children:l||"\u2014"})]}),(0,o.jsxs)("div",{className:"meta-item",children:[(0,o.jsx)("span",{className:"meta-label",children:"Date:"}),(0,o.jsx)("span",{className:"meta-value",children:a.createdAt?new Date(a.createdAt).toLocaleDateString():"\u2014"})]}),(0,o.jsxs)("div",{className:"meta-item",children:[(0,o.jsx)("span",{className:"meta-label",children:"Target:"}),(0,o.jsx)("span",{className:"meta-value",children:a.acquisitionDate?new Date(a.acquisitionDate).toLocaleDateString():"\u2014"})]}),(0,o.jsxs)("div",{className:"meta-item",children:[(0,o.jsx)("span",{className:"meta-label",children:"Duration:"}),(0,o.jsxs)("span",{className:"meta-value",children:[a.duration||"\u2014"," d"]})]})]})]}),(0,o.jsx)("div",{className:"card-footer",children:(0,o.jsx)(r.N_,{to:"/hr/manpower-request/".concat(a._id),className:"view-details-btn",children:"View Details"})})]},a._id)}))]})}),S.length>0&&(0,o.jsxs)("div",{className:"pagination-section inside-card",children:[(0,o.jsxs)("div",{className:"pagination-info",children:["Showing ",8*(f-1)+1," to ",Math.min(8*f,S.length)," of ",S.length," entries"]}),(0,o.jsxs)("div",{className:"pagination-controls",children:[(0,o.jsx)("button",{onClick:()=>w((e=>Math.max(e-1,1))),disabled:1===f,className:"pagination-btn",children:"Previous"}),Array.from({length:A},((e,a)=>a+1)).map((e=>(0,o.jsx)("button",{className:"pagination-btn ".concat(e===f?"active":""),onClick:()=>w(e),children:e},e))),(0,o.jsx)("button",{onClick:()=>w((e=>Math.min(e+1,A))),disabled:f===A,className:"pagination-btn",children:"Next"})]})]})]})]})})]}):(0,o.jsxs)("div",{style:{padding:24},children:[(0,o.jsx)("h2",{children:"Forbidden"}),(0,o.jsx)("p",{children:"You must be an HR user to view this page."})]})}},2660:()=>{},4786:()=>{},6919:(e,a,s)=>{s.r(a),s.d(a,{default:()=>D});var t=s(9379),n=s(5043),r=s(5475),i=s(3216),l=s(8818),c=s(3986);const o=e=>{const a=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,((e,a,s)=>s?s.toUpperCase():a.toLowerCase())))(e);return a.charAt(0).toUpperCase()+a.slice(1)},d=function(){for(var e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return a.filter(((e,a,s)=>Boolean(e)&&""!==e.trim()&&s.indexOf(e)===a)).join(" ").trim()};var m={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const u=["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"],h=(0,n.forwardRef)(((e,a)=>{let{color:s="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:o="",children:h,iconNode:p}=e,j=(0,c.A)(e,u);return(0,n.createElement)("svg",(0,t.A)((0,t.A)((0,t.A)({ref:a},m),{},{width:r,height:r,stroke:s,strokeWidth:l?24*Number(i)/Number(r):i,className:d("lucide",o)},!h&&!(e=>{for(const a in e)if(a.startsWith("aria-")||"role"===a||"title"===a)return!0})(j)&&{"aria-hidden":"true"}),j),[...p.map((e=>{let[a,s]=e;return(0,n.createElement)(a,s)})),...Array.isArray(h)?h:[h]])})),p=["className"],j=(e,a)=>{const s=(0,n.forwardRef)(((s,r)=>{let{className:i}=s,l=(0,c.A)(s,p);return(0,n.createElement)(h,(0,t.A)({ref:r,iconNode:a,className:d("lucide-".concat((m=o(e),m.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase())),"lucide-".concat(e),i)},l));var m}));return s.displayName=o(e),s},v=j("upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),x=j("search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),g=j("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),N=j("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var f=s(411),w=s(5766),b=s.n(w),y=s(3204),S=s(579);const A=10;function k(e){var a;let{manpower:s,onReassignClick:t,onEditClick:n}=e;const i=s.currentLoan&&s.currentLoan.returnDate&&new Date(s.currentLoan.returnDate)>new Date,l="string"===typeof s.location?s.location:s.location&&s.location.name?s.location.name:"";return(0,S.jsxs)("tr",{className:"mp-row",children:[(0,S.jsxs)("td",{className:"col-emp",children:[(0,S.jsx)("div",{className:"emp-name",children:s.name}),(0,S.jsx)("div",{className:"emp-pos",children:s.position})]}),(0,S.jsx)("td",{className:"col-project",children:i?(0,S.jsxs)("div",{className:"loan-wrapper",children:[(0,S.jsx)("span",{className:"loan-project",children:s.currentLoan.projectName}),(0,S.jsxs)("span",{className:"loan-until",children:["Until ",new Date(s.currentLoan.returnDate).toLocaleDateString()]})]}):s.project?(0,S.jsxs)("div",{className:"project-wrapper",children:[(0,S.jsx)(r.N_,{to:"/hr/project-records/".concat((null===(a=s.assignedProject)||void 0===a?void 0:a._id)||s.assignedProject||""),className:"project-name project-link",onClick:e=>{s.assignedProject||e.preventDefault()},children:s.project}),l&&(0,S.jsx)("span",{className:"project-location",children:l})]}):(0,S.jsx)("span",{className:"project-name unassigned",children:"Unassigned"})}),(0,S.jsx)("td",{className:"col-actions",children:(0,S.jsxs)("div",{className:"manpower-actions",children:[(0,S.jsx)("button",{className:"action-btn reassign-btn",title:"Reassign to Project",onClick:()=>t(s),disabled:i,children:(0,S.jsx)(y.yd7,{})}),(0,S.jsx)("button",{className:"action-btn edit-btn",title:"Edit Manpower",onClick:()=>n(s),children:(0,S.jsx)(y.NPy,{})})]})})]})}function C(e){let{currentPage:a,totalPages:s,totalEntries:t,onPageChange:n,showingRange:r}=e;const i=[];if(s<=7)for(let l=1;l<=s;l++)i.push(l);else{i.push(1),a>3&&i.push("...");const e=Math.max(2,a-1),t=Math.min(s-1,a+1);for(let a=e;a<=t;a++)i.push(a);a<s-2&&i.push("..."),i.push(s)}return(0,S.jsxs)("div",{className:"pagination-wrapper",children:[(0,S.jsxs)("span",{className:"pagination-info",children:["Showing ",r.start," to ",r.end," of ",t," entries"]}),(0,S.jsxs)("div",{className:"pagination",children:[(0,S.jsx)("button",{className:"pagination-btn",onClick:()=>n(a-1),disabled:1===a,children:"<"}),i.map(((e,s)=>(0,S.jsx)("button",{className:"pagination-btn ".concat(e===a?"active":""," ").concat("..."===e?"dots":""),disabled:"..."===e,onClick:()=>"number"===typeof e&&n(e),children:e},s))),(0,S.jsx)("button",{className:"pagination-btn",onClick:()=>n(a+1),disabled:a===s,children:">"})]})]})}function D(){const[e,a]=(0,n.useState)([]),[s,r]=(0,n.useState)(!0),[c,o]=(0,n.useState)(null),[d,m]=(0,n.useState)(1),[u,h]=(0,n.useState)(""),[p,j]=(0,n.useState)("all"),[w,D]=(0,n.useState)("none"),[q,P]=(0,n.useState)(!1),[L,R]=(0,n.useState)(null),[M,E]=(0,n.useState)(null),[B,_]=(0,n.useState)({name:"",position:""}),[T,F]=(0,n.useState)(!1),[I,z]=(0,n.useState)([]),[U,O]=(0,n.useState)(!1),V=(0,n.useRef)(null),W=(0,i.Zp)(),[H,J]=(0,n.useState)((()=>{const e=localStorage.getItem("user");return e?JSON.parse(e):null})),[X,Z]=(0,n.useState)((()=>localStorage.getItem("token")||"")),[Y,G]=(0,n.useState)((()=>null===H||void 0===H?void 0:H._id)),[$,K]=(0,n.useState)((null===H||void 0===H?void 0:H.name)||"HR Manager"),[Q,ee]=(0,n.useState)((null===H||void 0===H?void 0:H.role)||"");(0,n.useEffect)((()=>{const e=()=>{const e=localStorage.getItem("user");J(e?JSON.parse(e):null),G(e?JSON.parse(e)._id:void 0),Z(localStorage.getItem("token")||"")};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}),[]),(0,n.useEffect)((()=>{K((null===H||void 0===H?void 0:H.name)||"HR Manager"),ee((null===H||void 0===H?void 0:H.role)||"")}),[H]),(0,n.useEffect)((()=>{X&&Y||W("/")}),[X,Y,W]),(0,n.useEffect)((()=>{X&&(async()=>{try{r(!0);const{data:e}=await f.Ay.get("/manpower",{headers:{Authorization:"Bearer ".concat(X)}}),{data:s}=await f.Ay.get("/manpower-requests",{headers:{Authorization:"Bearer ".concat(X)}}),n=e.map((e=>{var a;const n=s.find((a=>a.manpowerProvided&&a.manpowerProvided.includes(e._id)&&a.returnDate&&new Date(a.returnDate)>new Date&&"Approved"===a.status));return(0,t.A)((0,t.A)({},e),{},{currentLoan:n?{projectName:(null===(a=n.project)||void 0===a?void 0:a.projectName)||"Unknown Project",returnDate:n.returnDate,requestId:n._id}:null})}));a(n),o(null)}catch(e){console.error("Error fetching manpower:",e),o("Failed to load manpower data"),a([])}finally{r(!1)}})()}),[X]),(0,n.useEffect)((()=>{X&&(async()=>{try{const{data:e}=await f.Ay.get("/projects",{headers:{Authorization:"Bearer ".concat(X)}});z(e)}catch(e){console.error("Error fetching projects:",e)}})()}),[X]);const ae=e=>{R(e),P(!0)};(0,n.useEffect)((()=>{M&&_({name:M.name||"",position:M.position||""})}),[M]);const se=e=>{const{name:a,value:s}=e.target;_((e=>(0,t.A)((0,t.A)({},e),{},{[a]:s})))},te=async e=>{if(L&&e){O(!0);try{await f.Ay.put("/manpower/".concat(L._id),{assignedProject:"unassign"===e?null:e},{headers:{Authorization:"Bearer ".concat(X)}});const s=I.find((a=>a._id===e));await f.Ay.post("/audit-logs",{action:"MANPOWER_REASSIGNED",performedBy:Y,performedByRole:Q,description:"Reassigned ".concat(L.name," ").concat("unassign"===e?"to unassigned":"to ".concat((null===s||void 0===s?void 0:s.projectName)||"unknown project")),meta:{manpowerId:L._id,manpowerName:L.name,previousProject:L.assignedProject,newProject:"unassign"===e?null:e}},{headers:{Authorization:"Bearer ".concat(X)}});const n=async()=>{try{r(!0);const{data:e}=await f.Ay.get("/manpower",{headers:{Authorization:"Bearer ".concat(X)}}),{data:s}=await f.Ay.get("/manpower-requests",{headers:{Authorization:"Bearer ".concat(X)}}),n=e.map((e=>{var a;const n=s.find((a=>a.manpowerProvided&&a.manpowerProvided.includes(e._id)&&a.returnDate&&new Date(a.returnDate)>new Date&&"Approved"===a.status));return(0,t.A)((0,t.A)({},e),{},{currentLoan:n?{projectName:(null===(a=n.project)||void 0===a?void 0:a.projectName)||"Unknown Project",returnDate:n.returnDate,requestId:n._id}:null})}));a(n),o(null)}catch(e){console.error("Error fetching manpower:",e),o("Failed to load manpower data"),a([])}finally{r(!1)}};await n(),P(!1),R(null)}catch(s){console.error("Error reassigning manpower:",s),alert("Failed to reassign manpower. Please try again.")}finally{O(!1)}}},ne=(0,n.useMemo)((()=>{let a=e;return u&&(a=a.filter((e=>{var a,s,t,n;return(null===(a=e.name)||void 0===a?void 0:a.toLowerCase().includes(u.toLowerCase()))||(null===(s=e.position)||void 0===s?void 0:s.toLowerCase().includes(u.toLowerCase()))||(null===(t=e.employeeId)||void 0===t?void 0:t.toLowerCase().includes(u.toLowerCase()))||(null===(n=e.project)||void 0===n?void 0:n.toLowerCase().includes(u.toLowerCase()))}))),"all"!==p&&(a=a.filter((e=>{var a;return(null===(a=e.position)||void 0===a?void 0:a.toLowerCase())===p.toLowerCase()}))),"none"!==w&&(a=[...a].sort(((e,a)=>{const s=!!e.assignedProject,t=!!a.assignedProject;return"assignedFirst"===w?s===t?0:s?-1:1:"unassignedFirst"===w?s===t?0:s?1:-1:0}))),a}),[e,u,p,w]),re=Math.ceil(ne.length/A),ie=(d-1)*A,le=ie+A,ce=ne.slice(ie,le),oe={start:ne.length>0?ie+1:0,end:Math.min(le,ne.length)},de=(0,n.useMemo)((()=>[...new Set(e.map((e=>e.position)).filter(Boolean))].sort()),[e]),me=(0,n.useMemo)((()=>{const a={assigned:0,unassigned:0,total:e.length};return e.forEach((e=>{e.assignedProject?a.assigned++:a.unassigned++})),a}),[e]);return(0,S.jsxs)("div",{className:"dashboard-container",children:[(0,S.jsx)(l.A,{roleSegment:"hr",onLogout:()=>{f.Ay.post("/auth/logout",{},{headers:{Authorization:"Bearer ".concat(X)}}).finally((()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),J(null),G(void 0),Z(""),window.dispatchEvent(new Event("storage")),W("/")}))},overrideNav:[{to:"/hr/dash",label:"Dashboard",icon:(0,S.jsx)(y.$BV,{}),match:"/hr/dash"},{to:"/hr/chat",label:"Chat",icon:(0,S.jsx)(y.uN,{}),match:"/hr/chat"},{to:"/hr/mlist",label:"Manpower",icon:(0,S.jsx)(y.YXz,{}),match:"/hr/mlist"},{to:"/hr/movement",label:"Movement",icon:(0,S.jsx)(y.yk7,{}),match:"/hr/movement"},{to:"/hr/project-records",label:"Projects",icon:(0,S.jsx)(y.yd7,{}),match:"/hr/project-records"},{to:"/hr/attendance",label:"Attendance",icon:(0,S.jsx)(y.bfZ,{}),match:"/hr/attendance"}]}),(0,S.jsx)("main",{className:"dashboard-main",children:(0,S.jsxs)("div",{className:"manpower-container",children:[(0,S.jsxs)("div",{className:"page-header",children:[(0,S.jsxs)("div",{className:"page-title-section",children:[(0,S.jsx)("h1",{className:"page-title",children:"Manpower Management"}),(0,S.jsx)("p",{className:"page-subtitle",children:"Manage and track all staff members across projects"})]}),(0,S.jsxs)("div",{className:"page-actions",children:[(0,S.jsxs)("button",{className:"action-button secondary",onClick:()=>{var e;return null===(e=V.current)||void 0===e?void 0:e.click()},children:[(0,S.jsx)(v,{}),(0,S.jsx)("span",{children:"Import CSV"})]}),(0,S.jsx)("input",{ref:V,type:"file",accept:".csv",onChange:e=>{const a=e.target.files[0];a&&b().parse(a,{header:!0,skipEmptyLines:!0,complete:async function(e){const a=e.data,s=e.errors;if(s.length>0)return void alert("CSV Upload Error: ".concat(s[0].message));if(0===a.length)return void alert("No data found in CSV file.");const t=[],n=[];if(a.forEach((e=>{const a=e.Name||e.name||"",s=e.Position||e.position||"",r=e.Status||e.status||"Active",i=e.Project||e.project||"";a&&s?t.push({name:a,position:s,status:r,project:i,location:"",employeeId:"",assignedProject:i,currentLoan:null}):n.push(e)})),n.length>0&&alert("Skipped ".concat(n.length," rows due to missing 'Name' or 'Position':\n").concat(n.map((e=>JSON.stringify(e))).join("\n"))),t.length>0){r(!0),o(null);try{const e=[];for(const a of t){const{data:s}=await f.Ay.post("/manpower",{name:a.name,position:a.position,status:a.status||"Active",assignedProject:null},{headers:{Authorization:"Bearer ".concat(X)}});e.push(s)}alert("Successfully imported ".concat(e.length," manpowers.")),window.location.reload()}catch(i){console.error("Error importing manpowers:",i),o("Failed to import manpowers. Please try again.")}finally{r(!1)}}else alert("No valid manpower data found in CSV file.")},error:function(e){console.error("CSV Parsing Error:",e),alert("Error parsing CSV file. Please ensure it is a valid CSV and try again.")}})},style:{display:"none"}}),(0,S.jsx)("button",{className:"action-button info",onClick:()=>alert('CSV Format:\n\nRequired columns:\n- Name (required)\n- Position (required)\n\nOptional columns:\n- Status (defaults to "Active" if empty)\n- Project (defaults to "Unassigned" if empty)\n\nExample:\nName,Position,Status,Project\nJohn Doe,Engineer,Active,Project A\nJane Smith,Manager,,Project B'),style:{marginLeft:"10px",backgroundColor:"#17a2b8",borderColor:"#17a2b8"},children:(0,S.jsx)("span",{children:"CSV Format"})})]})]}),(0,S.jsxs)("div",{className:"stats-overview",children:[(0,S.jsxs)("div",{className:"stat-card total",children:[(0,S.jsx)("div",{className:"stat-icon",children:(0,S.jsx)(y.YXz,{})}),(0,S.jsxs)("div",{className:"stat-content",children:[(0,S.jsx)("span",{className:"stat-value",children:me.total}),(0,S.jsx)("span",{className:"stat-label",children:"Total Manpower"})]})]}),(0,S.jsxs)("div",{className:"stat-card active",children:[(0,S.jsx)("div",{className:"stat-icon",children:(0,S.jsx)(y.BAG,{})}),(0,S.jsxs)("div",{className:"stat-content",children:[(0,S.jsx)("span",{className:"stat-value",children:me.assigned}),(0,S.jsx)("span",{className:"stat-label",children:"Assigned"})]})]}),(0,S.jsxs)("div",{className:"stat-card inactive",children:[(0,S.jsx)("div",{className:"stat-icon",children:(0,S.jsx)(y.NPF,{})}),(0,S.jsxs)("div",{className:"stat-content",children:[(0,S.jsx)("span",{className:"stat-value",children:me.unassigned}),(0,S.jsx)("span",{className:"stat-label",children:"Unassigned"})]})]})]}),(0,S.jsxs)("div",{className:"filters-section",children:[(0,S.jsxs)("div",{className:"search-box",children:[(0,S.jsx)(x,{className:"search-icon"}),(0,S.jsx)("input",{type:"text",placeholder:"Search by name, position, ID, or project...",value:u,onChange:e=>h(e.target.value),className:"search-input"})]}),(0,S.jsxs)("div",{className:"filter-controls",children:[(0,S.jsxs)("select",{value:p,onChange:e=>j(e.target.value),className:"filter-select",children:[(0,S.jsx)("option",{value:"all",children:"All Positions"}),de.map((e=>(0,S.jsx)("option",{value:e,children:e},e)))]}),(0,S.jsxs)("select",{value:w,onChange:e=>D(e.target.value),className:"filter-select",style:{minWidth:"150px"},children:[(0,S.jsx)("option",{value:"none",children:"No Sort"}),(0,S.jsx)("option",{value:"assignedFirst",children:"Assigned First"}),(0,S.jsx)("option",{value:"unassignedFirst",children:"Unassigned First"})]}),(0,S.jsx)("button",{className:"refresh-btn",onClick:()=>window.location.reload(),children:(0,S.jsx)(g,{})})]})]}),(0,S.jsx)("div",{className:"manpower-list-container",children:s?(0,S.jsxs)("div",{className:"loading-state",children:[(0,S.jsx)("div",{className:"loading-spinner"}),(0,S.jsx)("span",{children:"Loading manpower data..."})]}):c?(0,S.jsxs)("div",{className:"error-state",children:[(0,S.jsx)(y.BS8,{}),(0,S.jsx)("span",{children:c})]}):0===ce.length?(0,S.jsxs)("div",{className:"empty-state",children:[(0,S.jsx)(y.YXz,{}),(0,S.jsx)("span",{children:"No manpower found matching your criteria"})]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:"manpower-table-wrapper",children:(0,S.jsxs)("table",{className:"manpower-table",children:[(0,S.jsx)("thead",{children:(0,S.jsxs)("tr",{children:[(0,S.jsx)("th",{children:"Employee"}),(0,S.jsx)("th",{children:"Project / Loan"}),(0,S.jsx)("th",{style:{textAlign:"center"},children:"Actions"})]})}),(0,S.jsx)("tbody",{children:ce.map((e=>(0,S.jsx)(k,{manpower:e,onReassignClick:ae,onEditClick:E},e._id)))})]})}),(0,S.jsx)(C,{currentPage:d,totalPages:re,totalEntries:ne.length,onPageChange:e=>{m(e),window.scrollTo({top:0,behavior:"smooth"})},showingRange:oe})]})})]})}),q&&L&&(0,S.jsx)("div",{className:"reassign-modal-overlay",onClick:()=>P(!1),children:(0,S.jsxs)("div",{className:"reassign-modal",onClick:e=>e.stopPropagation(),children:[(0,S.jsxs)("div",{className:"reassign-modal-header",children:[(0,S.jsxs)("h3",{children:["Reassign ",L.name]}),(0,S.jsx)("button",{className:"reassign-modal-close",onClick:()=>P(!1),children:(0,S.jsx)(N,{size:20})})]}),(0,S.jsxs)("div",{className:"reassign-modal-content",children:[(0,S.jsxs)("div",{className:"current-assignment",children:[(0,S.jsx)("h4",{children:"Current Assignment:"}),(0,S.jsx)("p",{children:L.project||"Unassigned"}),(()=>{const e=L.location,a="string"===typeof e?e:e&&e.name?e.name:"";return a?(0,S.jsxs)("p",{className:"location",children:["Location: ",a]}):null})()]}),(0,S.jsxs)("div",{className:"new-assignment",children:[(0,S.jsx)("h4",{children:"Select New Project:"}),(0,S.jsxs)("div",{className:"project-options",children:[(0,S.jsx)("button",{className:"project-option unassign",onClick:()=>te("unassign"),disabled:U,children:(0,S.jsxs)("div",{className:"project-info",children:[(0,S.jsx)("span",{className:"project-name",children:"Unassign"}),(0,S.jsx)("span",{className:"project-description",children:"Remove from current project"})]})}),I.map((e=>(0,S.jsx)("button",{className:"project-option ".concat(L.assignedProject===e._id?"current":""),onClick:()=>te(e._id),disabled:U||L.assignedProject===e._id,children:(0,S.jsxs)("div",{className:"project-info",children:[(0,S.jsx)("span",{className:"project-name",children:e.projectName}),(0,S.jsx)("span",{className:"project-description",children:("string"===typeof e.location?e.location:e.location&&e.location.name?e.location.name:"No location specified")||"No location specified"}),L.assignedProject===e._id&&(0,S.jsx)("span",{className:"current-badge",children:"Current"})]})},e._id)))]})]}),U&&(0,S.jsxs)("div",{className:"reassigning-indicator",children:[(0,S.jsx)("div",{className:"loading-spinner"}),(0,S.jsx)("span",{children:"Reassigning..."})]})]})]})}),M&&(0,S.jsx)("div",{className:"reassign-modal-overlay",onClick:()=>!T&&E(null),children:(0,S.jsxs)("div",{className:"reassign-modal",onClick:e=>e.stopPropagation(),children:[(0,S.jsxs)("div",{className:"reassign-modal-header",children:[(0,S.jsxs)("h3",{children:["Edit ",M.name]}),(0,S.jsx)("button",{className:"reassign-modal-close",onClick:()=>!T&&E(null),children:(0,S.jsx)(N,{size:20})})]}),(0,S.jsxs)("div",{className:"reassign-modal-content",children:[(0,S.jsxs)("div",{className:"current-assignment",style:{marginBottom:"1rem"},children:[(0,S.jsx)("h4",{children:"Details"}),(0,S.jsxs)("div",{className:"edit-field-group",children:[(0,S.jsx)("label",{children:"Name"}),(0,S.jsx)("input",{name:"name",value:B.name,onChange:se})]}),(0,S.jsxs)("div",{className:"edit-field-group",children:[(0,S.jsx)("label",{children:"Position"}),(0,S.jsx)("input",{name:"position",value:B.position,onChange:se})]})]}),(0,S.jsxs)("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[(0,S.jsx)("button",{className:"action-button secondary",disabled:T,onClick:()=>E(null),children:"Cancel"}),(0,S.jsx)("button",{className:"action-button primary",disabled:T,onClick:async()=>{if(M)if(B.name.trim()&&B.position.trim()){F(!0);try{await f.Ay.put("/manpower/".concat(M._id),{name:B.name.trim(),position:B.position.trim()},{headers:{Authorization:"Bearer ".concat(X)}}),a((e=>e.map((e=>e._id===M._id?(0,t.A)((0,t.A)({},e),B):e)))),E(null)}catch(e){console.error("Edit manpower failed:",e),alert("Failed to save changes")}finally{F(!1)}}else alert("Name and Position are required")},children:T?"Saving...":"Save Changes"})]})]})]})})]})}},7352:(e,a,s)=>{s.r(a),s.d(a,{default:()=>i});s(5043);var t=s(1245),n=s(3216),r=s(579);function i(){const{id:e}=(0,n.g)(),a={"View Project":"/hr/project-records/".concat(e),Reports:"/hr/progress-report/".concat(e)};return(0,r.jsx)(t.A,{role:"hr",navPathOverrides:a,useUnifiedHeader:!0})}},7876:(e,a,s)=>{s.r(a),s.d(a,{default:()=>m});var t=s(5043),n=s(3216),r=s(5475),i=(s(2660),s(64),s(411)),l=s(3204),c=s(8818),o=s(1301),d=s(579);const m=()=>{const e=(0,n.Zp)(),a=(0,t.useRef)(null);if(null===a.current){const e=localStorage.getItem("user");a.current=e?JSON.parse(e):null}const s=a.current,[m,u]=(0,t.useState)([]),[h,p]=(0,t.useState)(!0),[j,v]=(0,t.useState)(""),[x,g]=(0,t.useState)("All"),[N,f]=(0,t.useState)(""),[w,b]=(0,t.useState)(1),[y,S]=(0,t.useState)("cards"),[A,k]=(0,t.useState)("mine"),[C,D]=(0,t.useState)(!1);(0,t.useEffect)((()=>{if(!s||"HR"!==s.role)return;let e=!0;return(async()=>{p(!0),v("");try{if("mine"===A){const{data:a}=await i.Ay.get("/manpower-requests/mine");if(!e)return;u(Array.isArray(a)?a:[])}else{const{data:a}=await i.Ay.get("/manpower-requests/hr");if(!e)return;const t=(Array.isArray(a)?a:[]).filter((e=>{var a,t,n,r;const i=(null===(a=e.createdBy)||void 0===a?void 0:a._id)||(null===(t=e.createdBy)||void 0===t?void 0:t.id)||e.createdBy,l="completed"===(null===(n=e.status)||void 0===n?void 0:n.toLowerCase());"pending"===(null===(r=e.status)||void 0===r?void 0:r.toLowerCase())&&e.acquisitionDate&&(new Date(e.acquisitionDate),new Date);return!s._id||i&&i!==s._id&&!l}));u(t)}}catch(a){if(!e)return;console.error("Failed to load manpower requests:",a),!a.response||401!==a.response.status&&403!==a.response.status?v("Failed to load manpower requests"):v("Session expired or unauthorized. Please login.")}finally{e&&(p(!1),b(1))}})(),()=>{e=!1}}),[s,A]);const q=(0,t.useMemo)((()=>{let e=m;if(e="All"!==x?"Archived"===x?e.filter((e=>(e.status||"Pending").toLowerCase().includes("archived"))):e.filter((e=>(e.status||"Pending").toLowerCase().includes(x.toLowerCase()))):e.filter((e=>!(e.status||"Pending").toLowerCase().includes("archived"))),N){const a=N.toLowerCase();e=e.filter((e=>{var s,t;const n=(null===(s=e.project)||void 0===s?void 0:s.projectName)||"",r=(null===(t=e.createdBy)||void 0===t?void 0:t.name)||"",i=(e.manpowers||[]).map((e=>"".concat(e.quantity," ").concat(e.type))).join(", ");return n.toLowerCase().includes(a)||r.toLowerCase().includes(a)||i.toLowerCase().includes(a)||(e.description||"").toLowerCase().includes(a)}))}return e}),[m,x,N]),P=Math.max(1,Math.ceil(q.length/8)),L=(0,t.useMemo)((()=>{const e=8*(w-1);return q.slice(e,e+8)}),[q,w]),R=(0,t.useMemo)((()=>{let e=0,a=0,s=0,t=0,n=0,r=0;return m.forEach((i=>{const l=(i.status||"Pending").toLowerCase(),c="pending"===l&&i.acquisitionDate&&new Date(i.acquisitionDate)<new Date;l.includes("archived")?r++:l.includes("completed")?s++:l.includes("approved")?a++:l.includes("reject")||l.includes("denied")||l.includes("cancel")?t++:c||l.includes("overdue")?n++:e++})),{total:m.length,pending:e,approved:a,rejected:t,overdue:n,completed:s,archived:r}}),[m]),M=(0,t.useMemo)((()=>({All:R.total-R.archived,Pending:R.pending,Overdue:R.overdue,Approved:R.approved,Completed:R.completed,Rejected:R.rejected,Archived:R.archived})),[R]);return s&&"HR"===s.role?(0,d.jsxs)("div",{className:"dashboard-container ceo-manpower-requests-page",children:[(0,d.jsx)(c.A,{roleSegment:"hr"}),(0,d.jsx)("main",{className:"dashboard-main",children:(0,d.jsxs)("div",{className:"page-container",children:[(0,d.jsxs)("div",{className:"dashboard-card ceo-mr-header-card",children:[(0,d.jsxs)("div",{className:"card-header mr-header-row",children:[(0,d.jsxs)("div",{className:"mr-header-texts",children:[(0,d.jsx)("h1",{className:"card-title",children:"Manpower Movement"}),(0,d.jsx)("p",{className:"card-subtitle",children:"Manage and track manpower requests across all projects"})]}),(0,d.jsx)("div",{className:"layout-toggle-wrapper",children:(0,d.jsx)("button",{onClick:()=>S((e=>"cards"===e?"table":"cards")),className:"btn-secondary toggle-layout-btn",children:"cards"===y?"Table View":"Card View"})})]}),(0,d.jsxs)("div",{className:"card-body mr-filters-row",children:[(0,d.jsx)("div",{className:"filter-tabs compact",children:["All","Pending","Overdue","Approved","Completed","Rejected","Archived"].map((e=>{var a;return(0,d.jsxs)("button",{className:"filter-tab ".concat(x===e?"active":""),onClick:()=>{g(e),b(1)},children:[(0,d.jsx)("span",{children:e}),(0,d.jsx)("span",{className:"count",children:null!==(a=M[e])&&void 0!==a?a:0})]},e)}))}),(0,d.jsxs)("div",{className:"search-wrapper stretch",children:[(0,d.jsx)(l.KSO,{className:"search-icon"}),(0,d.jsx)("input",{type:"text",placeholder:"Search requests...",value:N,onChange:e=>{f(e.target.value),b(1)},className:"search-input"})]}),(0,d.jsxs)("button",{onClick:async()=>{try{D(!0),await(0,o.k)(q,{companyName:"FadzTrack",logoPath:"".concat("","/images/Fadz-logo.png"),exporterName:(null===s||void 0===s?void 0:s.name)||"Unknown",exporterRole:(null===s||void 0===s?void 0:s.role)||"",filters:{status:x,searchTerm:N}})}catch(j){console.error("Export failed:",j),alert("Failed to export PDF")}finally{D(!1)}},disabled:C||0===q.length,className:"btn-primary export-btn",style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",minWidth:"auto"},children:[(0,d.jsx)(l.WCW,{}),C?"Exporting...":"Export PDF"]})]})]}),(0,d.jsx)("div",{className:"dashboard-card ceo-mr-header-card",style:{marginTop:"1rem"},children:(0,d.jsx)("div",{className:"card-body",children:(0,d.jsxs)("div",{className:"request-type-filter",style:{display:"flex",gap:"1rem",alignItems:"center"},children:[(0,d.jsx)("span",{style:{fontWeight:"500",color:"#374151"},children:"View:"}),(0,d.jsx)("button",{className:"type-filter-btn ".concat("mine"===A?"active":""),onClick:()=>k("mine"),style:{padding:"8px 16px",border:"1px solid #d1d5db",borderRadius:"6px",background:"mine"===A?"#3b82f6":"#ffffff",color:"mine"===A?"#ffffff":"#374151",cursor:"pointer",fontWeight:"500"},children:"My Requests"}),(0,d.jsx)("button",{className:"type-filter-btn ".concat("others"===A?"active":""),onClick:()=>k("others"),style:{padding:"8px 16px",border:"1px solid #d1d5db",borderRadius:"6px",background:"others"===A?"#3b82f6":"#ffffff",color:"others"===A?"#ffffff":"#374151",cursor:"pointer",fontWeight:"500"},children:"Others' Requests"}),(0,d.jsxs)("button",{onClick:()=>e("/hr/request-manpower"),className:"btn-primary",style:{marginLeft:"auto",padding:"8px 16px",background:"#10b981",color:"#ffffff",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"500",display:"flex",alignItems:"center",gap:"8px"},children:[(0,d.jsx)("span",{children:"+"}),(0,d.jsx)("span",{children:"Request Manpower"})]})]})})}),(0,d.jsxs)("div",{className:"dashboard-card ceo-mr-summary-card",children:[(0,d.jsx)("div",{className:"card-header",children:(0,d.jsx)("h3",{className:"card-title-sm",children:"Summary"})}),(0,d.jsx)("div",{className:"mr-summary-grid",children:[{label:"Total",value:R.total,color:"#334155"},{label:"Pending",value:R.pending,color:"#f59e0b"},{label:"Overdue",value:R.overdue,color:"#d97706"},{label:"Approved",value:R.approved,color:"#10b981"},{label:"Completed",value:R.completed,color:"#059669"},{label:"Rejected",value:R.rejected,color:"#ef4444"},{label:"Archived",value:R.archived,color:"#8b5cf6"}].map((e=>(0,d.jsxs)("div",{className:"mr-summary-item",children:[(0,d.jsx)("span",{className:"mr-summary-label",children:e.label}),(0,d.jsx)("span",{className:"mr-summary-value",style:{color:e.color},children:e.value}),(0,d.jsx)("div",{className:"mr-summary-bar",style:{background:e.color}})]},e.label)))})]}),(0,d.jsxs)("div",{className:"dashboard-card ceo-mr-list-card",children:[(0,d.jsx)("div",{className:"card-header list-header",children:(0,d.jsxs)("h3",{className:"card-title-sm",children:["Requests ",(0,d.jsxs)("span",{className:"muted",children:["(",q.length,")"]})]})}),(0,d.jsx)("div",{className:"requests-grid ceo-mr-grid ".concat("table"===y?"table-view":""),children:h?(0,d.jsxs)("div",{className:"loading-state",children:[(0,d.jsx)("div",{className:"loading-spinner"}),(0,d.jsx)("p",{children:"Loading manpower requests..."})]}):j?(0,d.jsx)("div",{className:"error-state",children:(0,d.jsx)("p",{children:j})}):0===L.length?(0,d.jsxs)("div",{className:"empty-state",children:[(0,d.jsx)("div",{className:"empty-icon",children:"\ud83d\udc65"}),(0,d.jsx)("h3",{children:"No manpower requests found"}),(0,d.jsx)("p",{children:"No requests match your current filters. Try adjusting your search criteria."})]}):(0,d.jsxs)(d.Fragment,{children:["table"===y&&(0,d.jsxs)("div",{className:"mr-table-header",role:"row","aria-label":"Table Header",children:[(0,d.jsx)("div",{children:"Project"}),(0,d.jsx)("div",{children:"Requester"}),(0,d.jsx)("div",{children:"Description"}),(0,d.jsx)("div",{children:"Manpower"}),(0,d.jsx)("div",{children:"Target"}),(0,d.jsx)("div",{children:"Dur"}),(0,d.jsx)("div",{children:"Created"}),(0,d.jsx)("div",{children:"Status"})]}),L.map((a=>{var s,t,n,i;const l=(a.manpowers||[]).map((e=>"".concat(e.quantity," ").concat(e.type))).join(", "),c=(e=>{const a=(e.status||"Pending").toLowerCase();return"pending"===a&&e.acquisitionDate&&new Date(e.acquisitionDate)<new Date?"Overdue":a.includes("archived")?"Archived":a.includes("completed")?"Completed":a.includes("approved")?"Approved":a.includes("pending")?"Pending":a.includes("reject")||a.includes("denied")||a.includes("cancel")?"Rejected":a.includes("overdue")?"Overdue":"Unknown"})(a);(e=>{const a=(e.status||"Pending").toLowerCase();"pending"===a&&e.acquisitionDate&&new Date(e.acquisitionDate)<new Date||(a.includes("archived")||(a.includes("completed")||(a.includes("approved")||(a.includes("pending")||(a.includes("reject")||a.includes("denied")||a.includes("cancel")||a.includes("overdue"))))))})(a);var o,m,u,h;return"table"===y?(0,d.jsxs)("div",{className:"mr-table-row",role:"row",onClick:()=>e("/hr/manpower-request/".concat(a._id)),style:{cursor:"pointer"},title:"View details",children:[(0,d.jsx)("div",{className:"rt-title",title:(null===(o=a.project)||void 0===o?void 0:o.projectName)||"(No Project Name)",children:(null===(m=a.project)||void 0===m?void 0:m.projectName)||"(No Project Name)"}),(0,d.jsx)("div",{className:"rt-req",title:(null===(u=a.createdBy)||void 0===u?void 0:u.name)||"Unknown",children:(null===(h=a.createdBy)||void 0===h?void 0:h.name)||"Unknown"}),(0,d.jsx)("div",{className:"rt-desc",title:a.description||"No description",children:a.description||"No description"}),(0,d.jsx)("div",{className:"rt-man",title:l||"\u2014",children:l||"\u2014"}),(0,d.jsx)("div",{className:"rt-date",title:"Target Date",children:a.acquisitionDate?new Date(a.acquisitionDate).toLocaleDateString():"\u2014"}),(0,d.jsxs)("div",{className:"rt-date",title:"Duration",children:[a.duration||"\u2014","d"]}),(0,d.jsx)("div",{className:"rt-date",title:"Created",children:a.createdAt?new Date(a.createdAt).toLocaleDateString():"\u2014"}),(0,d.jsx)("div",{className:"rt-btn",children:(0,d.jsx)("span",{className:"status-chip ".concat(c.toLowerCase()),children:c})})]},a._id):(0,d.jsxs)("div",{className:"request-card ceo-mr-card",children:[(0,d.jsxs)("div",{className:"card-body",children:[(0,d.jsxs)("div",{className:"mr-card-top-row",children:[(0,d.jsx)("h3",{className:"request-title",title:(null===(s=a.project)||void 0===s?void 0:s.projectName)||"(No Project Name)",children:(null===(t=a.project)||void 0===t?void 0:t.projectName)||"(No Project Name)"}),(0,d.jsx)("span",{className:"status-chip ".concat(c.toLowerCase()),children:c})]}),(0,d.jsx)("p",{className:"request-description",title:a.description||"No description provided",children:a.description||"No description provided"}),(0,d.jsxs)("div",{className:"request-meta",children:[(0,d.jsxs)("div",{className:"meta-item",children:[(0,d.jsx)("span",{className:"meta-label",children:"Requested by:"}),(0,d.jsx)("span",{className:"meta-value",title:(null===(n=a.createdBy)||void 0===n?void 0:n.name)||"Unknown",children:(null===(i=a.createdBy)||void 0===i?void 0:i.name)||"Unknown"})]}),(0,d.jsxs)("div",{className:"meta-item",children:[(0,d.jsx)("span",{className:"meta-label",children:"Manpower:"}),(0,d.jsx)("span",{className:"meta-value",title:l||"\u2014",children:l||"\u2014"})]}),(0,d.jsxs)("div",{className:"meta-item",children:[(0,d.jsx)("span",{className:"meta-label",children:"Date:"}),(0,d.jsx)("span",{className:"meta-value",children:a.createdAt?new Date(a.createdAt).toLocaleDateString():"\u2014"})]}),(0,d.jsxs)("div",{className:"meta-item",children:[(0,d.jsx)("span",{className:"meta-label",children:"Target:"}),(0,d.jsx)("span",{className:"meta-value",children:a.acquisitionDate?new Date(a.acquisitionDate).toLocaleDateString():"\u2014"})]}),(0,d.jsxs)("div",{className:"meta-item",children:[(0,d.jsx)("span",{className:"meta-label",children:"Duration:"}),(0,d.jsxs)("span",{className:"meta-value",children:[a.duration||"\u2014"," d"]})]})]})]}),(0,d.jsx)("div",{className:"card-footer",children:(0,d.jsx)(r.N_,{to:"/hr/manpower-request/".concat(a._id),className:"view-details-btn",children:"View Details"})})]},a._id)}))]})}),q.length>0&&(0,d.jsxs)("div",{className:"pagination-section inside-card",children:[(0,d.jsxs)("div",{className:"pagination-info",children:["Showing ",8*(w-1)+1," to ",Math.min(8*w,q.length)," of ",q.length," entries"]}),(0,d.jsxs)("div",{className:"pagination-controls",children:[(0,d.jsx)("button",{onClick:()=>b((e=>Math.max(e-1,1))),disabled:1===w,className:"pagination-btn",children:"Previous"}),Array.from({length:P},((e,a)=>a+1)).map((e=>(0,d.jsx)("button",{className:"pagination-btn ".concat(e===w?"active":""),onClick:()=>b(e),children:e},e))),(0,d.jsx)("button",{onClick:()=>b((e=>Math.min(e+1,P))),disabled:w===P,className:"pagination-btn",children:"Next"})]})]})]})]})})]}):(0,d.jsxs)("div",{style:{padding:24},children:[(0,d.jsx)("h2",{children:"Forbidden"}),(0,d.jsx)("p",{children:"You must be an HR user to view this page."})]})}},7968:(e,a,s)=>{s.r(a),s.d(a,{default:()=>j});var t=s(9379),n=s(5043),r=s(3216),i=s(5475),l=(s(4786),s(411)),c=s(108),o=s(163),d=s(4240),m=s(7869),u=(s(4801),s(8818)),h=s(3204),p=s(579);const j=e=>{let{forceUserUpdate:a}=e;const s=(0,r.Zp)(),[j,v]=(0,n.useState)((()=>{const e=localStorage.getItem("user");return e?JSON.parse(e):null})),[x,g]=(0,n.useState)((()=>localStorage.getItem("token")||"")),[N,f]=(0,n.useState)((()=>null===j||void 0===j?void 0:j._id));(0,n.useEffect)((()=>{const e=()=>{const e=localStorage.getItem("user");v(e?JSON.parse(e):null),f(e?JSON.parse(e)._id:void 0),g(localStorage.getItem("token")||"")};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}),[]);const[w,b]=(0,n.useState)((null===j||void 0===j?void 0:j.name)||"HR Manager"),[y,S]=(0,n.useState)((null===j||void 0===j?void 0:j.role)||"");(0,n.useEffect)((()=>{b((null===j||void 0===j?void 0:j.name)||"HR Manager"),S((null===j||void 0===j?void 0:j.role)||"")}),[j]);const[A,k]=(0,n.useState)([]),[C,D]=(0,n.useState)(!0),[q,P]=(0,n.useState)(null),[L,R]=(0,n.useState)([]),[M,E]=(0,n.useState)(!0),[B,_]=(0,n.useState)(null),[T,F]=(0,n.useState)((()=>{try{const e=localStorage.getItem("hrViewedRequests"),a=e?JSON.parse(e):[];return new Set(Array.isArray(a)?a:[])}catch(e){return new Set}})),I=(0,n.useCallback)((e=>{try{localStorage.setItem("hrViewedRequests",JSON.stringify(Array.from(e)))}catch(a){}}),[]),[z,U]=(0,n.useState)({totalStaff:0,assigned:0,available:0,requests:0,pendingRequests:0,approvedRequests:0}),[O,V]=(0,n.useState)([]),[W,H]=(0,n.useState)(!0);(0,n.useEffect)((()=>{x&&N||s("/")}),[x,N,s]);const J=(0,n.useCallback)((async()=>{if(x)try{const[e,a]=await Promise.all([l.Ay.get("/manpower",{headers:{Authorization:"Bearer ".concat(x)}}),l.Ay.get("/manpower-requests",{headers:{Authorization:"Bearer ".concat(x)}})]),s=e.data,t=a.data,n=s.length,r=s.filter((e=>!!e.assignedProject)).length,i=s.filter((e=>!e.assignedProject)).length,c=t.length,o=t.filter((e=>"Pending"===e.status)).length,d=t.filter((e=>"Approved"===e.status)).length;U({totalStaff:n,assigned:r,available:i,requests:c,pendingRequests:o,approvedRequests:d})}catch(e){console.error("Failed to fetch HR stats:",e)}}),[x]);(0,n.useEffect)((()=>{J()}),[J]);const X=(0,n.useCallback)((async()=>{if(x&&N){try{const{data:e}=await l.Ay.get("/chats/user/".concat(N),{headers:{Authorization:"Bearer ".concat(x)}});if(e&&Array.isArray(e)){const a=e.slice(0,5).map(((e,a)=>{var s,t;const n=null===(s=e.users)||void 0===s?void 0:s.find((e=>e._id!==N));let r="Unknown User";if(n)r=n.name||"".concat(n.firstname||""," ").concat(n.lastname||"").trim()||"Unknown User";else if((null===(t=e.users)||void 0===t?void 0:t.length)>0){const a=e.users.map((e=>e.name||"".concat(e.firstname||""," ").concat(e.lastname||"").trim()||"Unknown")).filter((e=>"Unknown"!==e));r=a.length>0?a.join(", "):"Unknown User"}let i="No messages yet",l=new Date;return e.lastMessage&&(i=e.lastMessage.content||"No messages yet",l=e.lastMessage.timestamp||new Date),{_id:e._id,name:e.isGroup?e.name:r,isGroup:e.isGroup||!1,lastMessage:i,lastMessageTime:l,users:e.users||[],color:"#4A6AA5"}}));k(a)}else k([]);P(null)}catch(e){console.log("Chat fetch error:",e),k([]),P("Failed to load conversations: ".concat(e.message))}D(!1)}}),[x,N]);(0,n.useEffect)((()=>{X()}),[X]);const Z=(0,n.useCallback)((async()=>{if(x){try{const{data:e}=await l.Ay.get("/manpower-requests",{headers:{Authorization:"Bearer ".concat(x)}});if(console.log("Raw manpower requests data:",e),e&&Array.isArray(e)){const a=e.map((e=>{var a,s;console.log("Processing individual request:",e);const t=String(e._id||e.id||"");let n="Unknown Project";null!==(a=e.project)&&void 0!==a&&a.projectName&&(n=e.project.projectName);let r="Unknown";null!==(s=e.createdBy)&&void 0!==s&&s.name&&(r=e.createdBy.name);let i="Unknown Position",l=1;if(e.manpowers&&Array.isArray(e.manpowers)&&e.manpowers.length>0){const a=e.manpowers[0];i=a.type||"Unknown Position",l=a.quantity||1}const c=(e.status||"Pending").toString();let o=c;try{const a=e.acquisitionDate?new Date(e.acquisitionDate):null;"pending"===c.toLowerCase()&&a&&a<new Date&&(o="Overdue")}catch(m){}const d={_id:t,projectName:n,requestedBy:r,position:i,quantity:l,status:o,requestDate:new Date(e.createdAt||e.acquisitionDate||Date.now()),priority:e.priority||"Normal",isViewed:Boolean(e.isViewed)||T.has(t)};return console.log("Processed request:",d),d})).sort(((e,a)=>a.requestDate-e.requestDate)).slice(0,5);R(a)}else R([]);_(null)}catch(e){console.log("Manpower requests fetch error:",e),R([]),_("Failed to load requests: ".concat(e.message))}E(!1)}}),[x,T]);(0,n.useEffect)((()=>{Z()}),[Z]),(0,n.useEffect)((()=>{R((e=>e.map((e=>T.has(e._id)?(0,t.A)((0,t.A)({},e),{},{isViewed:!0}):e))))}),[T]),(0,n.useEffect)((()=>{const e=()=>{Z()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)}),[Z]);const Y=(0,n.useCallback)((async()=>{if(x){try{const{data:e}=await l.Ay.get("/audit-logs",{headers:{Authorization:"Bearer ".concat(x)}});if(e&&Array.isArray(e)){const a=e.slice(0,6).map(((e,a)=>{var s;return{id:e._id||"activity-".concat(a),icon:G(e.action),iconClass:"activity-icon",title:"".concat(e.action," - ").concat(e.description||""),time:new Date(e.timestamp).toLocaleString(),type:(null===(s=e.action)||void 0===s?void 0:s.toLowerCase())||"general"}}));V(a)}else V([])}catch(e){console.error("Failed to fetch recent activities:",e),V([])}H(!1)}}),[x]);(0,n.useEffect)((()=>{Y()}),[Y]);const G=e=>{const a=(null===e||void 0===e?void 0:e.toLowerCase())||"";return a.includes("login")||a.includes("logout")?"\ud83d\udd10":a.includes("create")||a.includes("add")?"\u2795":a.includes("update")||a.includes("edit")?"\u270f\ufe0f":a.includes("delete")||a.includes("remove")?"\ud83d\uddd1\ufe0f":a.includes("approve")||a.includes("approval")?"\u2705":a.includes("reject")||a.includes("deny")?"\u274c":a.includes("assign")||a.includes("assignment")?"\ud83d\udc65":a.includes("request")||a.includes("requisition")?"\ud83d\udccb":"\ud83d\udcdd"},$=(0,n.useCallback)((()=>{l.Ay.post("/auth/logout",{},{headers:{Authorization:"Bearer ".concat(x)}}).finally((()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),v(null),f(void 0),g(""),a&&a(),window.dispatchEvent(new Event("storage")),s("/")}))}),[x,a,s]),K=n.useMemo((()=>{const e=z.totalStaff;if(0===e)return{data:[],assigned:0,available:0,total:0};const a=z.assigned,s=z.available;return{data:[{name:"Assigned",value:a,color:"#22c55e"},{name:"Available",value:s,color:"#3b82f6"}].filter((e=>e.value>0)),assigned:a,available:s,total:e}}),[z]),Q=(n.useMemo((()=>{const e=z.pendingRequests,a=z.approvedRequests,s=z.requests;if(0===s)return{data:[],pending:0,approved:0,total:0};return{data:[{name:"Pending",value:e,color:"#f59e0b"},{name:"Approved",value:a,color:"#22c55e"}].filter((e=>e.value>0)),pending:e,approved:a,total:s}}),[z]),e=>{if(!e)return"Unknown";const a=new Date(e),s=new Date,t=Math.abs(s-a),n=Math.ceil(t/864e5);return 1===n?"Today":2===n?"Yesterday":n<=7?"".concat(n-1," days ago"):a.toLocaleDateString()}),ee=(0,n.useCallback)((async e=>{try{await l.Ay.put("/manpower-requests/".concat(e),{isViewed:!0},{headers:{Authorization:"Bearer ".concat(x)}})}catch(a){console.error("Failed to mark as viewed:",a)}}),[x]),ae=(0,n.useCallback)(((e,a)=>{const n=String(a);try{e&&e.currentTarget&&e.currentTarget.classList&&(e.currentTarget.classList.remove("unviewed"),e.currentTarget.setAttribute("data-viewed","1"))}catch(r){}R((e=>e.map((e=>String(e._id)===n?(0,t.A)((0,t.A)({},e),{},{isViewed:!0}):e)))),F((e=>{const a=new Set(e);return a.add(n),I(a),a})),ee(n),s("/hr/manpower-request/".concat(n))}),[ee,s,I]);return(0,p.jsxs)("div",{className:"hr-dashboard dashboard-container",children:[(0,p.jsx)(u.A,{roleSegment:"hr",onLogout:$,overrideNav:[{to:"/hr/dash",label:"Dashboard",icon:(0,p.jsx)(h.$BV,{}),match:"/hr/dash"},{to:"/hr/chat",label:"Chat",icon:(0,p.jsx)(h.uN,{}),match:"/hr/chat"},{to:"/hr/mlist",label:"Manpower",icon:(0,p.jsx)(h.YXz,{}),match:"/hr/mlist"},{to:"/hr/movement",label:"Movement",icon:(0,p.jsx)(h.yk7,{}),match:"/hr/movement"},{to:"/hr/project-records",label:"Projects",icon:(0,p.jsx)(h.yd7,{}),match:"/hr/project-records"},{to:"/hr/attendance",label:"Attendance",icon:(0,p.jsx)(h.bfZ,{}),match:"/hr/attendance"}]}),(0,p.jsx)("main",{className:"dashboard-main",children:(0,p.jsxs)("div",{className:"dashboard-grid",children:[(0,p.jsxs)("div",{className:"dashboard-card hr-welcome-card",children:[(0,p.jsx)("div",{className:"hero-art","aria-hidden":"true",style:{backgroundImage:"radial-gradient(ellipse at 65% 35%, rgba(255,255,255,0.18), transparent 55%), url(".concat("","/images/illustration-construction-site.png)")}}),(0,p.jsxs)("div",{className:"welcome-content",children:[(0,p.jsxs)("h2",{className:"welcome-title",children:["Welcome back, ",w,"! \ud83d\udc4b"]}),(0,p.jsx)("p",{className:"welcome-subtitle",children:"Manage your workforce and track manpower activities"})]}),(0,p.jsxs)("div",{className:"welcome-stats",children:[(0,p.jsx)(i.N_,{to:"/hr/mlist",className:"stat-link",children:(0,p.jsxs)("div",{className:"stat-item",children:[(0,p.jsx)("div",{className:"stat-icon",children:(0,p.jsx)(h.YXz,{})}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("span",{className:"stat-value",children:z.totalStaff}),(0,p.jsx)("span",{className:"stat-label",children:"Total Manpower"})]})]})}),(0,p.jsx)(i.N_,{to:"/hr/mlist",className:"stat-link",children:(0,p.jsxs)("div",{className:"stat-item",children:[(0,p.jsx)("div",{className:"stat-icon",children:(0,p.jsx)(h.BAG,{})}),(0,p.jsxs)("div",{className:"stat-content",children:[(0,p.jsx)("span",{className:"stat-value",children:z.assigned}),(0,p.jsx)("span",{className:"stat-label",children:"Assigned"})]})]})})]}),(0,p.jsxs)("div",{className:"kpi-strip",children:[(0,p.jsxs)(i.N_,{to:"/hr/mlist",className:"kpi",children:[(0,p.jsx)("div",{className:"kpi-ico",children:(0,p.jsx)(h.YXz,{})}),(0,p.jsxs)("div",{className:"kpi-body",children:[(0,p.jsx)("div",{className:"kpi-title",children:"Total Manpower"}),(0,p.jsx)("div",{className:"kpi-value",children:z.totalStaff})]})]}),(0,p.jsxs)(i.N_,{to:"/hr/mlist",className:"kpi",children:[(0,p.jsx)("div",{className:"kpi-ico",children:(0,p.jsx)(h.BAG,{})}),(0,p.jsxs)("div",{className:"kpi-body",children:[(0,p.jsx)("div",{className:"kpi-title",children:"Assigned"}),(0,p.jsx)("div",{className:"kpi-value",children:z.assigned})]})]}),(0,p.jsxs)(i.N_,{to:"/hr/movement",className:"kpi",children:[(0,p.jsx)("div",{className:"kpi-ico",children:(0,p.jsx)(h.kkc,{})}),(0,p.jsxs)("div",{className:"kpi-body",children:[(0,p.jsx)("div",{className:"kpi-title",children:"Requests"}),(0,p.jsx)("div",{className:"kpi-value",children:z.requests})]})]})]})]}),K.data.length>0&&(0,p.jsxs)("div",{className:"dashboard-card chart-card",children:[(0,p.jsxs)("div",{className:"card-header",children:[(0,p.jsx)("h3",{className:"card-title",children:"Workforce Analytics"}),(0,p.jsxs)("div",{className:"card-subtitle",children:["Based on ",K.total," total workforce"]})]}),(0,p.jsx)("div",{className:"chart-container",children:(0,p.jsx)(c.u,{width:"100%",height:200,children:(0,p.jsx)(o.r,{children:(0,p.jsx)(d.F,{data:K.data,cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,fill:"#8884d8",paddingAngle:2,dataKey:"value",label:e=>{let{name:a,percent:s}=e;return"".concat(a," ").concat((100*s).toFixed(0),"%")},labelLine:!1,children:K.data.map(((e,a)=>(0,p.jsx)(m.f,{fill:e.color},"cell-".concat(a))))})})})}),(0,p.jsx)("div",{className:"chart-footer",children:(0,p.jsxs)("span",{className:"utilization-rate",children:["Utilization Rate: ",K.total>0?Math.round(K.assigned/K.total*100):0,"%"]})})]}),(0,p.jsxs)("div",{className:"dashboard-card requests-card",children:[(0,p.jsxs)("div",{className:"card-header",children:[(0,p.jsx)("h3",{className:"card-title",children:"Recent Manpower Requests"}),(0,p.jsxs)(i.N_,{to:"/hr/movement",className:"view-all-link",children:["View All ",(0,p.jsx)(h.Z0P,{})]})]}),(0,p.jsx)("div",{className:"requests-content",children:M?(0,p.jsxs)("div",{className:"loading-state",children:[(0,p.jsx)("div",{className:"loading-spinner"}),(0,p.jsx)("span",{children:"Loading requests..."})]}):B?(0,p.jsxs)("div",{className:"error-state",children:[(0,p.jsx)(h.BS8,{}),(0,p.jsx)("span",{children:B})]}):0===L.length?(0,p.jsxs)("div",{className:"empty-state",children:[(0,p.jsx)(h.kkc,{}),(0,p.jsx)("span",{children:"No recent requests found"}),(0,p.jsx)("p",{children:"All requests have been processed or none are pending"})]}):(0,p.jsx)("div",{className:"requests-list",children:L.slice(0,3).map((e=>{var a;return(0,p.jsxs)("div",{className:"request-item-new-layout ".concat(e.isViewed?"":"unviewed"),onClick:a=>ae(a,e._id),style:{cursor:"pointer",textDecoration:"none"},children:[(0,p.jsxs)("div",{className:"request-left-section",children:[(0,p.jsx)("div",{className:"request-icon-new",children:(0,p.jsx)(h.kkc,{})}),(0,p.jsxs)("div",{className:"request-details-new",children:[(0,p.jsxs)("h4",{className:"request-title-new",children:[e.position," - ",e.quantity," needed"]}),(0,p.jsxs)("div",{className:"request-meta-new",children:[(0,p.jsx)("span",{className:"request-project-new",children:e.projectName}),(0,p.jsx)("span",{className:"request-date-new",children:Q(e.requestDate)})]})]})]}),(0,p.jsx)("div",{className:"request-center-section",children:(0,p.jsx)("div",{className:"request-status-info",children:(0,p.jsxs)("span",{className:"request-requester",children:["By: ",e.requestedBy]})})}),(0,p.jsx)("div",{className:"request-right-section",children:(0,p.jsx)("div",{className:"request-status-new",children:(0,p.jsx)("span",{className:"status-text-new ".concat(null===(a=e.status)||void 0===a?void 0:a.replace(/\s/g,"").toLowerCase()),children:e.status})})})]},e._id)}))})})]})]})})]})}},8131:(e,a,s)=>{s.r(a),s.d(a,{default:()=>o});var t=s(5043),n=s(3216),r=s(411),i=s(8818),l=(s(1254),s(3204)),c=s(579);const o=()=>{const e=(0,n.Zp)(),[a,s]=(0,t.useState)([]),[o,d]=(0,t.useState)(!0),[m,u]=(0,t.useState)(""),[h,p]=(0,t.useState)("all"),[j,v]=(0,t.useState)("grid"),[x,g]=(0,t.useState)(""),N=(0,t.useDeferredValue)(x),[f,w]=(0,t.useState)("name"),[b,y]=(0,t.useState)("asc"),[S,A]=(0,t.useState)(1),[k,C]=(0,t.useState)(12);(0,t.useEffect)((()=>{let e=!0;return(async()=>{try{const{data:a}=await r.Ay.get("/projects");if(!e)return;s(Array.isArray(a)?a:[])}catch(a){e&&u("Failed to fetch projects")}finally{e&&d(!1)}})(),()=>{e=!1}}),[]);const D=(0,t.useMemo)((()=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:2})),[]),q=e=>e?new Date(e).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"",P=(0,t.useMemo)((()=>{const e=N.trim().toLowerCase();return a.filter((e=>{const a=(e.status||"").toLowerCase();return"completed"===h?"completed"===a:"ongoing"===h?["ongoing","on going"].includes(a):"pending"!==h||["pending","not started"].includes(a)})).filter((a=>{var s,t;return!e||[a.projectName,null===(s=a.location)||void 0===s?void 0:s.name,null===(t=a.projectmanager)||void 0===t?void 0:t.name,a.contractor].some((a=>(a||"").toLowerCase().includes(e)))})).sort(((e,a)=>{const s=e=>{var a,s;switch(f){case"location":return(null===(a=e.location)||void 0===a?void 0:a.name)||"";case"manager":return(null===(s=e.projectmanager)||void 0===s?void 0:s.name)||"";case"status":return e.status||"";case"startDate":return e.startDate?new Date(e.startDate).getTime():0;default:return e.projectName||""}},t=s(e),n=s(a);return t===n?0:(t>n?1:-1)*("asc"===b?1:-1)}))}),[a,h,N,f,b]);(0,t.useEffect)((()=>{A(1)}),[h,N,f,b]);const L=P.length,R=Math.max(1,Math.ceil(L/k)),M=Math.min(S,R),E=(0,t.useMemo)((()=>P.slice((M-1)*k,M*k)),[P,M,k]),B=(0,t.useMemo)((()=>({total:a.length,ongoing:a.filter((e=>["ongoing","on going"].includes((e.status||"").toLowerCase()))).length,completed:a.filter((e=>"completed"===(e.status||"").toLowerCase())).length,pending:a.filter((e=>["pending","not started"].includes((e.status||"").toLowerCase()))).length})),[a]),_=e=>{let{n:a=8}=e;return(0,c.jsx)("div",{className:"projects-display ".concat(j),children:Array.from({length:a}).map(((e,a)=>(0,c.jsxs)("div",{className:"project-card skeleton",children:[(0,c.jsx)("div",{className:"project-image-wrapper shimmer"}),(0,c.jsxs)("div",{className:"project-content",children:[(0,c.jsx)("div",{className:"skeleton-line w60"}),(0,c.jsx)("div",{className:"skeleton-line w40"}),(0,c.jsx)("div",{className:"skeleton-line w80"}),(0,c.jsx)("div",{className:"skeleton-line w50"})]})]},a)))})};return(0,c.jsxs)("div",{className:"dashboard-container no-inner-scroll ceo-projects-page",children:[(0,c.jsx)(i.A,{roleSegment:"hr"}),(0,c.jsx)("main",{className:"dashboard-main auto-height",children:(0,c.jsxs)("div",{className:"projects-container projects-light",children:[(0,c.jsxs)("div",{className:"page-header enhanced",children:[(0,c.jsxs)("div",{className:"page-title-section",children:[(0,c.jsx)("h1",{className:"page-title",children:"Projects"}),(0,c.jsx)("p",{className:"page-subtitle",children:"HR project records"})]}),(0,c.jsxs)("div",{className:"page-actions",children:[(0,c.jsxs)("div",{className:"search-container",children:[(0,c.jsx)(l.KSO,{className:"search-icon"}),(0,c.jsx)("input",{value:x,onChange:e=>g(e.target.value),placeholder:"Search by name, location, manager...",className:"search-input"})]}),(0,c.jsxs)("div",{className:"view-mode-container",children:[(0,c.jsx)("button",{"aria-label":"Grid view",className:"view-mode-btn ".concat("grid"===j?"active":""),onClick:()=>v("grid"),children:(0,c.jsx)(l.QJV,{})}),(0,c.jsx)("button",{"aria-label":"List view",className:"view-mode-btn ".concat("list"===j?"active":""),onClick:()=>v("list"),children:(0,c.jsx)(l.svy,{})})]}),(0,c.jsxs)("div",{className:"sort-container",children:[(0,c.jsxs)("select",{value:f,onChange:e=>w(e.target.value),className:"sort-select",children:[(0,c.jsx)("option",{value:"name",children:"Name"}),(0,c.jsx)("option",{value:"location",children:"Location"}),(0,c.jsx)("option",{value:"manager",children:"Manager"}),(0,c.jsx)("option",{value:"status",children:"Status"}),(0,c.jsx)("option",{value:"startDate",children:"Start Date"})]}),(0,c.jsx)("button",{"aria-label":"Toggle sort order",className:"sort-order-btn",onClick:()=>y((e=>"asc"===e?"desc":"asc")),children:"asc"===b?(0,c.jsx)(l.Ucs,{}):(0,c.jsx)(l.Vr3,{})})]})]})]}),(0,c.jsxs)("div",{className:"filter-bar below-header",children:[(0,c.jsxs)("button",{className:"filter-chip ".concat("all"===h?"active":""),onClick:()=>p("all"),children:["All ",(0,c.jsx)("span",{className:"badge",children:B.total})]}),(0,c.jsxs)("button",{className:"filter-chip ".concat("ongoing"===h?"active":""),onClick:()=>p("ongoing"),children:["Ongoing ",(0,c.jsx)("span",{className:"badge",children:B.ongoing})]}),(0,c.jsxs)("button",{className:"filter-chip ".concat("completed"===h?"active":""),onClick:()=>p("completed"),children:["Completed ",(0,c.jsx)("span",{className:"badge",children:B.completed})]}),(0,c.jsxs)("button",{className:"filter-chip ".concat("pending"===h?"active":""),onClick:()=>p("pending"),children:["Pending ",(0,c.jsx)("span",{className:"badge",children:B.pending})]})]}),m&&(0,c.jsxs)("div",{className:"error-state compact",children:[(0,c.jsx)(l.w_X,{}),(0,c.jsx)("span",{children:m})]}),o&&!m&&(0,c.jsx)(_,{n:8}),!o&&!m&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"projects-display ".concat(j),children:[0===E.length&&(0,c.jsxs)("div",{className:"empty-state full",children:[(0,c.jsx)(l.yd7,{size:42}),(0,c.jsx)("h3",{children:"No projects found"}),(0,c.jsx)("p",{children:x||"all"!==h?"Adjust search text, filters or sorting.":"No projects available."})]}),E.map((a=>{var s,t,n;const r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const a=e.toLowerCase();return"completed"===a?{color:"#10B981",Icon:l.A7C,label:"Completed"}:"ongoing"===a||"on going"===a?{color:"#3B82F6",Icon:l.w_X,label:"Ongoing"}:["pending","not started"].includes(a)?{color:"#F59E0B",Icon:l.w_X,label:"Pending"}:{color:"#6B7280",Icon:l.w_X,label:e||"Unknown"}}(a.status);return(0,c.jsxs)("div",{className:"project-card ".concat(j),onClick:()=>e("/hr/project-records/".concat(a._id)),role:"button",tabIndex:0,onKeyDown:s=>{"Enter"===s.key&&e("/hr/project-records/".concat(a._id))},children:[(0,c.jsxs)("div",{className:"project-image-wrapper",children:[(0,c.jsx)("img",{loading:"lazy",src:(null===(s=a.photos)||void 0===s?void 0:s[0])||"https://placehold.co/640x360?text=No+Photo",alt:a.projectName,className:"project-image"}),(0,c.jsxs)("div",{className:"status-badge",style:{backgroundColor:r.color},children:[(0,c.jsx)(r.Icon,{size:12}),(0,c.jsx)("span",{children:r.label})]})]}),(0,c.jsxs)("div",{className:"project-content",children:[(0,c.jsx)("h3",{className:"project-name clamp",children:a.projectName||"Untitled"}),(0,c.jsxs)("div",{className:"project-location",children:[(0,c.jsx)(l.vq8,{}),(0,c.jsx)("span",{children:(null===(t=a.location)||void 0===t?void 0:t.name)||"No Location"})]}),(0,c.jsxs)("ul",{className:"meta-list",children:[(0,c.jsxs)("li",{children:[(0,c.jsx)(l.p7b,{}),(0,c.jsx)("span",{children:(null===(n=a.projectmanager)||void 0===n?void 0:n.name)||"Unassigned"})]}),(0,c.jsxs)("li",{children:[(0,c.jsx)(l.ymh,{}),(0,c.jsx)("span",{children:a.contractor||"No Contractor"})]}),(0,c.jsxs)("li",{children:[(0,c.jsx)(l.bfZ,{}),(0,c.jsx)("span",{children:a.startDate&&a.endDate?"".concat(q(a.startDate)," - ").concat(q(a.endDate)):a.startDate?q(a.startDate):"No timeline"})]}),(0,c.jsxs)("li",{children:[(0,c.jsx)(l.YXz,{}),(0,c.jsx)("span",{children:Array.isArray(a.manpower)&&a.manpower.length>0?"".concat(a.manpower.length," manpower"):"No manpower"})]}),a.budget&&(0,c.jsxs)("li",{children:[(0,c.jsx)(l.MxO,{}),(0,c.jsx)("span",{children:D.format(a.budget)})]})]})]})]},a._id)}))]}),E.length>0&&(0,c.jsxs)("div",{className:"pagination-bar",children:[(0,c.jsxs)("div",{className:"pagination-left",children:[(0,c.jsxs)("span",{className:"pagination-info",children:["Showing ",(M-1)*k+1,"-",Math.min(M*k,L)," of ",L]}),(0,c.jsxs)("label",{className:"page-size-select-label",children:[(0,c.jsx)("span",{children:"Per page:"}),(0,c.jsx)("select",{value:k,onChange:e=>{C(parseInt(e.target.value)||12),A(1)},className:"page-size-select",children:[6,12,18,24,36].map((e=>(0,c.jsx)("option",{value:e,children:e},e)))})]})]}),(0,c.jsxs)("div",{className:"pagination-pages",children:[(0,c.jsx)("button",{disabled:1===M,onClick:()=>A((e=>Math.max(1,e-1))),className:"page-btn","aria-label":"Previous page",children:"\u2039"}),Array.from({length:R}).map(((e,a)=>{const s=a+1;return 1===s||s===R||Math.abs(s-M)<=1?(0,c.jsx)("button",{className:"page-btn ".concat(s===M?"active":""),onClick:()=>A(s),"aria-current":s===M?"page":void 0,children:s},s):2===s&&M>3?(0,c.jsx)("span",{className:"ellipsis",children:"\u2026"},"start-ellipsis"):s===R-1&&M<R-2?(0,c.jsx)("span",{className:"ellipsis",children:"\u2026"},"end-ellipsis"):null})),(0,c.jsx)("button",{disabled:M===R,onClick:()=>A((e=>Math.min(R,e+1))),className:"page-btn","aria-label":"Next page",children:"\u203a"})]})]})]})]})})]})}},9013:(e,a,s)=>{s.r(a),s.d(a,{default:()=>r});s(5043);var t=s(8153),n=s(579);function r(){return(0,n.jsx)(t.default,{baseSegment:"hr"})}}}]);
//# sourceMappingURL=hr.bd981ce8.chunk.js.map
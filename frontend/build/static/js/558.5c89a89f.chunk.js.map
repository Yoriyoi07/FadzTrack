{"version":3,"file":"static/js/558.5c89a89f.chunk.js","mappings":"6LAOA,MAkWA,EAxV2BA,IAMpB,IAADC,EAAA,IANsB,YAC1BC,EAAW,OACXC,EAAM,SACNC,EAAQ,OACRC,EAAM,iBACNC,GACDN,EAEC,MAAMO,EACS,oBAAbH,EAAiC,KAClB,iBAAbA,EAA8B,KAC9BA,EAEEI,EAAoB,OAAXN,QAAW,IAAXA,OAAW,EAAXA,EAAaM,OACtBC,EACQ,4BAAXD,GAAoD,OAAZD,GAC7B,yBAAXC,GAAiD,OAAZD,EAElCG,EAAsB,OAAXR,QAAW,IAAXA,GAAsB,QAAXD,EAAXC,EAAaS,iBAAS,IAAAV,OAAX,EAAXA,EAAwBW,MACtCC,IAAC,IAAAC,EAAA,OAAKD,EAAEE,OAASR,GAAWS,QAAa,QAANF,EAAAD,EAAEI,YAAI,IAAAH,OAAA,EAANA,EAAQI,MAAOL,EAAEI,QAAUD,OAAOb,EAAO,IAGzEgB,EAAkBV,IAAmBC,GAKpCU,EAAgBC,IAAqBC,EAAAA,EAAAA,WAAS,IAC9CC,EAAYC,IAAiBF,EAAAA,EAAAA,UAAS,KACtCG,EAAoBC,IAAyBJ,EAAAA,EAAAA,WAAS,GACvDK,EAAiB,WAAe,IAAdC,IAAKC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,KAAAA,UAAA,GAAUR,GAAkB,GAAWO,GAAOJ,EAAc,GAAK,EAExFQ,GAAcC,EAAAA,EAAAA,QAAO,IACrBC,GAAkBD,EAAAA,EAAAA,QAAO,OAC/BE,EAAAA,EAAAA,YAAU,KAAMH,EAAYI,QAAUb,CAAU,GAAI,CAACA,KAErDY,EAAAA,EAAAA,YAAU,KACLf,GAAkBc,EAAgBE,SACnCC,uBAAsB,KACpB,MAAMC,EAAKJ,EAAgBE,QAASE,EAAGC,QAASD,EAAGE,eAAiBF,EAAGG,aAAeH,EAAGI,MAAMZ,MAAM,GAEzG,GACA,CAACV,KAEHe,EAAAA,EAAAA,YAAU,KAER,GADgBf,GAAkBK,EACvB,CACT,MAAMkB,EAAOC,SAASC,KAAKC,MAAMC,SACjCH,SAASC,KAAKC,MAAMC,SAAS,SAC7B,MAAMC,EAASC,IAAiB,WAARA,EAAEC,MAAoB9B,GAAgBO,GAAe,GAAUF,GAAoBC,GAAsB,GAAO,EAExI,OADAyB,OAAOC,iBAAiB,UAAWJ,GAC5B,KAAMJ,SAASC,KAAKC,MAAMC,SAASJ,EAAMQ,OAAOE,oBAAoB,UAAWL,EAAM,CAC9F,IACA,CAAC5B,EAAgBK,IAEnB,MAAM6B,EAAcC,IAAA,IAAC,SAACC,GAASD,EAAA,OAAKE,EAAAA,EAAAA,cAAaD,EAAUZ,SAASC,KAAK,GAClEa,EAAUC,IAAerC,EAAAA,EAAAA,UAAS,OAClCsC,EAAgBC,IAAqBvC,EAAAA,EAAAA,WAAS,IAErDa,EAAAA,EAAAA,YAAU,KAAM,IAAIuB,EAAU,OAAQ,MAAMI,EAAEC,YAAW,IAAIJ,EAAY,OAAO,KAAO,MAAO,IAAIK,aAAaF,EAAE,GAAI,CAACJ,IAGtH,MAkDMO,IAA0B,OAAX/D,QAAW,IAAXA,IAAAA,EAAagE,cAC5BA,EAA0B,OAAXhE,QAAW,IAAXA,GAAAA,EAAagE,aA3HZC,KACtB,IAAKA,EAAS,MAAO,GACrB,MAAMC,EAAO,IAAIC,KAAKF,GACtB,OACEC,EAAKE,wBAAmBvC,EAAW,CAAEwC,KAAM,UAAWC,MAAO,UAAWC,IAAK,YAC7E,IACAL,EAAKM,wBAAmB3C,EAAW,CAAE4C,KAAM,UAAWC,OAAQ,WAAY,EAsHxEC,CAAe3E,EAAYgE,cAC3B,KAIEY,EADiB,CAAC,4BAA6B,0BACrBC,SAAoB,OAAX7E,QAAW,IAAXA,OAAW,EAAXA,EAAaM,QACtD,IAAIwE,EAAiB,KACjBF,IACFE,EAAiB,KAAgB,OAAX9E,QAAW,IAAXA,OAAW,EAAXA,EAAaS,YAAa,IAC7CsE,UACAC,MAAKC,GAAwB,WAAjBA,EAAIC,YAmBrB,IAAIC,EAAe,UACJ,4BAAX7E,GAAoD,OAAZD,EAC1C8E,EAAe,WACK,yBAAX7E,GAAiD,OAAZD,IAC9C8E,EAAe,WAIjB,MAAMC,GAAaC,EAAAA,EAAAA,UAAQ,IAAKpE,GAAiB,CAACA,IAGlD,IAAIqE,EAAsB,kCAO1B,MANe,4BAAXhF,GAAoD,OAAZD,EAC1CiF,EAAsB,sEACF,yBAAXhF,GAAiD,OAAZD,IAC9CiF,EAAsB,mDAItBC,EAAAA,EAAAA,MAAAC,EAAAA,SAAA,CAAAlC,SAAA,CAEGsB,GAAYE,IACXS,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CAAE6C,aAAc,IAAKnC,SAAA,EAC/BiC,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CACV8C,WAAY,IACZC,UAAW,SACXF,aAAc,GACdnC,SAAA,CAAC,sBA1CesC,KACxB,IAAKA,EAAU,MAAO,GACtB,IAAI/E,EACgB,oBAAlB+E,EAAS/E,KACL,kBACkB,iBAAlB+E,EAAS/E,KACT,eACA+E,EAAS/E,KACf,OAAI+E,EAAS7E,MAAiC,kBAAlB6E,EAAS7E,MAAqB6E,EAAS7E,KAAK8E,KAChE,GAANC,OAAUF,EAAS7E,KAAK8E,KAAI,MAAAC,OAAKjF,EAAI,KAEjC,GAANiF,OAAUjF,EAAI,EAgCckF,CAAiBjB,OAEvCS,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CACVoD,WAAY,UACZC,MAAO,UACPC,aAAc,EACdC,QAAS,YACTC,SAAU,GACVC,SAAU,IACVC,OAAQ,SACRC,OAAQ,oBACRZ,UAAW,QACXrC,SAAA,EACAkD,EAAAA,EAAAA,KAAA,OAAK5D,MAAO,CAAE8C,WAAY,IAAKD,aAAc,GAAInC,SAAC,YACjDwB,EAAe2B,aAKrBjD,IACCgD,EAAAA,EAAAA,KAAA,OAAK5D,MAAO,CACV6C,aAAc,GACdU,QAAS,YACTD,aAAc,EACdE,SAAU,GACVJ,WAA4B,YAAhBxC,EAASkD,KAAkB,UAAU,UACjDT,MAAuB,YAAhBzC,EAASkD,KAAkB,UAAU,UAC5CH,OAAO,aAADT,OAA+B,YAAhBtC,EAASkD,KAAkB,UAAU,YAC1DpD,SACCE,EAASmD,UAKb5C,IACCwB,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CACV0D,OAAQ,WACRX,UAAW,SACXM,MAAO,UACPP,WAAY,KACZpC,SAAA,CAAC,0EACuEU,MAQ5EuB,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,yBAAwBtD,SAAA,EACrCkD,EAAAA,EAAAA,KAAA,UAAQK,QAAS1G,EAAQyG,UAAU,WAAUtD,SAAC,SAC7CrC,IACCsE,EAAAA,EAAAA,MAAAC,EAAAA,SAAA,CAAAlC,SAAA,EACEkD,EAAAA,EAAAA,KAAA,UACEK,QAnKUC,KAAY7F,GAAyBO,GAAsB,EAAK,EAoK1EuF,UAAW3B,EACXwB,UAAU,2BACVhE,MAAO,CAAEoD,WAAYZ,EAAY,UAAU,UAAW4B,SAAU,IAAKC,OAAQ7B,EAAY,UAAU,eAAgB9B,SAElH6B,KAEHqB,EAAAA,EAAAA,KAAA,UACEK,QAvJOK,KAAQ/F,GAAkB,GAAOwC,GAAkB,EAAM,EAwJhEiD,UAAU,aACVhE,MAAO,CACLuE,WAAY,OACZnB,WAAY,UACZC,MAAO,OACPe,SAAU,KACV1D,SACH,eASNpC,IACCsF,EAAAA,EAAAA,KAACpD,EAAW,CAAAE,UACVkD,EAAAA,EAAAA,KAAA,OAAK3F,KAAK,SAAS,aAAW,OAAO,aAAW,eAAe+B,MAAO,CAACwE,SAAS,QAAQC,MAAM,EAAEC,OAAO,IAAKtB,WAAW,oBAAqBa,QAASA,KAAKnD,GAAkBjC,GAAe,GAAM6B,UAE/LkD,EAAAA,EAAAA,KAAA,OAAK5D,MAAO,CAACwE,SAAS,WAAWG,IAAI,MAAMC,KAAK,MAAMC,UAAU,uBAAuBC,MAAM,OAAOrB,SAAS,IAAIF,QAAQ,UAAU7C,UACnIiC,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CAACoD,WAAW,OAAO0B,MAAM,OAAOxB,aAAa,GAAGC,QAAQ,YAAYwB,UAAU,oCAAoCC,UAAU,yBAA0Bf,QAAS9D,GAAGA,EAAE8E,kBAAkBvE,SAAA,EAChMkD,EAAAA,EAAAA,KAAA,MAAI5D,MAAO,CAAC0D,OAAO,WAAWF,SAAS,IAAI9C,SAAC,kBAC5CkD,EAAAA,EAAAA,KAAA,KAAG5D,MAAO,CAAC0D,OAAO,WAAWF,SAAS,GAAGH,MAAM,WAAW3C,SAAC,yCAE3DkD,EAAAA,EAAAA,KAAA,OAAK5D,MAAO,CAACkF,UAAU,OAAOxE,UAC9BkD,EAAAA,EAAAA,KAAA,YACEuB,IAAI,MACJC,YAAY,EACZxF,MAAOnB,EACP4G,SAAUlF,IACR,MAAMmF,EAAMnF,EAAEoF,OAAO3F,MACfC,EAAOX,EAAYI,QACzB,IAAIkG,EAAOF,EAEX,GAAGA,EAAItG,SAAWa,EAAKb,OAAS,GAAKsG,EAAIG,SAAS5F,GAAM,CAGtD2F,EAAO3F,EADOyF,EAAII,MAAM,EAAGJ,EAAItG,OAASa,EAAKb,OAE/C,MAAO,GAAGsG,EAAItG,OAASa,EAAKb,OAAS,GAAKsG,EAAIG,SAAS5F,GAAM,CAG3D2F,EAAO3F,EADOyF,EAAII,MAAM,EAAGJ,EAAItG,OAASa,EAAKb,OAE/C,CACAN,EAAc8G,GAEdjG,uBAAsB,KACpB,GAAGH,EAAgBE,QAAQ,CACzB,MAAME,EAAKJ,EAAgBE,QAC3BE,EAAGE,eAAiBF,EAAGG,aAAeH,EAAGI,MAAMZ,MACjD,IACA,EAEJ2G,KAAM,EACNC,WAAS,EACTzB,SAAUrD,EACVd,MAAO,CACL8E,MAAM,OACNxB,aAAa,GACbK,OAAO,oBACPJ,QAAQ,YACRC,SAAS,GACTJ,WAAYtC,EAAgB,UAAU,UACtC+E,UAAU,IACVC,OAAO,WACPZ,UAAU,MACVnC,UAAU,OACVgD,WAAW,WACXC,aAAa,aACbC,WAAW,OACXC,WAAW,UACXC,YAAY,gBACZC,WAAW,EACXC,WAAW,UACXC,YAAY,UACZzB,UAAU,QAEZ0B,aAAa,MACbC,IAAKpH,EACLqH,YAAY,+BAGd9D,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CAAC0G,UAAU,GAAGC,QAAQ,OAAOC,eAAe,WAAWC,IAAI,IAAInG,SAAA,EACzEkD,EAAAA,EAAAA,KAAA,UAAQK,QAASA,IAAIpF,GAAe,GAAOsF,SAAUrD,EAAgBd,MAAO,CAACuD,QAAQ,YAAYH,WAAW,UAAUO,OAAO,OAAOL,aAAa,EAAER,WAAW,IAAIuB,OAAQvD,EAAgB,cAAc,UAAUgG,QAAShG,EAAgB,GAAG,GAAGJ,SAAC,YAClPkD,EAAAA,EAAAA,KAAA,UAAQK,QA3OH8C,UACjB,IAAKtI,EAAWuI,OAEd,YADAnG,EAAY,CAAEiD,KAAK,QAASC,QAAQ,wBAGtC,MAAMkD,EAAQC,aAAaC,QAAQ,SACnC,GAAIF,EACJ,IACElG,GAAkB,GAClBqG,QAAQC,IAAI,oBAAqB,CAAEC,GAAe,OAAXlK,QAAW,IAAXA,OAAW,EAAXA,EAAagB,IAAKyF,OAAQpF,UAC3D8I,EAAAA,GAAIC,KAAK,aAADtE,OACC9F,EAAYgB,IAAG,YAC5B,CAAEkE,SAAU,SAAUuB,OAAQpF,GAC9B,CAAEgJ,QAAS,CAAEC,cAAc,UAADxE,OAAY+D,MAExCpG,EAAY,CAAEiD,KAAK,UAAWC,QAAQ,oBACtCxF,GAAkB,GAClBG,EAAc,IACVlB,EAAkBA,IACjBD,GACP,CAAE,MAAOoK,GAAM,IAADC,EAAAC,EACZT,QAAQU,MAAMH,GACd9G,EAAY,CAAEiD,KAAK,QAASC,SAAY,OAAH4D,QAAG,IAAHA,GAAa,QAAVC,EAAHD,EAAKI,gBAAQ,IAAAH,GAAM,QAANC,EAAbD,EAAeI,YAAI,IAAAH,OAAhB,EAAHA,EAAqB9D,UAAW,2BACvE,CAAC,QACChD,GAAkB,EACpB,MAnBYF,EAAY,CAACiD,KAAK,QAASC,QAAQ,sBAmB/C,EAkNyCI,UAAW1F,EAAWuI,QAAQlG,EAAgBd,MAAO,CAACuD,QAAQ,YAAYH,YAAc3E,EAAWuI,QAAQlG,EAAiB,UAAU,UAAUuC,MAAM,OAAOM,OAAO,OAAOL,aAAa,EAAER,WAAW,IAAIuB,QAAU5F,EAAWuI,QAAQlG,EAAiB,cAAc,UAAUgG,QAAShG,EAAgB,GAAG,GAAGJ,SAAEI,EAAgB,gBAAgB,uBAQ1XnC,IACKiF,EAAAA,EAAAA,KAACpD,EAAW,CAAAE,UACVkD,EAAAA,EAAAA,KAAA,OAAK3F,KAAK,SAAS,aAAW,OAAO,aAAW,kBAAkB+B,MAAO,CAACwE,SAAS,QAAQC,MAAM,EAAEC,OAAO,IAAKiC,QAAQ,OAAOsB,WAAW,SAASrB,eAAe,SAASxD,WAAW,mBAAmBG,QAAQ,QAASU,QAASA,IAAIrF,GAAsB,GAAO8B,UACjQiC,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CAACoD,WAAW,OAAOE,aAAa,GAAGC,QAAQ,YAAYuB,MAAM,OAAOrB,SAAS,IAAIsB,UAAU,oCAAoCC,UAAU,yBAA0Bf,QAAS9D,GAAGA,EAAE8E,kBAAkBvE,SAAA,EACrNiC,EAAAA,EAAAA,MAAA,MAAI3C,MAAO,CAAC0D,OAAO,WAAWF,SAAS,GAAGmD,QAAQ,OAAOsB,WAAW,SAASpB,IAAI,IAAInG,SAAA,EAACkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,sBAAsBhE,MAAO,CAACqD,MAAM,aAAa,YAAUd,MACtJqB,EAAAA,EAAAA,KAAA,KAAG5D,MAAO,CAAC0D,OAAO,WAAWF,SAAS,GAAGH,MAAM,WAAW3C,SAAEgC,KAC5DC,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CAAC0G,UAAU,EAAEC,QAAQ,OAAOC,eAAe,WAAWC,IAAI,IAAInG,SAAA,EACxEkD,EAAAA,EAAAA,KAAA,UAAQK,QAASA,IAAIrF,GAAsB,GAAQoB,MAAO,CAACuD,QAAQ,YAAYH,WAAW,UAAUO,OAAO,OAAOL,aAAa,EAAER,WAAW,IAAIuB,OAAO,WAAW3D,SAAC,YACnKkD,EAAAA,EAAAA,KAAA,UAAQK,QA7QSiE,KAC7BtJ,GAAsB,GACtB,WACE,MAAMqI,EAAQC,aAAaC,QAAQ,SAC7BgB,EAAU,CAAE7F,SAAU,YAC5B,UACQiF,EAAAA,GAAIC,KAAK,aAADtE,OAAc9F,EAAYgB,IAAG,YAAY+J,EAAS,CAAEV,QAAQ,CAAEC,cAAc,UAADxE,OAAW+D,MACpGpG,EAAY,CAACiD,KAAK,UAAWC,QAAQ,sBAClCvG,EAAkBA,IAAyBD,GAChD,CAAE,MAAMoK,GAAK,IAADS,EAAAC,EACVxH,EAAY,CAACiD,KAAK,QAASC,SAAY,OAAH4D,QAAG,IAAHA,GAAa,QAAVS,EAAHT,EAAKI,gBAAQ,IAAAK,GAAM,QAANC,EAAbD,EAAeJ,YAAI,IAAAK,OAAhB,EAAHA,EAAqBtE,UAAW,8BACtE,CACD,EAVD,EAUI,EAiQiD/D,MAAO,CAACuD,QAAQ,YAAYH,WAAW,UAAUC,MAAM,OAAOM,OAAO,OAAOL,aAAa,EAAER,WAAW,IAAIuB,OAAO,WAAW3D,SAAC,wBAM/K,C,oHC7VP,MA4TA,EA5TkCxD,IAAmK,IAADoL,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,IAAjK,KAAExL,EAAI,UAAEyL,EAAU,oBAAmB,YAAEC,EAAY,0BAAyB,eAAEC,EAAe,sBAAqB,aAAEC,EAAa,KAAI,cAAEC,GAAc,GAAO5M,EAC7L,MAAM,GAAEoK,IAAOyC,EAAAA,EAAAA,KACTC,GAAWC,EAAAA,EAAAA,OACVC,EAAiBC,IAAsB3L,EAAAA,EAAAA,UAAS,OAChD4L,EAASC,IAAc7L,EAAAA,EAAAA,WAAS,IAChCsJ,EAAOwC,IAAY9L,EAAAA,EAAAA,UAAS,KAC5B+L,EAAmBC,IAAwBhM,EAAAA,EAAAA,WAAS,IACpDiM,EAAeC,IAAoBlM,EAAAA,EAAAA,WAAS,GAC7CmM,EAAmC,SAA1B1M,GAAM,IAAI2M,eAClBC,EAAmBC,IAAwBtM,EAAAA,EAAAA,WAAS,IAAKmM,EAAQ,CAAEI,KAAI,GAAS,CAAC,KACjFC,EAAQC,IAAazM,EAAAA,EAAAA,WAAS,IAE9B0M,EAAWC,IAAgB3M,EAAAA,EAAAA,WAAS,IAEpC4M,GAAmBC,KAAwB7M,EAAAA,EAAAA,UAAS,OAEpD8M,GAAYC,KAAiB/M,EAAAA,EAAAA,UAAS,CAAC,GACxCgN,IAAqBrM,EAAAA,EAAAA,QAAO,MAC5BhB,GAAO,MAAO,IAAK,OAAOsN,KAAKC,MAAMxE,aAAaC,QAAQ,UAAU,IAAK,CAAC,MAAAwE,GAAM,OAAO,IAAK,CAAG,EAAxF,GACPtO,GAAa,OAAJc,SAAI,IAAJA,QAAI,EAAJA,GAAMC,IAAWd,GAAe,OAAJa,SAAI,IAAJA,QAAI,EAAJA,GAAMF,KAE3C2N,IAAeC,EAAAA,EAAAA,cAAY,KAAM,IAAIC,GAAQ,EAAMzB,GAAW,GAAOC,EAAS,IAAK,MAAMyB,EAAK,IAAIC,gBAItG,OAHAC,EAAAA,GAAcC,IAAI,aAADhJ,OAAcoE,GAAK,CAAC6E,OAAOJ,EAAKI,SAASC,MAAKC,IAASP,GAAiB3B,EAAmBkC,EAAErE,KAAK,IAChHsE,OAAMnM,IAAI,IAADoM,EAAAC,EAAMV,GAA6B,kBAAT3L,EAAE8C,MAAgCqH,GAAU,OAADnK,QAAC,IAADA,GAAW,QAAVoM,EAADpM,EAAG4H,gBAAQ,IAAAwE,GAAM,QAANC,EAAXD,EAAavE,YAAI,IAAAwE,OAAhB,EAADA,EAAmBzI,UAAS,iBAAiB,IAC3H0I,SAAQ,IAAIX,GAAWzB,GAAW,KAC9B,KAAMyB,GAAQ,EAAOC,EAAKW,OAAO,CAAG,GAC3C,CAACpF,KACHjI,EAAAA,EAAAA,YAAU,IAAsBuM,MAAkC,CAACA,MAGnEvM,EAAAA,EAAAA,YAAU,KACR,IAAI6K,IAAoBA,EAAgByC,aAAoD,IAArCzC,EAAgByC,YAAY3N,OAAY,OAC/F,IAAI4N,GAAO,EAUX,MATA,WACE,IACE,MAAMC,QAAYZ,EAAAA,GAAcC,IAAI,aAADhJ,OAAcgH,EAAgB9L,IAAG,wBACpE,IAAIwO,EAAQ,OACZ,MAAME,EAAI,CAAC,GACVD,EAAI7E,MAAM,IAAI+E,SAAQC,IAAQA,EAAE5M,KAAO4M,EAAEC,YAAWH,EAAIE,EAAE5M,KAAK4M,EAAEC,UAAS,IAC3E1B,GAAcuB,EAChB,CAAC,MAAMnF,GAAMP,QAAQ8F,KAAK,yCAA0CvF,EAAM,CAC3E,EARD,GASO,KAAKiF,GAAO,CAAK,CAAC,GACzB,CAAC1C,KAEH7K,EAAAA,EAAAA,YAAU,KAAM,MAAM8N,EAASA,KAAM,MAAMC,EAAG/M,OAAOgN,aAAavN,SAASwN,gBAAgBC,UAAW/C,EAAqB4C,EAAG,GAAG,EAAWnJ,EAAS9D,IAASqL,GAAmBlM,UAAYkM,GAAmBlM,QAAQkO,SAASrN,EAAEoF,SAASmF,GAAiB,EAAM,EAA6F,OAAxFrK,OAAOC,iBAAiB,SAAS6M,GAAWrN,SAASQ,iBAAiB,QAAQ2D,GAAiB,KAAM5D,OAAOE,oBAAoB,SAAS4M,GAAWrN,SAASS,oBAAoB,QAAQ0D,EAAQ,CAAG,GAAI,IAEhd,MAAMwJ,IAAa5B,EAAAA,EAAAA,cAAY,IAAK7B,GAAU,IAAG,CAACA,IAI5C0D,GAAuB,WAC3B,MAAMC,GAD8B5O,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,IAChB6O,MAAM,KAAKC,MAAMjD,cACtC,MAAG,CAAC,MAAM,MAAM,OAAO,MAAM,QAAQ3I,SAAS0L,IAAa/J,EAAAA,EAAAA,KAAA,KAAGI,UAAU,sBAC/D,QAAN2J,GAAoB/J,EAAAA,EAAAA,KAAA,KAAGI,UAAU,kBAAkBhE,MAAO,CAACqD,MAAM,aACjE,CAAC,MAAM,QAAQpB,SAAS0L,IAAa/J,EAAAA,EAAAA,KAAA,KAAGI,UAAU,mBAAmBhE,MAAO,CAACqD,MAAM,aACnF,CAAC,MAAM,QAAQpB,SAAS0L,IAAa/J,EAAAA,EAAAA,KAAA,KAAGI,UAAU,oBAAoBhE,MAAO,CAACqD,MAAM,cAChFO,EAAAA,EAAAA,KAAA,KAAGI,UAAU,eACtB,EAsBA,IAHA3E,EAAAA,EAAAA,YAAU,KACR,IAAI+L,GAAmB,OAAQ,MAAMlL,EAAMC,IAAgB,WAARA,EAAEC,KAAgBiL,GAAqB,KAAK,EAA+C,OAA1ChL,OAAOC,iBAAiB,UAAUJ,GAAe,IAAIG,OAAOE,oBAAoB,UAAUL,EAAM,GAAI,CAACkL,KAExMhB,GAAStC,IAAQoC,EAClB,OAAOvH,EAAAA,EAAAA,MAAA,OAAKqB,UAAS,uBAAAd,OAAyBwG,GAAYhJ,SAAA,EACtDoJ,IAAiBlG,EAAAA,EAAAA,KAACkK,EAAAA,EAAS,CAACC,aAAc9P,GAAM,IAAI2M,cAAc3I,SAAS,mBAAoB,MAAQhE,GAAM,IAAI2M,cAAc3I,SAAS,gBAAiB,MAAQhE,GAAM,IAAI2M,cAAc3I,SAAS,oBAAqB,OAAShE,GAAM,IAAI2M,cAAc3I,SAAS,OAAQ,OAAShE,GAAM,IAAI2M,cAAc3I,SAAS,MAAO,KAAK,MAC/T+L,OAAOrL,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,iBAAiBhE,MAAO,CAACuD,QAAQ,kBAAkB7C,SAAA,EACvEiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,cAAatD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,MAAII,UAAU,eAAehE,MAAO,CAAC0D,OAAO,EAAEF,SAAS,WAAW9C,SAAC,6BAA4BkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,kBAAkBhE,MAAO,CAAC0D,OAAO,EAAEF,SAAS,UAAUsD,QAAQ,KAAKpG,SAAC,wBAC7MkD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,eAActD,UAACiC,EAAAA,EAAAA,MAAA,UAAQsB,QAASwJ,GAAYzJ,UAAU,gBAAetD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,sBAAqB,mBAG3HJ,EAAAA,EAAAA,KAAA,OAAKI,UAAU,iBAAgBtD,UAACiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,iBAAgBtD,SAAA,CAAE0J,IAAWzH,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,gBAAetD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,qBAAmBJ,EAAAA,EAAAA,KAAA,KAAAlD,SAAG,mBAAuB0J,GAAWtC,IAASlE,EAAAA,EAAAA,KAAA,OAAKI,UAAU,cAAatD,UAACkD,EAAAA,EAAAA,KAAA,KAAAlD,SAAIoH,cAGhO,MAAM,MAAEmG,GAAK,KAAEC,KAASC,EAAAA,EAAAA,IAAqBjE,GACvCkE,GAAiBH,GAAMI,QAAOC,GAAa,cAAVA,EAAEC,QAAqBvP,OACxDwP,GAAaP,GAAMjP,OACnByP,GAAcC,KAAKC,IAAI,IAAKD,KAAKE,MAAOR,IAAgBI,IAAY,GAAI,MACxEK,IAAcC,EAAAA,EAAAA,IAAe5E,EAAgBxM,OAAQwQ,GAAK/M,YAC1D4N,IAASC,EAAAA,EAAAA,IAAoB9E,EAAiB5M,IAE9C0E,GAAW,UAAUiN,KAAK/E,EAAgBxM,QAAQ,IACxD,IAAIwR,GAAiB,KAClBlN,IAAYmN,MAAMC,QAAQlF,EAAgBrM,aAC3CqR,GAAiB,IAAIhF,EAAgBrM,WAAWsE,UAAUC,MAAKrE,GAAgB,WAAbA,EAAEuE,YAGtE,MACM+M,GAAsB,sBADT/R,IAAU,IAAIsN,cAE3B0E,IAA2B,OAAfpF,QAAe,IAAfA,GAA0B,QAAX5B,EAAf4B,EAAiBqF,iBAAS,IAAAjH,OAAX,EAAfA,EAA4BlK,OAAQf,GAChDmS,IAAetF,EAAgBxM,QAAQ,IAAIkN,cAC3C6E,GAAkC,aAAhBD,IAA8BtF,EAAgBwF,cAEhEC,GAAiBR,MAAMC,QAAQlF,EAAgBrM,YAAcqM,EAAgBrM,UAAUmB,OAAS,EAChG4Q,GAAaP,IAASC,KAAcG,KAAoBE,IAAkC,4BAAhBH,GAC1EK,GAAkBR,IAASC,KAAcG,IAAmC,aAAhBD,GAclE,OACE7M,EAAAA,EAAAA,MAAA,OAAKqB,UAAS,uBAAAd,OAAyBwG,GAAYhJ,SAAA,EAC/CoJ,IAAkBD,IAClBjG,EAAAA,EAAAA,KAACkK,EAAAA,EAAS,CAACC,aAAc9P,GAAM,IAAI2M,cAAc3I,SAAS,mBAAoB,MAAQhE,GAAM,IAAI2M,cAAc3I,SAAS,gBAAiB,MAAQhE,GAAM,IAAI2M,cAAc3I,SAAS,oBAAqB,OAAShE,GAAM,IAAI2M,cAAc3I,SAAS,OAAQ,OAAShE,GAAM,IAAI2M,cAAc3I,SAAS,MAAO,KAAK,MAC5S+L,OAAOrL,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,iBAAiBhE,MAAO,CAACuD,QAAQ,kBAAkB7C,SAAA,EACvEiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,cAAatD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,MAAII,UAAU,eAAehE,MAAO,CAAC0D,OAAO,EAAEF,SAAS,WAAW9C,SAAEiJ,KAAiB/F,EAAAA,EAAAA,KAAA,KAAGI,UAAU,kBAAkBhE,MAAO,CAAC0D,OAAO,EAAEF,SAAS,UAAUsD,QAAQ,KAAKpG,SAAEkJ,QACpMhG,EAAAA,EAAAA,KAAA,OAAKI,UAAU,eAActD,UAACiC,EAAAA,EAAAA,MAAA,UAAQsB,QAASwJ,GAAYzJ,UAAU,gBAAetD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,sBAAqB,oBAI7HJ,EAAAA,EAAAA,KAAA,OAAKI,UAAU,iBAAgBtD,UACnCiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAS,OAAAd,OAASyH,EAAO,WAAW,IAAKjK,SAAA,EACtCiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,eAActD,SAAA,EAC3BiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,gBAAetD,SAAA,EAC5BiC,EAAAA,EAAAA,MAAA,UAAQsB,QAASwJ,GAAYzJ,UAAU,eAAeF,KAAK,SAAS,aAAW,wBAAuBpD,SAAA,EACpGkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,uBACbJ,EAAAA,EAAAA,KAAA,QAAAlD,SAAM,aAERkD,EAAAA,EAAAA,KAAA,MAAII,UAAU,iBAAgBtD,SAAC,wBAEhCwJ,EAAgBxM,SAAUkG,EAAAA,EAAAA,KAAA,OAAKI,UAAU,wBAG5CrB,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,aAAYtD,SAAA,EACzBiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,qBAAoBtD,SAAA,EACjCiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,cAAatD,SAAA,EAC1BiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,cAAatD,SAAA,EAC1BkD,EAAAA,EAAAA,KAAA,QAAMI,UAAU,eAActD,SAAC,QAC/BkD,EAAAA,EAAAA,KAAA,QAAMI,UAAU,eAActD,SAAEwJ,EAAgB9L,OAChDwF,EAAAA,EAAAA,KAAA,UAAQI,UAAU,WAAWC,QAASA,KAAK,IAAD6L,EAAoB,QAAnBA,EAAAC,UAAUC,iBAAS,IAAAF,GAAnBA,EAAqBG,UAAU/F,EAAgB9L,KAAM6M,GAAU,GAAOhK,YAAW,IAAIgK,GAAU,IAAO,KAAK,EAAIiF,MAAM,UAASxP,UAACkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,kBACtLgH,IAAUpH,EAAAA,EAAAA,KAAA,QAAMI,UAAU,aAAYtD,SAAC,gBAE1CkD,EAAAA,EAAAA,KAAA,MAAII,UAAU,YAAYhE,MAAO,CAAC0G,UAAU,GAAGhG,SAAEwJ,EAAgBiG,eAAiB,qBACjFjG,EAAgBkG,cAAexM,EAAAA,EAAAA,KAAA,KAAGI,UAAU,WAAWhE,MAAO,CAAC0G,UAAU,GAAGhG,SAAEwJ,EAAgBkG,eAC/FzN,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,mBAAkBtD,SAAA,EAC/BiC,EAAAA,EAAAA,MAAA,QAAMqB,UAAU,WAAUtD,SAAA,CAAC,WAAS,IAAIa,KAAK2I,EAAgBmG,WAAW7O,yBAC9C,QAAvB+G,EAAA2B,EAAgBoG,eAAO,IAAA/H,OAAA,EAAvBA,EAAyBgI,eAAe3M,EAAAA,EAAAA,KAAA,QAAMI,UAAU,WAAUtD,SAAEwJ,EAAgBoG,QAAQC,cACjD,kBAAb,QAA9B/H,EAAO0B,EAAgBoG,eAAO,IAAA9H,OAAA,EAAvBA,EAAyBgI,UAAuB7N,EAAAA,EAAAA,MAAA,QAAMqB,UAAU,WAAUtD,SAAA,CAAC,2BAAoBwJ,EAAgBoG,QAAQE,OAAOC,qBAChH,QAAvBhI,EAAAyB,EAAgBoG,eAAO,IAAA7H,OAAA,EAAvBA,EAAyBiI,YAAY9M,EAAAA,EAAAA,KAAA,QAAMI,UAAU,WAAUtD,UAAkC,QAAhCgI,EAAAwB,EAAgBoG,QAAQI,gBAAQ,IAAAhI,OAAA,EAAhCA,EAAkCzF,QAAwC,QAApC0F,EAAIuB,EAAgBoG,QAAQI,gBAAQ,IAAA/H,GAAU,QAAVC,EAAhCD,EAAkCgI,gBAAQ,IAAA/H,OAAV,EAAhCA,EAAAgI,KAAAjI,KAAkD,eAEhKhG,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,eAAe,aAAW,oBAAmBtD,SAAA,EAC1DkD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,mBAAkBtD,UAACkD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,oBAAoBhE,MAAO,CAAC8E,MAAM2J,GAAY,UAC/F9L,EAAAA,EAAAA,MAAA,QAAMqB,UAAU,oBAAmBtD,SAAA,CAAE+N,GAAY,YAAKL,GAAe,IAAEI,GAAW,mBAGtF5K,EAAAA,EAAAA,KAAA,OAAKI,UAAU,eAActD,UAC3BkD,EAAAA,EAAAA,KAAA,OAAKI,UAAS,2BAAAd,OAA6B2L,GAAYjE,eAAgBlK,SAAEmO,WAI7ElM,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,kBAAiBtD,SAAA,EAC9BiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,eAActD,SAAA,CAC1BsB,IAAYkN,KACXvM,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CACVoD,WAAW,UACXO,OAAO,oBACPJ,QAAQ,YACRD,aAAa,GACbT,aAAa,GACbQ,MAAM,UACN4C,WAAW,IACXzC,SAAS,IACRvF,KAAK,QAAQ,YAAU,SAAQyC,SAAA,EAChCiC,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CAAC8C,WAAW,IAAID,aAAa,EAAE8D,QAAQ,OAAOsB,WAAW,SAASpB,IAAI,GAAGnG,SAAA,EACnFkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,eAAc,kBAAgBkL,GAAejR,KAAK,OAADiF,OAAQgM,GAAejR,MAAO,OAE9F2F,EAAAA,EAAAA,KAAA,OAAK5D,MAAO,CAAC+F,WAAW,YAAYrF,SAAEwO,GAAerL,QAAU,yBAC3C,QAAnBgF,EAAAqG,GAAe/Q,YAAI,IAAA0K,OAAA,EAAnBA,EAAqB5F,QACpBN,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CAAC0G,UAAU,EAAElD,SAAS,GAAGsD,QAAQ,IAAIpG,SAAA,CAAC,OAAKwO,GAAe/Q,KAAK8E,KAAK,WAAI,IAAI1B,KAAK2N,GAAe5N,MAAM4N,GAAe2B,WAAW3B,GAAemB,WAAWnG,EAAgB2G,WAAWJ,wBAK/M9N,EAAAA,EAAAA,MAAA,WAASqB,UAAU,mBAAmB,kBAAgB,SAAQtD,SAAA,EACpDiC,EAAAA,EAAAA,MAAA,MAAI2E,GAAG,SAAStD,UAAU,oBAAmBtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,uBAAsB,mBACjFrB,EAAAA,EAAAA,MAAA,MAAIqB,UAAU,qBAAoBtD,SAAA,EAChCiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,YAAWtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,eAAckD,EAAAA,EAAAA,KAAA,MAAAlD,SAAKwJ,EAAgBiG,eAAe,eAEjFxN,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,YAAWtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,aAAYkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAK,IAAIa,KAAK2I,EAAgBmG,WAAWI,sBACnFvC,GAAK/M,aAAcwB,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,YAAWtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,cAAakD,EAAAA,EAAAA,KAAA,MAAAlD,SAAK,IAAIa,KAAK2I,EAAgB4G,YAAc5G,EAAgB9I,cAAcqP,uBAC1I9N,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,YAAWtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,YAAWkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAKmO,SAC/ClM,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,YAAWtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,aAAYkD,EAAAA,EAAAA,KAAA,MAAAlD,UAA4B,QAAvBoI,EAAAoB,EAAgBoG,eAAO,IAAAxH,OAAA,EAAvBA,EAAyByH,cAAa,cACpD,kBAAb,QAA9BxH,EAAOmB,EAAgBoG,eAAO,IAAAvH,OAAA,EAAvBA,EAAyByH,UAAuB7N,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,YAAWtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,oBAAmBiC,EAAAA,EAAAA,MAAA,MAAAjC,SAAA,CAAI,SAAEwJ,EAAgBoG,QAAQE,OAAOC,8BAIzI9N,EAAAA,EAAAA,MAAA,WAASqB,UAAU,mBAAmB,kBAAgB,QAAOtD,SAAA,EAC3DiC,EAAAA,EAAAA,MAAA,MAAI2E,GAAG,QAAQtD,UAAU,oBAAmBtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,gBAAe,iBACzErB,EAAAA,EAAAA,MAAA,MAAIqB,UAAU,qBAAoBtD,SAAA,EAChCiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,YAAWtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,UAASkD,EAAAA,EAAAA,KAAA,MAAAlD,UAA8B,QAAzBsI,EAAAkB,EAAgBqF,iBAAS,IAAAvG,OAAA,EAAzBA,EAA2B/F,OAAM,eAC9EN,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,YAAWtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,WAAUkD,EAAAA,EAAAA,KAAA,MAAAlD,UAA8B,QAAzBuI,EAAAiB,EAAgBqF,iBAAS,IAAAtG,OAAA,EAAzBA,EAA2B8H,QAAO,eAChFpO,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,YAAWtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,UAASkD,EAAAA,EAAAA,KAAA,MAAAlD,UAA8B,QAAzBwI,EAAAgB,EAAgBqF,iBAAS,IAAArG,OAAA,EAAzBA,EAA2BjL,OAAM,eAC9E0E,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,YAAWtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,cAAakD,EAAAA,EAAAA,KAAA,MAAAlD,UAA4B,QAAvByI,EAAAe,EAAgBoG,eAAO,IAAAnH,GAAU,QAAVC,EAAvBD,EAAyBuH,gBAAQ,IAAAtH,OAAV,EAAvBA,EAAmCnG,QAA+B,QAA3BoG,EAAIa,EAAgBoG,eAAO,IAAAjH,GAAU,QAAVC,EAAvBD,EAAyBqH,gBAAQ,IAAApH,GAAU,QAAVC,EAAjCD,EAAmCqH,gBAAQ,IAAApH,OAApB,EAAvBA,EAAAqH,KAAAtH,KAAmD,qBAInJ3G,EAAAA,EAAAA,MAAA,WAASqB,UAAU,mBAAmB,kBAAgB,QAAOtD,SAAA,EAC3DiC,EAAAA,EAAAA,MAAA,MAAI2E,GAAG,QAAQtD,UAAU,oBAAmBtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,iBAAgB,gBAChD,QAAzBwF,EAAAU,EAAgB8G,iBAAS,IAAAxH,GAAzBA,EAA2BxK,QAC1B4E,EAAAA,EAAAA,KAAA,MAAII,UAAU,2BAA0BtD,SACrCwJ,EAAgB8G,UAAUlE,KAAI,CAACmE,EAAEC,KAChCvO,EAAAA,EAAAA,MAAA,MAAYqB,UAAU,oBAAmBtD,SAAA,EACvCiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,oBAAmBtD,SAAA,EAChCkD,EAAAA,EAAAA,KAAA,QAAMI,UAAU,oBAAmBtD,SAAEuQ,EAAEE,gBACvCxO,EAAAA,EAAAA,MAAA,QAAMqB,UAAU,UAAStD,SAAA,CAAEuQ,EAAEG,SAAUH,EAAEI,KAAK,IAADnO,OAAK+N,EAAEI,MAAO,SAE5DJ,EAAEK,iBAAkB1N,EAAAA,EAAAA,KAAA,OAAKI,UAAU,WAAUtD,SAAEuQ,EAAEK,mBAL3CJ,QASXtN,EAAAA,EAAAA,KAAA,KAAGI,UAAU,YAAWtD,SAAC,mCAIjCiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,eAActD,SAAA,EAE3BiC,EAAAA,EAAAA,MAAA,WAASqB,UAAU,mBAAmB,kBAAgB,QAAOtD,SAAA,EAC3DiC,EAAAA,EAAAA,MAAA,MAAI2E,GAAG,QAAQtD,UAAU,oBAAmBtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,qBAAoB,kBAClD,QAA3ByF,EAAAS,EAAgByC,mBAAW,IAAAlD,GAA3BA,EAA6BzK,QAC5B4E,EAAAA,EAAAA,KAAA,OAAKI,UAAU,qBAAoBtD,SAChCwJ,EAAgByC,YAAYG,KAAI,CAAC/O,EAAEmT,KAClC,MAAMK,EAvLD,WAAW,IAAVxT,EAACgB,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,GAC5B,IAAIhB,EAAG,MAAO,GACd,GAAGuN,GAAWvN,GAAI,OAAOuN,GAAWvN,GAEpC,GAAGA,EAAEyT,WAAW,QAAQ,CACtB,MAAMP,EAAIlT,EAAE0T,MAAM,iEAClB,OAAGR,GAAKA,EAAE,IAAM3F,GAAW2F,EAAE,IAAY3F,GAAW2F,EAAE,IAC/ClT,CACT,CACA,MAAO,EACT,CA6KkC2T,CAAmB3T,GACzB4T,EA5LZ,WACd,MAAMhE,GADc5O,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,IACH6O,MAAM,KAAKC,MAAMjD,cACnC,MAAO,CAAC,MAAM,MAAM,OAAO,MAAM,QAAQ3I,SAAS0L,EACpD,CAyLoCiE,CAAQ7T,GACtB,OACE4E,EAAAA,EAAAA,MAAA,OAAaqB,UAAU,kBAAkBkM,MAAOnS,EAAE2C,SAAA,CAC/CiR,GAASJ,GACR3N,EAAAA,EAAAA,KAAA,UAAQE,KAAK,SAASE,UAAU,YAAYC,QAASA,IAAIoH,GAAqBkG,GAAM,aAAW,qBAAoB7Q,UACjHkD,EAAAA,EAAAA,KAAA,OAAKiO,IAAKN,EAAKO,IAAK/T,EAAGqM,QAAQ,YAGjCxG,EAAAA,EAAAA,KAAA,OAAKI,UAAU,gBAAgBC,QAASA,IAAKsN,GAAOlR,OAAO0R,KAAKR,EAAI,SAAS,YAAatT,KAAK,SAAS+T,SAAU,EAAGC,UAAW9R,GAAW,UAARA,EAAEC,KAAgBmR,GAAOlR,OAAO0R,KAAKR,EAAI,SAAS,YAAY7Q,SAC9LgN,GAAqB3P,MAG1B4E,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,kBAAiBtD,SAAA,EAC9BkD,EAAAA,EAAAA,KAAA,QAAMI,UAAU,sBAAqBtD,SAAE3C,IACtCwT,GAAM3N,EAAAA,EAAAA,KAAA,KAAGI,UAAU,sBAAsBkO,KAAMX,EAAKhM,OAAO,SAAS4M,IAAI,sBAAqBzR,SAAC,cAAekD,EAAAA,EAAAA,KAAA,QAAM5D,MAAO,CAACwD,SAAS,GAAGH,MAAM,WAAW3C,SAAC,gBAZpJwQ,EAcJ,OAIVtN,EAAAA,EAAAA,KAAA,KAAGI,UAAU,YAAWtD,SAAC,wBAG/BiC,EAAAA,EAAAA,MAAA,WAASqB,UAAU,mBAAmB,kBAAgB,SAAQtD,SAAA,EAC5DiC,EAAAA,EAAAA,MAAA,MAAI2E,GAAG,SAAStD,UAAU,oBAAmBtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,iBAAgB,qBAC3EJ,EAAAA,EAAAA,KAAA,MAAII,UAAU,eAActD,SACzBuN,GAAMnB,KAAIsF,IAAQ,MAAMC,EAA+B,aAAXD,EAAKhS,KAAiC,YAAbgS,EAAK7D,OAAqBL,GAAKoE,YAAcpE,GAAKqE,aAAerE,GAAK/M,aAAe+M,GAAKsE,UAAiBC,EAAWL,EAAK9Q,KAAM,IAAIC,KAAK6Q,EAAK9Q,MAAMmP,iBAAgC,YAAb2B,EAAK7D,MAAoB,UAAY8D,EAAoB,uBAAyB,UAAW,OACzU1P,EAAAA,EAAAA,MAAA,MAAmBqB,UAAS,WAAAd,OAAakP,EAAK7D,OAAQ7N,SAAA,EACpDkD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,aACfrB,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,aAAYtD,SAAA,EACzBkD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,WAAUtD,SAAE0R,EAAKM,SAChC9O,EAAAA,EAAAA,KAAA,OAAKI,UAAU,UAAStD,SAAE+R,SAJrBL,EAAKhS,IAMT,UAKT2O,IAAUa,IAAcC,MACxBlN,EAAAA,EAAAA,MAAA,WAASqB,UAAU,mBAAmB,kBAAgB,QAAOtD,SAAA,EAC3DiC,EAAAA,EAAAA,MAAA,MAAI2E,GAAG,QAAQtD,UAAU,oBAAmBtD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,iBAAgB,cACzE+K,KAAUnL,EAAAA,EAAAA,KAAA,OAAKI,UAAU,mBAAkBtD,UAACkD,EAAAA,EAAAA,KAAC+O,EAAAA,QAAkB,CAACvV,YAAa8M,EAAiB7M,OAAQA,GAAQC,SAAUA,GAAUC,OAAQkQ,GAAYjQ,iBAAkBoO,QACvKgE,IAAcC,MACdlN,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,mBAAmBhE,MAAO,CAAC2G,QAAQ,OAAOiM,cAAc,SAAS/L,IAAI,IAAInG,SAAA,CACrFkP,KAAcjN,EAAAA,EAAAA,MAAA,UAAQsB,QAxK1B4O,KAAWjD,IAAY5F,EAAS,8BAAD9G,OAA+BgH,EAAgB9L,KAAM,EAwKrC4F,UAAU,gBAAetD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,gBAAe,mBACjG6L,KAAmBlN,EAAAA,EAAAA,MAAA,UAAQsB,QAnLvB8C,UACzB,GAAI8I,KAAmB3E,EAAvB,CACAC,GAAa,GACb,UACQc,EAAAA,GAAc6G,MAAM,aAAD5P,OAAcgH,EAAgB9L,IAAG,cAC1D+L,GAAmBtK,IAAIkT,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAASlT,GAAI,IAAEnC,OAAO,WAAYgS,eAAc,EAAMtO,cAAa,IAAIG,MAAOyR,iBACvG,CAAE,MAAO7S,GACP8S,MAAM,6BACR,CAAC,QAAW9H,GAAa,EAAQ,CAPO,CAOP,EA2K4ChH,SAAU+G,EAAWlH,UAAU,cAAatD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,oBAAmB,IAAEkH,EAAW,aAAe,uBAClKtH,EAAAA,EAAAA,KAAA,KAAG5D,MAAO,CAACwD,SAAS,GAAGE,OAAO,EAAEL,MAAM,WAAW3C,SAAC,6FAQ/D0K,KACCxH,EAAAA,EAAAA,KAAA,OAAKI,UAAU,eAAe/F,KAAK,SAAS,aAAW,OAAO,aAAW,qBAAqBgG,QAASA,IAAIoH,GAAqB,MAAM3K,UACpIiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,qBAAqBC,QAAS9D,GAAGA,EAAE8E,kBAAkBvE,SAAA,EAClEkD,EAAAA,EAAAA,KAAA,UAAQI,UAAU,qBAAqBC,QAASA,IAAIoH,GAAqB,MAAO,aAAW,gBAAe3K,UAACkD,EAAAA,EAAAA,KAAA,KAAGI,UAAU,oBACxHJ,EAAAA,EAAAA,KAAA,OAAKiO,IAAKzG,GAAmB0G,IAAI,qBAAqB9N,UAAU,iCAMtE,C,4JClQV,SAASjC,EAAeT,GACtB,IAAKA,EAAM,MAAO,MAClB,MAAM4R,EAAK,IAAI3R,KAAKD,GACpB,OAAO6R,OAAOC,MAAMF,EAAGG,WAAa,MAAQH,EAAGzC,gBACjD,CA6BA,SAAS6C,EAAmBC,GAC1B,IAAKA,EAAK,MAAO,UACjB,GAAIA,EAAI7V,OAAQ,OAAO6V,EAAI7V,OAC3B,GAAI6V,EAAIC,eAAiBrE,MAAMC,QAAQmE,EAAIC,eAAgB,CACzD,MAAMC,EAAWF,EAAIC,cAAcD,EAAIC,cAAcxU,OAAS,GAC9D,OAAe,OAARyU,QAAQ,IAARA,OAAQ,EAARA,EAAU/V,SAAU,SAC7B,CACA,MAAO,SACT,CAEOqJ,eAAe2M,IAAoD,IAA1B/N,EAAI5G,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,GAAI4U,EAAO5U,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,CAAC,EACpE,MAAM,YACJ6U,EAAc,YAAW,SACzBC,EAAQ,GAAA3Q,OAAgC,GAAE,yBAAuB,aACjE4Q,EAAe,UAAS,aACxBC,EAAe,GAAE,QACjBC,EAAU,CAAC,EAAC,YACZC,EAAc,4BACZN,EAEEO,EAAM,IAAIC,EAAAA,GAAM,CAAE9C,KAAM,KAAM+C,OAAQ,OAKtCC,EAAW,YACXC,EAAY,OAEZC,EAAU,GAChB,IAAIC,EAAI,GAGR,MAAMC,QA3H0BlD,EA2HYsC,EA1HrC,IAAIa,SAASC,IAClB,IAAKpD,EAAK,OAAOoD,EAAQ,MACzB,IACE,MAAMC,EAAM,IAAIC,MAChBD,EAAIE,YAAc,YAClBF,EAAIG,OAAS,KACX,MAAMC,EAAIlV,SAASmV,cAAc,UACjCD,EAAElQ,MAAQ8P,EAAIM,aACdF,EAAEG,OAASP,EAAIQ,cACfJ,EAAEK,WAAW,MAAMC,UAAUV,EAAK,EAAG,GACrCD,EAAQ,CAAEY,QAASP,EAAEQ,UAAU,aAAcC,EAAGb,EAAIM,aAAcQ,EAAGd,EAAIQ,eAAgB,EAE3FR,EAAIe,QAAU,IAAMhB,EAAQ,MAC5BC,EAAI/C,IAAMN,CACZ,CAAE,MAAA5F,GACAgJ,EAAQ,KACV,MAjBJ,IAAkCpD,EA4HhC,IAAIqE,EAASrB,EACb,GAAQ,OAAJE,QAAI,IAAJA,GAAAA,EAAMc,QAAS,CACjB,MAAQE,EAAGI,EAAOH,EAAGI,GA1EzB,SAAmBL,EAAGC,EAAGK,EAAMC,GAC7B,IAAKP,IAAMC,EAAG,MAAO,CAAED,EAAGM,EAAML,EAAGM,GACnC,MAAM3J,EAAIqC,KAAKC,IAAIoH,EAAON,EAAGO,EAAON,EAAG,GACvC,MAAO,CAAED,EAAGA,EAAIpJ,EAAGqJ,EAAGA,EAAIrJ,EAC5B,CAsEmC4J,CAAUxB,EAAKgB,EAAGhB,EAAKiB,EAAG,IAAK,IAC9DxB,EAAIgC,SAASzB,EAAKc,QAAS,MAAOhB,EAASC,EAAI,GAAIqB,EAAOC,OAAO7W,EAAW,QAC5E2W,EAASrB,EAAUsB,EAAQ,EAC7B,CAEA3B,EAAIiC,QAAQ9B,EAAUC,GACtBJ,EAAIkC,YAAY,IAChBlC,EAAImC,aAAa,IACjBnC,EAAIoC,KAAKpY,OAAO0V,GAAcgC,EAAQpB,EAAI,IAE1CN,EAAIiC,QAAQ9B,EAAU,UACtBH,EAAIkC,YAAY,IAChBlC,EAAImC,aAAa,IACjBnC,EAAIoC,KAAKrC,EAAa2B,EAAQpB,EAAI,IAGlCN,EAAIqC,aAAa,KACjBrC,EAAIsC,aAAa,GACjBtC,EAAIuC,KAAKlC,EAASC,EAAI,GAAI,IAAeA,EAAI,IAC7CA,GAAK,GAGLN,EAAIiC,QAAQ9B,EAAUC,GACtBJ,EAAIkC,YAAY,IAChBlC,EAAImC,aAAa,IACjBnC,EAAIoC,KAAK,iBAAkB/B,EAASC,GAEpCN,EAAIiC,QAAQ9B,EAAU,UACtBH,EAAImC,aAAa,IACjB,MAAMnI,EAAO,CAAC,gBAADhL,OACK4Q,GAAY5Q,OAAG6Q,EAAY,KAAA7Q,OAAQ6Q,EAAY,KAAM,IAAE,kBAAA7Q,OACrDnB,EAAe,IAAIR,QAEjCmV,EAvFR,SAA6B1C,GAC3B,MAAM2C,EAAQ,GAUd,GATI3C,EAAQtW,QAA6B,QAAnBsW,EAAQtW,QAAuC,QAAnBsW,EAAQtW,QACxDiZ,EAAMC,KAAK,WAAD1T,OAAY8Q,EAAQtW,SAE5BsW,EAAQ6C,QAAU7C,EAAQ6C,OAAO7P,QACnC2P,EAAMC,KAAK,YAAD1T,OAAa8Q,EAAQ6C,OAAO7P,OAAM,MAE1CgN,EAAQ8C,QAA6B,WAAnB9C,EAAQ8C,QAC5BH,EAAMC,KAAK,SAAD1T,OAAU8Q,EAAQ8C,SAE1B9C,EAAQ+C,UAAY/C,EAAQgD,OAAQ,CACtC,MAAMC,EAAOjD,EAAQ+C,SAAW,IAAIxV,KAAKyS,EAAQ+C,UAAUvV,qBAAuB,QAC5E0V,EAAKlD,EAAQgD,OAAS,IAAIzV,KAAKyS,EAAQgD,QAAQxV,qBAAuB,MAC5EmV,EAAMC,KAAK,eAAD1T,OAAgB+T,EAAI,OAAA/T,OAAMgU,GACtC,CACA,OAAOP,EAAM3X,OAAS2X,EAAMQ,KAAK,MAAQ,IAC3C,CAsEwBC,CAAoBpD,GACtC0C,GAAexI,EAAK0I,KAAK,YAAD1T,OAAawT,IAEzC,IAAIW,EAAQ7C,EAAI,GAChBtG,EAAKnB,SAAS0J,IACZvC,EAAIoC,KAAKG,EAAMlC,EAAS8C,GACxBA,GAAS,EAAE,IAIb,MAAMC,EAAcD,EAAQ,EAEtBtX,EAAO4F,EAAKmH,KAAKT,IAAO,IAADkL,EAAAC,EAC3B,MAAMC,EAAkBtI,MAAMC,QAAQ/C,EAAE2E,WACpC3E,EAAE2E,UAAUlE,KAAKmE,GAAC,GAAA/N,OAAQ+N,EAAEG,SAAQ,KAAAlO,OAAI+N,EAAEhO,MAAQgO,EAAEE,gBAAgBgG,KAAK,MACzE,GACJ,MAAO,CACL9K,EAAEgE,UAAY,IAAI9O,KAAK8K,EAAEgE,WAAW7O,qBAAuB,GAC3DtD,QAAkB,QAAXqZ,EAAAlL,EAAEkD,iBAAS,IAAAgI,OAAA,EAAXA,EAAatU,OAAQ,IAC5B/E,QAAgB,QAATsZ,EAAAnL,EAAEiE,eAAO,IAAAkH,OAAA,EAATA,EAAWjH,cAAe,IACjCkH,EACAnE,EAAmBjH,GACnBnO,OAAOmO,EAAEqL,UAAY,UACtB,KAGHC,EAAAA,EAAAA,IAAUzD,EAAK,CACb0D,OAAQN,EACRO,KAjBW,CAAC,CAAC,OAAQ,YAAa,UAAW,sBAAuB,SAAU,aAkB9E9X,OACA+X,OAAQ,CAAEC,KAAM1D,EAAU2D,UAAW,SAAUxU,SAAU,GAAIyU,YAAa,EAAGC,OAAQ,OAAQjY,SAAU,aACvGkY,WAAY,CAAEJ,KAAM1D,EAAU2D,UAAW1D,EAAW8D,UAAW,CAAC,GAAI,IAAK,KAAMC,UAAW,KAC1FC,MAAO,OACP5U,OAAQ,CAAEkB,KAAM2P,EAASgE,MAAOhE,GAChCiE,aAAc,CAAE,EAAG,CAAEC,UAAW,MAChCC,YAAc1Q,IACZ,MAAM2Q,EAAG,cAAAzV,OAAiBnB,EAAe,IAAIR,OAC7C2S,EAAIiC,QAAQ9B,EAAU,UACtBH,EAAIkC,YAAY,GAChBlC,EAAImC,aAAa,KACjBnC,EAAIoC,KAAKqC,EAAKpE,EAASL,EAAI0E,SAASC,SAAS1D,OAAS,IAEtD,MAAM2D,EAAO9Q,EAAK+Q,YAAc,EAC1BC,EAAQ9E,EAAI+E,mBACZvG,EAAK,QAAAxP,OAAW4V,EAAI,QAAA5V,OAAO8V,GAC3BvD,EAAIvB,EAAIgF,aAAaxG,GAC3BwB,EAAIoC,KAAK5D,EAAOwB,EAAI0E,SAASC,SAAS/T,MAAQyP,EAAUkB,EAAGvB,EAAI0E,SAASC,SAAS1D,OAAS,GAAG,IAIjGjB,EAAIiF,KAjJN,WAA6D,IAAtCC,EAAMra,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,2BAC9B,MAAMsa,EAAI,IAAI9X,KACR+X,EAAOC,GAAQrb,OAAOqb,GAAKC,SAAS,EAAG,KACvClY,EAAI,GAAA4B,OAAMmW,EAAEI,eAAavW,OAAGoW,EAAID,EAAEK,WAAa,IAAExW,OAAGoW,EAAID,EAAEM,YAC1DC,EAAI,GAAA1W,OAAMoW,EAAID,EAAEQ,aAAW3W,OAAGoW,EAAID,EAAES,eAC1C,MAAM,GAAN5W,OAAUkW,EAAM,KAAAlW,OAAI5B,EAAI,KAAA4B,OAAI0W,EAAI,OAClC,CA2IWG,GACX,C,aC5MA,MAojBA,EApjBgC7c,IAYzB,IAAD8c,EAAAC,EAAA,IAZ2B,KAC/Bhc,EAAI,SACJic,EAAW,iBAAgB,UAC3BxQ,EAAY,kBAAiB,aAC7ByQ,EAAe,EAAC,eAChBC,EAAiB,oBAAmB,YACpCzQ,EAAc,oBAAmB,eACjCC,EAAiB,wBAAuB,aACxCC,EAAe,KAAI,cACnBC,GAAgB,EAAK,aACrBuQ,GAAe,EAAK,YACpBC,EAAc,4BACfpd,EACC,MAAOqd,EAAUC,IAAehc,EAAAA,EAAAA,UAAS,KAClC4L,EAASC,IAAc7L,EAAAA,EAAAA,WAAS,IAChCsJ,EAAOwC,IAAY9L,EAAAA,EAAAA,UAAS,KAC5B6P,EAAQoM,IAAajc,EAAAA,EAAAA,UAAS,QAC9Bkc,EAAYC,IAAiBnc,EAAAA,EAAAA,UAAS,KACtCsY,EAAQ8D,IAAapc,EAAAA,EAAAA,UAAS,WAC9Bqc,EAAUC,IAAetc,EAAAA,EAAAA,UAAS,SAClCuc,EAAaC,IAAkBxc,EAAAA,EAAAA,UAAS,IACxCyc,EAAWC,IAAgB1c,EAAAA,EAAAA,WAAS,IAEpC2c,EAAeC,IAAoB5c,EAAAA,EAAAA,UAAS,OAC5C6c,EAAgBC,IAAqB9c,EAAAA,EAAAA,UAAS,CAAC,IAC/C+c,EAAOC,IAAYhd,EAAAA,EAAAA,UAAS+C,KAAKka,OAClCC,EAAqB,qBAATzd,EACZ0d,EAAa,MAAO,IAAM,OAAOlQ,KAAKC,MAAMxE,aAAaC,QAAQ,SAAS,OAAS,CAAE,MAAAwE,GAAQ,OAAO,IAAM,CAAG,EAAhG,GACbtO,EAAmB,OAAVse,QAAU,IAAVA,OAAU,EAAVA,EAAYvd,KAGpBwd,EAAmBC,IAAwBrd,EAAAA,EAAAA,WAAS,IACpDsd,GAAiBC,KAAsBvd,EAAAA,EAAAA,UAAS,OAIvDa,EAAAA,EAAAA,YAAU,KAAM,GAAIqc,EAAmB,IAAM,MAAMM,EAAMvQ,KAAKC,MAAMxE,aAAaC,QAAQ,mBAAmB,MAAOmU,EAAkBU,EAAQ,CAAE,MAAAC,GAAM,IAAI,CAACP,KAC1Jrc,EAAAA,EAAAA,YAAU,KAAUqc,GAAmBxU,aAAagV,QAAQ,iBAAkBzQ,KAAK0Q,UAAUd,GAAgB,GAAI,CAACA,EAAeK,KAEjIrc,EAAAA,EAAAA,YAAU,KAAM,IAAIqc,EAAW,OAAQ,MAAMpU,EAAG8U,aAAY,IAAIZ,EAASja,KAAKka,QAAO,KAAO,MAAO,IAAIY,cAAc/U,EAAG,GAAI,CAACoU,IAC7H,MAAMY,GAAiBnC,GAEvB9a,EAAAA,EAAAA,YAAU,KACRkI,EAAAA,GAAI2E,IAAIgO,GACL9N,MAAKS,IACJ2N,EAAYrL,MAAMC,QAAQvC,EAAI7E,MAAQ6E,EAAI7E,KAAO,IACjDsC,EAAS,GAAG,IAEbgC,OAAM3E,IAAG,IAAAS,EAAAC,EAAA,OAAIiC,GAAY,OAAH3C,QAAG,IAAHA,GAAa,QAAVS,EAAHT,EAAKI,gBAAQ,IAAAK,GAAM,QAANC,EAAbD,EAAeJ,YAAI,IAAAK,OAAhB,EAAHA,EAAqBtE,UAAW,0BAA0B,IAChF0I,SAAQ,IAAMpC,GAAW,IAAO,GAClC,CAAC6P,KAGJ7a,EAAAA,EAAAA,YAAU,KAAUqc,GAAcre,GAAgBkK,EAAAA,GAAI2E,IAAI,mCAADhJ,OAAoC7F,EAAM,6BAA4B+O,MAAKC,IAAI,IAADkQ,EAAEnB,GAAuB,QAANmB,EAAAlQ,EAAErE,YAAI,IAAAuU,OAAA,EAANA,EAAS,KAAI,KAAK,IAAKjQ,OAAM,IAAI8O,EAAiB,OAAM,GAAI,CAACM,EAAUre,IAEjO,MAAMmf,GAAmBjC,EAASlM,QAAOhC,IAAM,IAADmL,EAAAiF,EAAAlF,EAC5C,MAAM7Z,GAAU2O,EAAE3O,QAAQ,IAAIkN,cACxB8R,EAAyB,aAAXhf,KAA2B2O,EAAEqD,cAC3CiN,EAAwB,aAAXjf,KAA2B2O,EAAEsQ,WAUhD,KAPiC,QAAXtO,GAAoBsO,EAC5B,YAAXtO,GAAwB3Q,EAAOuE,SAAS,aAAe0a,GAC5C,aAAXtO,GAAyB3Q,EAAOuE,SAAS,aAA0B,aAAXvE,IAA0Bif,GACvE,cAAXtO,IAA2B3Q,EAAOuE,SAAS,WAAavE,EAAOuE,SAAS,aAAe0a,GAC5E,cAAXtO,GAA0BqO,IAAgBC,GAC/B,aAAXtO,GAAyBsO,GAER,OAAO,EAG3B,MAAMpM,EAAcoM,GAActQ,EAAEuQ,oBAAsBvQ,EAAEuQ,oBAA+B,QAAZpF,EAAGnL,EAAEiE,eAAO,IAAAkH,OAAA,EAATA,EAAWjH,YAQ7F,MANqB,EACR,QAAXkM,EAAApQ,EAAE2E,iBAAS,IAAAyL,OAAA,EAAXA,EAAa3P,KAAImE,GAAKA,EAAEE,eAAcgG,KAAK,QAAS,GACpD9K,EAAE+D,aAAe,IACN,QAAXmH,EAAAlL,EAAEkD,iBAAS,IAAAgI,OAAA,EAAXA,EAAatU,OAAQ,GACrBsN,GAAe,IACf4G,KAAK,KAAKvM,cACQ3I,SAASyY,EAAW9P,cAAc,IAIlDiS,IAAiBpa,EAAAA,EAAAA,UAAQ,IACtB,IAAI+Z,IAAkBM,MAAK,CAAC/e,EAAEgf,KAAO,IAADC,EAAAC,EAAAC,EAAAC,EACzC,GAAe,QAAX9O,EAAkB,CACpB,MAAM+O,EAAsC,cAAhCrf,EAAEL,QAAQ,IAAIkN,eAAgC7M,EAAE2R,cAAgB,EAAE,EACxE2N,EAAsC,cAAhCN,EAAErf,QAAQ,IAAIkN,eAAgCmS,EAAErN,cAAgB,EAAE,EAC9E,GAAI0N,IAAOC,EAAI,OAAOD,EAAKC,CAC7B,CACQ,OAAQvG,GACZ,IAAK,SACL,IAAK,OAWK,QACR,OAAO,IAAIvV,KAAKwb,EAAE1M,WAAW,GAAK,IAAI9O,KAAKxD,EAAEsS,WAAW,GAV1D,IAAK,SACH,OAAO,IAAI9O,KAAKxD,EAAEsS,WAAW,GAAK,IAAI9O,KAAKwb,EAAE1M,WAAW,GAE1D,IAAK,SACH,OAAQtS,EAAEL,QAAQ,IAAI4f,cAAcP,EAAErf,QAAQ,IAChD,IAAK,YACH,QAAmB,QAAXsf,EAAAjf,EAAEwR,iBAAS,IAAAyN,OAAA,EAAXA,EAAa/Z,OAAM,IAAIqa,eAAyB,QAAXL,EAAAF,EAAExN,iBAAS,IAAA0N,OAAA,EAAXA,EAAaha,OAAM,IAClE,IAAK,UACH,QAAiB,QAATia,EAAAnf,EAAEuS,eAAO,IAAA4M,OAAA,EAATA,EAAW3M,cAAa,IAAI+M,eAAuB,QAATH,EAAAJ,EAAEzM,eAAO,IAAA6M,OAAA,EAATA,EAAW5M,cAAa,IAG9E,KAEH,CAACiM,GAAkB1F,EAAQzI,IAExBkP,GAAa7O,KAAK8O,KAAKX,GAAe7d,OAASsd,IAC/CmB,IAAc1C,EAAc,GAAKuB,GACjCoB,GAAeb,GAAenX,MAAM+X,GAAYA,GAAanB,KAE5DqB,GAAeC,KAAoBpf,EAAAA,EAAAA,UAAS,CAAC,IAC7Cqf,GAAYC,KAAiBtf,EAAAA,EAAAA,UAAS,MAsBvCuf,GAAwBC,IAC5B,MAAMC,EAAU1D,EAASnY,MAAKiK,GAAKA,EAAEjO,MAAQ4f,IAC7CjC,GAAmBkC,GACnBpC,GAAqB,EAAK,EAqBtBqC,GAAcnX,UAClB,IAAI2U,EAAW,OAAQ,MAAMpU,EAAG6W,EAAO/f,IAAWV,GAAQygB,EAAOzgB,QAAQ,IAAIkN,cAC7E,IAAc,4BAATlN,GAA+C,yBAATA,MACxC2d,EAAe/T,IAAO+T,EAAe/T,GAAM/F,KAAKka,SAChDkC,GAAcrW,GAAjB,CACAsW,IAAiBQ,IAACrL,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAOqL,GAAC,IAAC,CAAC9W,IAAI,MAChC,IACE,MAAM,KAAEU,SAAeT,EAAAA,GAAIC,KAAK,aAADtE,OAAcoE,EAAE,WACzC+W,GAAY,OAAJrW,QAAI,IAAJA,OAAI,EAAJA,EAAMsW,gBAAkB/c,KAAKka,MAAM,KACjDxI,MAAM,kBACNqI,GAAkBzb,IAAQ,MAAM2F,GAAIuN,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAKlT,GAAI,IAAC,CAACyH,GAAI+W,IAAsE,OAA9DnX,aAAagV,QAAQ,iBAAkBzQ,KAAK0Q,UAAU3W,IAAeA,CAAI,GACtI,CAAE,MAAMrF,GAAG,IAADoM,EAAAC,EAAA+R,EAAAC,EACR,MAAMC,EAAK,OAADte,QAAC,IAADA,GAAW,QAAVoM,EAADpM,EAAG4H,gBAAQ,IAAAwE,GAAM,QAANC,EAAXD,EAAavE,YAAI,IAAAwE,OAAhB,EAADA,EAAmBzI,QAAe2a,EAAa,OAADve,QAAC,IAADA,GAAW,QAAVoe,EAADpe,EAAG4H,gBAAQ,IAAAwW,GAAM,QAANC,EAAXD,EAAavW,YAAI,IAAAwW,OAAhB,EAADA,EAAmBF,cAAe,GAAGG,EAAkB,GAAZxL,MAAMwL,GAASC,EAAcpD,GAAkBzb,IAAQ,MAAM2F,GAAIuN,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAKlT,GAAI,IAAC,CAACyH,GAAIoX,IAA4E,OAA9DxX,aAAagV,QAAQ,iBAAkBzQ,KAAK0Q,UAAU3W,IAAeA,CAAI,QAAa,CAAE,MAAMiM,EAAM,eAAekN,KAAKF,GAAM,GAAGhN,EAAM,CAAE,MAAMmN,EAAKC,SAASpN,EAAM,GAAG,IAAW4M,EAAM9c,KAAKka,MAAW,GAALmD,EAAQ,IAAMtD,GAAkBzb,IAAQ,MAAM2F,GAAIuN,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAKlT,GAAI,IAAC,CAACyH,GAAI+W,IAAsE,OAA9DnX,aAAagV,QAAQ,iBAAkBzQ,KAAK0Q,UAAU3W,IAAeA,CAAI,GAAM,CAAE,MAASyN,MAAM,2BAA6B,CAAC,QAClkB2K,IAAiBQ,IAAK,MAAQ,CAAC9W,GAAIwX,GAAYV,EAAG,OAALW,EAAAA,EAAAA,GAAEX,EAAC,CAAjB9W,GAAEwF,IAAAkS,EAAAA,GAA4B,GAAM,CATjD,CASiD,EAGzEC,GAAmBC,IACvB,GAAGA,GAAM,EAAG,MAAO,QACnB,MAAMC,EAAWzQ,KAAK8O,KAAK0B,EAAG,KACxBjO,EAAIvC,KAAK0Q,MAAMD,EAAS,IACxB7Q,EAAI6Q,EAAS,GACnB,GAAGlO,GAAK,GAAG,CACT,MAAMyE,EAAIhH,KAAK0Q,MAAMnO,EAAE,IAAWoO,EAAKpO,EAAE,GAAI,MAAM,GAAN/N,OAAUwS,EAAC,MAAAxS,OAAKmc,EAAE,IACjE,CACA,OAAOpO,EAAE,EAAC,GAAA/N,OAAM+N,EAAC,MAAA/N,OAAKoL,EAAEqC,WAAW6I,SAAS,EAAE,KAAI,QAAAtW,OAASoL,EAAC,IAAG,EAG3DgR,GAAkBC,IACtB,IAAIA,EAAI,MAAO,GACf,MAAMlG,EAAI,IAAI9X,KAAKge,GACb9D,EAAM,IAAIla,KAEVie,EAAWnG,EAAEzX,mBAAmB,GADzB,CAAEC,KAAK,UAAWC,OAAO,YAEhC2d,EAAUpG,EAAEqG,iBAAmBjE,EAAIiE,eACzC,MAAM,GAANxc,OAAUuc,EAAS,QAAUpG,EAAE7X,qBAAoB,KAAA0B,OAAIsc,EAAQ,EAG3DG,GAAWpR,IACf,OAAOA,GACL,IAAK,YAAa,MAAO,SACzB,IAAK,SAAU,MAAO,SACtB,IAAK,UAAW,MAAO,IACvB,IAAK,UAAW,MAAO,SAEvB,QAAS,MAAO,SAClB,EAEIqR,GAASA,CAACtR,EAAGlO,IACP,cAANkO,EAA+C,OACzC,WAANA,EAAuB,SACjB,YAANA,EAAwB,UAClB,YAANA,EAAwB,UACG,UAqMjC,OACE3L,EAAAA,EAAAA,MAAA,OAAKqB,UAAS,uBAAAd,OAAyBwG,GAAYhJ,SAAA,EACnDoJ,IAAkBD,IACdjG,EAAAA,EAAAA,KAACkK,EAAAA,EAAS,CAACC,aAAc9P,GAAM,IAAI2M,cAAc3I,SAAS,mBAAoB,MAAQhE,GAAM,IAAI2M,cAAc3I,SAAS,gBAAiB,MAAQhE,GAAM,IAAI2M,cAAc3I,SAAS,oBAAqB,OAAShE,GAAM,IAAI2M,cAAc3I,SAAS,OAAQ,OAAShE,GAAM,IAAI2M,cAAc3I,SAAS,MAAO,KAAK,MAC5S+L,OAAOrL,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,iBAAiBhE,MAAO,CAACuD,QAAQ,kBAAkB7C,SAAA,EACvEiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,cAAatD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,MAAII,UAAU,eAAehE,MAAO,CAAC0D,OAAO,EAAEF,SAAS,WAAW9C,SAAEiJ,KAAiB/F,EAAAA,EAAAA,KAAA,KAAGI,UAAU,kBAAkBhE,MAAO,CAAC0D,OAAO,EAAEF,SAAS,UAAUsD,QAAQ,KAAKpG,SAAEkJ,QACpMhG,EAAAA,EAAAA,KAAA,OAAKI,UAAU,eAActD,UAACkD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,mBAAmBhE,MAAO,CAACoD,WAAW,UAAUG,QAAQ,WAAWD,aAAa,GAAGE,SAAS,IAAI9C,SAAEzC,aAIrJ2F,EAAAA,EAAAA,KAAA,QAAMI,UAAU,iBAAgBtD,UAC9BiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,iBAAgBtD,SAAA,EAC7BiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,eAActD,SAAA,EAC3BkD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,cAAatD,SACzB,CAAC,MAAM,UAAU,WAAW,YAAY,YAAY,YAAYoM,KAAI+S,IACnEjc,EAAAA,EAAAA,KAAA,UAAkBI,UAAS,cAAAd,OAAgBmL,IAASwR,EAAI,SAAS,IAAM5b,QAASA,KAAKwW,EAAUoF,GAAM7E,EAAe,EAAE,EAAGta,SAAEmf,GAA9GA,QAGjBld,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,sBAAqBtD,SAAA,EAClCkD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,iBAAgBtD,UAC7BkD,EAAAA,EAAAA,KAAA,SAAOhE,MAAO8a,EAAYrV,SAAUlF,GAAGwa,EAAcxa,EAAEoF,OAAO3F,OAAQ6G,YAAY,qBAAqBzC,UAAU,oBAEnHJ,EAAAA,EAAAA,KAAA,OAAKI,UAAU,eAActD,UAC3BiC,EAAAA,EAAAA,MAAA,UAAQ/C,MAAOkX,EAAQzR,SAAUlF,GAAGya,EAAUza,EAAEoF,OAAO3F,OAAQoE,UAAU,cAAatD,SAAA,EACpFkD,EAAAA,EAAAA,KAAA,UAAQhE,MAAM,SAAQc,SAAC,kBACvBkD,EAAAA,EAAAA,KAAA,UAAQhE,MAAM,SAAQc,SAAC,kBAEvBkD,EAAAA,EAAAA,KAAA,UAAQhE,MAAM,SAAQc,SAAC,eACvBkD,EAAAA,EAAAA,KAAA,UAAQhE,MAAM,YAAWc,SAAC,kBAC1BkD,EAAAA,EAAAA,KAAA,UAAQhE,MAAM,UAASc,SAAC,qBAG5BiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,cAAatD,SAAA,EAC1BkD,EAAAA,EAAAA,KAAA,UACEI,UAAS,mBAAAd,OAAkC,SAAb2X,EAAsB,SAAW,IAC/D5W,QAASA,IAAM6W,EAAY,QAC3B5K,MAAM,YAAWxP,UAEjBkD,EAAAA,EAAAA,KAAA,OAAKkB,MAAM,KAAKqQ,OAAO,KAAK2K,QAAQ,YAAYC,KAAK,eAAcrf,UACjEkD,EAAAA,EAAAA,KAAA,QAAMyV,EAAE,sEAGZzV,EAAAA,EAAAA,KAAA,UACEI,UAAS,mBAAAd,OAAkC,SAAb2X,EAAsB,SAAW,IAC/D5W,QAASA,IAAM6W,EAAY,QAC3B5K,MAAM,YAAWxP,UAEjBkD,EAAAA,EAAAA,KAAA,OAAKkB,MAAM,KAAKqQ,OAAO,KAAK2K,QAAQ,YAAYC,KAAK,eAAcrf,UACjEkD,EAAAA,EAAAA,KAAA,QAAMyV,EAAE,kGAIbgB,IACC1X,EAAAA,EAAAA,MAAA,UACEsB,QA3VQ8C,UACtB,GAAKsT,EACL,IACEa,GAAa,SACPxH,EAA0BmJ,GAAgB,CAC9CjJ,YAAa,YACbC,SAAS,GAAD3Q,OAA+B,GAAE,yBACzC4Q,cAAwB,OAAV6H,QAAU,IAAVA,OAAU,EAAVA,EAAY1Y,OAAQ,UAClC8Q,cAAwB,OAAV4H,QAAU,IAAVA,OAAU,EAAVA,EAAY1d,OAAQ,GAClC+V,QAAS,CAAE3F,SAAQqM,aAAY5D,UAC/B7C,YAAaqG,GAEjB,CAAE,MAAOxS,GACPV,QAAQU,MAAM,iBAAkBA,GAChCmL,MAAM,uBACR,CAAC,QACCiI,GAAa,EACf,GA2Uc/W,SAAU8W,GAAuC,IAA1B4B,GAAe7d,OACtCgF,UAAU,yBACVhE,MAAO,CAAE2G,QAAS,OAAQsB,WAAY,SAAUpB,IAAK,MAAOtD,QAAS,WAAYa,SAAU,QAAS1D,SAAA,EAEpGkD,EAAAA,EAAAA,KAACoc,EAAAA,IAAU,IACV/E,EAAY,eAAiB,gBAGjCS,GAAaP,IACZvX,EAAAA,EAAAA,KAAA,UAAQK,QAASA,IAAI5D,OAAOqQ,SAASwB,KAAI,iBAAAhP,OAAoBiY,EAAc/c,IAAG,YAAY4F,UAAU,mBAAmBhE,MAAO,CAACuE,WAAW,UAAU7D,SAAC,yBAM3JkD,EAAAA,EAAAA,KAAA,OAAKI,UAAS,iBAAAd,OAAgC,SAAb2X,EAAsB,YAAc,iBAAkBna,SACpF0J,GACCzH,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,gBAAetD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,qBAAmBJ,EAAAA,EAAAA,KAAA,KAAAlD,SAAG,kBAClEoH,GACFlE,EAAAA,EAAAA,KAAA,OAAKI,UAAU,cAAatD,UAACkD,EAAAA,EAAAA,KAAA,KAAAlD,SAAIoH,MACP,IAAxB4V,GAAa1e,QACf2D,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,cAAatD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,aAAYtD,SAAC,kBAAQkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,gCAA+BkD,EAAAA,EAAAA,KAAA,KAAAlD,SAAG,+CAE1F,SAAbma,GA9QVjX,EAAAA,EAAAA,KAAA,MAAII,UAAU,eAActD,SACzBgd,GAAa5Q,KAAIT,IAAM,IAAD4T,EAAAC,EAAAC,EACrB,MAAM,MAAElS,EAAK,KAAEC,IAASC,EAAAA,EAAAA,IAAqB9B,GACvCwC,GAAcC,EAAAA,EAAAA,IAAezC,EAAE3O,OAAQwQ,EAAK/M,YAC5Cwb,EAA0B,aAAbtQ,EAAE3O,QAAyB2O,EAAEsQ,WAC1CpM,EAAcoM,GAActQ,EAAEuQ,oBAAsBvQ,EAAEuQ,oBAA+B,QAAZqD,EAAG5T,EAAEiE,eAAO,IAAA2P,OAAA,EAATA,EAAW1P,YAE7F,OACE5N,EAAAA,EAAAA,MAAA,MAAgBqB,UAAS,eAAAd,OAAiBgL,EAAKsE,UAAU,iBAAiB,GAAE,KAAAtP,OAAIgL,EAAK/M,WAAW,oBAAoB,GAAE,KAAA+B,OAAIyZ,EAAW,kBAAkB,IAAKjc,SAAA,CACzJic,IACCha,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,kBAAiBtD,SAAA,EAC9BkD,EAAAA,EAAAA,KAAA,QAAMI,UAAU,iBAAgBtD,SAAC,sCAChC2L,EAAE+T,iBAAkBxc,EAAAA,EAAAA,KAAA,QAAMI,UAAU,iBAAgBtD,SAAE2L,EAAE+T,qBAG7Dzd,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,qBAAoBtD,SAAA,EACjCiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,sBAAqBtD,SAAA,EAClCkD,EAAAA,EAAAA,KAAA,MAAII,UAAU,oBAAmBtD,SAAa,QAAXwf,EAAA7T,EAAE2E,iBAAS,IAAAkP,GAAXA,EAAalhB,OAASqN,EAAE2E,UAAUlE,KAAImE,GAAG,GAAF/N,OAAK+N,EAAEE,aAAY,MAAAjO,OAAK+N,EAAEG,UAAQlO,OAAG+N,EAAEI,KAAM,IAAIJ,EAAEI,KAAK,GAAE,OAAK8F,KAAK,MAAQ,sBACtJvT,EAAAA,EAAAA,KAAA,KAAGI,UAAU,mBAAkBtD,UAAE2f,EAAAA,EAAAA,IAAchU,EAAE+D,aAAa,iBAAiB,UAEjFxM,EAAAA,EAAAA,KAAA,QAAMI,UAAS,sBAAAd,OAAwB2L,EAAYjE,eAAgBlK,SAAEmO,QAEvEjL,EAAAA,EAAAA,KAAA,OAAKI,UAAU,oBAAmBtD,UAChCiC,EAAAA,EAAAA,MAAA,QAAMqB,UAAU,cAAatD,SAAA,EAC3BkD,EAAAA,EAAAA,KAAA,UAAAlD,UAAoB,QAAXyf,EAAA9T,EAAEkD,iBAAS,IAAA4Q,OAAA,EAAXA,EAAald,OAAM,YAAmB,WAAI,IAAI1B,KAAK8K,EAAEgE,WAAW7O,qBACxE+O,IAAe5N,EAAAA,EAAAA,MAAA,QAAAjC,SAAA,CAAM,UAAG6P,UAG5BoM,GAActQ,EAAEiU,yBACf1c,EAAAA,EAAAA,KAAA,OAAKI,UAAU,2BAA0BtD,UACvCiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,wBAAuBtD,SAAA,EACpCkD,EAAAA,EAAAA,KAAA,UAAAlD,SAAQ,qBAAyB,IAAE2L,EAAEkU,sBACpClU,EAAEmU,yBACD7d,EAAAA,EAAAA,MAAA,QAAAjC,SAAA,CAAM,YAAGkD,EAAAA,EAAAA,KAAA,UAAAlD,SAAQ,sBAA0B,IAAE,IAAIa,KAAK8K,EAAEmU,wBAAwBhf,8BAKtFmb,IACA/Y,EAAAA,EAAAA,KAAA,OAAKI,UAAU,iBAAgBtD,SAC5BuN,EAAMnB,KAAI,CAACwB,EAAEmS,KACZ9d,EAAAA,EAAAA,MAAA,OAAiBqB,UAAS,iBAAAd,OAAmBoL,EAAEC,OAAQ7N,SAAA,EACrDkD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,YAAWtD,SAAEif,GAAQrR,EAAEC,UACtC3K,EAAAA,EAAAA,KAAA,OAAKI,UAAU,aAAYtD,SAAE4N,EAAEoE,SAC/B9O,EAAAA,EAAAA,KAAA,OAAKI,UAAU,WAAUtD,SAAEkf,GAAOtR,EAAEC,MAAMD,EAAElO,QAC5CwD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,YAAWtD,SAAE4N,EAAEhN,KAAM,IAAIC,KAAK+M,EAAEhN,MAAME,qBAAsB,WAC1Eif,EAAMxS,EAAMjP,OAAO,IAAK4E,EAAAA,EAAAA,KAAA,OAAKI,UAAS,kBAAAd,OAAyC,cAArB+K,EAAMwS,EAAI,GAAGlS,MAAoB,YAAY,QALhGD,EAAElO,UASlBwD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,kBAAiBtD,SAC7Bic,GACCha,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,mBAAkBtD,SAAA,EAC/BkD,EAAAA,EAAAA,KAAC8c,EAAAA,GAAI,CAACxJ,GAAE,GAAAhU,OAAKkX,EAAc,KAAAlX,OAAImJ,EAAEjO,KAAO4F,UAAU,mBAAkBtD,SAAC,kBACrEkD,EAAAA,EAAAA,KAAA,UACEK,QAASA,IAAM8Z,GAAqB1R,EAAEjO,KACtC4F,UAAU,sBACVG,SAAU0Z,KAAexR,EAAEjO,IAAIsC,SAE9Bmd,KAAexR,EAAEjO,IAAM,cAAgB,2BAI5CuE,EAAAA,EAAAA,MAAAC,EAAAA,SAAA,CAAAlC,SAAA,CACGgb,GACC,CAACiF,IAAM,MAAMjjB,GAAQ2O,EAAE3O,QAAQ,IAAIkN,cAA2K,GAAjI,4BAATlN,GAA6C,yBAATA,IAA+C,QAAXijB,EAAAtU,EAAEkD,iBAAS,IAAAoR,OAAA,EAAXA,EAAaviB,OAAMf,GAAW6Q,EAAK/M,YAAe+M,EAAKsE,UAAyB,OAAO,KAAM,MAAMoO,EAAWvF,EAAehP,EAAEjO,KAAYyiB,EAAYD,EAAcA,EAAarF,EAAS,EAAMsF,GAAW,GAAKD,GAC3V3f,YAAW,KAAMqa,GAAkBzb,IAAQ,MAAMihB,GAAI/N,EAAAA,EAAAA,GAAA,GAAKlT,GAAyF,cAA3EihB,EAAKzU,EAAEjO,KAAM8I,aAAagV,QAAQ,iBAAkBzQ,KAAK0Q,UAAU2E,IAAeA,CAAI,GAAI,GAAI,GACxK,MAAMC,EAAYpD,GAActR,EAAEjO,KAC5B4iB,EAAS3F,EAAehP,EAAEjO,KAChC,OAAOuE,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CAAC2G,QAAQ,OAAQiM,cAAc,SAAU3K,WAAW,cAAcvH,SAAA,EACnFkD,EAAAA,EAAAA,KAAA,UACEK,QAASA,IAAIia,GAAY7R,GACzBlI,SAAU0c,EAAU,GAAKE,EACzB/c,UAAU,mBACVkM,MAAO2Q,EAAU,GAAKG,EAAM,yBAAA9d,OAA4Boc,GAAe0B,IAAY,oCACnFhhB,MAAO,CAACoD,WAAW,UAAW0D,QAAS+Z,EAAU,GAAGE,EAAW,GAAI,GAAGrgB,SACtEqgB,EAAW,aAAe9B,GAAgB4B,KAC3CA,EAAU,GAAKG,IAAUpd,EAAAA,EAAAA,KAAA,QAAM5D,MAAO,CAAC0G,UAAU,EAAGlD,SAAS,GAAIH,MAAM,WAAW3C,SAAE4e,GAAe0B,OAC7F,EAbT,IAeFpd,EAAAA,EAAAA,KAAC8c,EAAAA,GAAI,CAACxJ,GAAE,GAAAhU,OAAKkX,EAAc,KAAAlX,OAAImJ,EAAEjO,KAAO4F,UAAU,mBAAmBhE,MAAO,CAACuE,WAAWmX,EAAW,SAAS,GAAGhb,SAAC,wBAxE/G2L,EAAEjO,IA4EN,OAOXwF,EAAAA,EAAAA,KAAA,OAAKI,UAAU,0BAAyBtD,UACtCiC,EAAAA,EAAAA,MAAA,SAAOqB,UAAU,gBAAetD,SAAA,EAC9BkD,EAAAA,EAAAA,KAAA,SAAAlD,UACEiC,EAAAA,EAAAA,MAAA,MAAAjC,SAAA,EACEkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,eACJkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,iBACJkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,eACJkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,aACJkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,UACJkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,YACJkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,kBAGRkD,EAAAA,EAAAA,KAAA,SAAAlD,SACGgd,GAAa5Q,KAAIT,IAAM,IAAD4U,EAAAC,EAAAC,EAAAC,EAAAC,EACrB,MAAM,MAAEpT,EAAK,KAAEC,IAASC,EAAAA,EAAAA,IAAqB9B,GACvCwC,GAAcC,EAAAA,EAAAA,IAAezC,EAAE3O,OAAQwQ,EAAK/M,YAC5Cwb,EAA0B,aAAbtQ,EAAE3O,QAAyB2O,EAAEsQ,WAC1CpM,EAAcoM,GAActQ,EAAEuQ,oBAAsBvQ,EAAEuQ,oBAA+B,QAAZqE,EAAG5U,EAAEiE,eAAO,IAAA2Q,OAAA,EAATA,EAAW1Q,YAE7F,OACE5N,EAAAA,EAAAA,MAAC2e,EAAAA,SAAc,CAAA5gB,SAAA,EACbiC,EAAAA,EAAAA,MAAA,MAAIqB,UAAS,aAAAd,OAAegL,EAAKsE,UAAU,iBAAiB,GAAE,KAAAtP,OAAIgL,EAAK/M,WAAW,oBAAoB,GAAE,KAAA+B,OAAIyZ,EAAW,kBAAkB,IAAKjc,SAAA,EAC5IkD,EAAAA,EAAAA,KAAA,MAAII,UAAU,4BAA4BkM,MAAkB,QAAXgR,EAAA7U,EAAE2E,iBAAS,IAAAkQ,GAAXA,EAAaliB,OAASqN,EAAE2E,UAAUlE,KAAImE,GAAG,GAAF/N,OAAK+N,EAAEE,aAAY,MAAAjO,OAAK+N,EAAEG,UAAQlO,OAAG+N,EAAEI,KAAM,IAAIJ,EAAEI,KAAK,GAAE,OAAK8F,KAAK,MAAQ,mBAAmBzW,SACzK,QAAXygB,EAAA9U,EAAE2E,iBAAS,IAAAmQ,GAAXA,EAAaniB,OAASqN,EAAE2E,UAAUlE,KAAImE,GAAG,GAAF/N,OAAK+N,EAAEE,aAAY,MAAAjO,OAAK+N,EAAEG,UAAQlO,OAAG+N,EAAEI,KAAM,IAAIJ,EAAEI,KAAK,GAAE,OAAK8F,KAAK,MAAQ,sBAEtHvT,EAAAA,EAAAA,KAAA,MAAII,UAAU,8BAA8BkM,MAAO7D,EAAE+D,aAAa,iBAAiB1P,UAChF2f,EAAAA,EAAAA,IAAchU,EAAE+D,aAAa,iBAAkB,OAElDxM,EAAAA,EAAAA,KAAA,MAAII,UAAU,4BAA4BkM,OAAkB,QAAXkR,EAAA/U,EAAEkD,iBAAS,IAAA6R,OAAA,EAAXA,EAAane,OAAM,UAAUvC,UAC5EkD,EAAAA,EAAAA,KAAA,UAAAlD,UAAoB,QAAX2gB,EAAAhV,EAAEkD,iBAAS,IAAA8R,OAAA,EAAXA,EAAape,OAAM,eAE9BW,EAAAA,EAAAA,KAAA,MAAII,UAAU,0BAA0BkM,MAAOK,GAAe,SAAI7P,SAC/D6P,GAAe,YAElB3M,EAAAA,EAAAA,KAAA,MAAII,UAAU,uBAAuBkM,MAAO,IAAI3O,KAAK8K,EAAEgE,WAAW7O,qBAAqBd,SACpF,IAAIa,KAAK8K,EAAEgE,WAAW7O,wBAEzBmB,EAAAA,EAAAA,MAAA,MAAIqB,UAAU,yBAAwBtD,SAAA,EACpCkD,EAAAA,EAAAA,KAAA,QAAMI,UAAS,sBAAAd,OAAwB2L,EAAYjE,eAAgBlK,SAAEmO,IACpE8N,GAActQ,EAAE+T,iBACfxc,EAAAA,EAAAA,KAAA,OAAKI,UAAU,iBAAiBhE,MAAO,CAACwD,SAAU,OAAQH,MAAO,OAAQqD,UAAW,OAAOhG,SACxF2L,EAAE+T,qBAITxc,EAAAA,EAAAA,KAAA,MAAII,UAAU,0BAAyBtD,SACpCic,GACCha,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,mBAAkBtD,SAAA,EAC/BkD,EAAAA,EAAAA,KAAC8c,EAAAA,GAAI,CAACxJ,GAAE,GAAAhU,OAAKkX,EAAc,KAAAlX,OAAImJ,EAAEjO,KAAO4F,UAAU,mBAAkBtD,SAAC,UACrEkD,EAAAA,EAAAA,KAAA,UACEK,QAASA,IAAM8Z,GAAqB1R,EAAEjO,KACtC4F,UAAU,sBACVG,SAAU0Z,KAAexR,EAAEjO,IAC3B4B,MAAO,CAACuE,WAAY,MAAOf,SAAU,OAAQD,QAAS,WAAW7C,SAEhEmd,KAAexR,EAAEjO,IAAM,cAAgB,eAI5CuE,EAAAA,EAAAA,MAAAC,EAAAA,SAAA,CAAAlC,SAAA,CACGgb,GACC,CAAC6F,IAAM,MAAM7jB,GAAQ2O,EAAE3O,QAAQ,IAAIkN,cAA2K,GAAjI,4BAATlN,GAA6C,yBAATA,IAA+C,QAAX6jB,EAAAlV,EAAEkD,iBAAS,IAAAgS,OAAA,EAAXA,EAAanjB,OAAMf,GAAW6Q,EAAK/M,YAAe+M,EAAKsE,UAAyB,OAAO,KAAM,MAAMoO,EAAWvF,EAAehP,EAAEjO,KAAYyiB,EAAYD,EAAcA,EAAarF,EAAS,EAAMsF,GAAW,GAAKD,GAC3V3f,YAAW,KAAMqa,GAAkBzb,IAAQ,MAAMihB,GAAI/N,EAAAA,EAAAA,GAAA,GAAKlT,GAAyF,cAA3EihB,EAAKzU,EAAEjO,KAAM8I,aAAagV,QAAQ,iBAAkBzQ,KAAK0Q,UAAU2E,IAAeA,CAAI,GAAI,GAAI,GACxK,MAAMC,EAAYpD,GAActR,EAAEjO,KAC5B4iB,EAAS3F,EAAehP,EAAEjO,KAChC,OAAOwF,EAAAA,EAAAA,KAAA,UACLK,QAASA,IAAIia,GAAY7R,GACzBlI,SAAU0c,EAAU,GAAKE,EACzB/c,UAAU,YACVkM,MAAO2Q,EAAU,GAAKG,EAAM,yBAAA9d,OAA4Boc,GAAe0B,IAAY,oCAAoCtgB,SACvHqgB,EAAW,aAAe9B,GAAgB4B,IAAuB,EATnE,IAWFjd,EAAAA,EAAAA,KAAC8c,EAAAA,GAAI,CAACxJ,GAAE,GAAAhU,OAAKkX,EAAc,KAAAlX,OAAImJ,EAAEjO,KAAO4F,UAAU,mBAAkBtD,SAAC,kBAK7EkD,EAAAA,EAAAA,KAAA,MAAII,UAAS,gBAAAd,OAAkBgL,EAAKsE,UAAU,iBAAiB,GAAE,KAAAtP,OAAIgL,EAAK/M,WAAW,oBAAoB,IAAKT,UAC5GkD,EAAAA,EAAAA,KAAA,MAAI4d,QAAQ,IAAIxd,UAAU,qBAAoBtD,UAC5CkD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,sBAAqBtD,SACjCuN,EAAMnB,KAAI,CAACwB,EAAEmS,KACZ9d,EAAAA,EAAAA,MAAA,OAAiBqB,UAAS,sBAAAd,OAAwBoL,EAAEC,OAAQ7N,SAAA,EAC1DkD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,iBAAgBtD,SAAEif,GAAQrR,EAAEC,UAC3C3K,EAAAA,EAAAA,KAAA,OAAKI,UAAU,kBAAiBtD,SAAE4N,EAAEoE,SACpC9O,EAAAA,EAAAA,KAAA,OAAKI,UAAU,gBAAetD,SAAEkf,GAAOtR,EAAEC,MAAMD,EAAElO,QACjDwD,EAAAA,EAAAA,KAAA,OAAKI,UAAU,iBAAgBtD,SAAE4N,EAAEhN,KAAM,IAAIC,KAAK+M,EAAEhN,MAAME,qBAAsB,WAC/Eif,EAAMxS,EAAMjP,OAAO,IAAK4E,EAAAA,EAAAA,KAAA,OAAKI,UAAS,uBAAAd,OAA8C,cAArB+K,EAAMwS,EAAI,GAAGlS,MAAoB,YAAY,QALrGD,EAAElO,eA7DDiM,EAAEjO,IAwEN,aAyFpBye,GAAe7d,OAAS,IACvB2D,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,qBAAoBtD,SAAA,EACjCiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,kBAAiBtD,SAAA,CAAC,WAAS+c,GAAW,EAAE,OAAK/O,KAAKC,IAAI8O,GAAWnB,GAAgBO,GAAe7d,QAAQ,OAAK6d,GAAe7d,OAAO,eAClJ2D,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,sBAAqBtD,SAAA,EAClCkD,EAAAA,EAAAA,KAAA,UAAQI,UAAU,iBAAiBG,SAAwB,IAAd4W,EAAiB9W,QAASA,IAAI+W,GAAeoD,GAAG1P,KAAK+S,IAAIrD,EAAE,EAAE,KAAI1d,SAAC,aAC9GyO,MAAM8H,KAAK,CAACjY,OAAQue,KAAY,CAACuB,EAAE5N,IAAIA,EAAE,IAAGpE,KAAIsR,IAAIxa,EAAAA,EAAAA,KAAA,UAAgBI,UAAS,kBAAAd,OAAoBkb,IAAIrD,EAAY,SAAS,IAAM9W,QAASA,IAAI+W,EAAeoD,GAAG1d,SAAE0d,GAAhGA,MAClExa,EAAAA,EAAAA,KAAA,UAAQI,UAAU,iBAAiBG,SAAU4W,IAAcwC,GAAYtZ,QAASA,IAAI+W,GAAeoD,GAAG1P,KAAKC,IAAIyP,EAAE,EAAEb,MAAa7c,SAAC,oBAO1Ikb,GAAqBE,KACpBlY,EAAAA,EAAAA,KAAA,OAAKI,UAAU,gBAAetD,UAC5BiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,cAAatD,SAAA,EAC1BkD,EAAAA,EAAAA,KAAA,MAAAlD,SAAI,gCAEJiC,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CACV0hB,gBAAiB,UACjB/d,OAAQ,oBACRL,aAAc,MACdC,QAAS,OACTV,aAAc,QACdnC,SAAA,EACAiC,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CAAC2G,QAAS,OAAQsB,WAAY,SAAUpB,IAAK,MAAOhE,aAAc,OAAOnC,SAAA,EACnFkD,EAAAA,EAAAA,KAAA,QAAM5D,MAAO,CAACwD,SAAU,QAAQ9C,SAAC,kBACjCkD,EAAAA,EAAAA,KAAA,UAAQ5D,MAAO,CAACqD,MAAO,WAAW3C,SAAC,mCAErCkD,EAAAA,EAAAA,KAAA,KAAG5D,MAAO,CAACqD,MAAO,UAAWK,OAAQ,EAAGF,SAAU,QAAQ9C,SAAC,wGAK7DiC,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CAAC6C,aAAc,QAAQnC,SAAA,EACjCkD,EAAAA,EAAAA,KAAA,KAAG5D,MAAO,CAAC6C,aAAc,MAAOC,WAAY,OAAOpC,SAAC,sBACpDiC,EAAAA,EAAAA,MAAA,OAAK3C,MAAO,CAAC0hB,gBAAiB,UAAWne,QAAS,OAAQD,aAAc,MAAOE,SAAU,QAAQ9C,SAAA,EAC/FiC,EAAAA,EAAAA,MAAA,KAAG3C,MAAO,CAAC0D,OAAQ,aAAahD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,UAAAlD,SAAQ,aAAiB,KAAyB,QAAvBsZ,EAAA8B,GAAgBxL,eAAO,IAAA0J,OAAA,EAAvBA,EAAyBzJ,cAAe,cACpG5N,EAAAA,EAAAA,MAAA,KAAG3C,MAAO,CAAC0D,OAAQ,aAAahD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,UAAAlD,SAAQ,eAAmB,KAA2B,QAAzBuZ,EAAA6B,GAAgBvM,iBAAS,IAAA0K,OAAA,EAAzBA,EAA2BhX,OAAQ,cACjGN,EAAAA,EAAAA,MAAA,KAAG3C,MAAO,CAAC0D,OAAQ,aAAahD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,UAAAlD,SAAQ,YAAgB,IAAEob,GAAgBpe,QAAU,cACrFiF,EAAAA,EAAAA,MAAA,KAAG3C,MAAO,CAAC0D,OAAQ,KAAKhD,SAAA,EAACkD,EAAAA,EAAAA,KAAA,UAAAlD,SAAQ,aAAiB,IAAEob,GAAgBzL,UAAY,IAAI9O,KAAKua,GAAgBzL,WAAW7O,qBAAuB,oBAI/ImB,EAAAA,EAAAA,MAAA,KAAG3C,MAAO,CAAC6C,aAAc,OAAQW,SAAU,OAAQyC,WAAY,OAAOvF,SAAA,CAAC,6BAC5CkD,EAAAA,EAAAA,KAAA,UAAAlD,SAAQ,uBAA2B,uCAG9DiC,EAAAA,EAAAA,MAAA,OAAKqB,UAAU,gBAAgBhE,MAAO,CAAC2G,QAAQ,OAAOE,IAAI,SAASD,eAAe,YAAYlG,SAAA,EAC5FkD,EAAAA,EAAAA,KAAA,UACEI,UAAU,MACVC,QAASA,KACP4X,GAAqB,GACrBE,GAAmB,KAAK,EACxBrb,SACH,YAGDkD,EAAAA,EAAAA,KAAA,UACEI,UAAU,cACVG,SAAU0Z,KAAe/B,GAAgB1d,IACzC6F,QAzZgB8C,UAC5B,GAAK+U,GAAL,CAEAgC,GAAchC,GAAgB1d,KAC9B,UACQmJ,EAAAA,GAAIoa,OAAO,aAADze,OAAc4Y,GAAgB1d,IAAG,cAEjD,MAAMyO,QAAYtF,EAAAA,GAAI2E,IAAIgO,GAC1BM,EAAYrL,MAAMC,QAAQvC,EAAI7E,MAAQ6E,EAAI7E,KAAO,IACjD6T,GAAqB,GACrBE,GAAmB,KACrB,CAAE,MAAOjU,GAAQ,IAAD8Z,EAAAC,EACd5O,MAAM,wCAA8C,OAALnL,QAAK,IAALA,GAAe,QAAV8Z,EAAL9Z,EAAOC,gBAAQ,IAAA6Z,GAAM,QAANC,EAAfD,EAAiB5Z,YAAI,IAAA6Z,OAAhB,EAALA,EAAuB9d,UAAW+D,EAAM/D,SACzF,CAAC,QACC+Z,GAAc,KAChB,CAd4B,CAc5B,EA2YY9d,MAAO,CAAC0hB,gBAAiB,WAAWhhB,SAEnCmd,KAAe/B,GAAgB1d,IAAM,cAAgB,sCAM5D,C,0ECzjBH,MAAMiiB,EAAgB,WAA+B,IAA9B/J,EAAIvX,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,GAAI+iB,EAAQ/iB,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,GAClD,IAAKuX,GAAwB,kBAATA,EAAmB,MAAO,GAC9C,MAAMyL,EAAQzL,EAAKtP,OAAO4G,MAAM,OAChC,OAAImU,EAAM/iB,QAAU8iB,EAAiBxL,EAC9ByL,EAAMrc,MAAM,EAAGoc,GAAU3K,KAAK,KAAO,KAC9C,EAEarI,EAAiBA,CAACpR,EAAQskB,KACrC,MAAM1T,GAAK5Q,GAAU,IAAIkN,cACzB,MAAU,aAAN0D,EAAyB,WACnB,aAANA,GAAoB0T,EAAqB,YACzC1T,EAAErM,SAAS,YAAoB,WAC/BqM,EAAErM,SAAS,WAAmB,UAC9BqM,EAAErM,SAAS,WAAaqM,EAAErM,SAAS,UAAkB,WAClD,SAAS,EAGLkM,EAAwB8P,IACnC,MAAMgE,EAAe9S,MAAMC,QAAQ6O,EAAQpgB,WAAaogB,EAAQpgB,UAAY,GACtEqkB,EAAaD,EAAa5T,QAAOtQ,GAAgB,oBAAXA,EAAEE,OAA4ByH,OAAO,GAAG,GAC9Eyc,EAAaF,EAAa5T,QAAOtQ,GAAgB,iBAAXA,EAAEE,OAAyByH,OAAO,GAAG,GAC3E0c,EAAuB,OAAVF,QAAU,IAAVA,OAAU,EAAVA,EAAY5f,SACzB+f,EAAuB,OAAVF,QAAU,IAAVA,OAAU,EAAVA,EAAY7f,SACzBggB,EAA0B,WAAfF,EACXG,EAA0B,WAAfF,EACX/P,EAA4B,aAAf8P,EACb7P,EAA4B,aAAf8P,EACb7S,GAAeyO,EAAQvgB,QAAU,IAAIkN,cACrCzJ,EAA6B,aAAhBqO,GAA8ByO,EAAQvO,cACnDtO,EAAe6c,EAAQnN,YAAcmN,EAAQ7c,cAAgB,KAC7DoR,EAAY8P,GAAYC,GAAY/S,EAAYvN,SAAS,UAG/D,IAAIugB,EAAe,KACfhT,EAAYvN,SAAS,2BACvBugB,EAAe,KACNhT,EAAYvN,SAAS,wBAC9BugB,EAAe,KACNlQ,GAAcC,IAAepR,IAAeqR,IACrDgQ,EAAe,YAGjB,MAAMC,EAAUH,EAAW,SAAWhQ,EAAa,YAAgC,OAAjBkQ,EAAwB,UAAY,UACtG,IAAIE,EAKAC,EAJUD,EAAVJ,EAAoB,SACdhQ,EACKiQ,EAAW,SAAWhQ,EAAa,YAAgC,OAAjBiQ,EAAwB,UAAY,UADrE,UAIjBG,EAAXnQ,EAA2B,SACpBF,GAAcC,EACJpR,EAAa,YAAgC,aAAjBqhB,EAA8B,UAAY,UADrC,UAStD,MAAO,CAAEvU,MANK,CACZ,CAAE7N,IAAI,SAAUsS,MAAM,SAAUpR,KAAK2c,EAAQ5N,UAAW9B,MAAM,aAC9D,CAAEnO,IAAI,KAAMsS,MAAM,KAAMpR,MAAgB,OAAV4gB,QAAU,IAAVA,OAAU,EAAVA,EAAYU,YAAa,KAAMrU,MAAOkU,GACpE,CAAEriB,IAAI,KAAMsS,MAAM,KAAMpR,MAAgB,OAAV6gB,QAAU,IAAVA,OAAU,EAAVA,EAAYS,YAAa,KAAMrU,MAAOmU,GACpE,CAAEtiB,IAAI,WAAYsS,MAAM,WAAYpR,KAAMH,EAAcC,IAA0B,OAAV+gB,QAAU,IAAVA,OAAU,EAAVA,EAAYS,WAAa,KAAMrU,MAAOoU,IAEhGzU,KAAK,CAAEgU,aAAYC,aAAY7P,aAAYgQ,WAAU/P,aAAYgQ,WAAUphB,aAAYqR,YAAWgQ,gBAAgB,EAGvHxT,EAAsBA,CAACiP,EAAS3gB,KAC3C,MAAMW,GAAQX,GAAU,IAAIsN,cACtBlN,IAAiB,OAAPugB,QAAO,IAAPA,OAAO,EAAPA,EAASvgB,SAAQ,IAAIkN,cACrC,QAAKqT,KACDvgB,EAAOuE,SAAS,WAAwB,aAAXvE,IAClB,4BAAXA,EAA6C,CAAC,kBAAkB,KAAK,SAASuE,SAAShE,GAC5E,yBAAXP,GAA0C,CAAC,eAAe,KAAK,SAASuE,SAAShE,IACzE,C","sources":["components/ApproveDenyActions.js","components/material/MaterialRequestDetailView.jsx","utils/materialRequestsPdfEnhanced.js","components/material/MaterialRequestListView.jsx","components/material/materialStatusUtils.js"],"sourcesContent":["import React, { useState, useMemo, useEffect, useRef } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport api from '../api/axiosInstance';\r\n\r\n\r\n\r\n// Helper: Get display date from a date string\r\nconst formatDateTime = (dateVal) => {\r\n  if (!dateVal) return '';\r\n  const date = new Date(dateVal);\r\n  return (\r\n    date.toLocaleDateString(undefined, { year: 'numeric', month: '2-digit', day: '2-digit' }) +\r\n    \" \" +\r\n    date.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' })\r\n  );\r\n};\r\n\r\nconst ApproveDenyActions = ({\r\n  requestData,\r\n  userId,\r\n  userRole,\r\n  onBack,\r\n  onActionComplete\r\n}) => {\r\n  // Map roles to approval keys\r\n  const roleKey =\r\n    userRole === 'Project Manager' ? 'PM'\r\n    : userRole === 'Area Manager' ? 'AM'\r\n    : userRole;\r\n\r\n  const status = requestData?.status;\r\n  const isPendingForMe =\r\n    (status === 'Pending Project Manager' && roleKey === 'PM') ||\r\n    (status === 'Pending Area Manager' && roleKey === 'AM');\r\n\r\n  const hasActed = requestData?.approvals?.some(\r\n    (a) => a.role === roleKey && String(a.user?._id || a.user) === String(userId)\r\n  );\r\n\r\n  const showApproveDeny = isPendingForMe && !hasActed;\r\n\r\n  // PO feature removed: simple approve/deny only\r\n\r\n  // Modal state\r\n  const [showDenyReason, setShowDenyReason] = useState(false);\r\n  const [denyReason, setDenyReason] = useState('');\r\n  const [showApproveConfirm, setShowApproveConfirm] = useState(false);\r\n  const closeDenyModal = (clear=true)=>{ setShowDenyReason(false); if(clear) setDenyReason(''); };\r\n  // Track previous denyReason to detect prepend typing bug (characters appearing in reverse order)\r\n  const prevDenyRef = useRef('');\r\n  const denyTextareaRef = useRef(null);\r\n  useEffect(()=>{ prevDenyRef.current = denyReason; },[denyReason]);\r\n  // When modal opens, focus & move caret to end\r\n  useEffect(()=>{\r\n    if(showDenyReason && denyTextareaRef.current){\r\n      requestAnimationFrame(()=>{\r\n        const el = denyTextareaRef.current; el.focus(); el.selectionStart = el.selectionEnd = el.value.length;\r\n      });\r\n    }\r\n  },[showDenyReason]);\r\n  // Modal body scroll lock + ESC handling\r\n  useEffect(()=>{\r\n    const anyOpen = showDenyReason || showApproveConfirm;\r\n    if(anyOpen){\r\n      const prev = document.body.style.overflow;\r\n      document.body.style.overflow='hidden';\r\n      const onKey = (e)=>{ if(e.key==='Escape'){ if(showDenyReason) closeDenyModal(true); if(showApproveConfirm) setShowApproveConfirm(false);} };\r\n      window.addEventListener('keydown', onKey);\r\n      return ()=>{ document.body.style.overflow=prev; window.removeEventListener('keydown', onKey); };\r\n    }\r\n  },[showDenyReason, showApproveConfirm]);\r\n\r\n  const ModalPortal = ({children}) => createPortal(children, document.body);\r\n  const [feedback, setFeedback] = useState(null); // {type:'success'|'error', message:string}\r\n  const [denySubmitting, setDenySubmitting] = useState(false);\r\n  // Auto clear feedback after a few seconds\r\n  useEffect(()=>{ if(!feedback) return; const t=setTimeout(()=>setFeedback(null), 5000); return ()=>clearTimeout(t); },[feedback]);\r\n\r\n  // Approve button click: only validation + open modal\r\n  const handleApprove = () => { if(!showApproveDeny) return; setShowApproveConfirm(true); };\r\n\r\n  // Actual approve submission from confirmation modal\r\n  const submitApproveFromModal = () => {\r\n    setShowApproveConfirm(false);\r\n    (async()=>{\r\n      const token = localStorage.getItem('token');\r\n      const payload = { decision: 'approved' };\r\n      try {\r\n        await api.post(`/requests/${requestData._id}/approve`, payload, { headers:{ Authorization:`Bearer ${token}` } });\r\n        setFeedback({type:'success', message:'Request approved.'});\r\n        if(onActionComplete) onActionComplete(); else onBack();\r\n      } catch(err){\r\n        setFeedback({type:'error', message: err?.response?.data?.message || 'Failed to approve request.'});\r\n      }\r\n    })();\r\n  };\r\n\r\n\r\n  // Deny\r\n  const handleDeny = () => { setShowDenyReason(true); setDenySubmitting(false); };\r\n  const submitDeny = async () => {\r\n    if (!denyReason.trim()) {\r\n      setFeedback({ type:'error', message:'Reason is required.' });\r\n      return;\r\n    }\r\n    const token = localStorage.getItem('token');\r\n    if(!token){ setFeedback({type:'error', message:'Not authenticated.'}); return; }\r\n    try {\r\n      setDenySubmitting(true);\r\n      console.log('[DENY] submitting', { id: requestData?._id, reason: denyReason });\r\n      await api.post(\r\n        `/requests/${requestData._id}/approve`,\r\n        { decision: 'denied', reason: denyReason },\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n      setFeedback({ type:'success', message:'Request denied.' });\r\n      setShowDenyReason(false);\r\n      setDenyReason('');\r\n      if (onActionComplete) onActionComplete();\r\n      else onBack();\r\n    } catch (err) {\r\n      console.error(err);\r\n      setFeedback({ type:'error', message: err?.response?.data?.message || 'Failed to deny request.' });\r\n    } finally {\r\n      setDenySubmitting(false);\r\n    }\r\n  };\r\n\r\n  // --- RECEIVED BY PIC INFO ---\r\n  const isReceived = !!requestData?.receivedDate;\r\n  const receivedDate = requestData?.receivedDate\r\n    ? formatDateTime(requestData.receivedDate)\r\n    : null;\r\n\r\n  // --- DENIAL INFO ---\r\n  const deniedStatuses = ['Denied by Project Manager', 'Denied by Area Manager'];\r\n  const isDenied = deniedStatuses.includes(requestData?.status);\r\n  let deniedApproval = null;\r\n  if (isDenied) {\r\n    deniedApproval = [...(requestData?.approvals || [])]\r\n      .reverse()\r\n      .find(app => app.decision === 'denied');\r\n  }\r\n\r\n  // Helper: Get Denier Display\r\n  const getDenierDisplay = (approval) => {\r\n    if (!approval) return '';\r\n    let role =\r\n      approval.role === 'Project Manager'\r\n        ? 'Project Manager'\r\n        : approval.role === 'Area Manager'\r\n        ? 'Area Manager'\r\n        : approval.role;\r\n    if (approval.user && typeof approval.user === 'object' && approval.user.name) {\r\n      return `${approval.user.name} (${role})`;\r\n    }\r\n    return `${role}`;\r\n  };\r\n\r\n  // ---- Approve Button Label logic ----\r\n  let approveLabel = 'Approve';\r\n  if (status === 'Pending Project Manager' && roleKey === 'PM') {\r\n    approveLabel = 'Validate';\r\n  } else if (status === 'Pending Area Manager' && roleKey === 'AM') {\r\n    approveLabel = 'Approve';\r\n  }\r\n\r\n  // Validation helpers\r\n  const canApprove = useMemo(()=> showApproveDeny, [showApproveDeny]);\r\n\r\n  // Dynamic approve modal messaging\r\n  let approveModalMessage = 'You are approving this request.';\r\n  if (status === 'Pending Project Manager' && roleKey === 'PM') {\r\n    approveModalMessage = 'You are validating this request and sending it to the Area Manager.';\r\n  } else if (status === 'Pending Area Manager' && roleKey === 'AM') {\r\n    approveModalMessage = 'You are approving and completing this request.';\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {/* Denied Banner */}\r\n      {isDenied && deniedApproval && (\r\n        <div style={{ marginBottom: 24 }}>\r\n          <div style={{\r\n            fontWeight: 600,\r\n            textAlign: 'center',\r\n            marginBottom: 4\r\n          }}>\r\n            Request Denied By: {getDenierDisplay(deniedApproval)}\r\n          </div>\r\n          <div style={{\r\n            background: '#faeaea',\r\n            color: '#a12d2d',\r\n            borderRadius: 8,\r\n            padding: '12px 16px',\r\n            fontSize: 15,\r\n            maxWidth: 800,\r\n            margin: '0 auto',\r\n            border: '1px solid #eedcdc',\r\n            textAlign: 'left'\r\n          }}>\r\n            <div style={{ fontWeight: 500, marginBottom: 6 }}>Reason:</div>\r\n            {deniedApproval.reason}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {feedback && (\r\n        <div style={{\r\n          marginBottom: 16,\r\n          padding: '10px 14px',\r\n          borderRadius: 8,\r\n          fontSize: 13,\r\n          background: feedback.type==='success'? '#ecfdf5':'#fef2f2',\r\n          color: feedback.type==='success'? '#065f46':'#b91c1c',\r\n          border: `1px solid ${feedback.type==='success'? '#a7f3d0':'#fecaca'}`\r\n        }}>\r\n          {feedback.message}\r\n        </div>\r\n      )}\r\n\r\n      {/* Delivered Banner */}\r\n      {isReceived && (\r\n        <div style={{\r\n          margin: '40px 0 0',\r\n          textAlign: 'center',\r\n          color: '#15a563',\r\n          fontWeight: 600\r\n        }}>\r\n          This Request has been Closed and Items were Successfully Delivered On: {receivedDate}\r\n        </div>\r\n      )}\r\n\r\n      {/* PO input section for AM final approval */}\r\n  {/* PO UI removed */}\r\n\r\n      {/* Action Buttons */}\r\n      <div className=\"action-buttons unified\">\r\n        <button onClick={onBack} className=\"back-btn\">Back</button>\r\n        {showApproveDeny && (\r\n          <>\r\n            <button\r\n              onClick={handleApprove}\r\n              disabled={!canApprove}\r\n              className=\"publish-button-picmatreq\"\r\n              style={{ background: canApprove? '#16a34a':'#9ca3af', minWidth: 140, cursor: canApprove? 'pointer':'not-allowed' }}\r\n            >\r\n              {approveLabel}\r\n            </button>\r\n            <button\r\n              onClick={handleDeny}\r\n              className=\"cancel-btn\"\r\n              style={{\r\n                marginLeft: '1rem',\r\n                background: '#dc3545',\r\n                color: '#fff',\r\n                minWidth: 120\r\n              }}\r\n            >\r\n              Deny\r\n            </button>\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n  {/* (Removed legacy inline deny modal; using portal version below) */}\r\n\r\n      {showDenyReason && (\r\n        <ModalPortal>\r\n          <div role=\"dialog\" aria-modal=\"true\" aria-label=\"Deny Request\" style={{position:'fixed',inset:0,zIndex:2000,background:'rgba(0,0,0,0.55)'}} onClick={()=>!denySubmitting && closeDenyModal(true)}>\r\n            {/* Center wrapper */}\r\n            <div style={{position:'absolute',top:'50%',left:'50%',transform:'translate(-50%,-50%)',width:'100%',maxWidth:840,padding:'0 24px'}}>\r\n            <div style={{background:'#fff',width:'100%',borderRadius:14,padding:'30px 34px',boxShadow:'0 15px 40px -8px rgba(0,0,0,0.25)',animation:'fadeInScale .18s ease'}} onClick={e=>e.stopPropagation()}>\r\n              <h3 style={{margin:'0 0 14px',fontSize:22}}>Deny Request</h3>\r\n              <p style={{margin:'0 0 18px',fontSize:14,color:'#475569'}}>Please provide a reason for denial:</p>\r\n              {/* LTR isolation wrapper */}\r\n              <div style={{direction:'ltr'}}>\r\n              <textarea\r\n                dir=\"ltr\"\r\n                spellCheck={true}\r\n                value={denyReason}\r\n                onChange={e=>{\r\n                  const raw = e.target.value;\r\n                  const prev = prevDenyRef.current;\r\n                  let next = raw;\r\n                  // Detect pattern where new chars are prepended (typing appears reversed): new ends with previous\r\n                  if(raw.length === prev.length + 1 && raw.endsWith(prev)){\r\n                    // Example: typed 'a','b','c' but value becomes 'cba' progression; fix by appending typed char\r\n                    const added = raw.slice(0, raw.length - prev.length); // the prepended char(s)\r\n                    next = prev + added;\r\n                  } else if(raw.length > prev.length + 1 && raw.endsWith(prev)){\r\n                    // Multiple chars pasted/inserted at start\r\n                    const added = raw.slice(0, raw.length - prev.length);\r\n                    next = prev + added;\r\n                  }\r\n                  setDenyReason(next);\r\n                  // Force caret to end after React updates DOM\r\n                  requestAnimationFrame(()=>{\r\n                    if(denyTextareaRef.current){\r\n                      const el = denyTextareaRef.current;\r\n                      el.selectionStart = el.selectionEnd = el.value.length;\r\n                    }\r\n                  });\r\n                }}\r\n                rows={6}\r\n                autoFocus\r\n                disabled={denySubmitting}\r\n                style={{\r\n                  width:'100%',\r\n                  borderRadius:10,\r\n                  border:'1px solid #93c5fd',\r\n                  padding:'14px 16px',\r\n                  fontSize:14,\r\n                  background: denySubmitting? '#f1f5f9':'#f8fafc',\r\n                  minHeight:170,\r\n                  resize:'vertical',\r\n                  direction:'ltr',\r\n                  textAlign:'left',\r\n                  whiteSpace:'pre-wrap',\r\n                  overflowWrap:'break-word',\r\n                  lineHeight:'1.45',\r\n                  fontFamily:'inherit',\r\n                  writingMode:'horizontal-tb',\r\n                  textIndent:0,\r\n                  caretColor:'#111827',\r\n                  unicodeBidi:'isolate',\r\n                  transform:'none'\r\n                }}\r\n                autoComplete=\"off\"\r\n                ref={denyTextareaRef}\r\n                placeholder=\"Enter reason for denial\"\r\n              />\r\n              </div>\r\n              <div style={{marginTop:20,display:'flex',justifyContent:'flex-end',gap:12}}>\r\n                <button onClick={()=>closeDenyModal(true)} disabled={denySubmitting} style={{padding:'11px 22px',background:'#e2e8f0',border:'none',borderRadius:9,fontWeight:500,cursor: denySubmitting? 'not-allowed':'pointer',opacity: denySubmitting? .6:1}}>Cancel</button>\r\n                <button onClick={submitDeny} disabled={!denyReason.trim()||denySubmitting} style={{padding:'11px 24px',background: (!denyReason.trim()||denySubmitting)? '#fca5a5':'#dc2626',color:'#fff',border:'none',borderRadius:9,fontWeight:600,cursor: (!denyReason.trim()||denySubmitting)? 'not-allowed':'pointer',opacity: denySubmitting? .7:1}}>{denySubmitting? 'Submitting...':'Submit'}</button>\r\n              </div>\r\n            </div>\r\n            </div>\r\n          </div>\r\n        </ModalPortal>\r\n      )}\r\n\r\n  {showApproveConfirm && (\r\n        <ModalPortal>\r\n          <div role=\"dialog\" aria-modal=\"true\" aria-label=\"Approve Request\" style={{position:'fixed',inset:0,zIndex:2000,display:'flex',alignItems:'center',justifyContent:'center',background:'rgba(0,0,0,0.55)',padding:'24px'}} onClick={()=>setShowApproveConfirm(false)}>\r\n            <div style={{background:'#fff',borderRadius:14,padding:'30px 34px',width:'100%',maxWidth:640,boxShadow:'0 15px 40px -8px rgba(0,0,0,0.25)',animation:'fadeInScale .18s ease'}} onClick={e=>e.stopPropagation()}>\r\n      <h3 style={{margin:'0 0 14px',fontSize:22,display:'flex',alignItems:'center',gap:10}}><i className=\"fas fa-check-circle\" style={{color:'#16a34a'}}/> Confirm {approveLabel}</h3>\r\n              <p style={{margin:'0 0 18px',fontSize:14,color:'#475569'}}>{approveModalMessage}</p>\r\n              <div style={{marginTop:4,display:'flex',justifyContent:'flex-end',gap:12}}>\r\n                <button onClick={()=>setShowApproveConfirm(false)} style={{padding:'11px 22px',background:'#e2e8f0',border:'none',borderRadius:9,fontWeight:500,cursor:'pointer'}}>Cancel</button>\r\n                <button onClick={submitApproveFromModal} style={{padding:'11px 24px',background:'#16a34a',color:'#fff',border:'none',borderRadius:9,fontWeight:600,cursor:'pointer'}}>Confirm</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </ModalPortal>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ApproveDenyActions;\r\n","import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport './materialRequestDetail.css';\r\nimport AppHeader from '../layout/AppHeader';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport axiosInstance from '../../api/axiosInstance';\r\nimport ApproveDenyActions from '../ApproveDenyActions';\r\nimport { getStatusBadge, computeApprovalSteps, canUserActOnRequest } from './materialStatusUtils';\r\n\r\nconst MaterialRequestDetailView = ({ role, rootClass='mr-request-detail', headerTitle='Material Request Detail', headerSubtitle='Full lifecycle view', customHeader=null, disableHeader=false }) => {\r\n  const { id } = useParams();\r\n  const navigate = useNavigate();\r\n  const [materialRequest, setMaterialRequest] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [isHeaderCollapsed, setIsHeaderCollapsed] = useState(false);\r\n  const [isProfileOpen, setIsProfileOpen] = useState(false);\r\n  const isCEO = (role||'').toLowerCase()==='ceo';\r\n  const [collapsedSections, setCollapsedSections] = useState(()=> isCEO ? { att:true } : {});\r\n  const [copied, setCopied] = useState(false);\r\n  // PIC receiving action state must be declared before any early return to satisfy hooks rules\r\n  const [receiving, setReceiving] = useState(false);\r\n  // Lightbox preview state for attachments\r\n  const [previewAttachment, setPreviewAttachment] = useState(null);\r\n  // Signed URL map { key: signedUrl }\r\n  const [signedUrls, setSignedUrls] = useState({});\r\n  const profileDropdownRef = useRef(null);\r\n  const user = (()=>{ try {return JSON.parse(localStorage.getItem('user'))||null;}catch{return null;} })();\r\n  const userId = user?._id; const userRole = user?.role;\r\n\r\n  const fetchRequest = useCallback(()=>{ let mounted=true; setLoading(true); setError(''); const ctrl=new AbortController();\r\n    axiosInstance.get(`/requests/${id}`,{signal:ctrl.signal}).then(r=>{ if(!mounted) return; setMaterialRequest(r.data); })\r\n      .catch(e=>{ if(!mounted) return; if(e.name==='CanceledError') return; setError(e?.response?.data?.message||'Failed to load'); })\r\n      .finally(()=>mounted && setLoading(false));\r\n    return ()=>{ mounted=false; ctrl.abort(); };\r\n  },[id]);\r\n  useEffect(()=>{ const cleanup = fetchRequest(); return cleanup; },[fetchRequest]);\r\n\r\n  // Fetch signed URLs once request (and its attachments) are loaded\r\n  useEffect(()=>{\r\n    if(!materialRequest || !materialRequest.attachments || materialRequest.attachments.length===0) return;\r\n    let active=true;\r\n    (async()=>{\r\n      try{\r\n        const res = await axiosInstance.get(`/requests/${materialRequest._id}/attachments/signed`);\r\n        if(!active) return;\r\n        const map={};\r\n        (res.data||[]).forEach(o=>{ if(o.key && o.signedUrl) map[o.key]=o.signedUrl; });\r\n        setSignedUrls(map);\r\n      }catch(err){ console.warn('Failed to fetch signed attachment urls', err); }\r\n    })();\r\n    return ()=>{active=false};\r\n  },[materialRequest]);\r\n\r\n  useEffect(()=>{ const onScroll=()=>{ const st=window.pageYOffset||document.documentElement.scrollTop; setIsHeaderCollapsed(st>50); }; const onClick=(e)=>{ if(profileDropdownRef.current && !profileDropdownRef.current.contains(e.target)) setIsProfileOpen(false); }; window.addEventListener('scroll',onScroll); document.addEventListener('click',onClick); return ()=>{ window.removeEventListener('scroll',onScroll); document.removeEventListener('click',onClick); }; },[]);\r\n\r\n  const handleBack = useCallback(()=> navigate(-1),[navigate]);\r\n  const toggleSection = (key)=> setCollapsedSections(prev=>({...prev,[key]:!prev[key]}));\r\n  const handleLogout = () => { localStorage.removeItem('token'); localStorage.removeItem('user'); navigate('/'); };\r\n\r\n  const renderAttachmentIcon = (filename='') => {\r\n    const ext = filename.split('.').pop().toLowerCase();\r\n    if(['png','jpg','jpeg','gif','webp'].includes(ext)) return <i className=\"fas fa-file-image\"/>;\r\n    if(ext==='pdf') return <i className=\"fas fa-file-pdf\" style={{color:'#dc2626'}}/>;\r\n    if(['doc','docx'].includes(ext)) return <i className=\"fas fa-file-word\" style={{color:'#2563eb'}}/>;\r\n    if(['xls','xlsx'].includes(ext)) return <i className=\"fas fa-file-excel\" style={{color:'#16a34a'}}/>;\r\n    return <i className=\"fas fa-file\"/>;\r\n  };\r\n\r\n  const isImage = (fname='') => {\r\n    const ext = fname.split('.').pop().toLowerCase();\r\n    return ['png','jpg','jpeg','gif','webp'].includes(ext);\r\n  };\r\n  const buildAttachmentUrl = (a='') => {\r\n    if(!a) return '';\r\n    if(signedUrls[a]) return signedUrls[a];\r\n    // If a is full public supabase URL, attempt to extract relative key and look up\r\n    if(a.startsWith('http')){\r\n      const m = a.match(/\\/storage\\/v1\\/object\\/public\\/material-request-photos\\/(.+)$/);\r\n      if(m && m[1] && signedUrls[m[1]]) return signedUrls[m[1]];\r\n      return a; // fallback to original public URL\r\n    }\r\n    return '';\r\n  };\r\n\r\n  // Close preview on ESC\r\n  useEffect(()=>{\r\n    if(!previewAttachment) return; const onKey=e=>{ if(e.key==='Escape') setPreviewAttachment(null); }; window.addEventListener('keydown',onKey); return ()=>window.removeEventListener('keydown',onKey); },[previewAttachment]);\r\n\r\n  if(loading||error||!materialRequest){\r\n    return <div className={`dashboard-container ${rootClass}`}>\r\n      {!disableHeader && <AppHeader roleSegment={(role||'').toLowerCase().includes('project manager')? 'pm' : (role||'').toLowerCase().includes('area manager')? 'am' : (role||'').toLowerCase().includes('person in charge')? 'pic' : (role||'').toLowerCase().includes('ceo')? 'ceo' : (role||'').toLowerCase().includes('it')? 'it':'pic'}\r\n        below={<div className=\"header-content\" style={{padding:'0.75rem 1.5rem'}}>\r\n          <div className=\"header-left\"><h1 className=\"header-title\" style={{margin:0,fontSize:'1.15rem'}}>Material Request Detail</h1><p className=\"header-subtitle\" style={{margin:0,fontSize:'0.75rem',opacity:.75}}>Loading details</p></div>\r\n          <div className=\"header-right\"><button onClick={handleBack} className=\"btn-secondary\"><i className=\"fas fa-arrow-left\"/> Back</button></div>\r\n        </div>}\r\n      />}\r\n      <div className=\"dashboard-main\"><div className=\"page-container\">{loading && <div className=\"loading-state\"><div className=\"loading-spinner\"/><p>Loading...</p></div>}{!loading && error && <div className=\"error-state\"><p>{error}</p></div>}</div></div></div>;\r\n  }\r\n\r\n  const { steps, meta } = computeApprovalSteps(materialRequest);\r\n  const completedCount = steps.filter(s=>s.state==='completed').length;\r\n  const totalCount = steps.length;\r\n  const progressPct = Math.min(100, Math.round((completedCount/(totalCount||1))*100));\r\n  const statusBadge = getStatusBadge(materialRequest.status, meta.isReceived);\r\n  const canAct = canUserActOnRequest(materialRequest, userRole);\r\n  // Denial info\r\n  const isDenied = /denied/i.test(materialRequest.status||'');\r\n  let denialApproval = null;\r\n  if(isDenied && Array.isArray(materialRequest.approvals)){\r\n    denialApproval = [...materialRequest.approvals].reverse().find(a=>a.decision==='denied');\r\n  }\r\n  // PIC role specific capabilities\r\n  const lowerRole = (userRole||'').toLowerCase();\r\n  const isPIC = lowerRole === 'person in charge';\r\n  const isCreator = materialRequest?.createdBy?._id === userId;\r\n  const statusLower = (materialRequest.status||'').toLowerCase();\r\n  const alreadyReceived = statusLower === 'received' || materialRequest.receivedByPIC;\r\n  // PIC can only edit while request is still at initial stage (no validations / approvals yet)\r\n  const hasAnyApproval = Array.isArray(materialRequest.approvals) && materialRequest.approvals.length > 0;\r\n  const canEditPIC = isPIC && isCreator && !alreadyReceived && !hasAnyApproval && statusLower === 'pending project manager';\r\n  const canMarkReceived = isPIC && isCreator && !alreadyReceived && statusLower === 'approved';\r\n\r\n  const handleMarkReceived = async () => {\r\n    if(!canMarkReceived || receiving) return;\r\n    setReceiving(true);\r\n    try {\r\n      await axiosInstance.patch(`/requests/${materialRequest._id}/received`);\r\n      setMaterialRequest(prev => ({...prev, status:'Received', receivedByPIC:true, receivedDate:new Date().toISOString()}));\r\n    } catch (e) {\r\n      alert('Failed to mark as received');\r\n    } finally { setReceiving(false); }\r\n  };\r\n  const handleEdit = () => { if(canEditPIC) navigate(`/pic/material-request/edit/${materialRequest._id}`); };\r\n\r\n  return (\r\n    <div className={`dashboard-container ${rootClass}`}>\r\n      {!disableHeader && (customHeader ? customHeader : (\r\n        <AppHeader roleSegment={(role||'').toLowerCase().includes('project manager')? 'pm' : (role||'').toLowerCase().includes('area manager')? 'am' : (role||'').toLowerCase().includes('person in charge')? 'pic' : (role||'').toLowerCase().includes('ceo')? 'ceo' : (role||'').toLowerCase().includes('it')? 'it':'pic'}\r\n          below={<div className=\"header-content\" style={{padding:'0.75rem 1.5rem'}}>\r\n            <div className=\"header-left\"><h1 className=\"header-title\" style={{margin:0,fontSize:'1.15rem'}}>{headerTitle}</h1><p className=\"header-subtitle\" style={{margin:0,fontSize:'0.75rem',opacity:.75}}>{headerSubtitle}</p></div>\r\n            <div className=\"header-right\"><button onClick={handleBack} className=\"btn-secondary\"><i className=\"fas fa-arrow-left\"/> Back</button></div>\r\n          </div>}\r\n        />\r\n      ))}\r\n      <div className=\"dashboard-main\">\r\n  <div className={`mrd ${isCEO? 'mrd--bar':''}`}>\r\n          <div className=\"mrd-page-bar\">\r\n            <div className=\"mrd-page-left\">\r\n              <button onClick={handleBack} className=\"mrd-back-btn\" type=\"button\" aria-label=\"Back to previous page\">\r\n                <i className=\"fas fa-arrow-left\"/>\r\n                <span>Back</span>\r\n              </button>\r\n              <h1 className=\"mrd-page-title\">Material Request</h1>\r\n            </div>\r\n            {materialRequest.status && <div className=\"mrd-page-status\"></div>}\r\n          </div>\r\n          {/* Modern Redesigned Layout */}\r\n          <div className=\"mrd-modern\">\r\n            <div className=\"mrd-modern-summary\">\r\n              <div className=\"mrd-ms-left\">\r\n                <div className=\"mrd-id-line\">\r\n                  <span className=\"mrd-id-label\">ID</span>\r\n                  <span className=\"mrd-id-value\">{materialRequest._id}</span>\r\n                  <button className=\"mrd-copy\" onClick={()=>{navigator.clipboard?.writeText(materialRequest._id); setCopied(true); setTimeout(()=>setCopied(false),1600);}} title=\"Copy ID\"><i className=\"fas fa-copy\"/></button>\r\n                  {copied && <span className=\"mrd-copied\">Copied!</span>}\r\n                </div>\r\n                <h2 className=\"mrd-title\" style={{marginTop:4}}>{materialRequest.requestNumber || 'Material Request'}</h2>\r\n                {materialRequest.description && <p className=\"mrd-desc\" style={{marginTop:8}}>{materialRequest.description}</p>}\r\n                <div className=\"mrd-summary-tags\">\r\n                  <span className=\"mrd-meta\">Created {new Date(materialRequest.createdAt).toLocaleDateString()}</span>\r\n                    {materialRequest.project?.projectName && <span className=\"mrd-meta\">{materialRequest.project.projectName}</span>}\r\n                    {typeof materialRequest.project?.budget === 'number' && <span className=\"mrd-meta\">Remaining Budget: ₱{materialRequest.project.budget.toLocaleString()}</span>}\r\n                  {materialRequest.project?.location && <span className=\"mrd-meta\">{materialRequest.project.location?.name || materialRequest.project.location?.toString?.() || '—'}</span>}\r\n                </div>\r\n                <div className=\"mrd-progress\" aria-label=\"Approval progress\">\r\n                  <div className=\"mrd-progress-bar\"><div className=\"mrd-progress-fill\" style={{width:progressPct+'%'}}/></div>\r\n                  <span className=\"mrd-progress-meta\">{progressPct}% • {completedCount}/{totalCount} steps</span>\r\n                </div>\r\n              </div>\r\n              <div className=\"mrd-ms-right\">\r\n                <div className={`mrd-status-badge status-${statusBadge.toLowerCase()}`}>{statusBadge}</div>\r\n                {/* priority removed */}\r\n              </div>\r\n            </div>\r\n            <div className=\"mrd-modern-body\">\r\n              <div className=\"mrd-col-main\">\r\n                {isDenied && denialApproval && (\r\n                  <div style={{\r\n                    background:'#fef2f2',\r\n                    border:'1px solid #fecaca',\r\n                    padding:'14px 18px',\r\n                    borderRadius:12,\r\n                    marginBottom:18,\r\n                    color:'#991b1b',\r\n                    lineHeight:1.4,\r\n                    fontSize:14\r\n                  }} role=\"alert\" aria-live=\"polite\">\r\n                    <div style={{fontWeight:600,marginBottom:6,display:'flex',alignItems:'center',gap:8}}>\r\n                      <i className=\"fas fa-ban\"/> Request Denied{denialApproval.role?` by ${denialApproval.role}`:''}\r\n                    </div>\r\n                    <div style={{whiteSpace:'pre-wrap'}}>{denialApproval.reason || 'No reason provided.'}</div>\r\n                    {denialApproval.user?.name && (\r\n                      <div style={{marginTop:8,fontSize:11,opacity:.7}}>By: {denialApproval.user.name} • {new Date(denialApproval.date||denialApproval.updatedAt||denialApproval.createdAt||materialRequest.updatedAt).toLocaleString()}</div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n                {/* Info */}\r\n        <section className=\"mrd-section flat\" aria-labelledby=\"info-h\">\r\n                  <h3 id=\"info-h\" className=\"mrd-section-title\"><i className=\"fas fa-info-circle\"/> Information</h3>\r\n                  <dl className=\"mrd-fields two-col\">\r\n                    <div className=\"mrd-field\"><dt>Request #</dt><dd>{materialRequest.requestNumber||'—'}</dd></div>\r\n                    {/* Priority field removed */}\r\n                    <div className=\"mrd-field\"><dt>Created</dt><dd>{new Date(materialRequest.createdAt).toLocaleString()}</dd></div>\r\n                    {meta.isReceived && <div className=\"mrd-field\"><dt>Received</dt><dd>{new Date(materialRequest.receivedAt || materialRequest.receivedDate).toLocaleString()}</dd></div>}\r\n                    <div className=\"mrd-field\"><dt>Status</dt><dd>{statusBadge}</dd></div>\r\n                    <div className=\"mrd-field\"><dt>Project</dt><dd>{materialRequest.project?.projectName||'—'}</dd></div>\r\n          {typeof materialRequest.project?.budget === 'number' && <div className=\"mrd-field\"><dt>Project Budget</dt><dd>₱{materialRequest.project.budget.toLocaleString()}</dd></div>}\r\n                  </dl>\r\n                </section>\r\n                {/* Requester */}\r\n                <section className=\"mrd-section flat\" aria-labelledby=\"req-h\">\r\n                  <h3 id=\"req-h\" className=\"mrd-section-title\"><i className=\"fas fa-user\"/> Requester</h3>\r\n                  <dl className=\"mrd-fields two-col\">\r\n                    <div className=\"mrd-field\"><dt>Name</dt><dd>{materialRequest.createdBy?.name||'—'}</dd></div>\r\n                    <div className=\"mrd-field\"><dt>Email</dt><dd>{materialRequest.createdBy?.email||'—'}</dd></div>\r\n                    <div className=\"mrd-field\"><dt>Role</dt><dd>{materialRequest.createdBy?.role||'—'}</dd></div>\r\n                    <div className=\"mrd-field\"><dt>Location</dt><dd>{materialRequest.project?.location?.name || materialRequest.project?.location?.toString?.() || '—'}</dd></div>\r\n                  </dl>\r\n                </section>\r\n                {/* Materials */}\r\n                <section className=\"mrd-section flat\" aria-labelledby=\"mat-h\">\r\n                  <h3 id=\"mat-h\" className=\"mrd-section-title\"><i className=\"fas fa-boxes\"/> Materials</h3>\r\n                  {materialRequest.materials?.length ? (\r\n                    <ul className=\"mrd-material-list modern\">\r\n                      {materialRequest.materials.map((m,i)=>(\r\n                        <li key={i} className=\"mrd-material-item\">\r\n                          <div className=\"mrd-material-head\">\r\n                            <span className=\"mrd-material-name\">{m.materialName}</span>\r\n                            <span className=\"mrd-qty\">{m.quantity}{m.unit?` ${m.unit}`:''}</span>\r\n                          </div>\r\n                          {m.specifications && <div className=\"mrd-spec\">{m.specifications}</div>}\r\n                        </li>\r\n                      ))}\r\n                    </ul>\r\n                  ) : <p className=\"mrd-empty\">No materials specified.</p>}\r\n                </section>\r\n                {/* Attachments moved to right column for immediate visibility */}\r\n              </div>\r\n              <div className=\"mrd-col-side\">\r\n                {/* Attachments (Gallery) */}\r\n                <section className=\"mrd-section flat\" aria-labelledby=\"att-h\">\r\n                  <h3 id=\"att-h\" className=\"mrd-section-title\"><i className=\"fas fa-paperclip\"/> Attachments</h3>\r\n                  {materialRequest.attachments?.length ? (\r\n                    <div className=\"mrd-attach-gallery\">\r\n                      {materialRequest.attachments.map((a,i)=>{\r\n                        const url = buildAttachmentUrl(a);\r\n                        const image = isImage(a);\r\n                        return (\r\n                          <div key={i} className=\"mrd-attach-tile\" title={a}>\r\n                            {image && url ? (\r\n                              <button type=\"button\" className=\"mrd-thumb\" onClick={()=>setPreviewAttachment(url)} aria-label=\"Open image preview\">\r\n                                <img src={url} alt={a} loading=\"lazy\" />\r\n                              </button>\r\n                            ) : (\r\n                              <div className=\"mrd-file-icon\" onClick={()=> url && window.open(url,'_blank','noopener')} role=\"button\" tabIndex={0} onKeyDown={e=>e.key==='Enter'&& url && window.open(url,'_blank','noopener')}>\r\n                                {renderAttachmentIcon(a)}\r\n                              </div>\r\n                            )}\r\n                            <div className=\"mrd-attach-meta\">\r\n                              <span className=\"mrd-attach-filename\">{a}</span>\r\n                              {url ? <a className=\"mrd-attach-download\" href={url} target=\"_blank\" rel=\"noopener noreferrer\">Download</a> : <span style={{fontSize:10,color:'#dc2626'}}>No URL</span>}\r\n                            </div>\r\n                          </div>\r\n                        );\r\n                      })}\r\n                    </div>\r\n                  ) : <p className=\"mrd-empty\">No attachments.</p>}\r\n                </section>\r\n                {/* Approval Timeline */}\r\n                <section className=\"mrd-section flat\" aria-labelledby=\"flow-h\">\r\n                  <h3 id=\"flow-h\" className=\"mrd-section-title\"><i className=\"fas fa-tasks\"/> Approval Flow</h3>\r\n                  <ul className=\"mrd-timeline\">\r\n                    {steps.map(step=>{ const waitingForReceipt = step.key==='received' && step.state==='pending' && meta.pmApproved && meta.amApproved && !meta.isReceived && !meta.anyDenied; const metaText = step.date? new Date(step.date).toLocaleString() : step.state==='blocked' ? 'Waiting' : waitingForReceipt ? 'Awaiting PIC receipt' : 'Pending'; return (\r\n                      <li key={step.key} className={`tl-step ${step.state}`}>\r\n                        <div className=\"tl-node\" />\r\n                        <div className=\"tl-content\">\r\n                          <div className=\"tl-title\">{step.label}</div>\r\n                          <div className=\"tl-meta\">{metaText}</div>\r\n                        </div>\r\n                      </li>\r\n                    ); })}\r\n                  </ul>\r\n                </section>\r\n                {/* Actions */}\r\n                {(canAct || canEditPIC || canMarkReceived) && (\r\n                  <section className=\"mrd-section flat\" aria-labelledby=\"act-h\">\r\n                    <h3 id=\"act-h\" className=\"mrd-section-title\"><i className=\"fas fa-gavel\"/> Actions</h3>\r\n                    {canAct && <div className=\"mrd-action-block\"><ApproveDenyActions requestData={materialRequest} userId={userId} userRole={userRole} onBack={handleBack} onActionComplete={fetchRequest} /></div>}\r\n                    {(canEditPIC || canMarkReceived) && (\r\n                      <div className=\"mrd-action-block\" style={{display:'flex',flexDirection:'column',gap:12}}>\r\n                        {canEditPIC && <button onClick={handleEdit} className=\"btn-secondary\"><i className=\"fas fa-edit\"/> Edit Request</button>}\r\n                        {canMarkReceived && <button onClick={handleMarkReceived} disabled={receiving} className=\"btn-primary\"><i className=\"fas fa-box-open\"/> {receiving? 'Marking...' : 'Mark as Received'}</button>}\r\n                        <p style={{fontSize:12,margin:0,color:'#64748b'}}>Edit allowed only before manager validation. Receipt after full approval.</p>\r\n                      </div>\r\n                    )}\r\n                  </section>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          {previewAttachment && (\r\n            <div className=\"mrd-lightbox\" role=\"dialog\" aria-modal=\"true\" aria-label=\"Attachment preview\" onClick={()=>setPreviewAttachment(null)}>\r\n              <div className=\"mrd-lightbox-inner\" onClick={e=>e.stopPropagation()}>\r\n                <button className=\"mrd-lightbox-close\" onClick={()=>setPreviewAttachment(null)} aria-label=\"Close preview\"><i className=\"fas fa-times\"/></button>\r\n                <img src={previewAttachment} alt=\"Attachment preview\" className=\"mrd-lightbox-img\" />\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MaterialRequestDetailView;\r\n","import jsPDF from 'jspdf';\r\nimport autoTable from 'jspdf-autotable';\r\n\r\n/* ---------- utility functions ---------- */\r\nfunction loadImageDataURLWithSize(url) {\r\n  return new Promise((resolve) => {\r\n    if (!url) return resolve(null);\r\n    try {\r\n      const img = new Image();\r\n      img.crossOrigin = 'anonymous';\r\n      img.onload = () => {\r\n        const c = document.createElement('canvas');\r\n        c.width = img.naturalWidth;\r\n        c.height = img.naturalHeight;\r\n        c.getContext('2d').drawImage(img, 0, 0);\r\n        resolve({ dataUrl: c.toDataURL('image/png'), w: img.naturalWidth, h: img.naturalHeight });\r\n      };\r\n      img.onerror = () => resolve(null);\r\n      img.src = url;\r\n    } catch {\r\n      resolve(null);\r\n    }\r\n  });\r\n}\r\n\r\nfunction loadFontFromPublic(doc, fontFile, family, style) {\r\n  return new Promise((resolve) => {\r\n    try {\r\n      const fontPath = `${process.env.PUBLIC_URL || ''}/fonts/${fontFile}`;\r\n      fetch(fontPath)\r\n        .then((r) => r.arrayBuffer())\r\n        .then((buf) => {\r\n          try {\r\n            doc.addFileToVFS(fontFile, buf);\r\n            doc.addFont(fontFile, family, style);\r\n            resolve(true);\r\n          } catch {\r\n            resolve(false);\r\n          }\r\n        })\r\n        .catch(() => resolve(false));\r\n    } catch {\r\n      resolve(false);\r\n    }\r\n  });\r\n}\r\n\r\nfunction fontUsable(doc, family, style) {\r\n  try {\r\n    const fonts = doc.getFontList();\r\n    return fonts && fonts[family] && fonts[family][style];\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction fitInside(w, h, maxW, maxH) {\r\n  if (!w || !h) return { w: maxW, h: maxH };\r\n  const r = Math.min(maxW / w, maxH / h, 1);\r\n  return { w: w * r, h: h * r };\r\n}\r\n\r\nfunction formatDateTime(date) {\r\n  if (!date) return 'N/A';\r\n  const dt = new Date(date);\r\n  return Number.isNaN(dt.getTime()) ? 'N/A' : dt.toLocaleString();\r\n}\r\n\r\nfunction buildFileName(prefix = 'Material-Requests-Export') {\r\n  const d = new Date();\r\n  const pad = (num) => String(num).padStart(2, '0');\r\n  const date = `${d.getFullYear()}${pad(d.getMonth() + 1)}${pad(d.getDate())}`;\r\n  const time = `${pad(d.getHours())}${pad(d.getMinutes())}`;\r\n  return `${prefix}-${date}-${time}.pdf`;\r\n}\r\n\r\nfunction buildFiltersSummary(filters) {\r\n  const parts = [];\r\n  if (filters.status && filters.status !== 'All' && filters.status !== 'all') {\r\n    parts.push(`Status: ${filters.status}`);\r\n  }\r\n  if (filters.search && filters.search.trim()) {\r\n    parts.push(`Search: \"${filters.search.trim()}\"`);\r\n  }\r\n  if (filters.sortBy && filters.sortBy !== 'latest') {\r\n    parts.push(`Sort: ${filters.sortBy}`);\r\n  }\r\n  if (filters.dateFrom || filters.dateTo) {\r\n    const from = filters.dateFrom ? new Date(filters.dateFrom).toLocaleDateString() : 'Start';\r\n    const to = filters.dateTo ? new Date(filters.dateTo).toLocaleDateString() : 'End';\r\n    parts.push(`Date Range: ${from} - ${to}`);\r\n  }\r\n  return parts.length ? parts.join(', ') : null;\r\n}\r\n\r\nfunction computeStatusLabel(req) {\r\n  if (!req) return 'Unknown';\r\n  if (req.status) return req.status;\r\n  if (req.approvalSteps && Array.isArray(req.approvalSteps)) {\r\n    const lastStep = req.approvalSteps[req.approvalSteps.length - 1];\r\n    return lastStep?.status || 'Pending';\r\n  }\r\n  return 'Pending';\r\n}\r\n\r\nexport async function exportMaterialRequestsPdf(rows = [], options = {}) {\r\n  const {\r\n    companyName = 'FadzTrack',\r\n    logoPath = `${process.env.PUBLIC_URL || ''}/images/Fadz-logo.png`,\r\n    exporterName = 'Unknown',\r\n    exporterRole = '',\r\n    filters = {},\r\n    reportTitle = 'Material Requests Export',\r\n  } = options;\r\n\r\n  const doc = new jsPDF({ unit: 'pt', format: 'a4' });\r\n\r\n  // Fonts (assuming NotoSans is loaded via pdfUtils or similar global setup)\r\n  const FAMILY = 'NotoSans';\r\n  // For simplicity, assuming fonts are available or falling back to helvetica\r\n  const bodyFont = 'helvetica'; // Fallback\r\n  const headStyle = 'bold';     // Fallback\r\n\r\n  const marginX = 40;\r\n  let y = 40;\r\n\r\n  // Header: logo + company name + context\r\n  const logo = await loadImageDataURLWithSize(logoPath);\r\n  let titleX = marginX;\r\n  if (logo?.dataUrl) {\r\n    const { w: drawW, h: drawH } = fitInside(logo.w, logo.h, 180, 60); // Increased size\r\n    doc.addImage(logo.dataUrl, 'PNG', marginX, y - 12, drawW, drawH, undefined, 'FAST');\r\n    titleX = marginX + drawW + 16; // More spacing\r\n  }\r\n\r\n  doc.setFont(bodyFont, headStyle);\r\n  doc.setFontSize(20); // Increased font size\r\n  doc.setTextColor(20);\r\n  doc.text(String(companyName), titleX, y + 16);\r\n\r\n  doc.setFont(bodyFont, 'normal');\r\n  doc.setFontSize(12);\r\n  doc.setTextColor(90);\r\n  doc.text(reportTitle, titleX, y + 26);\r\n\r\n  // Divider\r\n  doc.setDrawColor(220);\r\n  doc.setLineWidth(1);\r\n  doc.line(marginX, y + 38, 595 - marginX, y + 38);\r\n  y += 54;\r\n\r\n  // Metadata block\r\n  doc.setFont(bodyFont, headStyle);\r\n  doc.setFontSize(12);\r\n  doc.setTextColor(20);\r\n  doc.text('Export Details', marginX, y);\r\n\r\n  doc.setFont(bodyFont, 'normal');\r\n  doc.setTextColor(60);\r\n  const meta = [\r\n    `Exported by: ${exporterName}${exporterRole ? ` (${exporterRole})` : ''}`,\r\n    `Date exported: ${formatDateTime(new Date())}`,\r\n  ];\r\n  const filterSummary = buildFiltersSummary(filters);\r\n  if (filterSummary) meta.push(`Filters: ${filterSummary}`);\r\n\r\n  let metaY = y + 16;\r\n  meta.forEach((line) => {\r\n    doc.text(line, marginX, metaY);\r\n    metaY += 16;\r\n  });\r\n\r\n  // Table\r\n  const tableStartY = metaY + 6;\r\n  const head = [['Date', 'Requester', 'Project', 'Materials Requested', 'Status', 'Priority']];\r\n  const body = rows.map((r) => {\r\n    const materialDetails = Array.isArray(r.materials)\r\n      ? r.materials.map((m) => `${m.quantity} ${m.name || m.materialName}`).join(', ')\r\n      : '';\r\n    return [\r\n      r.createdAt ? new Date(r.createdAt).toLocaleDateString() : '',\r\n      String(r.createdBy?.name || ''),\r\n      String(r.project?.projectName || ''),\r\n      materialDetails,\r\n      computeStatusLabel(r),\r\n      String(r.priority || 'Normal'),\r\n    ];\r\n  });\r\n\r\n  autoTable(doc, {\r\n    startY: tableStartY,\r\n    head,\r\n    body,\r\n    styles: { font: bodyFont, fontStyle: 'normal', fontSize: 10, cellPadding: 5, halign: 'left', overflow: 'linebreak' },\r\n    headStyles: { font: bodyFont, fontStyle: headStyle, fillColor: [59, 130, 246], textColor: 255 },\r\n    theme: 'grid',\r\n    margin: { left: marginX, right: marginX },\r\n    columnStyles: { 3: { cellWidth: 150 } }, // Materials Requested column\r\n    didDrawPage: (data) => {\r\n      const str = `Generated: ${formatDateTime(new Date())}`;\r\n      doc.setFont(bodyFont, 'normal');\r\n      doc.setFontSize(9);\r\n      doc.setTextColor(120);\r\n      doc.text(str, marginX, doc.internal.pageSize.height - 24);\r\n\r\n      const page = data.pageNumber || 1;\r\n      const pages = doc.getNumberOfPages();\r\n      const label = `Page ${page} of ${pages}`;\r\n      const w = doc.getTextWidth(label);\r\n      doc.text(label, doc.internal.pageSize.width - marginX - w, doc.internal.pageSize.height - 24);\r\n    },\r\n  });\r\n\r\n  doc.save(buildFileName());\r\n}\r\n","import React, { useEffect, useMemo, useState } from 'react';\r\nimport './materialRequests.css';\r\nimport AppHeader from '../layout/AppHeader';\r\nimport { Link } from 'react-router-dom';\r\nimport api from '../../api/axiosInstance';\r\nimport { truncateWords, getStatusBadge, computeApprovalSteps } from './materialStatusUtils';\r\nimport { FaDownload } from 'react-icons/fa';\r\nimport { exportMaterialRequestsPdf } from '../../utils/materialRequestsPdfEnhanced';\r\n\r\n// Generic list view for PM / AM roles\r\nconst MaterialRequestListView = ({\r\n  role,\r\n  fetchUrl = '/requests/mine',\r\n  rootClass = 'mr-request-list',\r\n  itemsPerPage = 8,\r\n  detailLinkBase = '/material-request',\r\n  headerTitle = 'Material Requests',\r\n  headerSubtitle = 'All material requests',\r\n  customHeader = null,\r\n  disableHeader = false,\r\n  enableExport = false,\r\n  exportTitle = 'Material Requests Export'\r\n}) => {\r\n  const [requests, setRequests] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [filter, setFilter] = useState('All');\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [sortBy, setSortBy] = useState('latest');\r\n  const [viewMode, setViewMode] = useState('card'); // 'card' or 'list'\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [exporting, setExporting] = useState(false);\r\n  // PIC specific state (active project + nudge cooldowns)\r\n  const [activeProject, setActiveProject] = useState(null);\r\n  const [nudgeCooldowns, setNudgeCooldowns] = useState({});\r\n  const [nowTs, setNowTs] = useState(Date.now());\r\n  const isPICRole = role === 'Person in Charge';\r\n  const storedUser = (()=>{ try { return JSON.parse(localStorage.getItem('user')||'null'); } catch { return null; } })();\r\n  const userId = storedUser?._id;\r\n  \r\n  // Confirmation modal state\r\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\r\n  const [requestToDelete, setRequestToDelete] = useState(null);\r\n\r\n  // Load cooldowns from localStorage (PIC only)\r\n  // Load persisted cooldowns once (don't filter out expired until display to keep stability if system clock shifts)\r\n  useEffect(()=>{ if(!isPICRole) return; try { const saved=JSON.parse(localStorage.getItem('nudgeCooldowns')||'{}'); setNudgeCooldowns(saved); } catch{} },[isPICRole]);\r\n  useEffect(()=>{ if(!isPICRole) return; localStorage.setItem('nudgeCooldowns', JSON.stringify(nudgeCooldowns)); },[nudgeCooldowns,isPICRole]);\r\n  // ticking clock for countdown display\r\n  useEffect(()=>{ if(!isPICRole) return; const id=setInterval(()=>setNowTs(Date.now()),1000); return ()=>clearInterval(id); },[isPICRole]);\r\n  const ITEMS_PER_PAGE = itemsPerPage;\r\n\r\n  useEffect(() => {\r\n    api.get(fetchUrl)\r\n      .then(res => {\r\n        setRequests(Array.isArray(res.data) ? res.data : []);\r\n        setError('');\r\n      })\r\n      .catch(err => setError(err?.response?.data?.message || 'Failed to load requests'))\r\n      .finally(() => setLoading(false));\r\n  }, [fetchUrl]);\r\n\r\n  // Fetch active project for PIC so we can show an inline New Request button\r\n  useEffect(()=>{ if(!isPICRole || !userId) return; api.get(`/projects/by-user-status?userId=${userId}&role=pic&status=Ongoing`).then(r=>{ setActiveProject(r.data?.[0]||null); }).catch(()=>setActiveProject(null)); },[isPICRole,userId]);\r\n\r\n  const filteredRequests = requests.filter(r => {\r\n    const status = (r.status||'').toLowerCase();\r\n    const isCompleted = status === 'received' || !!r.receivedByPIC;\r\n    const isArchived = status === 'archived' || !!r.isArchived;\r\n    \r\n    // For \"All\" filter, exclude archived requests to keep the dashboard clean\r\n    const matchesFilter = filter === 'All' ? !isArchived :\r\n      (filter === 'Pending' && status.includes('pending') && !isArchived) ||\r\n      (filter === 'Approved' && status.includes('approved') && status !== 'received' && !isArchived) ||\r\n      (filter === 'Cancelled' && (status.includes('denied') || status.includes('cancel')) && !isArchived) ||\r\n      (filter === 'Completed' && isCompleted && !isArchived) ||\r\n      (filter === 'Archived' && isArchived);\r\n    \r\n    if (!matchesFilter) return false;\r\n    \r\n    // For archived requests, use original project name if available\r\n    const projectName = isArchived && r.originalProjectName ? r.originalProjectName : r.project?.projectName;\r\n    \r\n    const searchTarget = [\r\n      r.materials?.map(m => m.materialName).join(', ') || '',\r\n      r.description || '',\r\n      r.createdBy?.name || '',\r\n      projectName || ''\r\n    ].join(' ').toLowerCase();\r\n    return searchTarget.includes(searchTerm.toLowerCase());\r\n  });\r\n\r\n  // priority removed\r\n  const sortedRequests = useMemo(() => {\r\n    return [...filteredRequests].sort((a,b) => {\r\n      if (filter === 'All') {\r\n        const aC = (a.status||'').toLowerCase() === 'received' || a.receivedByPIC ? 1:0;\r\n        const bC = (b.status||'').toLowerCase() === 'received' || b.receivedByPIC ? 1:0;\r\n        if (aC !== bC) return aC - bC;\r\n      }\r\n              switch (sortBy) {\r\n          case 'latest':\r\n          case 'date': \r\n            return new Date(b.createdAt||0) - new Date(a.createdAt||0);\r\n          case 'oldest': \r\n            return new Date(a.createdAt||0) - new Date(b.createdAt||0);\r\n          // priority case removed\r\n          case 'status': \r\n            return (a.status||'').localeCompare(b.status||'');\r\n          case 'requester': \r\n            return (a.createdBy?.name||'').localeCompare(b.createdBy?.name||'');\r\n          case 'project': \r\n            return (a.project?.projectName||'').localeCompare(b.project?.projectName||'');\r\n                    default:\r\n            return new Date(b.createdAt||0) - new Date(a.createdAt||0);\r\n        }\r\n    });\r\n  }, [filteredRequests, sortBy, filter]);\r\n\r\n  const totalPages = Math.ceil(sortedRequests.length / ITEMS_PER_PAGE);\r\n  const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;\r\n  const pageRequests = sortedRequests.slice(startIndex, startIndex + ITEMS_PER_PAGE);\r\n\r\n  const [pendingNudges, setPendingNudges] = useState({}); // transient disable while awaiting server\r\n  const [deletingId, setDeletingId] = useState(null);\r\n\r\n  const handleExportPdf = async () => {\r\n    if (!enableExport) return;\r\n    try {\r\n      setExporting(true);\r\n      await exportMaterialRequestsPdf(sortedRequests, {\r\n        companyName: 'FadzTrack',\r\n        logoPath: `${process.env.PUBLIC_URL || ''}/images/Fadz-logo.png`,\r\n        exporterName: storedUser?.name || 'Unknown',\r\n        exporterRole: storedUser?.role || '',\r\n        filters: { filter, searchTerm, sortBy },\r\n        reportTitle: exportTitle,\r\n      });\r\n    } catch (error) {\r\n      console.error('Export failed:', error);\r\n      alert('Failed to export PDF');\r\n    } finally {\r\n      setExporting(false);\r\n    }\r\n  };\r\n  \r\n  const handleDeleteArchived = (requestId) => {\r\n    const request = requests.find(r => r._id === requestId);\r\n    setRequestToDelete(request);\r\n    setShowDeleteConfirm(true);\r\n  };\r\n\r\n  const confirmDeleteArchived = async () => {\r\n    if (!requestToDelete) return;\r\n    \r\n    setDeletingId(requestToDelete._id);\r\n    try {\r\n      await api.delete(`/requests/${requestToDelete._id}/archived`);\r\n      // Refresh the requests list\r\n      const res = await api.get(fetchUrl);\r\n      setRequests(Array.isArray(res.data) ? res.data : []);\r\n      setShowDeleteConfirm(false);\r\n      setRequestToDelete(null);\r\n    } catch (error) {\r\n      alert('Failed to delete archived request: ' + (error?.response?.data?.message || error.message));\r\n    } finally {\r\n      setDeletingId(null);\r\n    }\r\n  };\r\n  \r\n  const handleNudge = async (reqObj) => {\r\n    if(!isPICRole) return; const id=reqObj._id; const status=(reqObj.status||'').toLowerCase();\r\n    if(!(status==='pending project manager' || status==='pending area manager')) return;\r\n    if(nudgeCooldowns[id] && nudgeCooldowns[id] > Date.now()) return; // still cooling down\r\n    if(pendingNudges[id]) return; // already firing\r\n    setPendingNudges(p=>({...p,[id]:true}));\r\n    try {\r\n      const { data } = await api.post(`/requests/${id}/nudge`);\r\n      const until = data?.nextAllowedAt || (Date.now()+60*60*1000);\r\n      alert('Reminder sent.');\r\n      setNudgeCooldowns(prev=>{ const next={...prev,[id]:until}; localStorage.setItem('nudgeCooldowns', JSON.stringify(next)); return next; });\r\n    } catch(e){\r\n      const msg=e?.response?.data?.message; const untilServer=e?.response?.data?.nextAllowedAt; if(msg){ alert(msg); if(untilServer){ setNudgeCooldowns(prev=>{ const next={...prev,[id]:untilServer}; localStorage.setItem('nudgeCooldowns', JSON.stringify(next)); return next; }); } else { const match=/(\\d+) minute/.exec(msg); if(match){ const mins=parseInt(match[1],10); const until=Date.now()+mins*60*1000; setNudgeCooldowns(prev=>{ const next={...prev,[id]:until}; localStorage.setItem('nudgeCooldowns', JSON.stringify(next)); return next; }); } } } else alert('Failed to send reminder.'); }\r\n    finally { setPendingNudges(p=>{ const { [id]:_, ...rest}=p; return rest; }); }\r\n  };\r\n\r\n  const formatRemaining = (ms) => {\r\n    if(ms <= 0) return 'Nudge';\r\n    const totalSec = Math.ceil(ms/1000);\r\n    const m = Math.floor(totalSec/60);\r\n    const s = totalSec%60;\r\n    if(m >= 60){\r\n      const h = Math.floor(m/60); const rm = m%60; return `${h}h ${rm}m`;\r\n    }\r\n    return m>0 ? `${m}m ${s.toString().padStart(2,'0')}s` : `${s}s`;\r\n  };\r\n\r\n  const formatNextTime = (ts) => {\r\n    if(!ts) return '';\r\n    const d = new Date(ts);\r\n    const now = new Date();\r\n    const opts = { hour:'2-digit', minute:'2-digit' };\r\n    const timePart = d.toLocaleTimeString([], opts);\r\n    const isToday = d.toDateString() === now.toDateString();\r\n    return `${isToday? 'Today' : d.toLocaleDateString()} ${timePart}`;\r\n  };\r\n\r\n  const iconFor = (state) => {\r\n    switch(state){\r\n      case 'completed': return '✓';\r\n      case 'denied': return '✗';\r\n      case 'blocked': return '!';\r\n      case 'current': return '●';\r\n      case 'pending': return '○';\r\n      default: return '○';\r\n    }\r\n  };\r\n  const subFor = (s, key) => {\r\n    if (s === 'completed') return key === 'received' ? 'Done' : 'Done';\r\n    if (s === 'denied') return 'Denied';\r\n    if (s === 'blocked') return 'Waiting';\r\n    if (s === 'current') return 'Current';\r\n    if (key === 'received') return 'Pending';\r\n    return 'Pending';\r\n  };\r\n\r\n  const renderCardView = () => (\r\n    <ul className=\"request-list\">\r\n      {pageRequests.map(r => {\r\n        const { steps, meta } = computeApprovalSteps(r);\r\n        const statusBadge = getStatusBadge(r.status, meta.isReceived);\r\n        const isArchived = r.status === 'Archived' || r.isArchived;\r\n        const projectName = isArchived && r.originalProjectName ? r.originalProjectName : r.project?.projectName;\r\n        \r\n        return (\r\n          <li key={r._id} className={`request-row ${meta.anyDenied?'request-denied':''} ${meta.isReceived?'request-completed':''} ${isArchived?'status-archived':''}`}>\r\n            {isArchived && (\r\n              <div className=\"archived-notice\">\r\n                <span className=\"archived-badge\">Archived – Project Completed</span>\r\n                {r.archivedReason && <span className=\"archive-reason\">{r.archivedReason}</span>}\r\n              </div>\r\n            )}\r\n            <div className=\"request-row-header\">\r\n              <div className=\"request-title-group\">\r\n                <h3 className=\"request-row-title\">{r.materials?.length ? r.materials.map(m=>`${m.materialName} (${m.quantity}${m.unit? ' '+m.unit:''})`).join(', ') : 'Material Request'}</h3>\r\n                <p className=\"request-row-desc\">{truncateWords(r.description||'No description',28)}</p>\r\n              </div>\r\n              <span className={`status-chip status-${statusBadge.toLowerCase()}`}>{statusBadge}</span>\r\n            </div>\r\n            <div className=\"request-meta-line\">\r\n              <span className=\"meta-origin\">\r\n                <strong>{r.createdBy?.name||'Unknown'}</strong> • {new Date(r.createdAt).toLocaleDateString()} \r\n                {projectName && <span>• {projectName}</span>}\r\n              </span>\r\n            </div>\r\n            {isArchived && r.originalRequestDetails && (\r\n              <div className=\"original-request-details\">\r\n                <div className=\"original-project-info\">\r\n                  <strong>Original Status:</strong> {r.originalRequestStatus}\r\n                  {r.originalProjectEndDate && (\r\n                    <span> • <strong>Project End Date:</strong> {new Date(r.originalProjectEndDate).toLocaleDateString()}</span>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            )}\r\n            {!isArchived && (\r\n              <div className=\"progress-steps\">\r\n                {steps.map((s,idx)=>(\r\n                  <div key={s.key} className={`progress-step ${s.state}`}>\r\n                    <div className=\"step-icon\">{iconFor(s.state)}</div>\r\n                    <div className=\"step-label\">{s.label}</div>\r\n                    <div className=\"step-sub\">{subFor(s.state,s.key)}</div>\r\n                    <div className=\"step-date\">{s.date? new Date(s.date).toLocaleDateString(): '—'}</div>\r\n                    {idx < steps.length-1 && <div className={`step-connector ${steps[idx+1].state==='completed'?'completed':''}`}></div>}\r\n                  </div>))}\r\n              </div>\r\n            )}\r\n            <div className=\"request-actions\">\r\n              {isArchived ? (\r\n                <div className=\"archived-actions\">\r\n                  <Link to={`${detailLinkBase}/${r._id}`} className=\"view-details-btn\">View Details</Link>\r\n                  <button \r\n                    onClick={() => handleDeleteArchived(r._id)} \r\n                    className=\"delete-archived-btn\"\r\n                    disabled={deletingId === r._id}\r\n                  >\r\n                    {deletingId === r._id ? 'Deleting...' : 'Delete Permanently'}\r\n                  </button>\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  {isPICRole && (\r\n                    (()=>{ const status=(r.status||'').toLowerCase(); const canNudge = (status==='pending project manager'||status==='pending area manager') && r.createdBy?._id===userId && !meta.isReceived && !meta.anyDenied; if(!canNudge) return null; const coolingRaw=nudgeCooldowns[r._id]; const remaining = coolingRaw ? (coolingRaw - nowTs) : 0; if(remaining<=0 && coolingRaw){ // cleanup expired\r\n                      setTimeout(()=>{ setNudgeCooldowns(prev=>{ const copy={...prev}; delete copy[r._id]; localStorage.setItem('nudgeCooldowns', JSON.stringify(copy)); return copy; }); },0); }\r\n                    const isPending = pendingNudges[r._id];\r\n                    const nextAt = nudgeCooldowns[r._id];\r\n                    return <div style={{display:'flex', flexDirection:'column', alignItems:'flex-start'}}>\r\n                      <button\r\n                        onClick={()=>handleNudge(r)}\r\n                        disabled={remaining>0 || isPending}\r\n                        className=\"view-details-btn\"\r\n                        title={remaining>0 && nextAt ? `Next nudge allowed at ${formatNextTime(nextAt)}` : 'Send reminder to pending approver'}\r\n                        style={{background:'#0f766e', opacity:(remaining>0||isPending)?0.7:1}}\r\n                      >{isPending? 'Sending...' : formatRemaining(remaining)}</button>\r\n                      {remaining>0 && nextAt && <span style={{marginTop:4, fontSize:11, color:'#0f766e'}}>{formatNextTime(nextAt)}</span>}\r\n                    </div>; })()\r\n                  )}\r\n                  <Link to={`${detailLinkBase}/${r._id}`} className=\"view-details-btn\" style={{marginLeft:isPICRole? '0.5rem':0}}>View Details</Link>\r\n                </>\r\n              )}\r\n            </div>\r\n          </li>\r\n        );\r\n      })}\r\n    </ul>\r\n  );\r\n\r\n  const renderListView = () => (\r\n    <div className=\"request-table-container\">\r\n      <table className=\"request-table\">\r\n        <thead>\r\n          <tr>\r\n            <th>Materials</th>\r\n            <th>Description</th>\r\n            <th>Requester</th>\r\n            <th>Project</th>\r\n            <th>Date</th>\r\n            <th>Status</th>\r\n            <th>Actions</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {pageRequests.map(r => {\r\n            const { steps, meta } = computeApprovalSteps(r);\r\n            const statusBadge = getStatusBadge(r.status, meta.isReceived);\r\n            const isArchived = r.status === 'Archived' || r.isArchived;\r\n            const projectName = isArchived && r.originalProjectName ? r.originalProjectName : r.project?.projectName;\r\n            \r\n            return (\r\n              <React.Fragment key={r._id}>\r\n                <tr className={`table-row ${meta.anyDenied?'request-denied':''} ${meta.isReceived?'request-completed':''} ${isArchived?'status-archived':''}`}>\r\n                  <td className=\"table-cell materials-cell\" title={r.materials?.length ? r.materials.map(m=>`${m.materialName} (${m.quantity}${m.unit? ' '+m.unit:''})`).join(', ') : 'Material Request'}>\r\n                    {r.materials?.length ? r.materials.map(m=>`${m.materialName} (${m.quantity}${m.unit? ' '+m.unit:''})`).join(', ') : 'Material Request'}\r\n                  </td>\r\n                  <td className=\"table-cell description-cell\" title={r.description||'No description'}>\r\n                    {truncateWords(r.description||'No description', 50)}\r\n                  </td>\r\n                  <td className=\"table-cell requester-cell\" title={r.createdBy?.name||'Unknown'}>\r\n                    <strong>{r.createdBy?.name||'Unknown'}</strong>\r\n                  </td>\r\n                  <td className=\"table-cell project-cell\" title={projectName || '—'}>\r\n                    {projectName || '—'}\r\n                  </td>\r\n                  <td className=\"table-cell date-cell\" title={new Date(r.createdAt).toLocaleDateString()}>\r\n                    {new Date(r.createdAt).toLocaleDateString()}\r\n                  </td>\r\n                  <td className=\"table-cell status-cell\">\r\n                    <span className={`status-chip status-${statusBadge.toLowerCase()}`}>{statusBadge}</span>\r\n                    {isArchived && r.archivedReason && (\r\n                      <div className=\"archive-reason\" style={{fontSize: '11px', color: '#666', marginTop: '2px'}}>\r\n                        {r.archivedReason}\r\n                      </div>\r\n                    )}\r\n                  </td>\r\n                  <td className=\"table-cell actions-cell\">\r\n                    {isArchived ? (\r\n                      <div className=\"archived-actions\">\r\n                        <Link to={`${detailLinkBase}/${r._id}`} className=\"view-details-btn\">View</Link>\r\n                        <button \r\n                          onClick={() => handleDeleteArchived(r._id)} \r\n                          className=\"delete-archived-btn\"\r\n                          disabled={deletingId === r._id}\r\n                          style={{marginLeft: '5px', fontSize: '11px', padding: '2px 6px'}}\r\n                        >\r\n                          {deletingId === r._id ? 'Deleting...' : 'Delete'}\r\n                        </button>\r\n                      </div>\r\n                    ) : (\r\n                      <>\r\n                        {isPICRole && (\r\n                          (()=>{ const status=(r.status||'').toLowerCase(); const canNudge = (status==='pending project manager'||status==='pending area manager') && r.createdBy?._id===userId && !meta.isReceived && !meta.anyDenied; if(!canNudge) return null; const coolingRaw=nudgeCooldowns[r._id]; const remaining = coolingRaw ? (coolingRaw - nowTs) : 0; if(remaining<=0 && coolingRaw){ // cleanup expired\r\n                            setTimeout(()=>{ setNudgeCooldowns(prev=>{ const copy={...prev}; delete copy[r._id]; localStorage.setItem('nudgeCooldowns', JSON.stringify(copy)); return copy; }); },0); }\r\n                          const isPending = pendingNudges[r._id];\r\n                          const nextAt = nudgeCooldowns[r._id];\r\n                          return <button\r\n                            onClick={()=>handleNudge(r)}\r\n                            disabled={remaining>0 || isPending}\r\n                            className=\"nudge-btn\"\r\n                            title={remaining>0 && nextAt ? `Next nudge allowed at ${formatNextTime(nextAt)}` : 'Send reminder to pending approver'}\r\n                          >{isPending? 'Sending...' : formatRemaining(remaining)}</button>; })()\r\n                        )}\r\n                        <Link to={`${detailLinkBase}/${r._id}`} className=\"view-details-btn\">View</Link>\r\n                      </>\r\n                    )}\r\n                  </td>\r\n                </tr>\r\n                <tr className={`progress-row ${meta.anyDenied?'request-denied':''} ${meta.isReceived?'request-completed':''}`}>\r\n                  <td colSpan=\"7\" className=\"progress-cell-full\">\r\n                    <div className=\"progress-steps-list\">\r\n                      {steps.map((s,idx)=>(\r\n                        <div key={s.key} className={`progress-step-list ${s.state}`}>\r\n                          <div className=\"step-icon-list\">{iconFor(s.state)}</div>\r\n                          <div className=\"step-label-list\">{s.label}</div>\r\n                          <div className=\"step-sub-list\">{subFor(s.state,s.key)}</div>\r\n                          <div className=\"step-date-list\">{s.date? new Date(s.date).toLocaleDateString(): '—'}</div>\r\n                          {idx < steps.length-1 && <div className={`step-connector-list ${steps[idx+1].state==='completed'?'completed':''}`}></div>}\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              </React.Fragment>\r\n            );\r\n          })}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className={`dashboard-container ${rootClass}`}>\r\n  {!disableHeader && (customHeader ? customHeader : (\r\n        <AppHeader roleSegment={(role||'').toLowerCase().includes('project manager')? 'pm' : (role||'').toLowerCase().includes('area manager')? 'am' : (role||'').toLowerCase().includes('person in charge')? 'pic' : (role||'').toLowerCase().includes('ceo')? 'ceo' : (role||'').toLowerCase().includes('it')? 'it':'pic'}\r\n          below={<div className=\"header-content\" style={{padding:'0.75rem 1.5rem'}}>\r\n            <div className=\"header-left\"><h1 className=\"header-title\" style={{margin:0,fontSize:'1.15rem'}}>{headerTitle}</h1><p className=\"header-subtitle\" style={{margin:0,fontSize:'0.75rem',opacity:.75}}>{headerSubtitle}</p></div>\r\n            <div className=\"header-right\"><div className=\"header-role-chip\" style={{background:'#1e293b',padding:'4px 10px',borderRadius:16,fontSize:12}}>{role}</div></div>\r\n          </div>}\r\n        />\r\n  ))}\r\n      <main className=\"dashboard-main\">\r\n        <div className=\"page-container\">\r\n          <div className=\"controls-bar\">\r\n            <div className=\"filter-tabs\">\r\n              {['All','Pending','Approved','Cancelled','Completed','Archived'].map(tab => (\r\n                <button key={tab} className={`filter-tab ${filter===tab?'active':''}`} onClick={()=>{setFilter(tab); setCurrentPage(1);}}>{tab}</button>\r\n              ))}\r\n            </div>\r\n            <div className=\"search-sort-section\">\r\n              <div className=\"search-wrapper\">\r\n                <input value={searchTerm} onChange={e=>setSearchTerm(e.target.value)} placeholder=\"Search requests...\" className=\"search-input\" />\r\n              </div>\r\n              <div className=\"sort-wrapper\">\r\n                <select value={sortBy} onChange={e=>setSortBy(e.target.value)} className=\"sort-select\">\r\n                  <option value=\"latest\">Latest First</option>\r\n                  <option value=\"oldest\">Oldest First</option>\r\n                  {/* Priority sort removed */}\r\n                  <option value=\"status\">By Status</option>\r\n                  <option value=\"requester\">By Requester</option>\r\n                  <option value=\"project\">By Project</option>\r\n                </select>\r\n              </div>\r\n              <div className=\"view-toggle\">\r\n                <button\r\n                  className={`view-toggle-btn ${viewMode === 'card' ? 'active' : ''}`}\r\n                  onClick={() => setViewMode('card')}\r\n                  title=\"Card View\"\r\n                >\r\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                    <path d=\"M3 3h7v7H3V3zm0 11h7v7H3v-7zm11-11h7v7h-7V3zm0 11h7v7h-7v-7z\"/>\r\n                  </svg>\r\n                </button>\r\n                <button\r\n                  className={`view-toggle-btn ${viewMode === 'list' ? 'active' : ''}`}\r\n                  onClick={() => setViewMode('list')}\r\n                  title=\"List View\"\r\n                >\r\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                    <path d=\"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z\"/>\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n              {enableExport && (\r\n                <button\r\n                  onClick={handleExportPdf}\r\n                  disabled={exporting || sortedRequests.length === 0}\r\n                  className=\"btn-primary export-btn\"\r\n                  style={{ display: 'flex', alignItems: 'center', gap: '8px', padding: '8px 16px', minWidth: 'auto' }}\r\n                >\r\n                  <FaDownload />\r\n                  {exporting ? 'Exporting...' : 'Export PDF'}\r\n                </button>\r\n              )}\r\n              {isPICRole && activeProject && (\r\n                <button onClick={()=>window.location.href = `/pic/projects/${activeProject._id}/request`} className=\"view-details-btn\" style={{marginLeft:'0.5rem'}}>\r\n                  + New Request\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n          <div className={`requests-grid ${viewMode === 'list' ? 'list-view' : 'enhanced-list'}`}>\r\n            {loading ? (\r\n              <div className=\"loading-state\"><div className=\"loading-spinner\"/><p>Loading...</p></div>\r\n            ) : error ? (\r\n              <div className=\"error-state\"><p>{error}</p></div>\r\n            ) : pageRequests.length === 0 ? (\r\n              <div className=\"empty-state\"><div className=\"empty-icon\">📦</div><h3>No material requests found</h3><p>No requests match your current filters.</p></div>\r\n            ) : (\r\n              viewMode === 'card' ? renderCardView() : renderListView()\r\n            )}\r\n          </div>\r\n          {sortedRequests.length > 0 && (\r\n            <div className=\"pagination-section\">\r\n              <div className=\"pagination-info\">Showing {startIndex+1} to {Math.min(startIndex+ITEMS_PER_PAGE, sortedRequests.length)} of {sortedRequests.length} entries</div>\r\n              <div className=\"pagination-controls\">\r\n                <button className=\"pagination-btn\" disabled={currentPage===1} onClick={()=>setCurrentPage(p=>Math.max(p-1,1))}>Previous</button>\r\n                {Array.from({length: totalPages},(_,i)=>i+1).map(p=> <button key={p} className={`pagination-btn ${p===currentPage?'active':''}`} onClick={()=>setCurrentPage(p)}>{p}</button>)}\r\n                <button className=\"pagination-btn\" disabled={currentPage===totalPages} onClick={()=>setCurrentPage(p=>Math.min(p+1,totalPages))}>Next</button>\r\n              </div>\r\n            </div>) }\r\n        </div>\r\n      </main>\r\n      \r\n      {/* Delete Confirmation Modal */}\r\n      {showDeleteConfirm && requestToDelete && (\r\n        <div className=\"modal-overlay\">\r\n          <div className=\"modal small\">\r\n            <h3>Confirm Permanent Deletion</h3>\r\n            \r\n            <div style={{\r\n              backgroundColor: '#fef2f2',\r\n              border: '1px solid #fecaca',\r\n              borderRadius: '8px',\r\n              padding: '12px',\r\n              marginBottom: '16px'\r\n            }}>\r\n              <div style={{display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '8px'}}>\r\n                <span style={{fontSize: '20px'}}>⚠️</span>\r\n                <strong style={{color: '#dc2626'}}>Permanent Deletion Warning</strong>\r\n              </div>\r\n              <p style={{color: '#dc2626', margin: 0, fontSize: '14px'}}>\r\n                This action cannot be undone. The archived request will be permanently removed from the system.\r\n              </p>\r\n            </div>\r\n\r\n            <div style={{marginBottom: '16px'}}>\r\n              <p style={{marginBottom: '8px', fontWeight: '600'}}>Request Details:</p>\r\n              <div style={{backgroundColor: '#f9fafb', padding: '12px', borderRadius: '6px', fontSize: '14px'}}>\r\n                <p style={{margin: '0 0 4px 0'}}><strong>Project:</strong> {requestToDelete.project?.projectName || 'Unknown'}</p>\r\n                <p style={{margin: '0 0 4px 0'}}><strong>Requester:</strong> {requestToDelete.createdBy?.name || 'Unknown'}</p>\r\n                <p style={{margin: '0 0 4px 0'}}><strong>Status:</strong> {requestToDelete.status || 'Unknown'}</p>\r\n                <p style={{margin: '0'}}><strong>Created:</strong> {requestToDelete.createdAt ? new Date(requestToDelete.createdAt).toLocaleDateString() : 'Unknown'}</p>\r\n              </div>\r\n            </div>\r\n\r\n            <p style={{marginBottom: '16px', fontSize: '14px', lineHeight: '1.5'}}>\r\n              Are you sure you want to <strong>permanently delete</strong> this archived material request?\r\n            </p>\r\n\r\n            <div className=\"modal-actions\" style={{display:'flex',gap:'0.5rem',justifyContent:'flex-end'}}>\r\n              <button \r\n                className=\"btn\" \r\n                onClick={() => {\r\n                  setShowDeleteConfirm(false);\r\n                  setRequestToDelete(null);\r\n                }}\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button \r\n                className=\"btn primary\" \r\n                disabled={deletingId === requestToDelete._id}\r\n                onClick={confirmDeleteArchived}\r\n                style={{backgroundColor: '#dc2626'}}\r\n              >\r\n                {deletingId === requestToDelete._id ? 'Deleting...' : 'Yes, Delete Permanently'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MaterialRequestListView;\r\n","// Shared utilities for Material Request views\r\nexport const truncateWords = (text = '', maxWords = 10) => {\r\n  if (!text || typeof text !== 'string') return '';\r\n  const words = text.trim().split(/\\s+/);\r\n  if (words.length <= maxWords) return text;\r\n  return words.slice(0, maxWords).join(' ') + '...';\r\n};\r\n\r\nexport const getStatusBadge = (status, receivedFlag) => {\r\n  const s = (status || '').toLowerCase();\r\n  if (s === 'archived') return 'Archived';\r\n  if (s === 'received' || receivedFlag) return 'Completed';\r\n  if (s.includes('approved')) return 'Approved';\r\n  if (s.includes('pending')) return 'Pending';\r\n  if (s.includes('denied') || s.includes('cancel')) return 'Rejected';\r\n  return 'Unknown';\r\n};\r\n\r\nexport const computeApprovalSteps = (request) => {\r\n  const approvalsArr = Array.isArray(request.approvals) ? request.approvals : [];\r\n  const pmApproval = approvalsArr.filter(a => a.role === 'Project Manager').slice(-1)[0];\r\n  const amApproval = approvalsArr.filter(a => a.role === 'Area Manager').slice(-1)[0];\r\n  const pmDecision = pmApproval?.decision; // approved | denied\r\n  const amDecision = amApproval?.decision;\r\n  const pmDenied = pmDecision === 'denied';\r\n  const amDenied = amDecision === 'denied';\r\n  const pmApproved = pmDecision === 'approved';\r\n  const amApproved = amDecision === 'approved';\r\n  const statusLower = (request.status || '').toLowerCase();\r\n  const isReceived = statusLower === 'received' || request.receivedByPIC;\r\n  const receivedDate = request.receivedAt || request.receivedDate || null;\r\n  const anyDenied = pmDenied || amDenied || statusLower.includes('denied');\r\n\r\n  // Determine current stage for highlighting\r\n  let currentStage = null;\r\n  if (statusLower.includes('pending project manager')) {\r\n    currentStage = 'pm';\r\n  } else if (statusLower.includes('pending area manager')) {\r\n    currentStage = 'am';\r\n  } else if (pmApproved && amApproved && !isReceived && !anyDenied) {\r\n    currentStage = 'received';\r\n  }\r\n\r\n  const pmState = pmDenied ? 'denied' : pmApproved ? 'completed' : (currentStage === 'pm' ? 'current' : 'pending');\r\n  let amState;\r\n  if (pmDenied) amState = 'denied';\r\n  else if (!pmApproved) amState = 'blocked';\r\n  else amState = amDenied ? 'denied' : amApproved ? 'completed' : (currentStage === 'am' ? 'current' : 'pending');\r\n\r\n  let receivedState;\r\n  if (anyDenied) receivedState = 'denied';\r\n  else if (!(pmApproved && amApproved)) receivedState = 'blocked';\r\n  else receivedState = isReceived ? 'completed' : (currentStage === 'received' ? 'current' : 'pending');\r\n\r\n  const steps = [\r\n    { key:'placed', label:'Placed', date:request.createdAt, state:'completed' },\r\n    { key:'pm', label:'PM', date: pmApproval?.timestamp || null, state: pmState },\r\n    { key:'am', label:'AM', date: amApproval?.timestamp || null, state: amState },\r\n    { key:'received', label:'Received', date: isReceived ? (receivedDate || amApproval?.timestamp) : null, state: receivedState }\r\n  ];\r\n  return { steps, meta:{ pmApproval, amApproval, pmApproved, pmDenied, amApproved, amDenied, isReceived, anyDenied, currentStage } };\r\n};\r\n\r\nexport const canUserActOnRequest = (request, userRole) => {\r\n  const role = (userRole||'').toLowerCase();\r\n  const status = (request?.status||'').toLowerCase();\r\n  if (!request) return false;\r\n  if (status.includes('denied') || status === 'received') return false;\r\n  if (status === 'pending project manager') return ['project manager','pm','admin'].includes(role);\r\n  if (status === 'pending area manager') return ['area manager','am','admin'].includes(role);\r\n  return false;\r\n};\r\n"],"names":["_ref","_requestData$approval","requestData","userId","userRole","onBack","onActionComplete","roleKey","status","isPendingForMe","hasActed","approvals","some","a","_a$user","role","String","user","_id","showApproveDeny","showDenyReason","setShowDenyReason","useState","denyReason","setDenyReason","showApproveConfirm","setShowApproveConfirm","closeDenyModal","clear","arguments","length","undefined","prevDenyRef","useRef","denyTextareaRef","useEffect","current","requestAnimationFrame","el","focus","selectionStart","selectionEnd","value","prev","document","body","style","overflow","onKey","e","key","window","addEventListener","removeEventListener","ModalPortal","_ref2","children","createPortal","feedback","setFeedback","denySubmitting","setDenySubmitting","t","setTimeout","clearTimeout","isReceived","receivedDate","dateVal","date","Date","toLocaleDateString","year","month","day","toLocaleTimeString","hour","minute","formatDateTime","isDenied","includes","deniedApproval","reverse","find","app","decision","approveLabel","canApprove","useMemo","approveModalMessage","_jsxs","_Fragment","marginBottom","fontWeight","textAlign","approval","name","concat","getDenierDisplay","background","color","borderRadius","padding","fontSize","maxWidth","margin","border","_jsx","reason","type","message","className","onClick","handleApprove","disabled","minWidth","cursor","handleDeny","marginLeft","position","inset","zIndex","top","left","transform","width","boxShadow","animation","stopPropagation","direction","dir","spellCheck","onChange","raw","target","next","endsWith","slice","rows","autoFocus","minHeight","resize","whiteSpace","overflowWrap","lineHeight","fontFamily","writingMode","textIndent","caretColor","unicodeBidi","autoComplete","ref","placeholder","marginTop","display","justifyContent","gap","opacity","async","trim","token","localStorage","getItem","console","log","id","api","post","headers","Authorization","err","_err$response2","_err$response2$data","error","response","data","alignItems","submitApproveFromModal","payload","_err$response","_err$response$data","_materialRequest$crea","_materialRequest$proj","_materialRequest$proj2","_materialRequest$proj3","_materialRequest$proj4","_materialRequest$proj5","_materialRequest$proj6","_denialApproval$user","_materialRequest$proj7","_materialRequest$proj8","_materialRequest$crea2","_materialRequest$crea3","_materialRequest$crea4","_materialRequest$proj9","_materialRequest$proj0","_materialRequest$proj1","_materialRequest$proj10","_materialRequest$proj11","_materialRequest$mate","_materialRequest$atta","rootClass","headerTitle","headerSubtitle","customHeader","disableHeader","useParams","navigate","useNavigate","materialRequest","setMaterialRequest","loading","setLoading","setError","isHeaderCollapsed","setIsHeaderCollapsed","isProfileOpen","setIsProfileOpen","isCEO","toLowerCase","collapsedSections","setCollapsedSections","att","copied","setCopied","receiving","setReceiving","previewAttachment","setPreviewAttachment","signedUrls","setSignedUrls","profileDropdownRef","JSON","parse","_unused","fetchRequest","useCallback","mounted","ctrl","AbortController","axiosInstance","get","signal","then","r","catch","_e$response","_e$response$data","finally","abort","attachments","active","res","map","forEach","o","signedUrl","warn","onScroll","st","pageYOffset","documentElement","scrollTop","contains","handleBack","renderAttachmentIcon","ext","split","pop","AppHeader","roleSegment","below","steps","meta","computeApprovalSteps","completedCount","filter","s","state","totalCount","progressPct","Math","min","round","statusBadge","getStatusBadge","canAct","canUserActOnRequest","test","denialApproval","Array","isArray","isPIC","isCreator","createdBy","statusLower","alreadyReceived","receivedByPIC","hasAnyApproval","canEditPIC","canMarkReceived","_navigator$clipboard","navigator","clipboard","writeText","title","requestNumber","description","createdAt","project","projectName","budget","toLocaleString","location","toString","call","updatedAt","receivedAt","email","materials","m","i","materialName","quantity","unit","specifications","url","startsWith","match","buildAttachmentUrl","image","isImage","src","alt","open","tabIndex","onKeyDown","href","rel","step","waitingForReceipt","pmApproved","amApproved","anyDenied","metaText","label","ApproveDenyActions","flexDirection","handleEdit","patch","_objectSpread","toISOString","alert","dt","Number","isNaN","getTime","computeStatusLabel","req","approvalSteps","lastStep","exportMaterialRequestsPdf","options","companyName","logoPath","exporterName","exporterRole","filters","reportTitle","doc","jsPDF","format","bodyFont","headStyle","marginX","y","logo","Promise","resolve","img","Image","crossOrigin","onload","c","createElement","naturalWidth","height","naturalHeight","getContext","drawImage","dataUrl","toDataURL","w","h","onerror","titleX","drawW","drawH","maxW","maxH","fitInside","addImage","setFont","setFontSize","setTextColor","text","setDrawColor","setLineWidth","line","filterSummary","parts","push","search","sortBy","dateFrom","dateTo","from","to","join","buildFiltersSummary","metaY","tableStartY","_r$createdBy","_r$project","materialDetails","priority","autoTable","startY","head","styles","font","fontStyle","cellPadding","halign","headStyles","fillColor","textColor","theme","right","columnStyles","cellWidth","didDrawPage","str","internal","pageSize","page","pageNumber","pages","getNumberOfPages","getTextWidth","save","prefix","d","pad","num","padStart","getFullYear","getMonth","getDate","time","getHours","getMinutes","buildFileName","_requestToDelete$proj","_requestToDelete$crea","fetchUrl","itemsPerPage","detailLinkBase","enableExport","exportTitle","requests","setRequests","setFilter","searchTerm","setSearchTerm","setSortBy","viewMode","setViewMode","currentPage","setCurrentPage","exporting","setExporting","activeProject","setActiveProject","nudgeCooldowns","setNudgeCooldowns","nowTs","setNowTs","now","isPICRole","storedUser","showDeleteConfirm","setShowDeleteConfirm","requestToDelete","setRequestToDelete","saved","_unused2","setItem","stringify","setInterval","clearInterval","ITEMS_PER_PAGE","_r$data","filteredRequests","_r$materials","isCompleted","isArchived","originalProjectName","sortedRequests","sort","b","_a$createdBy","_b$createdBy","_a$project","_b$project","aC","bC","localeCompare","totalPages","ceil","startIndex","pageRequests","pendingNudges","setPendingNudges","deletingId","setDeletingId","handleDeleteArchived","requestId","request","handleNudge","reqObj","p","until","nextAllowedAt","_e$response2","_e$response2$data","msg","untilServer","exec","mins","parseInt","_","_objectWithoutProperties","_toPropertyKey","formatRemaining","ms","totalSec","floor","rm","formatNextTime","ts","timePart","isToday","toDateString","iconFor","subFor","tab","viewBox","fill","FaDownload","_r$project2","_r$materials2","_r$createdBy2","archivedReason","truncateWords","originalRequestDetails","originalRequestStatus","originalProjectEndDate","idx","Link","_r$createdBy3","coolingRaw","remaining","copy","isPending","nextAt","_r$project3","_r$materials3","_r$materials4","_r$createdBy4","_r$createdBy5","React","_r$createdBy6","colSpan","max","backgroundColor","delete","_error$response","_error$response$data","maxWords","words","receivedFlag","approvalsArr","pmApproval","amApproval","pmDecision","amDecision","pmDenied","amDenied","currentStage","pmState","amState","receivedState","timestamp"],"sourceRoot":""}
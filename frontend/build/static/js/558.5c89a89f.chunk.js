"use strict";(self.webpackChunkfadz_web_frontend=self.webpackChunkfadz_web_frontend||[]).push([[558],{1499:(e,t,a)=>{a.r(t),a.d(t,{default:()=>l});var s=a(5043),n=a(7950),i=a(411),r=a(579);const l=e=>{var t;let{requestData:a,userId:l,userRole:o,onBack:d,onActionComplete:c}=e;const m="Project Manager"===o?"PM":"Area Manager"===o?"AM":o,u=null===a||void 0===a?void 0:a.status,h="Pending Project Manager"===u&&"PM"===m||"Pending Area Manager"===u&&"AM"===m,p=null===a||void 0===a||null===(t=a.approvals)||void 0===t?void 0:t.some((e=>{var t;return e.role===m&&String((null===(t=e.user)||void 0===t?void 0:t._id)||e.user)===String(l)})),g=h&&!p,[v,x]=(0,s.useState)(!1),[j,f]=(0,s.useState)(""),[y,N]=(0,s.useState)(!1),b=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];x(!1),e&&f("")},w=(0,s.useRef)(""),S=(0,s.useRef)(null);(0,s.useEffect)((()=>{w.current=j}),[j]),(0,s.useEffect)((()=>{v&&S.current&&requestAnimationFrame((()=>{const e=S.current;e.focus(),e.selectionStart=e.selectionEnd=e.value.length}))}),[v]),(0,s.useEffect)((()=>{if(v||y){const e=document.body.style.overflow;document.body.style.overflow="hidden";const t=e=>{"Escape"===e.key&&(v&&b(!0),y&&N(!1))};return window.addEventListener("keydown",t),()=>{document.body.style.overflow=e,window.removeEventListener("keydown",t)}}}),[v,y]);const C=e=>{let{children:t}=e;return(0,n.createPortal)(t,document.body)},[A,k]=(0,s.useState)(null),[D,q]=(0,s.useState)(!1);(0,s.useEffect)((()=>{if(!A)return;const e=setTimeout((()=>k(null)),5e3);return()=>clearTimeout(e)}),[A]);const R=!(null===a||void 0===a||!a.receivedDate),L=null!==a&&void 0!==a&&a.receivedDate?(e=>{if(!e)return"";const t=new Date(e);return t.toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"})+" "+t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})})(a.receivedDate):null,P=["Denied by Project Manager","Denied by Area Manager"].includes(null===a||void 0===a?void 0:a.status);let M=null;P&&(M=[...(null===a||void 0===a?void 0:a.approvals)||[]].reverse().find((e=>"denied"===e.decision)));let z="Approve";"Pending Project Manager"===u&&"PM"===m?z="Validate":"Pending Area Manager"===u&&"AM"===m&&(z="Approve");const B=(0,s.useMemo)((()=>g),[g]);let _="You are approving this request.";return"Pending Project Manager"===u&&"PM"===m?_="You are validating this request and sending it to the Area Manager.":"Pending Area Manager"===u&&"AM"===m&&(_="You are approving and completing this request."),(0,r.jsxs)(r.Fragment,{children:[P&&M&&(0,r.jsxs)("div",{style:{marginBottom:24},children:[(0,r.jsxs)("div",{style:{fontWeight:600,textAlign:"center",marginBottom:4},children:["Request Denied By: ",(e=>{if(!e)return"";let t="Project Manager"===e.role?"Project Manager":"Area Manager"===e.role?"Area Manager":e.role;return e.user&&"object"===typeof e.user&&e.user.name?"".concat(e.user.name," (").concat(t,")"):"".concat(t)})(M)]}),(0,r.jsxs)("div",{style:{background:"#faeaea",color:"#a12d2d",borderRadius:8,padding:"12px 16px",fontSize:15,maxWidth:800,margin:"0 auto",border:"1px solid #eedcdc",textAlign:"left"},children:[(0,r.jsx)("div",{style:{fontWeight:500,marginBottom:6},children:"Reason:"}),M.reason]})]}),A&&(0,r.jsx)("div",{style:{marginBottom:16,padding:"10px 14px",borderRadius:8,fontSize:13,background:"success"===A.type?"#ecfdf5":"#fef2f2",color:"success"===A.type?"#065f46":"#b91c1c",border:"1px solid ".concat("success"===A.type?"#a7f3d0":"#fecaca")},children:A.message}),R&&(0,r.jsxs)("div",{style:{margin:"40px 0 0",textAlign:"center",color:"#15a563",fontWeight:600},children:["This Request has been Closed and Items were Successfully Delivered On: ",L]}),(0,r.jsxs)("div",{className:"action-buttons unified",children:[(0,r.jsx)("button",{onClick:d,className:"back-btn",children:"Back"}),g&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{g&&N(!0)},disabled:!B,className:"publish-button-picmatreq",style:{background:B?"#16a34a":"#9ca3af",minWidth:140,cursor:B?"pointer":"not-allowed"},children:z}),(0,r.jsx)("button",{onClick:()=>{x(!0),q(!1)},className:"cancel-btn",style:{marginLeft:"1rem",background:"#dc3545",color:"#fff",minWidth:120},children:"Deny"})]})]}),v&&(0,r.jsx)(C,{children:(0,r.jsx)("div",{role:"dialog","aria-modal":"true","aria-label":"Deny Request",style:{position:"fixed",inset:0,zIndex:2e3,background:"rgba(0,0,0,0.55)"},onClick:()=>!D&&b(!0),children:(0,r.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:"100%",maxWidth:840,padding:"0 24px"},children:(0,r.jsxs)("div",{style:{background:"#fff",width:"100%",borderRadius:14,padding:"30px 34px",boxShadow:"0 15px 40px -8px rgba(0,0,0,0.25)",animation:"fadeInScale .18s ease"},onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("h3",{style:{margin:"0 0 14px",fontSize:22},children:"Deny Request"}),(0,r.jsx)("p",{style:{margin:"0 0 18px",fontSize:14,color:"#475569"},children:"Please provide a reason for denial:"}),(0,r.jsx)("div",{style:{direction:"ltr"},children:(0,r.jsx)("textarea",{dir:"ltr",spellCheck:!0,value:j,onChange:e=>{const t=e.target.value,a=w.current;let s=t;if(t.length===a.length+1&&t.endsWith(a)){s=a+t.slice(0,t.length-a.length)}else if(t.length>a.length+1&&t.endsWith(a)){s=a+t.slice(0,t.length-a.length)}f(s),requestAnimationFrame((()=>{if(S.current){const e=S.current;e.selectionStart=e.selectionEnd=e.value.length}}))},rows:6,autoFocus:!0,disabled:D,style:{width:"100%",borderRadius:10,border:"1px solid #93c5fd",padding:"14px 16px",fontSize:14,background:D?"#f1f5f9":"#f8fafc",minHeight:170,resize:"vertical",direction:"ltr",textAlign:"left",whiteSpace:"pre-wrap",overflowWrap:"break-word",lineHeight:"1.45",fontFamily:"inherit",writingMode:"horizontal-tb",textIndent:0,caretColor:"#111827",unicodeBidi:"isolate",transform:"none"},autoComplete:"off",ref:S,placeholder:"Enter reason for denial"})}),(0,r.jsxs)("div",{style:{marginTop:20,display:"flex",justifyContent:"flex-end",gap:12},children:[(0,r.jsx)("button",{onClick:()=>b(!0),disabled:D,style:{padding:"11px 22px",background:"#e2e8f0",border:"none",borderRadius:9,fontWeight:500,cursor:D?"not-allowed":"pointer",opacity:D?.6:1},children:"Cancel"}),(0,r.jsx)("button",{onClick:async()=>{if(!j.trim())return void k({type:"error",message:"Reason is required."});const e=localStorage.getItem("token");if(e)try{q(!0),console.log("[DENY] submitting",{id:null===a||void 0===a?void 0:a._id,reason:j}),await i.Ay.post("/requests/".concat(a._id,"/approve"),{decision:"denied",reason:j},{headers:{Authorization:"Bearer ".concat(e)}}),k({type:"success",message:"Request denied."}),x(!1),f(""),c?c():d()}catch(n){var t,s;console.error(n),k({type:"error",message:(null===n||void 0===n||null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Failed to deny request."})}finally{q(!1)}else k({type:"error",message:"Not authenticated."})},disabled:!j.trim()||D,style:{padding:"11px 24px",background:!j.trim()||D?"#fca5a5":"#dc2626",color:"#fff",border:"none",borderRadius:9,fontWeight:600,cursor:!j.trim()||D?"not-allowed":"pointer",opacity:D?.7:1},children:D?"Submitting...":"Submit"})]})]})})})}),y&&(0,r.jsx)(C,{children:(0,r.jsx)("div",{role:"dialog","aria-modal":"true","aria-label":"Approve Request",style:{position:"fixed",inset:0,zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.55)",padding:"24px"},onClick:()=>N(!1),children:(0,r.jsxs)("div",{style:{background:"#fff",borderRadius:14,padding:"30px 34px",width:"100%",maxWidth:640,boxShadow:"0 15px 40px -8px rgba(0,0,0,0.25)",animation:"fadeInScale .18s ease"},onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("h3",{style:{margin:"0 0 14px",fontSize:22,display:"flex",alignItems:"center",gap:10},children:[(0,r.jsx)("i",{className:"fas fa-check-circle",style:{color:"#16a34a"}})," Confirm ",z]}),(0,r.jsx)("p",{style:{margin:"0 0 18px",fontSize:14,color:"#475569"},children:_}),(0,r.jsxs)("div",{style:{marginTop:4,display:"flex",justifyContent:"flex-end",gap:12},children:[(0,r.jsx)("button",{onClick:()=>N(!1),style:{padding:"11px 22px",background:"#e2e8f0",border:"none",borderRadius:9,fontWeight:500,cursor:"pointer"},children:"Cancel"}),(0,r.jsx)("button",{onClick:()=>{N(!1),(async()=>{const e=localStorage.getItem("token"),t={decision:"approved"};try{await i.Ay.post("/requests/".concat(a._id,"/approve"),t,{headers:{Authorization:"Bearer ".concat(e)}}),k({type:"success",message:"Request approved."}),c?c():d()}catch(r){var s,n;k({type:"error",message:(null===r||void 0===r||null===(s=r.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||"Failed to approve request."})}})()},style:{padding:"11px 24px",background:"#16a34a",color:"#fff",border:"none",borderRadius:9,fontWeight:600,cursor:"pointer"},children:"Confirm"})]})]})})})]})}},3182:(e,t,a)=>{a.d(t,{A:()=>m});var s=a(9379),n=a(5043),i=a(8818),r=a(3216),l=a(411),o=a(1499),d=a(9855),c=a(579);const m=e=>{var t,a,m,u,h,p,g,v,x,j,f,y,N,b,w,S,C,A,k,D;let{role:q,rootClass:R="mr-request-detail",headerTitle:L="Material Request Detail",headerSubtitle:P="Full lifecycle view",customHeader:M=null,disableHeader:z=!1}=e;const{id:B}=(0,r.g)(),_=(0,r.Zp)(),[E,I]=(0,n.useState)(null),[F,T]=(0,n.useState)(!0),[W,U]=(0,n.useState)(""),[H,O]=(0,n.useState)(!1),[Y,V]=(0,n.useState)(!1),J="ceo"===(q||"").toLowerCase(),[K,G]=(0,n.useState)((()=>J?{att:!0}:{})),[Z,$]=(0,n.useState)(!1),[Q,X]=(0,n.useState)(!1),[ee,te]=(0,n.useState)(null),[ae,se]=(0,n.useState)({}),ne=(0,n.useRef)(null),ie=(()=>{try{return JSON.parse(localStorage.getItem("user"))||null}catch(e){return null}})(),re=null===ie||void 0===ie?void 0:ie._id,le=null===ie||void 0===ie?void 0:ie.role,oe=(0,n.useCallback)((()=>{let e=!0;T(!0),U("");const t=new AbortController;return l.Ay.get("/requests/".concat(B),{signal:t.signal}).then((t=>{e&&I(t.data)})).catch((t=>{var a,s;e&&"CanceledError"!==t.name&&U((null===t||void 0===t||null===(a=t.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to load")})).finally((()=>e&&T(!1))),()=>{e=!1,t.abort()}}),[B]);(0,n.useEffect)((()=>oe()),[oe]),(0,n.useEffect)((()=>{if(!E||!E.attachments||0===E.attachments.length)return;let e=!0;return(async()=>{try{const t=await l.Ay.get("/requests/".concat(E._id,"/attachments/signed"));if(!e)return;const a={};(t.data||[]).forEach((e=>{e.key&&e.signedUrl&&(a[e.key]=e.signedUrl)})),se(a)}catch(t){console.warn("Failed to fetch signed attachment urls",t)}})(),()=>{e=!1}}),[E]),(0,n.useEffect)((()=>{const e=()=>{const e=window.pageYOffset||document.documentElement.scrollTop;O(e>50)},t=e=>{ne.current&&!ne.current.contains(e.target)&&V(!1)};return window.addEventListener("scroll",e),document.addEventListener("click",t),()=>{window.removeEventListener("scroll",e),document.removeEventListener("click",t)}}),[]);const de=(0,n.useCallback)((()=>_(-1)),[_]),ce=function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split(".").pop().toLowerCase();return["png","jpg","jpeg","gif","webp"].includes(e)?(0,c.jsx)("i",{className:"fas fa-file-image"}):"pdf"===e?(0,c.jsx)("i",{className:"fas fa-file-pdf",style:{color:"#dc2626"}}):["doc","docx"].includes(e)?(0,c.jsx)("i",{className:"fas fa-file-word",style:{color:"#2563eb"}}):["xls","xlsx"].includes(e)?(0,c.jsx)("i",{className:"fas fa-file-excel",style:{color:"#16a34a"}}):(0,c.jsx)("i",{className:"fas fa-file"})};if((0,n.useEffect)((()=>{if(!ee)return;const e=e=>{"Escape"===e.key&&te(null)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[ee]),F||W||!E)return(0,c.jsxs)("div",{className:"dashboard-container ".concat(R),children:[!z&&(0,c.jsx)(i.A,{roleSegment:(q||"").toLowerCase().includes("project manager")?"pm":(q||"").toLowerCase().includes("area manager")?"am":(q||"").toLowerCase().includes("person in charge")?"pic":(q||"").toLowerCase().includes("ceo")?"ceo":(q||"").toLowerCase().includes("it")?"it":"pic",below:(0,c.jsxs)("div",{className:"header-content",style:{padding:"0.75rem 1.5rem"},children:[(0,c.jsxs)("div",{className:"header-left",children:[(0,c.jsx)("h1",{className:"header-title",style:{margin:0,fontSize:"1.15rem"},children:"Material Request Detail"}),(0,c.jsx)("p",{className:"header-subtitle",style:{margin:0,fontSize:"0.75rem",opacity:.75},children:"Loading details"})]}),(0,c.jsx)("div",{className:"header-right",children:(0,c.jsxs)("button",{onClick:de,className:"btn-secondary",children:[(0,c.jsx)("i",{className:"fas fa-arrow-left"})," Back"]})})]})}),(0,c.jsx)("div",{className:"dashboard-main",children:(0,c.jsxs)("div",{className:"page-container",children:[F&&(0,c.jsxs)("div",{className:"loading-state",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Loading..."})]}),!F&&W&&(0,c.jsx)("div",{className:"error-state",children:(0,c.jsx)("p",{children:W})})]})})]});const{steps:me,meta:ue}=(0,d.Yf)(E),he=me.filter((e=>"completed"===e.state)).length,pe=me.length,ge=Math.min(100,Math.round(he/(pe||1)*100)),ve=(0,d.KC)(E.status,ue.isReceived),xe=(0,d._U)(E,le),je=/denied/i.test(E.status||"");let fe=null;je&&Array.isArray(E.approvals)&&(fe=[...E.approvals].reverse().find((e=>"denied"===e.decision)));const ye="person in charge"===(le||"").toLowerCase(),Ne=(null===E||void 0===E||null===(t=E.createdBy)||void 0===t?void 0:t._id)===re,be=(E.status||"").toLowerCase(),we="received"===be||E.receivedByPIC,Se=Array.isArray(E.approvals)&&E.approvals.length>0,Ce=ye&&Ne&&!we&&!Se&&"pending project manager"===be,Ae=ye&&Ne&&!we&&"approved"===be;return(0,c.jsxs)("div",{className:"dashboard-container ".concat(R),children:[!z&&(M||(0,c.jsx)(i.A,{roleSegment:(q||"").toLowerCase().includes("project manager")?"pm":(q||"").toLowerCase().includes("area manager")?"am":(q||"").toLowerCase().includes("person in charge")?"pic":(q||"").toLowerCase().includes("ceo")?"ceo":(q||"").toLowerCase().includes("it")?"it":"pic",below:(0,c.jsxs)("div",{className:"header-content",style:{padding:"0.75rem 1.5rem"},children:[(0,c.jsxs)("div",{className:"header-left",children:[(0,c.jsx)("h1",{className:"header-title",style:{margin:0,fontSize:"1.15rem"},children:L}),(0,c.jsx)("p",{className:"header-subtitle",style:{margin:0,fontSize:"0.75rem",opacity:.75},children:P})]}),(0,c.jsx)("div",{className:"header-right",children:(0,c.jsxs)("button",{onClick:de,className:"btn-secondary",children:[(0,c.jsx)("i",{className:"fas fa-arrow-left"})," Back"]})})]})})),(0,c.jsx)("div",{className:"dashboard-main",children:(0,c.jsxs)("div",{className:"mrd ".concat(J?"mrd--bar":""),children:[(0,c.jsxs)("div",{className:"mrd-page-bar",children:[(0,c.jsxs)("div",{className:"mrd-page-left",children:[(0,c.jsxs)("button",{onClick:de,className:"mrd-back-btn",type:"button","aria-label":"Back to previous page",children:[(0,c.jsx)("i",{className:"fas fa-arrow-left"}),(0,c.jsx)("span",{children:"Back"})]}),(0,c.jsx)("h1",{className:"mrd-page-title",children:"Material Request"})]}),E.status&&(0,c.jsx)("div",{className:"mrd-page-status"})]}),(0,c.jsxs)("div",{className:"mrd-modern",children:[(0,c.jsxs)("div",{className:"mrd-modern-summary",children:[(0,c.jsxs)("div",{className:"mrd-ms-left",children:[(0,c.jsxs)("div",{className:"mrd-id-line",children:[(0,c.jsx)("span",{className:"mrd-id-label",children:"ID"}),(0,c.jsx)("span",{className:"mrd-id-value",children:E._id}),(0,c.jsx)("button",{className:"mrd-copy",onClick:()=>{var e;null===(e=navigator.clipboard)||void 0===e||e.writeText(E._id),$(!0),setTimeout((()=>$(!1)),1600)},title:"Copy ID",children:(0,c.jsx)("i",{className:"fas fa-copy"})}),Z&&(0,c.jsx)("span",{className:"mrd-copied",children:"Copied!"})]}),(0,c.jsx)("h2",{className:"mrd-title",style:{marginTop:4},children:E.requestNumber||"Material Request"}),E.description&&(0,c.jsx)("p",{className:"mrd-desc",style:{marginTop:8},children:E.description}),(0,c.jsxs)("div",{className:"mrd-summary-tags",children:[(0,c.jsxs)("span",{className:"mrd-meta",children:["Created ",new Date(E.createdAt).toLocaleDateString()]}),(null===(a=E.project)||void 0===a?void 0:a.projectName)&&(0,c.jsx)("span",{className:"mrd-meta",children:E.project.projectName}),"number"===typeof(null===(m=E.project)||void 0===m?void 0:m.budget)&&(0,c.jsxs)("span",{className:"mrd-meta",children:["Remaining Budget: \u20b1",E.project.budget.toLocaleString()]}),(null===(u=E.project)||void 0===u?void 0:u.location)&&(0,c.jsx)("span",{className:"mrd-meta",children:(null===(h=E.project.location)||void 0===h?void 0:h.name)||(null===(p=E.project.location)||void 0===p||null===(g=p.toString)||void 0===g?void 0:g.call(p))||"\u2014"})]}),(0,c.jsxs)("div",{className:"mrd-progress","aria-label":"Approval progress",children:[(0,c.jsx)("div",{className:"mrd-progress-bar",children:(0,c.jsx)("div",{className:"mrd-progress-fill",style:{width:ge+"%"}})}),(0,c.jsxs)("span",{className:"mrd-progress-meta",children:[ge,"% \u2022 ",he,"/",pe," steps"]})]})]}),(0,c.jsx)("div",{className:"mrd-ms-right",children:(0,c.jsx)("div",{className:"mrd-status-badge status-".concat(ve.toLowerCase()),children:ve})})]}),(0,c.jsxs)("div",{className:"mrd-modern-body",children:[(0,c.jsxs)("div",{className:"mrd-col-main",children:[je&&fe&&(0,c.jsxs)("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",padding:"14px 18px",borderRadius:12,marginBottom:18,color:"#991b1b",lineHeight:1.4,fontSize:14},role:"alert","aria-live":"polite",children:[(0,c.jsxs)("div",{style:{fontWeight:600,marginBottom:6,display:"flex",alignItems:"center",gap:8},children:[(0,c.jsx)("i",{className:"fas fa-ban"})," Request Denied",fe.role?" by ".concat(fe.role):""]}),(0,c.jsx)("div",{style:{whiteSpace:"pre-wrap"},children:fe.reason||"No reason provided."}),(null===(v=fe.user)||void 0===v?void 0:v.name)&&(0,c.jsxs)("div",{style:{marginTop:8,fontSize:11,opacity:.7},children:["By: ",fe.user.name," \u2022 ",new Date(fe.date||fe.updatedAt||fe.createdAt||E.updatedAt).toLocaleString()]})]}),(0,c.jsxs)("section",{className:"mrd-section flat","aria-labelledby":"info-h",children:[(0,c.jsxs)("h3",{id:"info-h",className:"mrd-section-title",children:[(0,c.jsx)("i",{className:"fas fa-info-circle"})," Information"]}),(0,c.jsxs)("dl",{className:"mrd-fields two-col",children:[(0,c.jsxs)("div",{className:"mrd-field",children:[(0,c.jsx)("dt",{children:"Request #"}),(0,c.jsx)("dd",{children:E.requestNumber||"\u2014"})]}),(0,c.jsxs)("div",{className:"mrd-field",children:[(0,c.jsx)("dt",{children:"Created"}),(0,c.jsx)("dd",{children:new Date(E.createdAt).toLocaleString()})]}),ue.isReceived&&(0,c.jsxs)("div",{className:"mrd-field",children:[(0,c.jsx)("dt",{children:"Received"}),(0,c.jsx)("dd",{children:new Date(E.receivedAt||E.receivedDate).toLocaleString()})]}),(0,c.jsxs)("div",{className:"mrd-field",children:[(0,c.jsx)("dt",{children:"Status"}),(0,c.jsx)("dd",{children:ve})]}),(0,c.jsxs)("div",{className:"mrd-field",children:[(0,c.jsx)("dt",{children:"Project"}),(0,c.jsx)("dd",{children:(null===(x=E.project)||void 0===x?void 0:x.projectName)||"\u2014"})]}),"number"===typeof(null===(j=E.project)||void 0===j?void 0:j.budget)&&(0,c.jsxs)("div",{className:"mrd-field",children:[(0,c.jsx)("dt",{children:"Project Budget"}),(0,c.jsxs)("dd",{children:["\u20b1",E.project.budget.toLocaleString()]})]})]})]}),(0,c.jsxs)("section",{className:"mrd-section flat","aria-labelledby":"req-h",children:[(0,c.jsxs)("h3",{id:"req-h",className:"mrd-section-title",children:[(0,c.jsx)("i",{className:"fas fa-user"})," Requester"]}),(0,c.jsxs)("dl",{className:"mrd-fields two-col",children:[(0,c.jsxs)("div",{className:"mrd-field",children:[(0,c.jsx)("dt",{children:"Name"}),(0,c.jsx)("dd",{children:(null===(f=E.createdBy)||void 0===f?void 0:f.name)||"\u2014"})]}),(0,c.jsxs)("div",{className:"mrd-field",children:[(0,c.jsx)("dt",{children:"Email"}),(0,c.jsx)("dd",{children:(null===(y=E.createdBy)||void 0===y?void 0:y.email)||"\u2014"})]}),(0,c.jsxs)("div",{className:"mrd-field",children:[(0,c.jsx)("dt",{children:"Role"}),(0,c.jsx)("dd",{children:(null===(N=E.createdBy)||void 0===N?void 0:N.role)||"\u2014"})]}),(0,c.jsxs)("div",{className:"mrd-field",children:[(0,c.jsx)("dt",{children:"Location"}),(0,c.jsx)("dd",{children:(null===(b=E.project)||void 0===b||null===(w=b.location)||void 0===w?void 0:w.name)||(null===(S=E.project)||void 0===S||null===(C=S.location)||void 0===C||null===(A=C.toString)||void 0===A?void 0:A.call(C))||"\u2014"})]})]})]}),(0,c.jsxs)("section",{className:"mrd-section flat","aria-labelledby":"mat-h",children:[(0,c.jsxs)("h3",{id:"mat-h",className:"mrd-section-title",children:[(0,c.jsx)("i",{className:"fas fa-boxes"})," Materials"]}),null!==(k=E.materials)&&void 0!==k&&k.length?(0,c.jsx)("ul",{className:"mrd-material-list modern",children:E.materials.map(((e,t)=>(0,c.jsxs)("li",{className:"mrd-material-item",children:[(0,c.jsxs)("div",{className:"mrd-material-head",children:[(0,c.jsx)("span",{className:"mrd-material-name",children:e.materialName}),(0,c.jsxs)("span",{className:"mrd-qty",children:[e.quantity,e.unit?" ".concat(e.unit):""]})]}),e.specifications&&(0,c.jsx)("div",{className:"mrd-spec",children:e.specifications})]},t)))}):(0,c.jsx)("p",{className:"mrd-empty",children:"No materials specified."})]})]}),(0,c.jsxs)("div",{className:"mrd-col-side",children:[(0,c.jsxs)("section",{className:"mrd-section flat","aria-labelledby":"att-h",children:[(0,c.jsxs)("h3",{id:"att-h",className:"mrd-section-title",children:[(0,c.jsx)("i",{className:"fas fa-paperclip"})," Attachments"]}),null!==(D=E.attachments)&&void 0!==D&&D.length?(0,c.jsx)("div",{className:"mrd-attach-gallery",children:E.attachments.map(((e,t)=>{const a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return"";if(ae[e])return ae[e];if(e.startsWith("http")){const t=e.match(/\/storage\/v1\/object\/public\/material-request-photos\/(.+)$/);return t&&t[1]&&ae[t[1]]?ae[t[1]]:e}return""}(e),s=function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split(".").pop().toLowerCase();return["png","jpg","jpeg","gif","webp"].includes(e)}(e);return(0,c.jsxs)("div",{className:"mrd-attach-tile",title:e,children:[s&&a?(0,c.jsx)("button",{type:"button",className:"mrd-thumb",onClick:()=>te(a),"aria-label":"Open image preview",children:(0,c.jsx)("img",{src:a,alt:e,loading:"lazy"})}):(0,c.jsx)("div",{className:"mrd-file-icon",onClick:()=>a&&window.open(a,"_blank","noopener"),role:"button",tabIndex:0,onKeyDown:e=>"Enter"===e.key&&a&&window.open(a,"_blank","noopener"),children:ce(e)}),(0,c.jsxs)("div",{className:"mrd-attach-meta",children:[(0,c.jsx)("span",{className:"mrd-attach-filename",children:e}),a?(0,c.jsx)("a",{className:"mrd-attach-download",href:a,target:"_blank",rel:"noopener noreferrer",children:"Download"}):(0,c.jsx)("span",{style:{fontSize:10,color:"#dc2626"},children:"No URL"})]})]},t)}))}):(0,c.jsx)("p",{className:"mrd-empty",children:"No attachments."})]}),(0,c.jsxs)("section",{className:"mrd-section flat","aria-labelledby":"flow-h",children:[(0,c.jsxs)("h3",{id:"flow-h",className:"mrd-section-title",children:[(0,c.jsx)("i",{className:"fas fa-tasks"})," Approval Flow"]}),(0,c.jsx)("ul",{className:"mrd-timeline",children:me.map((e=>{const t="received"===e.key&&"pending"===e.state&&ue.pmApproved&&ue.amApproved&&!ue.isReceived&&!ue.anyDenied,a=e.date?new Date(e.date).toLocaleString():"blocked"===e.state?"Waiting":t?"Awaiting PIC receipt":"Pending";return(0,c.jsxs)("li",{className:"tl-step ".concat(e.state),children:[(0,c.jsx)("div",{className:"tl-node"}),(0,c.jsxs)("div",{className:"tl-content",children:[(0,c.jsx)("div",{className:"tl-title",children:e.label}),(0,c.jsx)("div",{className:"tl-meta",children:a})]})]},e.key)}))})]}),(xe||Ce||Ae)&&(0,c.jsxs)("section",{className:"mrd-section flat","aria-labelledby":"act-h",children:[(0,c.jsxs)("h3",{id:"act-h",className:"mrd-section-title",children:[(0,c.jsx)("i",{className:"fas fa-gavel"})," Actions"]}),xe&&(0,c.jsx)("div",{className:"mrd-action-block",children:(0,c.jsx)(o.default,{requestData:E,userId:re,userRole:le,onBack:de,onActionComplete:oe})}),(Ce||Ae)&&(0,c.jsxs)("div",{className:"mrd-action-block",style:{display:"flex",flexDirection:"column",gap:12},children:[Ce&&(0,c.jsxs)("button",{onClick:()=>{Ce&&_("/pic/material-request/edit/".concat(E._id))},className:"btn-secondary",children:[(0,c.jsx)("i",{className:"fas fa-edit"})," Edit Request"]}),Ae&&(0,c.jsxs)("button",{onClick:async()=>{if(Ae&&!Q){X(!0);try{await l.Ay.patch("/requests/".concat(E._id,"/received")),I((e=>(0,s.A)((0,s.A)({},e),{},{status:"Received",receivedByPIC:!0,receivedDate:(new Date).toISOString()})))}catch(e){alert("Failed to mark as received")}finally{X(!1)}}},disabled:Q,className:"btn-primary",children:[(0,c.jsx)("i",{className:"fas fa-box-open"})," ",Q?"Marking...":"Mark as Received"]}),(0,c.jsx)("p",{style:{fontSize:12,margin:0,color:"#64748b"},children:"Edit allowed only before manager validation. Receipt after full approval."})]})]})]})]})]}),ee&&(0,c.jsx)("div",{className:"mrd-lightbox",role:"dialog","aria-modal":"true","aria-label":"Attachment preview",onClick:()=>te(null),children:(0,c.jsxs)("div",{className:"mrd-lightbox-inner",onClick:e=>e.stopPropagation(),children:[(0,c.jsx)("button",{className:"mrd-lightbox-close",onClick:()=>te(null),"aria-label":"Close preview",children:(0,c.jsx)("i",{className:"fas fa-times"})}),(0,c.jsx)("img",{src:ee,alt:"Attachment preview",className:"mrd-lightbox-img"})]})})]})})]})}},5111:(e,t,a)=>{a.d(t,{A:()=>j});var s=a(3986),n=a(816),i=a(9379),r=a(5043),l=(a(9389),a(8818)),o=a(5475),d=a(411),c=a(9855),m=a(3204),u=a(7762),h=a(4857);function p(e){if(!e)return"N/A";const t=new Date(e);return Number.isNaN(t.getTime())?"N/A":t.toLocaleString()}function g(e){if(!e)return"Unknown";if(e.status)return e.status;if(e.approvalSteps&&Array.isArray(e.approvalSteps)){const t=e.approvalSteps[e.approvalSteps.length-1];return(null===t||void 0===t?void 0:t.status)||"Pending"}return"Pending"}async function v(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{companyName:a="FadzTrack",logoPath:s="".concat("","/images/Fadz-logo.png"),exporterName:n="Unknown",exporterRole:i="",filters:r={},reportTitle:l="Material Requests Export"}=t,o=new u.Ay({unit:"pt",format:"a4"}),d="helvetica",c="bold",m=40;let v=40;const x=await(j=s,new Promise((e=>{if(!j)return e(null);try{const t=new Image;t.crossOrigin="anonymous",t.onload=()=>{const a=document.createElement("canvas");a.width=t.naturalWidth,a.height=t.naturalHeight,a.getContext("2d").drawImage(t,0,0),e({dataUrl:a.toDataURL("image/png"),w:t.naturalWidth,h:t.naturalHeight})},t.onerror=()=>e(null),t.src=j}catch(t){e(null)}})));var j;let f=m;if(null!==x&&void 0!==x&&x.dataUrl){const{w:e,h:t}=function(e,t,a,s){if(!e||!t)return{w:a,h:s};const n=Math.min(a/e,s/t,1);return{w:e*n,h:t*n}}(x.w,x.h,180,60);o.addImage(x.dataUrl,"PNG",m,v-12,e,t,void 0,"FAST"),f=m+e+16}o.setFont(d,c),o.setFontSize(20),o.setTextColor(20),o.text(String(a),f,v+16),o.setFont(d,"normal"),o.setFontSize(12),o.setTextColor(90),o.text(l,f,v+26),o.setDrawColor(220),o.setLineWidth(1),o.line(m,v+38,555,v+38),v+=54,o.setFont(d,c),o.setFontSize(12),o.setTextColor(20),o.text("Export Details",m,v),o.setFont(d,"normal"),o.setTextColor(60);const y=["Exported by: ".concat(n).concat(i?" (".concat(i,")"):""),"Date exported: ".concat(p(new Date))],N=function(e){const t=[];if(e.status&&"All"!==e.status&&"all"!==e.status&&t.push("Status: ".concat(e.status)),e.search&&e.search.trim()&&t.push('Search: "'.concat(e.search.trim(),'"')),e.sortBy&&"latest"!==e.sortBy&&t.push("Sort: ".concat(e.sortBy)),e.dateFrom||e.dateTo){const a=e.dateFrom?new Date(e.dateFrom).toLocaleDateString():"Start",s=e.dateTo?new Date(e.dateTo).toLocaleDateString():"End";t.push("Date Range: ".concat(a," - ").concat(s))}return t.length?t.join(", "):null}(r);N&&y.push("Filters: ".concat(N));let b=v+16;y.forEach((e=>{o.text(e,m,b),b+=16}));const w=b+6,S=e.map((e=>{var t,a;const s=Array.isArray(e.materials)?e.materials.map((e=>"".concat(e.quantity," ").concat(e.name||e.materialName))).join(", "):"";return[e.createdAt?new Date(e.createdAt).toLocaleDateString():"",String((null===(t=e.createdBy)||void 0===t?void 0:t.name)||""),String((null===(a=e.project)||void 0===a?void 0:a.projectName)||""),s,g(e),String(e.priority||"Normal")]}));(0,h.Ay)(o,{startY:w,head:[["Date","Requester","Project","Materials Requested","Status","Priority"]],body:S,styles:{font:d,fontStyle:"normal",fontSize:10,cellPadding:5,halign:"left",overflow:"linebreak"},headStyles:{font:d,fontStyle:c,fillColor:[59,130,246],textColor:255},theme:"grid",margin:{left:m,right:m},columnStyles:{3:{cellWidth:150}},didDrawPage:e=>{const t="Generated: ".concat(p(new Date));o.setFont(d,"normal"),o.setFontSize(9),o.setTextColor(120),o.text(t,m,o.internal.pageSize.height-24);const a=e.pageNumber||1,s=o.getNumberOfPages(),n="Page ".concat(a," of ").concat(s),i=o.getTextWidth(n);o.text(n,o.internal.pageSize.width-m-i,o.internal.pageSize.height-24)}}),o.save(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Material-Requests-Export";const t=new Date,a=e=>String(e).padStart(2,"0"),s="".concat(t.getFullYear()).concat(a(t.getMonth()+1)).concat(a(t.getDate())),n="".concat(a(t.getHours())).concat(a(t.getMinutes()));return"".concat(e,"-").concat(s,"-").concat(n,".pdf")}())}var x=a(579);const j=e=>{var t,a;let{role:u,fetchUrl:h="/requests/mine",rootClass:p="mr-request-list",itemsPerPage:g=8,detailLinkBase:j="/material-request",headerTitle:f="Material Requests",headerSubtitle:y="All material requests",customHeader:N=null,disableHeader:b=!1,enableExport:w=!1,exportTitle:S="Material Requests Export"}=e;const[C,A]=(0,r.useState)([]),[k,D]=(0,r.useState)(!0),[q,R]=(0,r.useState)(""),[L,P]=(0,r.useState)("All"),[M,z]=(0,r.useState)(""),[B,_]=(0,r.useState)("latest"),[E,I]=(0,r.useState)("card"),[F,T]=(0,r.useState)(1),[W,U]=(0,r.useState)(!1),[H,O]=(0,r.useState)(null),[Y,V]=(0,r.useState)({}),[J,K]=(0,r.useState)(Date.now()),G="Person in Charge"===u,Z=(()=>{try{return JSON.parse(localStorage.getItem("user")||"null")}catch(e){return null}})(),$=null===Z||void 0===Z?void 0:Z._id,[Q,X]=(0,r.useState)(!1),[ee,te]=(0,r.useState)(null);(0,r.useEffect)((()=>{if(G)try{const e=JSON.parse(localStorage.getItem("nudgeCooldowns")||"{}");V(e)}catch(e){}}),[G]),(0,r.useEffect)((()=>{G&&localStorage.setItem("nudgeCooldowns",JSON.stringify(Y))}),[Y,G]),(0,r.useEffect)((()=>{if(!G)return;const e=setInterval((()=>K(Date.now())),1e3);return()=>clearInterval(e)}),[G]);const ae=g;(0,r.useEffect)((()=>{d.Ay.get(h).then((e=>{A(Array.isArray(e.data)?e.data:[]),R("")})).catch((e=>{var t,a;return R((null===e||void 0===e||null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||"Failed to load requests")})).finally((()=>D(!1)))}),[h]),(0,r.useEffect)((()=>{G&&$&&d.Ay.get("/projects/by-user-status?userId=".concat($,"&role=pic&status=Ongoing")).then((e=>{var t;O((null===(t=e.data)||void 0===t?void 0:t[0])||null)})).catch((()=>O(null)))}),[G,$]);const se=C.filter((e=>{var t,a,s;const n=(e.status||"").toLowerCase(),i="received"===n||!!e.receivedByPIC,r="archived"===n||!!e.isArchived;if(!("All"===L?!r:"Pending"===L&&n.includes("pending")&&!r||"Approved"===L&&n.includes("approved")&&"received"!==n&&!r||"Cancelled"===L&&(n.includes("denied")||n.includes("cancel"))&&!r||"Completed"===L&&i&&!r||"Archived"===L&&r))return!1;const l=r&&e.originalProjectName?e.originalProjectName:null===(t=e.project)||void 0===t?void 0:t.projectName;return[(null===(a=e.materials)||void 0===a?void 0:a.map((e=>e.materialName)).join(", "))||"",e.description||"",(null===(s=e.createdBy)||void 0===s?void 0:s.name)||"",l||""].join(" ").toLowerCase().includes(M.toLowerCase())})),ne=(0,r.useMemo)((()=>[...se].sort(((e,t)=>{var a,s,n,i;if("All"===L){const a="received"===(e.status||"").toLowerCase()||e.receivedByPIC?1:0,s="received"===(t.status||"").toLowerCase()||t.receivedByPIC?1:0;if(a!==s)return a-s}switch(B){case"latest":case"date":default:return new Date(t.createdAt||0)-new Date(e.createdAt||0);case"oldest":return new Date(e.createdAt||0)-new Date(t.createdAt||0);case"status":return(e.status||"").localeCompare(t.status||"");case"requester":return((null===(a=e.createdBy)||void 0===a?void 0:a.name)||"").localeCompare((null===(s=t.createdBy)||void 0===s?void 0:s.name)||"");case"project":return((null===(n=e.project)||void 0===n?void 0:n.projectName)||"").localeCompare((null===(i=t.project)||void 0===i?void 0:i.projectName)||"")}}))),[se,B,L]),ie=Math.ceil(ne.length/ae),re=(F-1)*ae,le=ne.slice(re,re+ae),[oe,de]=(0,r.useState)({}),[ce,me]=(0,r.useState)(null),ue=e=>{const t=C.find((t=>t._id===e));te(t),X(!0)},he=async e=>{if(!G)return;const t=e._id,a=(e.status||"").toLowerCase();if(("pending project manager"===a||"pending area manager"===a)&&!(Y[t]&&Y[t]>Date.now())&&!oe[t]){de((e=>(0,i.A)((0,i.A)({},e),{},{[t]:!0})));try{const{data:e}=await d.Ay.post("/requests/".concat(t,"/nudge")),a=(null===e||void 0===e?void 0:e.nextAllowedAt)||Date.now()+36e5;alert("Reminder sent."),V((e=>{const s=(0,i.A)((0,i.A)({},e),{},{[t]:a});return localStorage.setItem("nudgeCooldowns",JSON.stringify(s)),s}))}catch(m){var r,l,o,c;const e=null===m||void 0===m||null===(r=m.response)||void 0===r||null===(l=r.data)||void 0===l?void 0:l.message,a=null===m||void 0===m||null===(o=m.response)||void 0===o||null===(c=o.data)||void 0===c?void 0:c.nextAllowedAt;if(e)if(alert(e),a)V((e=>{const s=(0,i.A)((0,i.A)({},e),{},{[t]:a});return localStorage.setItem("nudgeCooldowns",JSON.stringify(s)),s}));else{const a=/(\d+) minute/.exec(e);if(a){const e=parseInt(a[1],10),s=Date.now()+60*e*1e3;V((e=>{const a=(0,i.A)((0,i.A)({},e),{},{[t]:s});return localStorage.setItem("nudgeCooldowns",JSON.stringify(a)),a}))}}else alert("Failed to send reminder.")}finally{de((e=>{const{[t]:a}=e;return(0,s.A)(e,[t].map(n.A))}))}}},pe=e=>{if(e<=0)return"Nudge";const t=Math.ceil(e/1e3),a=Math.floor(t/60),s=t%60;if(a>=60){const e=Math.floor(a/60),t=a%60;return"".concat(e,"h ").concat(t,"m")}return a>0?"".concat(a,"m ").concat(s.toString().padStart(2,"0"),"s"):"".concat(s,"s")},ge=e=>{if(!e)return"";const t=new Date(e),a=new Date,s=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),n=t.toDateString()===a.toDateString();return"".concat(n?"Today":t.toLocaleDateString()," ").concat(s)},ve=e=>{switch(e){case"completed":return"\u2713";case"denied":return"\u2717";case"blocked":return"!";case"current":return"\u25cf";default:return"\u25cb"}},xe=(e,t)=>"completed"===e?"Done":"denied"===e?"Denied":"blocked"===e?"Waiting":"current"===e?"Current":"Pending";return(0,x.jsxs)("div",{className:"dashboard-container ".concat(p),children:[!b&&(N||(0,x.jsx)(l.A,{roleSegment:(u||"").toLowerCase().includes("project manager")?"pm":(u||"").toLowerCase().includes("area manager")?"am":(u||"").toLowerCase().includes("person in charge")?"pic":(u||"").toLowerCase().includes("ceo")?"ceo":(u||"").toLowerCase().includes("it")?"it":"pic",below:(0,x.jsxs)("div",{className:"header-content",style:{padding:"0.75rem 1.5rem"},children:[(0,x.jsxs)("div",{className:"header-left",children:[(0,x.jsx)("h1",{className:"header-title",style:{margin:0,fontSize:"1.15rem"},children:f}),(0,x.jsx)("p",{className:"header-subtitle",style:{margin:0,fontSize:"0.75rem",opacity:.75},children:y})]}),(0,x.jsx)("div",{className:"header-right",children:(0,x.jsx)("div",{className:"header-role-chip",style:{background:"#1e293b",padding:"4px 10px",borderRadius:16,fontSize:12},children:u})})]})})),(0,x.jsx)("main",{className:"dashboard-main",children:(0,x.jsxs)("div",{className:"page-container",children:[(0,x.jsxs)("div",{className:"controls-bar",children:[(0,x.jsx)("div",{className:"filter-tabs",children:["All","Pending","Approved","Cancelled","Completed","Archived"].map((e=>(0,x.jsx)("button",{className:"filter-tab ".concat(L===e?"active":""),onClick:()=>{P(e),T(1)},children:e},e)))}),(0,x.jsxs)("div",{className:"search-sort-section",children:[(0,x.jsx)("div",{className:"search-wrapper",children:(0,x.jsx)("input",{value:M,onChange:e=>z(e.target.value),placeholder:"Search requests...",className:"search-input"})}),(0,x.jsx)("div",{className:"sort-wrapper",children:(0,x.jsxs)("select",{value:B,onChange:e=>_(e.target.value),className:"sort-select",children:[(0,x.jsx)("option",{value:"latest",children:"Latest First"}),(0,x.jsx)("option",{value:"oldest",children:"Oldest First"}),(0,x.jsx)("option",{value:"status",children:"By Status"}),(0,x.jsx)("option",{value:"requester",children:"By Requester"}),(0,x.jsx)("option",{value:"project",children:"By Project"})]})}),(0,x.jsxs)("div",{className:"view-toggle",children:[(0,x.jsx)("button",{className:"view-toggle-btn ".concat("card"===E?"active":""),onClick:()=>I("card"),title:"Card View",children:(0,x.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,x.jsx)("path",{d:"M3 3h7v7H3V3zm0 11h7v7H3v-7zm11-11h7v7h-7V3zm0 11h7v7h-7v-7z"})})}),(0,x.jsx)("button",{className:"view-toggle-btn ".concat("list"===E?"active":""),onClick:()=>I("list"),title:"List View",children:(0,x.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,x.jsx)("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"})})})]}),w&&(0,x.jsxs)("button",{onClick:async()=>{if(w)try{U(!0),await v(ne,{companyName:"FadzTrack",logoPath:"".concat("","/images/Fadz-logo.png"),exporterName:(null===Z||void 0===Z?void 0:Z.name)||"Unknown",exporterRole:(null===Z||void 0===Z?void 0:Z.role)||"",filters:{filter:L,searchTerm:M,sortBy:B},reportTitle:S})}catch(q){console.error("Export failed:",q),alert("Failed to export PDF")}finally{U(!1)}},disabled:W||0===ne.length,className:"btn-primary export-btn",style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",minWidth:"auto"},children:[(0,x.jsx)(m.WCW,{}),W?"Exporting...":"Export PDF"]}),G&&H&&(0,x.jsx)("button",{onClick:()=>window.location.href="/pic/projects/".concat(H._id,"/request"),className:"view-details-btn",style:{marginLeft:"0.5rem"},children:"+ New Request"})]})]}),(0,x.jsx)("div",{className:"requests-grid ".concat("list"===E?"list-view":"enhanced-list"),children:k?(0,x.jsxs)("div",{className:"loading-state",children:[(0,x.jsx)("div",{className:"loading-spinner"}),(0,x.jsx)("p",{children:"Loading..."})]}):q?(0,x.jsx)("div",{className:"error-state",children:(0,x.jsx)("p",{children:q})}):0===le.length?(0,x.jsxs)("div",{className:"empty-state",children:[(0,x.jsx)("div",{className:"empty-icon",children:"\ud83d\udce6"}),(0,x.jsx)("h3",{children:"No material requests found"}),(0,x.jsx)("p",{children:"No requests match your current filters."})]}):"card"===E?(0,x.jsx)("ul",{className:"request-list",children:le.map((e=>{var t,a,s;const{steps:n,meta:r}=(0,c.Yf)(e),l=(0,c.KC)(e.status,r.isReceived),d="Archived"===e.status||e.isArchived,m=d&&e.originalProjectName?e.originalProjectName:null===(t=e.project)||void 0===t?void 0:t.projectName;return(0,x.jsxs)("li",{className:"request-row ".concat(r.anyDenied?"request-denied":""," ").concat(r.isReceived?"request-completed":""," ").concat(d?"status-archived":""),children:[d&&(0,x.jsxs)("div",{className:"archived-notice",children:[(0,x.jsx)("span",{className:"archived-badge",children:"Archived \u2013 Project Completed"}),e.archivedReason&&(0,x.jsx)("span",{className:"archive-reason",children:e.archivedReason})]}),(0,x.jsxs)("div",{className:"request-row-header",children:[(0,x.jsxs)("div",{className:"request-title-group",children:[(0,x.jsx)("h3",{className:"request-row-title",children:null!==(a=e.materials)&&void 0!==a&&a.length?e.materials.map((e=>"".concat(e.materialName," (").concat(e.quantity).concat(e.unit?" "+e.unit:"",")"))).join(", "):"Material Request"}),(0,x.jsx)("p",{className:"request-row-desc",children:(0,c.sz)(e.description||"No description",28)})]}),(0,x.jsx)("span",{className:"status-chip status-".concat(l.toLowerCase()),children:l})]}),(0,x.jsx)("div",{className:"request-meta-line",children:(0,x.jsxs)("span",{className:"meta-origin",children:[(0,x.jsx)("strong",{children:(null===(s=e.createdBy)||void 0===s?void 0:s.name)||"Unknown"})," \u2022 ",new Date(e.createdAt).toLocaleDateString(),m&&(0,x.jsxs)("span",{children:["\u2022 ",m]})]})}),d&&e.originalRequestDetails&&(0,x.jsx)("div",{className:"original-request-details",children:(0,x.jsxs)("div",{className:"original-project-info",children:[(0,x.jsx)("strong",{children:"Original Status:"})," ",e.originalRequestStatus,e.originalProjectEndDate&&(0,x.jsxs)("span",{children:[" \u2022 ",(0,x.jsx)("strong",{children:"Project End Date:"})," ",new Date(e.originalProjectEndDate).toLocaleDateString()]})]})}),!d&&(0,x.jsx)("div",{className:"progress-steps",children:n.map(((e,t)=>(0,x.jsxs)("div",{className:"progress-step ".concat(e.state),children:[(0,x.jsx)("div",{className:"step-icon",children:ve(e.state)}),(0,x.jsx)("div",{className:"step-label",children:e.label}),(0,x.jsx)("div",{className:"step-sub",children:xe(e.state,e.key)}),(0,x.jsx)("div",{className:"step-date",children:e.date?new Date(e.date).toLocaleDateString():"\u2014"}),t<n.length-1&&(0,x.jsx)("div",{className:"step-connector ".concat("completed"===n[t+1].state?"completed":"")})]},e.key)))}),(0,x.jsx)("div",{className:"request-actions",children:d?(0,x.jsxs)("div",{className:"archived-actions",children:[(0,x.jsx)(o.N_,{to:"".concat(j,"/").concat(e._id),className:"view-details-btn",children:"View Details"}),(0,x.jsx)("button",{onClick:()=>ue(e._id),className:"delete-archived-btn",disabled:ce===e._id,children:ce===e._id?"Deleting...":"Delete Permanently"})]}):(0,x.jsxs)(x.Fragment,{children:[G&&(t=>{const a=(e.status||"").toLowerCase();if("pending project manager"!==a&&"pending area manager"!==a||(null===(t=e.createdBy)||void 0===t?void 0:t._id)!==$||r.isReceived||r.anyDenied)return null;const s=Y[e._id],n=s?s-J:0;n<=0&&s&&setTimeout((()=>{V((t=>{const a=(0,i.A)({},t);return delete a[e._id],localStorage.setItem("nudgeCooldowns",JSON.stringify(a)),a}))}),0);const l=oe[e._id],o=Y[e._id];return(0,x.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,x.jsx)("button",{onClick:()=>he(e),disabled:n>0||l,className:"view-details-btn",title:n>0&&o?"Next nudge allowed at ".concat(ge(o)):"Send reminder to pending approver",style:{background:"#0f766e",opacity:n>0||l?.7:1},children:l?"Sending...":pe(n)}),n>0&&o&&(0,x.jsx)("span",{style:{marginTop:4,fontSize:11,color:"#0f766e"},children:ge(o)})]})})(),(0,x.jsx)(o.N_,{to:"".concat(j,"/").concat(e._id),className:"view-details-btn",style:{marginLeft:G?"0.5rem":0},children:"View Details"})]})})]},e._id)}))}):(0,x.jsx)("div",{className:"request-table-container",children:(0,x.jsxs)("table",{className:"request-table",children:[(0,x.jsx)("thead",{children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{children:"Materials"}),(0,x.jsx)("th",{children:"Description"}),(0,x.jsx)("th",{children:"Requester"}),(0,x.jsx)("th",{children:"Project"}),(0,x.jsx)("th",{children:"Date"}),(0,x.jsx)("th",{children:"Status"}),(0,x.jsx)("th",{children:"Actions"})]})}),(0,x.jsx)("tbody",{children:le.map((e=>{var t,a,s,n,l;const{steps:d,meta:m}=(0,c.Yf)(e),u=(0,c.KC)(e.status,m.isReceived),h="Archived"===e.status||e.isArchived,p=h&&e.originalProjectName?e.originalProjectName:null===(t=e.project)||void 0===t?void 0:t.projectName;return(0,x.jsxs)(r.Fragment,{children:[(0,x.jsxs)("tr",{className:"table-row ".concat(m.anyDenied?"request-denied":""," ").concat(m.isReceived?"request-completed":""," ").concat(h?"status-archived":""),children:[(0,x.jsx)("td",{className:"table-cell materials-cell",title:null!==(a=e.materials)&&void 0!==a&&a.length?e.materials.map((e=>"".concat(e.materialName," (").concat(e.quantity).concat(e.unit?" "+e.unit:"",")"))).join(", "):"Material Request",children:null!==(s=e.materials)&&void 0!==s&&s.length?e.materials.map((e=>"".concat(e.materialName," (").concat(e.quantity).concat(e.unit?" "+e.unit:"",")"))).join(", "):"Material Request"}),(0,x.jsx)("td",{className:"table-cell description-cell",title:e.description||"No description",children:(0,c.sz)(e.description||"No description",50)}),(0,x.jsx)("td",{className:"table-cell requester-cell",title:(null===(n=e.createdBy)||void 0===n?void 0:n.name)||"Unknown",children:(0,x.jsx)("strong",{children:(null===(l=e.createdBy)||void 0===l?void 0:l.name)||"Unknown"})}),(0,x.jsx)("td",{className:"table-cell project-cell",title:p||"\u2014",children:p||"\u2014"}),(0,x.jsx)("td",{className:"table-cell date-cell",title:new Date(e.createdAt).toLocaleDateString(),children:new Date(e.createdAt).toLocaleDateString()}),(0,x.jsxs)("td",{className:"table-cell status-cell",children:[(0,x.jsx)("span",{className:"status-chip status-".concat(u.toLowerCase()),children:u}),h&&e.archivedReason&&(0,x.jsx)("div",{className:"archive-reason",style:{fontSize:"11px",color:"#666",marginTop:"2px"},children:e.archivedReason})]}),(0,x.jsx)("td",{className:"table-cell actions-cell",children:h?(0,x.jsxs)("div",{className:"archived-actions",children:[(0,x.jsx)(o.N_,{to:"".concat(j,"/").concat(e._id),className:"view-details-btn",children:"View"}),(0,x.jsx)("button",{onClick:()=>ue(e._id),className:"delete-archived-btn",disabled:ce===e._id,style:{marginLeft:"5px",fontSize:"11px",padding:"2px 6px"},children:ce===e._id?"Deleting...":"Delete"})]}):(0,x.jsxs)(x.Fragment,{children:[G&&(t=>{const a=(e.status||"").toLowerCase();if("pending project manager"!==a&&"pending area manager"!==a||(null===(t=e.createdBy)||void 0===t?void 0:t._id)!==$||m.isReceived||m.anyDenied)return null;const s=Y[e._id],n=s?s-J:0;n<=0&&s&&setTimeout((()=>{V((t=>{const a=(0,i.A)({},t);return delete a[e._id],localStorage.setItem("nudgeCooldowns",JSON.stringify(a)),a}))}),0);const r=oe[e._id],l=Y[e._id];return(0,x.jsx)("button",{onClick:()=>he(e),disabled:n>0||r,className:"nudge-btn",title:n>0&&l?"Next nudge allowed at ".concat(ge(l)):"Send reminder to pending approver",children:r?"Sending...":pe(n)})})(),(0,x.jsx)(o.N_,{to:"".concat(j,"/").concat(e._id),className:"view-details-btn",children:"View"})]})})]}),(0,x.jsx)("tr",{className:"progress-row ".concat(m.anyDenied?"request-denied":""," ").concat(m.isReceived?"request-completed":""),children:(0,x.jsx)("td",{colSpan:"7",className:"progress-cell-full",children:(0,x.jsx)("div",{className:"progress-steps-list",children:d.map(((e,t)=>(0,x.jsxs)("div",{className:"progress-step-list ".concat(e.state),children:[(0,x.jsx)("div",{className:"step-icon-list",children:ve(e.state)}),(0,x.jsx)("div",{className:"step-label-list",children:e.label}),(0,x.jsx)("div",{className:"step-sub-list",children:xe(e.state,e.key)}),(0,x.jsx)("div",{className:"step-date-list",children:e.date?new Date(e.date).toLocaleDateString():"\u2014"}),t<d.length-1&&(0,x.jsx)("div",{className:"step-connector-list ".concat("completed"===d[t+1].state?"completed":"")})]},e.key)))})})})]},e._id)}))})]})})}),ne.length>0&&(0,x.jsxs)("div",{className:"pagination-section",children:[(0,x.jsxs)("div",{className:"pagination-info",children:["Showing ",re+1," to ",Math.min(re+ae,ne.length)," of ",ne.length," entries"]}),(0,x.jsxs)("div",{className:"pagination-controls",children:[(0,x.jsx)("button",{className:"pagination-btn",disabled:1===F,onClick:()=>T((e=>Math.max(e-1,1))),children:"Previous"}),Array.from({length:ie},((e,t)=>t+1)).map((e=>(0,x.jsx)("button",{className:"pagination-btn ".concat(e===F?"active":""),onClick:()=>T(e),children:e},e))),(0,x.jsx)("button",{className:"pagination-btn",disabled:F===ie,onClick:()=>T((e=>Math.min(e+1,ie))),children:"Next"})]})]})]})}),Q&&ee&&(0,x.jsx)("div",{className:"modal-overlay",children:(0,x.jsxs)("div",{className:"modal small",children:[(0,x.jsx)("h3",{children:"Confirm Permanent Deletion"}),(0,x.jsxs)("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"12px",marginBottom:"16px"},children:[(0,x.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[(0,x.jsx)("span",{style:{fontSize:"20px"},children:"\u26a0\ufe0f"}),(0,x.jsx)("strong",{style:{color:"#dc2626"},children:"Permanent Deletion Warning"})]}),(0,x.jsx)("p",{style:{color:"#dc2626",margin:0,fontSize:"14px"},children:"This action cannot be undone. The archived request will be permanently removed from the system."})]}),(0,x.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,x.jsx)("p",{style:{marginBottom:"8px",fontWeight:"600"},children:"Request Details:"}),(0,x.jsxs)("div",{style:{backgroundColor:"#f9fafb",padding:"12px",borderRadius:"6px",fontSize:"14px"},children:[(0,x.jsxs)("p",{style:{margin:"0 0 4px 0"},children:[(0,x.jsx)("strong",{children:"Project:"})," ",(null===(t=ee.project)||void 0===t?void 0:t.projectName)||"Unknown"]}),(0,x.jsxs)("p",{style:{margin:"0 0 4px 0"},children:[(0,x.jsx)("strong",{children:"Requester:"})," ",(null===(a=ee.createdBy)||void 0===a?void 0:a.name)||"Unknown"]}),(0,x.jsxs)("p",{style:{margin:"0 0 4px 0"},children:[(0,x.jsx)("strong",{children:"Status:"})," ",ee.status||"Unknown"]}),(0,x.jsxs)("p",{style:{margin:"0"},children:[(0,x.jsx)("strong",{children:"Created:"})," ",ee.createdAt?new Date(ee.createdAt).toLocaleDateString():"Unknown"]})]})]}),(0,x.jsxs)("p",{style:{marginBottom:"16px",fontSize:"14px",lineHeight:"1.5"},children:["Are you sure you want to ",(0,x.jsx)("strong",{children:"permanently delete"})," this archived material request?"]}),(0,x.jsxs)("div",{className:"modal-actions",style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[(0,x.jsx)("button",{className:"btn",onClick:()=>{X(!1),te(null)},children:"Cancel"}),(0,x.jsx)("button",{className:"btn primary",disabled:ce===ee._id,onClick:async()=>{if(ee){me(ee._id);try{await d.Ay.delete("/requests/".concat(ee._id,"/archived"));const e=await d.Ay.get(h);A(Array.isArray(e.data)?e.data:[]),X(!1),te(null)}catch(q){var e,t;alert("Failed to delete archived request: "+((null===q||void 0===q||null===(e=q.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||q.message))}finally{me(null)}}},style:{backgroundColor:"#dc2626"},children:ce===ee._id?"Deleting...":"Yes, Delete Permanently"})]})]})})]})}},9389:()=>{},9855:(e,t,a)=>{a.d(t,{KC:()=>n,Yf:()=>i,_U:()=>r,sz:()=>s});const s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!e||"string"!==typeof e)return"";const a=e.trim().split(/\s+/);return a.length<=t?e:a.slice(0,t).join(" ")+"..."},n=(e,t)=>{const a=(e||"").toLowerCase();return"archived"===a?"Archived":"received"===a||t?"Completed":a.includes("approved")?"Approved":a.includes("pending")?"Pending":a.includes("denied")||a.includes("cancel")?"Rejected":"Unknown"},i=e=>{const t=Array.isArray(e.approvals)?e.approvals:[],a=t.filter((e=>"Project Manager"===e.role)).slice(-1)[0],s=t.filter((e=>"Area Manager"===e.role)).slice(-1)[0],n=null===a||void 0===a?void 0:a.decision,i=null===s||void 0===s?void 0:s.decision,r="denied"===n,l="denied"===i,o="approved"===n,d="approved"===i,c=(e.status||"").toLowerCase(),m="received"===c||e.receivedByPIC,u=e.receivedAt||e.receivedDate||null,h=r||l||c.includes("denied");let p=null;c.includes("pending project manager")?p="pm":c.includes("pending area manager")?p="am":o&&d&&!m&&!h&&(p="received");const g=r?"denied":o?"completed":"pm"===p?"current":"pending";let v,x;v=r?"denied":o?l?"denied":d?"completed":"am"===p?"current":"pending":"blocked",x=h?"denied":o&&d?m?"completed":"received"===p?"current":"pending":"blocked";return{steps:[{key:"placed",label:"Placed",date:e.createdAt,state:"completed"},{key:"pm",label:"PM",date:(null===a||void 0===a?void 0:a.timestamp)||null,state:g},{key:"am",label:"AM",date:(null===s||void 0===s?void 0:s.timestamp)||null,state:v},{key:"received",label:"Received",date:m?u||(null===s||void 0===s?void 0:s.timestamp):null,state:x}],meta:{pmApproval:a,amApproval:s,pmApproved:o,pmDenied:r,amApproved:d,amDenied:l,isReceived:m,anyDenied:h,currentStage:p}}},r=(e,t)=>{const a=(t||"").toLowerCase(),s=((null===e||void 0===e?void 0:e.status)||"").toLowerCase();return!!e&&(!s.includes("denied")&&"received"!==s&&("pending project manager"===s?["project manager","pm","admin"].includes(a):"pending area manager"===s&&["area manager","am","admin"].includes(a)))}}}]);
//# sourceMappingURL=558.5c89a89f.chunk.js.map
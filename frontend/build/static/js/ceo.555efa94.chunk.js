"use strict";(self.webpackChunkfadz_web_frontend=self.webpackChunkfadz_web_frontend||[]).push([[434],{64:()=>{},647:(e,a,s)=>{s.r(a),s.d(a,{default:()=>d});var t=s(9379),n=s(5043),r=s(3216),i=s(411),l=s(8818),c=s(3204),o=s(579);const d=()=>{var e,a;const{id:s}=(0,r.g)(),d=(0,r.Zp)(),[m,u]=(0,n.useState)(null),[p,h]=(0,n.useState)(!0),[j,x]=(0,n.useState)(""),[v,g]=(0,n.useState)(!1),[N,b]=(0,n.useState)((()=>{const e=localStorage.getItem("user");return e?JSON.parse(e):null})),[f,y]=(0,n.useState)({description:"",materials:[],attachments:[]}),[w,C]=(0,n.useState)([]),[S,A]=(0,n.useState)([]);(0,n.useEffect)((()=>{i.Ay.get("/requests/".concat(s)).then((e=>{console.log("Material Request Data for Edit:",e.data);const a=e.data;u(a),y({description:a.description||"",materials:(a.materials||[]).map(((e,a)=>({id:a+1,materialName:e.materialName||"",quantity:e.quantity||"",unit:e.unit||""}))),attachments:a.attachments||[]}),x("")})).catch((e=>{console.error("Error fetching request:",e),x("Failed to load request details.")})).finally((()=>h(!1)))}),[s]),(0,n.useEffect)((()=>{}),[]),(0,n.useEffect)((()=>()=>{S.forEach((e=>URL.revokeObjectURL(e)))}),[S]);const k=()=>d("/ceo/material-request/".concat(s)),D=(e,a,s)=>{y((n=>(0,t.A)((0,t.A)({},n),{},{materials:n.materials.map((n=>n.id===e?(0,t.A)((0,t.A)({},n),{},{[a]:"quantity"===a?s.replace(/[^0-9.]/g,"").slice(0,10):s}):n))})))};if(p)return(0,o.jsxs)("div",{className:"mr-loading",children:[(0,o.jsx)("div",{className:"mr-spinner"}),(0,o.jsx)("p",{children:"Loading request\u2026"})]});if(!m)return(0,o.jsxs)("div",{className:"mr-loading",children:[(0,o.jsx)("p",{children:j||"Request not found"}),(0,o.jsx)("button",{onClick:k,className:"mr-btn ghost",type:"button",children:"Back"})]});const P="priority-badge-CEO priority-".concat((m.status||"pending").toLowerCase().replace(/\s+/g,"-"));return(0,o.jsxs)("div",{className:"mr-edit-page",children:[(0,o.jsx)(l.A,{roleSegment:"ceo"}),(0,o.jsxs)("div",{className:"mr-container",children:[(0,o.jsxs)("div",{className:"mr-page-head",children:[(0,o.jsxs)("div",{className:"mr-head-text",children:[(0,o.jsx)("h1",{children:"Edit Material Request"}),(0,o.jsxs)("div",{className:"mr-meta-line",children:[(0,o.jsxs)("span",{className:"mr-id",children:["ID: ",m._id]}),(0,o.jsx)("span",{className:P,children:m.status}),(0,o.jsxs)("span",{className:"mr-project",children:["Project: ",(0,o.jsx)("strong",{children:(null===(e=m.project)||void 0===e?void 0:e.projectName)||"\u2014"})]})]})]}),(0,o.jsxs)("div",{className:"mr-head-actions",children:[(0,o.jsx)("button",{type:"button",onClick:k,className:"mr-btn ghost",children:"Cancel"}),(0,o.jsx)("button",{type:"submit",form:"mr-form",className:"mr-btn primary",disabled:v,children:v?"Saving\u2026":"Save Changes"})]})]}),j&&(0,o.jsx)("div",{className:"mr-alert error",children:j}),(0,o.jsxs)("form",{id:"mr-form",onSubmit:async e=>{e.preventDefault(),x("");const a=f.materials.filter((e=>e.materialName.trim()&&e.quantity.trim()&&e.unit.trim()));if(!f.description.trim())return x("Description required");if(!a.length)return x("At least one material entry complete");g(!0);try{const e=new FormData;e.append("description",f.description.trim()),e.append("materials",JSON.stringify(a.map((e=>{let{materialName:a,quantity:s,unit:t}=e;return{materialName:a,quantity:s,unit:t}})))),e.append("attachments",JSON.stringify(f.attachments)),w.forEach((a=>e.append("newAttachments",a))),await i.Ay.put("/requests/".concat(s),e,{headers:{"Content-Type":"multipart/form-data"}}),d("/ceo/material-request/".concat(s))}catch(r){var t,n;console.error(r),x((null===(t=r.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Update failed")}finally{g(!1)}},className:"mr-form",autoComplete:"off",children:[(0,o.jsxs)("div",{className:"mr-grid",children:[(0,o.jsxs)("section",{className:"mr-section",children:[(0,o.jsx)("header",{children:(0,o.jsx)("h2",{children:"Request Information"})}),(0,o.jsxs)("div",{className:"mr-field",children:[(0,o.jsx)("label",{htmlFor:"mr-desc",children:"Description"}),(0,o.jsx)("textarea",{id:"mr-desc",name:"description",value:f.description,onChange:e=>{const{name:a,value:s}=e.target;y((e=>(0,t.A)((0,t.A)({},e),{},{[a]:s})))},rows:5,placeholder:"Describe the requested materials, purpose, urgency\u2026"}),(0,o.jsx)("div",{className:"mr-hint",children:"Provide enough context for approvers."})]}),(0,o.jsxs)("div",{className:"mr-inline-info",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{className:"lbl",children:"Current Status"}),(0,o.jsx)("span",{className:P,children:m.status})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{className:"lbl",children:"Project"}),(0,o.jsx)("span",{className:"val",children:(null===(a=m.project)||void 0===a?void 0:a.projectName)||"\u2014"})]})]})]}),(0,o.jsxs)("section",{className:"mr-section",children:[(0,o.jsx)("header",{children:(0,o.jsx)("h2",{children:"Materials"})}),(0,o.jsxs)("div",{className:"mr-materials-wrap",children:[(0,o.jsxs)("table",{className:"mr-materials-table",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{style:{width:"55%"},children:"Name"}),(0,o.jsx)("th",{style:{width:"15%"},children:"Qty"}),(0,o.jsx)("th",{style:{width:"20%"},children:"Unit"}),(0,o.jsx)("th",{style:{width:"10%"}})]})}),(0,o.jsx)("tbody",{children:f.materials.map((e=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("input",{type:"text",value:e.materialName,onChange:a=>D(e.id,"materialName",a.target.value),placeholder:"e.g. Cement Type 1"})}),(0,o.jsx)("td",{children:(0,o.jsx)("input",{type:"text",value:e.quantity,onChange:a=>D(e.id,"quantity",a.target.value),placeholder:"0"})}),(0,o.jsx)("td",{children:(0,o.jsxs)("select",{value:e.unit,onChange:a=>D(e.id,"unit",a.target.value),children:[(0,o.jsx)("option",{value:"",children:"Select"}),(0,o.jsx)("option",{value:"pcs",children:"pcs"}),(0,o.jsx)("option",{value:"kg",children:"kg"}),(0,o.jsx)("option",{value:"m",children:"m"}),(0,o.jsx)("option",{value:"l",children:"l"}),(0,o.jsx)("option",{value:"box",children:"box"}),(0,o.jsx)("option",{value:"roll",children:"roll"}),(0,o.jsx)("option",{value:"set",children:"set"}),(0,o.jsx)("option",{value:"pair",children:"pair"}),(0,o.jsx)("option",{value:"unit",children:"unit"}),(0,o.jsx)("option",{value:"bundle",children:"bundle"})]})}),(0,o.jsx)("td",{className:"mr-actions-cell",children:(0,o.jsx)("button",{type:"button",className:"mr-icon-btn danger",onClick:()=>{return a=e.id,void y((e=>(0,t.A)((0,t.A)({},e),{},{materials:e.materials.length>1?e.materials.filter((e=>e.id!==a)):e.materials})));var a},disabled:1===f.materials.length,title:"Remove",children:(0,o.jsx)(c.qbC,{})})})]},e.id)))})]}),(0,o.jsxs)("button",{type:"button",onClick:()=>{y((e=>{var a;return(0,t.A)((0,t.A)({},e),{},{materials:[...e.materials,{id:((null===(a=e.materials.at(-1))||void 0===a?void 0:a.id)||0)+1,materialName:"",quantity:"",unit:""}]})}))},className:"mr-btn subtle",style:{marginTop:12},children:[(0,o.jsx)(c.OiG,{})," Add Material"]})]})]}),(0,o.jsxs)("section",{className:"mr-section full",children:[(0,o.jsx)("header",{children:(0,o.jsx)("h2",{children:"Attachments"})}),(0,o.jsxs)("div",{className:"mr-attachments",children:[0===f.attachments.length&&(0,o.jsx)("div",{className:"mr-empty",children:"No attachments."}),f.attachments.length>0&&(0,o.jsx)("ul",{className:"mr-attachment-list",children:f.attachments.map(((e,a)=>(0,o.jsxs)("li",{className:"mr-attachment-item",children:[(0,o.jsxs)("a",{href:"".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"https://www.fadztrack.online/api",REACT_APP_SOCKET_PATH:"/socket.io",REACT_APP_SOCKET_URL:"https://www.fadztrack.online"}.REACT_APP_API_BASE_URL||"","/uploads/").concat(e),target:"_blank",rel:"noopener noreferrer",className:"file",children:[(0,o.jsx)(c.WCW,{})," ",(0,o.jsx)("span",{children:e})]}),(0,o.jsx)("button",{type:"button",className:"mr-icon-btn danger",onClick:()=>(e=>{y((a=>(0,t.A)((0,t.A)({},a),{},{attachments:a.attachments.filter(((a,s)=>s!==e))})))})(a),title:"Remove",children:(0,o.jsx)(c.qbC,{})})]},a)))}),(0,o.jsxs)("div",{className:"mr-file-add",children:[(0,o.jsxs)("label",{className:"mr-file-drop",children:[(0,o.jsx)(c.EHs,{})," ",(0,o.jsx)("span",{children:"Select Files"}),(0,o.jsx)("input",{type:"file",multiple:!0,onChange:e=>{const a=Array.from(e.target.files||[]);if(!a.length)return;const s=a.map((e=>URL.createObjectURL(e)));C((e=>[...e,...a])),A((e=>[...e,...s]))},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.txt"})]}),w.length>0&&(0,o.jsx)("ul",{className:"mr-attachment-list new",children:w.map(((e,a)=>(0,o.jsxs)("li",{className:"mr-attachment-item",children:[(0,o.jsxs)("span",{className:"file",children:[(0,o.jsx)(c.EHs,{})," ",e.name]}),(0,o.jsx)("button",{type:"button",className:"mr-icon-btn danger",onClick:()=>{return e=a,C((a=>a.filter(((a,s)=>s!==e)))),void A((a=>(URL.revokeObjectURL(a[e]),a.filter(((a,s)=>s!==e)))));var e},children:(0,o.jsx)(c.qbC,{})})]},a)))})]})]})]})]}),(0,o.jsx)("div",{className:"mr-floating-bar",children:(0,o.jsxs)("div",{className:"inner",children:[(0,o.jsx)("span",{className:"hint",children:"Review before saving."}),(0,o.jsxs)("div",{className:"actions",children:[(0,o.jsx)("button",{type:"button",onClick:k,className:"mr-btn ghost",children:"Cancel"}),(0,o.jsxs)("button",{type:"submit",className:"mr-btn primary",disabled:v,children:[(0,o.jsx)(c.dIn,{}),v?"Saving\u2026":"Save Changes"]})]})]})})]})]})]})}},1120:(e,a,s)=>{s.r(a),s.d(a,{default:()=>d});var t=s(5043),n=s(411),r=s(3216),i=s(8818),l=s(579);const c={textAlign:"left",padding:"10px 8px",fontWeight:600,borderBottom:"2px solid #eee"},o={padding:"8px 8px",borderBottom:"1px solid #eee"},d=()=>{(0,r.Zp)();const[e,a]=(0,t.useState)([]),[s,d]=(0,t.useState)(!0),[m,u]=(0,t.useState)(""),[p,h]=(0,t.useState)(""),[j,x]=(0,t.useState)(""),[v,g]=(0,t.useState)(1);(0,t.useEffect)((()=>{n.Ay.get("/audit-logs").then((e=>{a(e.data),d(!1)})).catch((()=>d(!1)))}),[]);const N=e.filter((e=>{var a,s,t,n,r,i,l;return(!p||(null===(a=e.performedByRole)||void 0===a?void 0:a.toLowerCase().includes(p.toLowerCase())))&&(!j||(null===(s=e.action)||void 0===s?void 0:s.toLowerCase().includes(j.toLowerCase())))&&(!m||(null===(t=e.description)||void 0===t?void 0:t.toLowerCase().includes(m.toLowerCase()))||(null===(n=e.performedBy)||void 0===n||null===(r=n.name)||void 0===r?void 0:r.toLowerCase().includes(m.toLowerCase()))||(null===(i=e.performedByRole)||void 0===i?void 0:i.toLowerCase().includes(m.toLowerCase()))||(null===(l=e.action)||void 0===l?void 0:l.toLowerCase().includes(m.toLowerCase())))})),b=Math.ceil(N.length/15),f=N.slice(15*(v-1),15*v);return(0,t.useEffect)((()=>{g(1)}),[m,p,j]),(0,l.jsxs)("div",{children:[(0,l.jsx)(i.A,{roleSegment:"ceo"}),(0,l.jsxs)("div",{style:{maxWidth:1200,margin:"30px auto",padding:24,background:"#fff",borderRadius:12,boxShadow:"0 2px 16px #0001"},children:[(0,l.jsx)("h2",{style:{marginBottom:24},children:"Audit Log"}),(0,l.jsxs)("div",{style:{display:"flex",gap:12,marginBottom:20,flexWrap:"wrap"},children:[(0,l.jsx)("input",{placeholder:"Search anything...",value:m,onChange:e=>u(e.target.value),style:{flex:2,minWidth:180,padding:8,borderRadius:6,border:"1px solid #bbb"}}),(0,l.jsx)("input",{placeholder:"Filter by role",value:p,onChange:e=>h(e.target.value),style:{flex:1,minWidth:120,padding:8,borderRadius:6,border:"1px solid #bbb"}}),(0,l.jsx)("input",{placeholder:"Filter by action",value:j,onChange:e=>x(e.target.value),style:{flex:1,minWidth:120,padding:8,borderRadius:6,border:"1px solid #bbb"}})]}),s?(0,l.jsx)("div",{children:"Loading..."}):(0,l.jsx)("div",{style:{overflowX:"auto"},children:(0,l.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:15},children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{style:{background:"#f6f6f6"},children:[(0,l.jsx)("th",{style:c,children:"Date/Time"}),(0,l.jsx)("th",{style:c,children:"Action"}),(0,l.jsx)("th",{style:c,children:"Performed By"}),(0,l.jsx)("th",{style:c,children:"Role"}),(0,l.jsx)("th",{style:c,children:"Description"}),(0,l.jsx)("th",{style:c,children:"Details"})]})}),(0,l.jsx)("tbody",{children:0===f.length?(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:6,style:{textAlign:"center",color:"#888"},children:"No logs found."})}):f.map(((e,a)=>{var s;return(0,l.jsxs)("tr",{style:{background:a%2?"#fafbfc":"#fff"},children:[(0,l.jsx)("td",{style:o,children:new Date(e.timestamp).toLocaleString()}),(0,l.jsx)("td",{style:o,children:(0,l.jsx)("span",{style:{background:"#f3f6ff",borderRadius:4,padding:"2px 8px"},children:e.action})}),(0,l.jsx)("td",{style:o,children:(null===(s=e.performedBy)||void 0===s?void 0:s.name)||"Unknown"}),(0,l.jsx)("td",{style:o,children:e.performedByRole}),(0,l.jsx)("td",{style:o,children:e.description}),(0,l.jsx)("td",{style:o,children:(0,l.jsxs)("details",{children:[(0,l.jsx)("summary",{style:{cursor:"pointer"},children:"View"}),(0,l.jsx)("pre",{style:{whiteSpace:"pre-wrap",fontSize:12,background:"#f8f8f8",padding:8,borderRadius:6},children:JSON.stringify(e.meta,null,2)})]})})]},e._id||a)}))})]})}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:10,marginTop:30},children:[(0,l.jsx)("button",{onClick:()=>g((e=>Math.max(1,e-1))),disabled:1===v,style:{padding:"7px 18px",borderRadius:6,border:"1px solid #bbb",background:1===v?"#eee":"#fafcff",color:1===v?"#bbb":"#333",cursor:1===v?"not-allowed":"pointer"},children:"Prev"}),Array.from({length:b},((e,a)=>a+1)).filter((e=>1===e||e===b||Math.abs(e-v)<=2)).reduce(((e,a,s,t)=>(s>0&&a-t[s-1]>1&&e.push("..."),e.push(a),e)),[]).map(((e,a)=>"..."===e?(0,l.jsx)("span",{style:{padding:"0 6px",color:"#aaa"},children:"..."},"ellipsis-"+a):(0,l.jsx)("button",{onClick:()=>g(e),style:{padding:"7px 14px",borderRadius:5,border:e===v?"2px solid #384ee6":"1px solid #ccc",background:e===v?"#f3f6ff":"#fff",color:e===v?"#384ee6":"#333",fontWeight:e===v?700:400,cursor:"pointer",margin:"0 2px"},disabled:e===v,children:e},e))),(0,l.jsx)("button",{onClick:()=>g((e=>Math.min(b,e+1))),disabled:v===b||0===b,style:{padding:"7px 18px",borderRadius:6,border:"1px solid #bbb",background:v===b||0===b?"#eee":"#fafcff",color:v===b||0===b?"#bbb":"#333",cursor:v===b||0===b?"not-allowed":"pointer"},children:"Next"})]})]})]})}},1254:()=>{},1301:(e,a,s)=>{s.d(a,{k:()=>o});var t=s(7762),n=s(4857);function r(e,a,s,t){return new Promise((n=>{try{const r="".concat("","/fonts/").concat(a);fetch(r).then((e=>e.arrayBuffer())).then((r=>{try{e.addFileToVFS(a,r),e.addFont(a,s,t),n(!0)}catch(i){n(!1)}})).catch((()=>n(!1)))}catch(r){n(!1)}}))}function i(e,a,s){try{const t=e.getFontList();return t&&t[a]&&t[a][s]}catch(t){return!1}}function l(e){if(!e)return"N/A";const a=new Date(e);return Number.isNaN(a.getTime())?"N/A":a.toLocaleString()}function c(e){return String(e).padStart(2,"0")}async function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{companyName:s="FadzTrack",logoPath:o="".concat("","/images/Fadz-logo.png"),exporterName:d="Unknown",exporterRole:m="",filters:u={},reportTitle:p="Manpower Requests Export"}=a,h=new t.Ay({unit:"pt",format:"a4"}),j="NotoSans",x=await r(h,"NotoSans-Regular.ttf",j,"normal"),v=await r(h,"NotoSans-Bold.ttf",j,"bold"),g=x&&i(h,j,"normal"),N=v&&i(h,j,"bold"),b=g?j:"helvetica",f=N?"bold":"normal",y=40;let w=40;const C=await(S=o,new Promise((e=>{if(!S)return e(null);try{const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{const s=document.createElement("canvas");s.width=a.naturalWidth,s.height=a.naturalHeight,s.getContext("2d").drawImage(a,0,0),e({dataUrl:s.toDataURL("image/png"),w:a.naturalWidth,h:a.naturalHeight})},a.onerror=()=>e(null),a.src=S}catch(a){e(null)}})));var S;let A=y;if(null!==C&&void 0!==C&&C.dataUrl){const{w:e,h:a}=function(e,a,s,t){if(!e||!a)return{w:s,h:t};const n=Math.min(s/e,t/a,1);return{w:e*n,h:a*n}}(C.w,C.h,180,60);h.addImage(C.dataUrl,"PNG",y,w-12,e,a,void 0,"FAST"),A=y+e+16}h.setFont(b,f),h.setFontSize(20),h.setTextColor(20),h.text(String(s),A,w+16),h.setFont(b,"normal"),h.setFontSize(12),h.setTextColor(90),h.text(p,A,w+26),h.setDrawColor(220),h.setLineWidth(1),h.line(y,w+38,555,w+38),w+=54,h.setFont(b,f),h.setFontSize(12),h.setTextColor(20),h.text("Export Details",y,w),h.setFont(b,"normal"),h.setTextColor(60);const k=["Exported by: ".concat(d).concat(m?" (".concat(m,")"):""),"Date exported: ".concat(l(new Date))],D=function(e){const a=[];return e.status&&"all"!==e.status&&a.push("Status: ".concat(e.status)),e.search&&a.push('Search: "'.concat(e.search,'"')),e.dateFrom&&a.push("From: ".concat(e.dateFrom)),e.dateTo&&a.push("To: ".concat(e.dateTo)),a.length?a.join(", "):null}(u);D&&k.push("Filters: ".concat(D));let P=w+16;k.forEach((e=>{h.text(e,y,P),P+=16}));const q=P+6,L=e.map((e=>{var a,s;const t=Array.isArray(e.manpowerRequested)?e.manpowerRequested.map((e=>"".concat(e.name||"").concat(e.position?" (".concat(e.position,")"):""))).join(", "):"";return[e.createdAt?new Date(e.createdAt).toLocaleDateString():"",String((null===(a=e.createdBy)||void 0===a?void 0:a.name)||""),String((null===(s=e.project)||void 0===s?void 0:s.projectName)||""),t,(n=e,"Approved"===n.status?"Approved":"Pending"===n.status?"Pending":"Rejected"===n.status?"Rejected":"Completed"===n.status?"Completed":"In Progress"===n.status?"In Progress":"Unknown"),e.acquisitionDate?new Date(e.acquisitionDate).toLocaleDateString():""];var n}));(0,n.Ay)(h,{startY:q,head:[["Date","Requester","Project","Manpower Requested","Status","Acquisition Date"]],body:L,styles:{font:b,fontStyle:"normal",fontSize:10,cellPadding:5,halign:"left",overflow:"linebreak"},headStyles:{font:b,fontStyle:f,fillColor:[59,130,246],textColor:255},theme:"grid",margin:{left:y,right:y},columnStyles:{3:{cellWidth:180}},didDrawPage:()=>{const e="Generated: ".concat(l(new Date));h.setFont(b,"normal"),h.setFontSize(9),h.setTextColor(120),h.text(e,y,818);const a=h.getCurrentPageInfo().pageNumber||1,s=h.getNumberOfPages(),t="Page ".concat(a," of ").concat(s),n=h.getTextWidth(t);h.text(t,555-n,818)}}),h.save(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Manpower-Requests-Export";const a=new Date,s="_".concat(c(a.getHours())).concat(c(a.getMinutes()));return"".concat(e,"-").concat(s,".pdf")}())}},1505:(e,a,s)=>{s.r(a),s.d(a,{default:()=>d});var t=s(5043),n=s(3216),r=s(5475),i=s(411),l=s(8818),c=(s(1254),s(3204)),o=s(579);const d=()=>{const e=(0,n.Zp)(),[a]=(0,r.ok)(),[s,d]=(0,t.useState)([]),[m,u]=(0,t.useState)(!0),[p,h]=(0,t.useState)(""),[j,x]=(0,t.useState)("all"),[v,g]=(0,t.useState)("grid"),[N,b]=(0,t.useState)(""),f=(0,t.useDeferredValue)(N),[y,w]=(0,t.useState)("name"),[C,S]=(0,t.useState)("asc"),[A,k]=(0,t.useState)(1),[D,P]=(0,t.useState)(12);(0,t.useEffect)((()=>{const e=a.get("status");e&&["ongoing","completed","pending"].includes(e)&&x(e)}),[a]),(0,t.useEffect)((()=>{let e=!0;return(async()=>{try{const{data:a}=await i.Ay.get("/projects");if(!e)return;d(Array.isArray(a)?a:[])}catch(a){e&&h("Failed to fetch projects")}finally{e&&u(!1)}})(),()=>{e=!1}}),[]);const q=(0,t.useMemo)((()=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:2})),[]),L=e=>e?new Date(e).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"",R=(0,t.useMemo)((()=>{const e=f.trim().toLowerCase();return s.filter((e=>{const a=(e.status||"").toLowerCase();return"completed"===j?"completed"===a:"ongoing"===j?["ongoing","on going"].includes(a):"pending"!==j||["pending","not started"].includes(a)})).filter((a=>{var s,t;return!e||[a.projectName,null===(s=a.location)||void 0===s?void 0:s.name,null===(t=a.projectmanager)||void 0===t?void 0:t.name,a.contractor].some((a=>(a||"").toLowerCase().includes(e)))})).sort(((e,a)=>{const s=e=>{var a,s;switch(y){case"location":return(null===(a=e.location)||void 0===a?void 0:a.name)||"";case"manager":return(null===(s=e.projectmanager)||void 0===s?void 0:s.name)||"";case"status":return e.status||"";case"startDate":return e.startDate?new Date(e.startDate).getTime():0;default:return e.projectName||""}},t=s(e),n=s(a);return t===n?0:(t>n?1:-1)*("asc"===C?1:-1)}))}),[s,j,f,y,C]);(0,t.useEffect)((()=>{k(1)}),[j,f,y,C]);const _=R.length,M=Math.max(1,Math.ceil(_/D)),F=Math.min(A,M),E=(0,t.useMemo)((()=>R.slice((F-1)*D,F*D)),[R,F,D]),T=(0,t.useMemo)((()=>({total:s.length,ongoing:s.filter((e=>["ongoing","on going"].includes((e.status||"").toLowerCase()))).length,completed:s.filter((e=>"completed"===(e.status||"").toLowerCase())).length,pending:s.filter((e=>["pending","not started"].includes((e.status||"").toLowerCase()))).length})),[s]),O=e=>{let{n:a=8}=e;return(0,o.jsx)("div",{className:"projects-display ".concat(v),children:Array.from({length:a}).map(((e,a)=>(0,o.jsxs)("div",{className:"project-card skeleton",children:[(0,o.jsx)("div",{className:"project-image-wrapper shimmer"}),(0,o.jsxs)("div",{className:"project-content",children:[(0,o.jsx)("div",{className:"skeleton-line w60"}),(0,o.jsx)("div",{className:"skeleton-line w40"}),(0,o.jsx)("div",{className:"skeleton-line w80"}),(0,o.jsx)("div",{className:"skeleton-line w50"})]})]},a)))})};return(0,o.jsxs)("div",{className:"dashboard-container no-inner-scroll ceo-projects-page",children:[(0,o.jsx)(l.A,{roleSegment:"ceo"}),(0,o.jsx)("main",{className:"dashboard-main auto-height",children:(0,o.jsxs)("div",{className:"projects-container projects-light",children:[(0,o.jsxs)("div",{className:"page-header enhanced",children:[(0,o.jsxs)("div",{className:"page-title-section",children:[(0,o.jsx)("h1",{className:"page-title",children:"Projects"}),(0,o.jsx)("p",{className:"page-subtitle",children:"Portfolio overview"})]}),(0,o.jsxs)("div",{className:"page-actions",children:[(0,o.jsxs)("div",{className:"search-container",children:[(0,o.jsx)(c.KSO,{className:"search-icon"}),(0,o.jsx)("input",{value:N,onChange:e=>b(e.target.value),placeholder:"Search by name, location, manager...",className:"search-input"})]}),(0,o.jsxs)("div",{className:"view-mode-container",children:[(0,o.jsx)("button",{"aria-label":"Grid view",className:"view-mode-btn ".concat("grid"===v?"active":""),onClick:()=>g("grid"),children:(0,o.jsx)(c.QJV,{})}),(0,o.jsx)("button",{"aria-label":"List view",className:"view-mode-btn ".concat("list"===v?"active":""),onClick:()=>g("list"),children:(0,o.jsx)(c.svy,{})})]}),(0,o.jsxs)("div",{className:"sort-container",children:[(0,o.jsxs)("select",{value:y,onChange:e=>w(e.target.value),className:"sort-select",children:[(0,o.jsx)("option",{value:"name",children:"Name"}),(0,o.jsx)("option",{value:"location",children:"Location"}),(0,o.jsx)("option",{value:"manager",children:"Manager"}),(0,o.jsx)("option",{value:"status",children:"Status"}),(0,o.jsx)("option",{value:"startDate",children:"Start Date"})]}),(0,o.jsx)("button",{"aria-label":"Toggle sort order",className:"sort-order-btn",onClick:()=>S((e=>"asc"===e?"desc":"asc")),children:"asc"===C?(0,o.jsx)(c.Ucs,{}):(0,o.jsx)(c.Vr3,{})})]})]})]}),(0,o.jsxs)("div",{className:"filter-bar below-header",children:[(0,o.jsxs)("button",{className:"filter-chip ".concat("all"===j?"active":""),onClick:()=>x("all"),children:["All ",(0,o.jsx)("span",{className:"badge",children:T.total})]}),(0,o.jsxs)("button",{className:"filter-chip ".concat("ongoing"===j?"active":""),onClick:()=>x("ongoing"),children:["Ongoing ",(0,o.jsx)("span",{className:"badge",children:T.ongoing})]}),(0,o.jsxs)("button",{className:"filter-chip ".concat("completed"===j?"active":""),onClick:()=>x("completed"),children:["Completed ",(0,o.jsx)("span",{className:"badge",children:T.completed})]}),(0,o.jsxs)("button",{className:"filter-chip ".concat("pending"===j?"active":""),onClick:()=>x("pending"),children:["Pending ",(0,o.jsx)("span",{className:"badge",children:T.pending})]})]}),p&&(0,o.jsxs)("div",{className:"error-state compact",children:[(0,o.jsx)(c.w_X,{}),(0,o.jsx)("span",{children:p})]}),m&&!p&&(0,o.jsx)(O,{n:8}),!m&&!p&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"projects-display ".concat(v),children:[0===E.length&&(0,o.jsxs)("div",{className:"empty-state full",children:[(0,o.jsx)(c.yd7,{size:42}),(0,o.jsx)("h3",{children:"No projects found"}),(0,o.jsx)("p",{children:N||"all"!==j?"Adjust search text, filters or sorting.":"Start by creating a new project."})]}),E.map((a=>{var s,t,n;const r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const a=e.toLowerCase();return"completed"===a?{color:"#10B981",Icon:c.A7C,label:"Completed"}:"ongoing"===a||"on going"===a?{color:"#3B82F6",Icon:c.w_X,label:"Ongoing"}:["pending","not started"].includes(a)?{color:"#F59E0B",Icon:c.w_X,label:"Pending"}:{color:"#6B7280",Icon:c.w_X,label:e||"Unknown"}}(a.status);return(0,o.jsxs)("div",{className:"project-card ".concat(v),onClick:()=>e("/ceo/proj/".concat(a._id)),role:"button",tabIndex:0,onKeyDown:s=>{"Enter"===s.key&&e("/ceo/proj/".concat(a._id))},children:[(0,o.jsxs)("div",{className:"project-image-wrapper",children:[(0,o.jsx)("img",{loading:"lazy",src:(null===(s=a.photos)||void 0===s?void 0:s[0])||"https://placehold.co/640x360?text=No+Photo",alt:a.projectName,className:"project-image"}),(0,o.jsxs)("div",{className:"status-badge",style:{backgroundColor:r.color},children:[(0,o.jsx)(r.Icon,{size:12}),(0,o.jsx)("span",{children:r.label})]})]}),(0,o.jsxs)("div",{className:"project-content",children:[(0,o.jsx)("h3",{className:"project-name clamp",children:a.projectName||"Untitled"}),(0,o.jsxs)("div",{className:"project-location",children:[(0,o.jsx)(c.vq8,{}),(0,o.jsx)("span",{children:(null===(t=a.location)||void 0===t?void 0:t.name)||"No Location"})]}),(0,o.jsxs)("ul",{className:"meta-list",children:[(0,o.jsxs)("li",{children:[(0,o.jsx)(c.p7b,{}),(0,o.jsx)("span",{children:(null===(n=a.projectmanager)||void 0===n?void 0:n.name)||"Unassigned"})]}),(0,o.jsxs)("li",{children:[(0,o.jsx)(c.ymh,{}),(0,o.jsx)("span",{children:a.contractor||"No Contractor"})]}),(0,o.jsxs)("li",{children:[(0,o.jsx)(c.bfZ,{}),(0,o.jsx)("span",{children:a.startDate&&a.endDate?"".concat(L(a.startDate)," - ").concat(L(a.endDate)):a.startDate?L(a.startDate):"No timeline"})]}),(0,o.jsxs)("li",{children:[(0,o.jsx)(c.YXz,{}),(0,o.jsx)("span",{children:Array.isArray(a.manpower)&&a.manpower.length>0?"".concat(a.manpower.length," manpower"):"No manpower"})]}),a.budget&&(0,o.jsxs)("li",{children:[(0,o.jsx)(c.MxO,{}),(0,o.jsx)("span",{children:q.format(a.budget)})]})]})]})]},a._id)}))]}),E.length>0&&(0,o.jsxs)("div",{className:"pagination-bar",children:[(0,o.jsxs)("div",{className:"pagination-left",children:[(0,o.jsxs)("span",{className:"pagination-info",children:["Showing ",(F-1)*D+1,"-",Math.min(F*D,_)," of ",_]}),(0,o.jsxs)("label",{className:"page-size-select-label",children:[(0,o.jsx)("span",{children:"Per page:"}),(0,o.jsx)("select",{value:D,onChange:e=>{P(parseInt(e.target.value)||12),k(1)},className:"page-size-select",children:[6,12,18,24,36].map((e=>(0,o.jsx)("option",{value:e,children:e},e)))})]})]}),(0,o.jsxs)("div",{className:"pagination-pages",children:[(0,o.jsx)("button",{disabled:1===F,onClick:()=>k((e=>Math.max(1,e-1))),className:"page-btn","aria-label":"Previous page",children:"\u2039"}),Array.from({length:M}).slice(0,M).map(((e,a)=>{const s=a+1;return 1===s||s===M||Math.abs(s-F)<=1?(0,o.jsx)("button",{className:"page-btn ".concat(s===F?"active":""),onClick:()=>k(s),"aria-current":s===F?"page":void 0,children:s},s):2===s&&F>3?(0,o.jsx)("span",{className:"ellipsis",children:"\u2026"},"start-ellipsis"):s===M-1&&F<M-2?(0,o.jsx)("span",{className:"ellipsis",children:"\u2026"},"end-ellipsis"):null})),(0,o.jsx)("button",{disabled:F===M,onClick:()=>k((e=>Math.min(M,e+1))),className:"page-btn","aria-label":"Next page",children:"\u203a"})]})]})]})]})})]})}},1806:(e,a,s)=>{s.r(a),s.d(a,{default:()=>l});var t=s(5043),n=s(411),r=s(3204),i=s(579);const l=e=>{let{onSuccess:a,onCancel:s}=e;const[l,c]=(0,t.useState)([]),[o,d]=(0,t.useState)([]),[m,u]=(0,t.useState)(""),[p,h]=(0,t.useState)([]),[j,x]=(0,t.useState)([]),[v,g]=(0,t.useState)(!0),[N,b]=(0,t.useState)(!0),[f,y]=(0,t.useState)(!1),[w,C]=(0,t.useState)(""),[S,A]=(0,t.useState)("");(0,t.useEffect)((()=>{let e=!0;return(async()=>{try{const[a,s]=await Promise.all([n.Ay.get("/users/role/Area%20Manager"),n.Ay.get("/locations")]);if(!e)return;c(Array.isArray(a.data)?a.data:[]),d(Array.isArray(s.data)?s.data:[])}catch(a){e&&C("Failed to load data")}finally{e&&(g(!1),b(!1))}})(),()=>{e=!1}}),[]),(0,t.useEffect)((()=>{if(!m)return h([]),void x([]);let e=!0;return(async()=>{try{const{data:a}=await n.Ay.get("/users/".concat(m,"/locations"));if(!e)return;const s=Array.isArray(a)?a.map((e=>e._id)):[];h(s),x(s)}catch(a){e&&C("Failed to load assigned locations")}})(),()=>{e=!1}}),[m]);const k=(0,t.useMemo)((()=>o.filter((e=>!S||e.name.toLowerCase().includes(S.toLowerCase())||e.region.toLowerCase().includes(S.toLowerCase()))).map((e=>e._id))),[o,S]),D=k.length>0&&k.every((e=>p.includes(e))),P=!D&&k.some((e=>p.includes(e))),q=(0,t.useMemo)((()=>{if(p.length!==j.length)return!0;const e=new Set(j);return p.some((a=>!e.has(a)))}),[p,j]),L=(0,t.useMemo)((()=>o.filter((e=>!S||e.name.toLowerCase().includes(S.toLowerCase())||e.region.toLowerCase().includes(S.toLowerCase()))).sort(((e,a)=>e.name.localeCompare(a.name)))),[o,S]);return(0,i.jsxs)("div",{className:"ceo-modal-card",children:[(0,i.jsxs)("div",{className:"modal-header-inline",children:[(0,i.jsx)("h2",{children:"Assign Locations"}),(0,i.jsx)("button",{className:"btn-text",onClick:s,children:"\u2715"})]}),(0,i.jsxs)("div",{className:"form-row",children:[(0,i.jsx)("label",{className:"form-label",htmlFor:"managerSelect",children:"Area Manager"}),(0,i.jsxs)("select",{id:"managerSelect",className:"input select w-full",value:m,onChange:e=>u(e.target.value),disabled:v||f,children:[(0,i.jsx)("option",{value:"",children:"Select Area Manager..."}),l.map((e=>(0,i.jsx)("option",{value:e._id,children:e.name},e._id)))]})]}),m&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"locations-toolbar",children:[(0,i.jsxs)("div",{className:"search-box",children:[(0,i.jsx)(r.KSO,{}),(0,i.jsx)("input",{type:"text",placeholder:"Search locations...",value:S,onChange:e=>A(e.target.value)})]}),(0,i.jsxs)("div",{className:"toolbar-actions",children:[(0,i.jsx)("button",{className:"btn-chip",onClick:()=>{h(D?e=>e.filter((e=>!k.includes(e))):e=>Array.from(new Set([...e,...k])))},disabled:!k.length,children:D?"Unselect Visible":P?"Select Remaining":"Select Visible"}),(0,i.jsx)("button",{className:"btn-chip",onClick:()=>h([]),disabled:!p.length,children:"Clear All"})]})]}),(0,i.jsxs)("div",{className:"locations-meta",children:[(0,i.jsxs)("span",{className:"count",children:[p.length," selected"]}),(0,i.jsx)("span",{className:"divider"}),(0,i.jsxs)("span",{className:"count subtle",children:[L.length," shown"]})]}),(0,i.jsx)("div",{className:"location-list",role:"group","aria-label":"Locations multi select",children:N?(0,i.jsx)("div",{className:"loading-row",children:"Loading locations..."}):0===L.length?(0,i.jsx)("div",{className:"empty-row",children:"No locations match your search."}):L.map((e=>{const a=p.includes(e._id);return(0,i.jsxs)("label",{className:"location-item ".concat(a?"selected":""),children:[(0,i.jsx)("input",{type:"checkbox",checked:a,onChange:()=>{return a=e._id,void h((e=>e.includes(a)?e.filter((e=>e!==a)):[...e,a]));var a}}),(0,i.jsx)("span",{className:"loc-name",children:e.name}),(0,i.jsx)("span",{className:"loc-region",children:e.region}),a?(0,i.jsx)(r.A7C,{className:"state-icon ok"}):(0,i.jsx)(r._Hm,{className:"state-icon muted"})]},e._id)}))})]}),w&&(0,i.jsx)("div",{className:"error-banner",children:w}),(0,i.jsxs)("div",{className:"sticky-actions",children:[(0,i.jsx)("button",{className:"btn-outline",onClick:s,disabled:f,children:"Cancel"}),(0,i.jsx)("button",{className:"btn-primary",onClick:async()=>{if(m){y(!0),C("");try{await n.Ay.put("/users/".concat(m,"/locations"),{locations:p}),x(p),a&&a()}catch(e){C("Failed to save locations")}finally{y(!1)}}},disabled:!m||f||!q,children:f?"Saving...":"Save Changes"})]})]})}},2291:(e,a,s)=>{s.d(a,{E:()=>c});var t=s(8420),n=s(8643),r=s(2185),i=s(6026),l=s(3831),c=(0,t.gu)({chartName:"BarChart",GraphicalChild:n.y,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:r.W},{axisType:"yAxis",AxisComp:i.h}],formatAxisMap:l.pr})},2660:()=>{},3485:(e,a,s)=>{s.r(a),s.d(a,{default:()=>r});s(5043);var t=s(5111),n=(s(9389),s(579));const r=()=>(0,n.jsx)(t.A,{role:"CEO",fetchUrl:"/requests",detailLinkBase:"/ceo/material-request",rootClass:"ceo-request-list",headerTitle:"Material Requests",headerSubtitle:"Organization-wide material requests overview",enableExport:!0,exportTitle:"Material Requests Export (CEO View)"})},5574:(e,a,s)=>{s.r(a),s.d(a,{default:()=>m});var t=s(5043),n=s(3216),r=s(5475),i=(s(2660),s(64),s(411)),l=s(3204),c=s(8818),o=s(1301),d=s(579);const m=()=>{const e=(0,n.Zp)(),a=(0,t.useRef)(null);if(null===a.current){const e=localStorage.getItem("user");a.current=e?JSON.parse(e):null}const s=a.current,[m,u]=(0,t.useState)([]),[p,h]=(0,t.useState)(!0),[j,x]=(0,t.useState)(""),[v,g]=(0,t.useState)("All"),[N,b]=(0,t.useState)(""),[f,y]=(0,t.useState)(1),[w,C]=(0,t.useState)("cards"),[S,A]=(0,t.useState)(!1);(0,t.useEffect)((()=>{if(!s||"CEO"!==s.role)return;let e=!0;return(async()=>{h(!0),x("");try{const{data:a}=await i.Ay.get("/manpower-requests");if(!e)return;u(Array.isArray(a)?a:[])}catch(a){if(!e)return;console.error("Failed to load manpower requests:",a),!a.response||401!==a.response.status&&403!==a.response.status?x("Failed to load manpower requests"):x("Session expired or unauthorized. Please login.")}finally{e&&(h(!1),y(1))}})(),()=>{e=!1}}),[s]);const k=(0,t.useMemo)((()=>{let e=m;if(e="All"!==v?"Archived"===v?e.filter((e=>(e.status||"Pending").toLowerCase().includes("archived"))):e.filter((e=>(e.status||"Pending").toLowerCase().includes(v.toLowerCase()))):e.filter((e=>!(e.status||"Pending").toLowerCase().includes("archived"))),N){const a=N.toLowerCase();e=e.filter((e=>{var s,t;const n=(null===(s=e.project)||void 0===s?void 0:s.projectName)||"",r=(null===(t=e.createdBy)||void 0===t?void 0:t.name)||"",i=(e.manpowers||[]).map((e=>"".concat(e.quantity," ").concat(e.type))).join(", ");return n.toLowerCase().includes(a)||r.toLowerCase().includes(a)||i.toLowerCase().includes(a)||(e.description||"").toLowerCase().includes(a)}))}return e}),[m,v,N]),D=Math.max(1,Math.ceil(k.length/8)),P=(0,t.useMemo)((()=>{const e=8*(f-1);return k.slice(e,e+8)}),[k,f]),q=(0,t.useMemo)((()=>{let e=0,a=0,s=0,t=0,n=0,r=0;return m.forEach((i=>{const l=(i.status||"Pending").toLowerCase(),c="pending"===l&&i.acquisitionDate&&new Date(i.acquisitionDate)<new Date;l.includes("archived")?r++:l.includes("completed")?s++:l.includes("approved")?a++:l.includes("reject")||l.includes("denied")||l.includes("cancel")?t++:c||l.includes("overdue")?n++:e++})),{total:m.length,pending:e,approved:a,rejected:t,overdue:n,completed:s,archived:r}}),[m]),L=(0,t.useMemo)((()=>({All:q.total-q.archived,Pending:q.pending,Overdue:q.overdue,Approved:q.approved,Completed:q.completed,Rejected:q.rejected,Archived:q.archived})),[q]);return s&&"CEO"===s.role?(0,d.jsxs)("div",{className:"dashboard-container ceo-manpower-requests-page",children:[(0,d.jsx)(c.A,{roleSegment:"ceo"}),(0,d.jsx)("main",{className:"dashboard-main",children:(0,d.jsxs)("div",{className:"page-container",children:[(0,d.jsxs)("div",{className:"dashboard-card ceo-mr-header-card",children:[(0,d.jsxs)("div",{className:"card-header mr-header-row",children:[(0,d.jsxs)("div",{className:"mr-header-texts",children:[(0,d.jsx)("h1",{className:"card-title",children:"Manpower Requests"}),(0,d.jsx)("p",{className:"card-subtitle",children:"Organization-wide manpower requests overview"})]}),(0,d.jsx)("div",{className:"layout-toggle-wrapper",children:(0,d.jsx)("button",{onClick:()=>C((e=>"cards"===e?"table":"cards")),className:"btn-secondary toggle-layout-btn",children:"cards"===w?"Table View":"Card View"})})]}),(0,d.jsxs)("div",{className:"card-body mr-filters-row",children:[(0,d.jsx)("div",{className:"filter-tabs compact",children:["All","Pending","Overdue","Approved","Completed","Rejected","Archived"].map((e=>{var a;return(0,d.jsxs)("button",{className:"filter-tab ".concat(v===e?"active":""),onClick:()=>{g(e),y(1)},children:[(0,d.jsx)("span",{children:e}),(0,d.jsx)("span",{className:"count",children:null!==(a=L[e])&&void 0!==a?a:0})]},e)}))}),(0,d.jsxs)("div",{className:"search-wrapper stretch",children:[(0,d.jsx)(l.KSO,{className:"search-icon"}),(0,d.jsx)("input",{type:"text",placeholder:"Search requests...",value:N,onChange:e=>{b(e.target.value),y(1)},className:"search-input"})]}),(0,d.jsxs)("button",{onClick:async()=>{try{A(!0),await(0,o.k)(k,{companyName:"FadzTrack",logoPath:"".concat("","/images/Fadz-logo.png"),exporterName:(null===s||void 0===s?void 0:s.name)||"Unknown",exporterRole:(null===s||void 0===s?void 0:s.role)||"",filters:{status:v,searchTerm:N},reportTitle:"Manpower Requests Export (CEO View)"})}catch(j){console.error("Export failed:",j),alert("Failed to export PDF")}finally{A(!1)}},disabled:S||0===k.length,className:"btn-primary export-btn",style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",minWidth:"auto"},children:[(0,d.jsx)(l.WCW,{}),S?"Exporting...":"Export PDF"]})]})]}),(0,d.jsxs)("div",{className:"dashboard-card ceo-mr-summary-card",children:[(0,d.jsx)("div",{className:"card-header",children:(0,d.jsx)("h3",{className:"card-title-sm",children:"Summary"})}),(0,d.jsx)("div",{className:"mr-summary-grid",children:[{label:"Total",value:q.total,color:"#334155"},{label:"Pending",value:q.pending,color:"#f59e0b"},{label:"Overdue",value:q.overdue,color:"#d97706"},{label:"Approved",value:q.approved,color:"#10b981"},{label:"Completed",value:q.completed,color:"#059669"},{label:"Rejected",value:q.rejected,color:"#ef4444"},{label:"Archived",value:q.archived,color:"#8b5cf6"}].map((e=>(0,d.jsxs)("div",{className:"mr-summary-item",children:[(0,d.jsx)("span",{className:"mr-summary-label",children:e.label}),(0,d.jsx)("span",{className:"mr-summary-value",style:{color:e.color},children:e.value}),(0,d.jsx)("div",{className:"mr-summary-bar",style:{background:e.color}})]},e.label)))})]}),(0,d.jsxs)("div",{className:"dashboard-card ceo-mr-list-card",children:[(0,d.jsx)("div",{className:"card-header list-header",children:(0,d.jsxs)("h3",{className:"card-title-sm",children:["Requests ",(0,d.jsxs)("span",{className:"muted",children:["(",k.length,")"]})]})}),(0,d.jsx)("div",{className:"requests-grid ceo-mr-grid ".concat("table"===w?"table-view":""),children:p?(0,d.jsxs)("div",{className:"loading-state",children:[(0,d.jsx)("div",{className:"loading-spinner"}),(0,d.jsx)("p",{children:"Loading manpower requests..."})]}):j?(0,d.jsx)("div",{className:"error-state",children:(0,d.jsx)("p",{children:j})}):0===P.length?(0,d.jsxs)("div",{className:"empty-state",children:[(0,d.jsx)("div",{className:"empty-icon",children:"\ud83d\udc65"}),(0,d.jsx)("h3",{children:"No manpower requests found"}),(0,d.jsx)("p",{children:"No requests match your current filters. Try adjusting your search criteria."})]}):(0,d.jsxs)(d.Fragment,{children:["table"===w&&(0,d.jsxs)("div",{className:"mr-table-header",role:"row","aria-label":"Table Header",children:[(0,d.jsx)("div",{children:"Project"}),(0,d.jsx)("div",{children:"Requester"}),(0,d.jsx)("div",{children:"Description"}),(0,d.jsx)("div",{children:"Manpower"}),(0,d.jsx)("div",{children:"Target"}),(0,d.jsx)("div",{children:"Dur"}),(0,d.jsx)("div",{children:"Created"}),(0,d.jsx)("div",{children:"Status"})]}),P.map((a=>{var s,t,n,i;const l=(a.manpowers||[]).map((e=>"".concat(e.quantity," ").concat(e.type))).join(", "),c=(e=>{const a=(e.status||"Pending").toLowerCase();return"pending"===a&&e.acquisitionDate&&new Date(e.acquisitionDate)<new Date?"Overdue":a.includes("archived")?"Archived":a.includes("completed")?"Completed":a.includes("approved")?"Approved":a.includes("pending")?"Pending":a.includes("reject")||a.includes("denied")||a.includes("cancel")?"Rejected":a.includes("overdue")?"Overdue":"Unknown"})(a);(e=>{const a=(e.status||"Pending").toLowerCase();"pending"===a&&e.acquisitionDate&&new Date(e.acquisitionDate)<new Date||(a.includes("archived")||(a.includes("completed")||(a.includes("approved")||(a.includes("pending")||(a.includes("reject")||a.includes("denied")||a.includes("cancel")||a.includes("overdue"))))))})(a);var o,m,u,p;return"table"===w?(0,d.jsxs)("div",{className:"mr-table-row",role:"row",onClick:()=>e("/ceo/manpower-request/".concat(a._id)),style:{cursor:"pointer"},title:"View details",children:[(0,d.jsx)("div",{className:"rt-title",title:(null===(o=a.project)||void 0===o?void 0:o.projectName)||"(No Project Name)",children:(null===(m=a.project)||void 0===m?void 0:m.projectName)||"(No Project Name)"}),(0,d.jsx)("div",{className:"rt-req",title:(null===(u=a.createdBy)||void 0===u?void 0:u.name)||"Unknown",children:(null===(p=a.createdBy)||void 0===p?void 0:p.name)||"Unknown"}),(0,d.jsx)("div",{className:"rt-desc",title:a.description||"No description",children:a.description||"No description"}),(0,d.jsx)("div",{className:"rt-man",title:l||"\u2014",children:l||"\u2014"}),(0,d.jsx)("div",{className:"rt-date",title:"Target Date",children:a.acquisitionDate?new Date(a.acquisitionDate).toLocaleDateString():"\u2014"}),(0,d.jsxs)("div",{className:"rt-date",title:"Duration",children:[a.duration||"\u2014","d"]}),(0,d.jsx)("div",{className:"rt-date",title:"Created",children:a.createdAt?new Date(a.createdAt).toLocaleDateString():"\u2014"}),(0,d.jsx)("div",{className:"rt-btn",children:(0,d.jsx)("span",{className:"status-chip ".concat(c.toLowerCase()),children:c})})]},a._id):(0,d.jsxs)("div",{className:"request-card ceo-mr-card",children:[(0,d.jsxs)("div",{className:"card-body",children:[(0,d.jsxs)("div",{className:"mr-card-top-row",children:[(0,d.jsx)("h3",{className:"request-title",title:(null===(s=a.project)||void 0===s?void 0:s.projectName)||"(No Project Name)",children:(null===(t=a.project)||void 0===t?void 0:t.projectName)||"(No Project Name)"}),(0,d.jsx)("span",{className:"status-chip ".concat(c.toLowerCase()),children:c})]}),(0,d.jsx)("p",{className:"request-description",title:a.description||"No description provided",children:a.description||"No description provided"}),(0,d.jsxs)("div",{className:"request-meta",children:[(0,d.jsxs)("div",{className:"meta-item",children:[(0,d.jsx)("span",{className:"meta-label",children:"Requested by:"}),(0,d.jsx)("span",{className:"meta-value",title:(null===(n=a.createdBy)||void 0===n?void 0:n.name)||"Unknown",children:(null===(i=a.createdBy)||void 0===i?void 0:i.name)||"Unknown"})]}),(0,d.jsxs)("div",{className:"meta-item",children:[(0,d.jsx)("span",{className:"meta-label",children:"Manpower:"}),(0,d.jsx)("span",{className:"meta-value",title:l||"\u2014",children:l||"\u2014"})]}),(0,d.jsxs)("div",{className:"meta-item",children:[(0,d.jsx)("span",{className:"meta-label",children:"Date:"}),(0,d.jsx)("span",{className:"meta-value",children:a.createdAt?new Date(a.createdAt).toLocaleDateString():"\u2014"})]}),(0,d.jsxs)("div",{className:"meta-item",children:[(0,d.jsx)("span",{className:"meta-label",children:"Target:"}),(0,d.jsx)("span",{className:"meta-value",children:a.acquisitionDate?new Date(a.acquisitionDate).toLocaleDateString():"\u2014"})]}),(0,d.jsxs)("div",{className:"meta-item",children:[(0,d.jsx)("span",{className:"meta-label",children:"Duration:"}),(0,d.jsxs)("span",{className:"meta-value",children:[a.duration||"\u2014"," d"]})]})]})]}),(0,d.jsx)("div",{className:"card-footer",children:(0,d.jsx)(r.N_,{to:"/ceo/manpower-request/".concat(a._id),className:"view-details-btn",children:"View Details"})})]},a._id)}))]})}),k.length>0&&(0,d.jsxs)("div",{className:"pagination-section inside-card",children:[(0,d.jsxs)("div",{className:"pagination-info",children:["Showing ",8*(f-1)+1," to ",Math.min(8*f,k.length)," of ",k.length," entries"]}),(0,d.jsxs)("div",{className:"pagination-controls",children:[(0,d.jsx)("button",{onClick:()=>y((e=>Math.max(e-1,1))),disabled:1===f,className:"pagination-btn",children:"Previous"}),Array.from({length:D},((e,a)=>a+1)).map((e=>(0,d.jsx)("button",{className:"pagination-btn ".concat(e===f?"active":""),onClick:()=>y(e),children:e},e))),(0,d.jsx)("button",{onClick:()=>y((e=>Math.min(e+1,D))),disabled:f===D,className:"pagination-btn",children:"Next"})]})]})]})]})})]}):(0,d.jsxs)("div",{style:{padding:24},children:[(0,d.jsx)("h2",{children:"Forbidden"}),(0,d.jsx)("p",{children:"You must be a CEO user to view this page."})]})}},6946:(e,a,s)=>{s.r(a),s.d(a,{default:()=>o});var t=s(5043),n=s(3216),r=s(411),i=s(8818),l=s(3204),c=s(579);const o=()=>{var e,a,s,o;const{id:d}=(0,n.g)(),m=(0,n.Zp)(),u=(0,t.useRef)(null);if(null===u.current){const e=localStorage.getItem("user");u.current=e?JSON.parse(e):null}const p=u.current,h=localStorage.getItem("token"),[j,x]=(0,t.useState)(null),[v,g]=(0,t.useState)(!0),[N,b]=(0,t.useState)("");(0,t.useEffect)((()=>{if(!p||"CEO"!==p.role)return;let e=!0;return(async()=>{g(!0),b("");try{const{data:a}=await r.Ay.get("/manpower-requests/".concat(d),{headers:{Authorization:"Bearer ".concat(h)}});if(!e)return;x(a)}catch(a){if(!e)return;console.error("Failed to load request",a),b("Failed to load request details")}finally{e&&g(!1)}})(),()=>{e=!1}}),[d,h]);return p&&"CEO"===p.role?v?(0,c.jsx)("div",{className:"dashboard-container",children:(0,c.jsxs)("div",{className:"loading-container",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Loading manpower request..."})]})}):N||!j?(0,c.jsx)("div",{className:"dashboard-container",children:(0,c.jsxs)("div",{className:"error-container",children:[(0,c.jsx)(l.BS8,{className:"error-icon"}),(0,c.jsx)("p",{children:N||"Request not found."})]})}):(0,c.jsxs)("div",{className:"dashboard-container ceo-mr-detail",children:[(0,c.jsx)(i.A,{roleSegment:"ceo"}),(0,c.jsx)("main",{className:"dashboard-main",children:(0,c.jsxs)("div",{className:"content-wrapper",children:[(0,c.jsx)("div",{className:"page-header",children:(0,c.jsxs)("div",{className:"page-header-content",children:[(0,c.jsxs)("button",{onClick:()=>m(-1),className:"back-button",children:[(0,c.jsx)(l.QVr,{}),(0,c.jsx)("span",{children:"Back"})]}),(0,c.jsxs)("div",{className:"page-title-section",children:[(0,c.jsx)("h1",{className:"page-title",children:"Manpower Request Details"}),(0,c.jsxs)("p",{className:"page-subtitle",children:["Executive overview for request #",j.requestNumber||(null===d||void 0===d?void 0:d.slice(-3))]})]})]})}),(0,c.jsxs)("div",{className:"status-metrics-card ".concat(null===(e=j.status)||void 0===e?void 0:e.toLowerCase()),children:[(0,c.jsxs)("div",{className:"smc-header",children:[(0,c.jsx)("div",{className:"smc-status-icon",children:(e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"approved":case"completed":return(0,c.jsx)(l.A7C,{className:"status-icon approved"});case"rejected":return(0,c.jsx)(l.BS8,{className:"status-icon rejected"});default:return(0,c.jsx)(l.lhZ,{className:"status-icon pending"})}})(j.status)}),(0,c.jsxs)("div",{className:"smc-texts",children:[(0,c.jsxs)("h3",{children:[j.status||"Pending"," Request"]}),(0,c.jsx)("p",{children:j.description||"No description provided"})]}),"pending"===(null===(a=j.status)||void 0===a?void 0:a.toLowerCase())&&j.acquisitionDate&&new Date(j.acquisitionDate)<new Date&&(0,c.jsx)("span",{className:"badge-overdue",children:"Overdue"})]}),(0,c.jsx)("div",{className:"smc-metrics",children:(()=>{const e=(()=>{const e=((null===j||void 0===j?void 0:j.status)||"Pending").toLowerCase();return"pending"===e&&j.acquisitionDate&&new Date(j.acquisitionDate)<new Date?{label:"Overdue",color:"#d97706"}:e.includes("completed")?{label:"Completed",color:"#059669"}:e.includes("approved")?{label:"Approved",color:"#10b981"}:e.includes("pending")?{label:"Pending",color:"#f59e0b"}:e.includes("reject")||e.includes("denied")||e.includes("cancel")?{label:"Rejected",color:"#ef4444"}:e.includes("overdue")?{label:"Overdue",color:"#d97706"}:{label:"Unknown",color:"#6b7280"}})(),a=Array.isArray(j.manpowers)?j.manpowers.reduce(((e,a)=>e+(Number(a.quantity)||0)),0):0;return[{label:"Status",value:e.label},{label:"Types",value:Array.isArray(j.manpowers)?j.manpowers.length:0},{label:"Quantity",value:a},{label:"Duration",value:"".concat(j.duration||0,"d")},{label:"Return",value:j.returnDate?"Yes":"No"}].map((e=>(0,c.jsxs)("div",{className:"smc-metric",children:[(0,c.jsx)("span",{className:"m-label",children:e.label}),(0,c.jsx)("span",{className:"m-value",children:e.value})]},e.label)))})()})]}),(0,c.jsxs)("div",{className:"info-grid",children:[(0,c.jsxs)("div",{className:"info-card",children:[(0,c.jsxs)("div",{className:"card-header",children:[(0,c.jsx)(l.t69,{className:"card-icon"}),(0,c.jsx)("h3",{children:"Request Information"})]}),(0,c.jsxs)("div",{className:"card-content",children:[(0,c.jsxs)("div",{className:"info-row",children:[(0,c.jsx)("span",{className:"info-label",children:"Request Number:"}),(0,c.jsxs)("span",{className:"info-value",children:["#",j.requestNumber||(null===d||void 0===d?void 0:d.slice(-3))]})]}),(0,c.jsxs)("div",{className:"info-row",children:[(0,c.jsx)("span",{className:"info-label",children:"Created By:"}),(0,c.jsxs)("span",{className:"info-value",children:[(0,c.jsx)(l.p7b,{className:"inline-icon"}),(null===(s=j.createdBy)||void 0===s?void 0:s.name)||"Unknown"]})]}),(0,c.jsxs)("div",{className:"info-row",children:[(0,c.jsx)("span",{className:"info-label",children:"Project:"}),(0,c.jsxs)("span",{className:"info-value",children:[(0,c.jsx)(l.yd7,{className:"inline-icon"}),(null===(o=j.project)||void 0===o?void 0:o.projectName)||"Unknown Project"]})]})]})]}),(0,c.jsxs)("div",{className:"info-card",children:[(0,c.jsxs)("div",{className:"card-header",children:[(0,c.jsx)(l.w_X,{className:"card-icon"}),(0,c.jsx)("h3",{children:"Timeline"})]}),(0,c.jsxs)("div",{className:"card-content",children:[(0,c.jsxs)("div",{className:"info-row",children:[(0,c.jsx)("span",{className:"info-label",children:"Target Date:"}),(0,c.jsx)("span",{className:"info-value",children:j.acquisitionDate?new Date(j.acquisitionDate).toLocaleDateString():"Not set"})]}),(0,c.jsxs)("div",{className:"info-row",children:[(0,c.jsx)("span",{className:"info-label",children:"Duration:"}),(0,c.jsxs)("span",{className:"info-value",children:[j.duration," days"]})]}),j.returnDate&&(0,c.jsxs)("div",{className:"info-row",children:[(0,c.jsx)("span",{className:"info-label",children:"Return Date:"}),(0,c.jsx)("span",{className:"info-value",children:new Date(j.returnDate).toLocaleDateString()})]})]})]})]}),(0,c.jsxs)("div",{className:"requirements-card",children:[(0,c.jsxs)("div",{className:"card-header",children:[(0,c.jsx)(l.YXz,{className:"card-icon"}),(0,c.jsx)("h3",{children:"Manpower Requirements"})]}),(0,c.jsx)("div",{className:"card-content",children:Array.isArray(j.manpowers)&&j.manpowers.length>0?(0,c.jsx)("div",{className:"manpower-grid",children:j.manpowers.map(((e,a)=>(0,c.jsxs)("div",{className:"manpower-item",children:[(0,c.jsx)("div",{className:"manpower-quantity",children:e.quantity}),(0,c.jsx)("div",{className:"manpower-type",children:e.type})]},a)))}):(0,c.jsx)("div",{className:"no-manpower",children:(0,c.jsx)("p",{children:"No manpower types listed"})})})]}),(0,c.jsxs)("div",{className:"description-card",children:[(0,c.jsxs)("div",{className:"card-header",children:[(0,c.jsx)(l.t69,{className:"card-icon"}),(0,c.jsx)("h3",{children:"Request Description"})]}),(0,c.jsx)("div",{className:"card-content",children:(0,c.jsx)("div",{className:"description-text",children:j.description||"No description provided"})})]}),(0,c.jsx)("div",{className:"bottom-actions",children:(0,c.jsxs)("button",{onClick:()=>m(-1),className:"back-btn",children:[(0,c.jsx)(l.QVr,{}),(0,c.jsx)("span",{children:"Go Back"})]})})]})})]}):(0,c.jsxs)("div",{style:{padding:24},children:[(0,c.jsx)("h2",{children:"Forbidden"}),(0,c.jsx)("p",{children:"CEO access only."})]})}},7038:(e,a,s)=>{s.r(a),s.d(a,{default:()=>i});s(5043);var t=s(1245),n=s(3216),r=s(579);function i(){const{id:e}=(0,n.g)(),a={"View Project":"/ceo/proj/".concat(e),Reports:"/ceo/progress-report/".concat(e)};return(0,r.jsx)(t.A,{role:"ceo",navPathOverrides:a,useUnifiedHeader:!0})}},8028:(e,a,s)=>{s.r(a),s.d(a,{default:()=>r});s(5043);var t=s(3182),n=s(579);const r=()=>(0,n.jsx)(t.A,{role:"CEO",headerTitle:"Material Request Detail",headerSubtitle:"Full lifecycle view",rootClass:"ceo-mr-request-detail"})},8666:(e,a,s)=>{s.r(a),s.d(a,{default:()=>r});s(5043);var t=s(8153),n=s(579);function r(){return(0,n.jsx)(t.default,{baseSegment:"ceo"})}},9862:(e,a,s)=>{s.r(a),s.d(a,{default:()=>N});var t=s(9379),n=s(5043),r=s(108),i=s(2291),l=s(7734),c=s(2185),o=s(6026),d=s(6150),m=s(8643),u=s(7950),p=s(5475),h=(s(2660),s(411)),j=s(1806),x=s(8818),v=s(3204),g=s(579);const N=()=>{const e=(0,n.useRef)(null);if(null===e.current){const a=localStorage.getItem("user");e.current=a?JSON.parse(a):null}const a=e.current,[s]=(0,n.useState)((null===a||void 0===a?void 0:a.name)||""),[N]=(0,n.useState)((null===a||void 0===a?void 0:a.role)||""),[b,f]=(0,n.useState)(!1),[y,w]=(0,n.useState)([]),[C,S]=(0,n.useState)([]),[A,k]=(0,n.useState)([]),[D,P]=(0,n.useState)({}),[q,L]=(0,n.useState)(!0),[R,_]=(0,n.useState)([]),[M,F]=(0,n.useState)(!0),[E,T]=(0,n.useState)(null),[O,I]=(0,n.useState)([]),[B,U]=(0,n.useState)(!0),[z,W]=(0,n.useState)(!1),[V,H]=(0,n.useState)(null),[K,X]=(0,n.useState)(""),[J,Z]=(0,n.useState)(""),[G,Q]=(0,n.useState)("");(0,n.useEffect)((()=>{let e=!0;const a=new AbortController;return(async()=>{try{const[s,n,r]=await Promise.all([h.Ay.get("/locations",{signal:a.signal}),h.Ay.get("/projects",{signal:a.signal}),h.Ay.get("/requests",{signal:a.signal})]);if(!e)return;const i=Array.isArray(s.data)?s.data:[],l=Array.isArray(n.data)?n.data:[],c=Array.isArray(r.data)?r.data:[];w(i),S(l),_(c),F(!1),T(null);const o=l.map((e=>{var a,s;const n="object"===typeof e.location&&null!==(a=e.location)&&void 0!==a&&a.name?e.location:i.find((a=>{var s;return a._id===((null===(s=e.location)||void 0===s?void 0:s._id)||e.location)}));return(0,t.A)((0,t.A)({},e),{},{location:n?(0,t.A)({},n):{name:"Unknown Location",region:""},name:e.projectName,engineer:(null===(s=e.projectmanager)||void 0===s?void 0:s.name)||"Not Assigned"})}));k(o)}catch(s){if(!e)return;T("Error loading data")}finally{e&&L(!1)}})(),()=>{e=!1,a.abort()}}),[]),(0,n.useEffect)((()=>{if(!A.length)return void I([]);let e=!1;U(!0);return(async()=>{const a=await Promise.all(A.map((async e=>{try{var a;const i=Array.isArray(e.pic)?e.pic.length:0;let d=0,m=0,u=i,p=null,j=[],x="";try{const{data:a}=await h.Ay.get("/projects/".concat(e._id,"/reports")),t=(null===a||void 0===a?void 0:a.reports)||[];if(t.length){var s;const e=[...t].sort(((e,a)=>new Date(a.uploadedAt||0)-new Date(e.uploadedAt||0)));p=(null===(s=e[0])||void 0===s?void 0:s.uploadedAt)||null;const a=new Map;for(const s of e){const e=s.uploadedBy||s.uploadedByName||s._id;a.has(e)||a.set(e,s)}const n=[...a.values()];let r=n.map((e=>{const a=(null===e||void 0===e?void 0:e.ai)||{},s=a.pic_contribution_percent_raw,t=a.pic_contribution_percent;let n=null;if(void 0!==s&&null!==s){const e="string"===typeof s?parseFloat(s.toString().replace(/[^0-9.]+/g,"")):Number(s);isFinite(e)&&(n=e)}else if(void 0!==t&&null!==t){const e="string"===typeof t?parseFloat(t.toString().replace(/[^0-9.]+/g,"")):Number(t);isFinite(e)&&(n=e)}return n})).filter((e=>null!==e&&e>=0&&e<=100));if(r.length){const e=r.reduce(((e,a)=>e+a),0);d=i>0?e/i:0}m=n.length,u=i>0?Math.max(0,i-m):0,j=n.map((e=>{const a=(null===e||void 0===e?void 0:e.ai)||{},s=a.pic_contribution_percent_raw,t=a.pic_contribution_percent;let n=0;if(void 0!==s&&null!==s){const e="string"===typeof s?parseFloat(s.toString().replace(/[^0-9.]+/g,"")):Number(s);isFinite(e)&&(n=e)}else if(void 0!==t&&null!==t){const e="string"===typeof t?parseFloat(t.toString().replace(/[^0-9.]+/g,"")):Number(t);isFinite(e)&&(n=e)}return{picId:e.uploadedBy||e._id,picName:e.uploadedByName||"Unknown",contribution:Math.round(n),hasReport:!0,lastReportDate:e.uploadedAt||null}}));for(const s of n){const e=null===s||void 0===s?void 0:s.ai,a=(Array.isArray(null===e||void 0===e?void 0:e.critical_path_analysis)?e.critical_path_analysis:[]).find((e=>"realistic"===((null===e||void 0===e?void 0:e.path_type)||"").toLowerCase()));if(x=((null===a||void 0===a?void 0:a.risk)||(null===e||void 0===e?void 0:e.risk)||"").toString(),x)break}}}catch(l){}if(0===d)try{const{data:a}=await h.Ay.get("/daily-reports/project/".concat(e._id,"/pic-contributions"));if(a){var t;if(!p){const e=(a.picContributions||[]).filter((e=>e.lastReportDate)).map((e=>new Date(e.lastReportDate))).sort(((e,a)=>a-e))[0];p=e?e.toISOString():p}a.averageContribution&&(d=a.averageContribution),m||(m=a.reportingPics||0),i&&u===i&&(u=null!==(t=a.pendingPics)&&void 0!==t?t:u),j.length||(j=a.picContributions||[])}}catch(c){}if(0===Math.round(d)&&0===m)try{var n,r;const{data:a}=await h.Ay.get("/daily-reports/project/".concat(e._id,"/progress")),s=Array.isArray(null===a||void 0===a?void 0:a.progress)?a.progress:[],t=(null===(n=s.find((e=>/completed/i.test(e.name))))||void 0===n?void 0:n.value)||0,i=(null===(r=s.find((e=>/in progress/i.test(e.name))))||void 0===r?void 0:r.value)||0,l=Math.round(Math.min(100,Math.max(0,t+.5*i)));l>0&&(d=l)}catch(o){}let v="ontrack";u>0&&i>1?v="pending":d<50&&(v="regressing");const g=p?new Date(p):null;g&&Date.now()-g.getTime()>2592e5&&(v="stale");const N=(j||[]).map((e=>e.hasReport?e.picName:"".concat(e.picName," (pending)")));return{projectId:e._id,projectName:e.name,pm:e.engineer,area:(null===(a=e.location)||void 0===a?void 0:a.name)||"Unknown Area",progressPrecise:Number(d.toFixed(2)),progress:Math.round(d),totalPics:i,latestDate:g,status:v,waitingForAll:u>0&&i>1,picNames:N,aiRisk:x,reportingPics:m,pendingPics:u,picContributions:j}}catch(d){var i;return{projectId:e._id,projectName:e.name,pm:e.engineer,area:(null===(i=e.location)||void 0===i?void 0:i.name)||"Unknown Area",progressPrecise:0,progress:0,totalPics:0,latestDate:null,status:"stale",waitingForAll:!1,picNames:[],picContributions:[]}}})));a.sort(((e,a)=>e.latestDate||a.latestDate?e.latestDate?a.latestDate?new Date(a.latestDate)-new Date(e.latestDate):-1:1:0)),e||(I(a),U(!1))})(),()=>{e=!0}}),[A]),(0,n.useEffect)((()=>{const e=e=>{var a;const s=null===e||void 0===e||null===(a=e.detail)||void 0===a?void 0:a.projectId;if(!s)return;const n=A.find((e=>String(e._id)===String(s)));n&&(async()=>{try{const a=Array.isArray(n.pic)?n.pic.length:0;let r=0,i=0,l=a,c=null,o=[];const{data:d}=await h.Ay.get("/projects/".concat(s,"/reports")),m=(null===d||void 0===d?void 0:d.reports)||[];if(m.length){var e;const s=[...m].sort(((e,a)=>new Date(a.uploadedAt||0)-new Date(e.uploadedAt||0)));c=(null===(e=s[0])||void 0===e?void 0:e.uploadedAt)||null;const t=new Map;for(const e of s){const a=e.uploadedBy||e.uploadedByName||e._id;t.has(a)||t.set(a,e)}const n=[...t.values()],d=n.map((e=>{const a=e.ai||{},s=Number(a.pic_contribution_percent_raw),t=Number(a.pic_contribution_percent);return isFinite(s)&&s>=0?s:isFinite(t)&&t>=0?t:0})).filter((e=>isFinite(e)&&e>=0));if(d.length){const e=d.reduce(((e,a)=>e+a),0);r=a>0?e/a:0}i=n.length,l=a>0?Math.max(0,a-i):0,o=n.map((e=>{const a=e.ai||{},s=Number(a.pic_contribution_percent_raw),t=Number(a.pic_contribution_percent),n=isFinite(s)&&s>=0?s:isFinite(t)&&t>=0?t:0;return{picId:e.uploadedBy||e._id,picName:e.uploadedByName||"Unknown",contribution:Math.round(n),hasReport:!0,lastReportDate:e.uploadedAt||null}}))}I((e=>e.map((e=>e.projectId===s?(0,t.A)((0,t.A)({},e),{},{progressPrecise:Number(r.toFixed(2)),progress:Math.round(r),reportingPics:i,pendingPics:l,latestDate:c?new Date(c):null,picContributions:o}):e))))}catch(a){}})()};return window.addEventListener("projectReportsUpdated",e),()=>window.removeEventListener("projectReportsUpdated",e)}),[A,I]);const Y=()=>f((e=>!e)),$=A.reduce(((e,a)=>{var s;const t=String(a.status||"").toLowerCase();if("completed"===t||/\bcompleted\b/.test(t))return e;const n=(null===(s=a.location)||void 0===s?void 0:s._id)||"unknown";var r,i;e[n]||(e[n]={name:(null===(r=a.location)||void 0===r?void 0:r.name)||"Unknown Location",region:(null===(i=a.location)||void 0===i?void 0:i.region)||"",projects:[]});return e[n].projects.push(a),e}),{}),ee=Object.values($).reduce(((e,a)=>e+a.projects.length),0),ae=(V?O.filter((e=>(e.area||"Unknown Area")===V)):O).filter((e=>!J||e.status===J)).filter((e=>!K||e.projectName.toLowerCase().includes(K.toLowerCase())||(e.area||"").toLowerCase().includes(K.toLowerCase())));O.filter((e=>"stale"===e.status||e.waitingForAll)).slice(0,5),O.slice().sort(((e,a)=>new Date(a.latestDate||0)-new Date(e.latestDate||0))).slice(0,5),O.map((e=>(0,t.A)((0,t.A)({},e),{},{age:e.latestDate?Math.floor((Date.now()-new Date(e.latestDate).getTime())/864e5):null}))).sort(((e,a)=>(a.age||0)-(e.age||0))).slice(0,5),O.slice().sort(((e,a)=>(a.progress||0)-(e.progress||0))).slice(0,5);return q?(0,g.jsxs)("div",{className:"loading-container",children:[(0,g.jsx)("div",{className:"loading-spinner"}),(0,g.jsx)("p",{children:"Loading dashboard data..."})]}):(0,g.jsxs)("div",{className:"ceo-dashboard dashboard-container",children:[(0,g.jsx)(x.A,{roleSegment:"ceo",extraLeft:(0,g.jsx)("button",{className:"sidebar-toggle-btn ceo-header-toggle",onClick:Y,"aria-label":b?"Close areas & projects panel":"Open areas & projects panel",children:(0,g.jsx)(v.OXb,{})})}),(0,g.jsxs)("main",{className:"dashboard-main",children:[(0,u.createPortal)((0,g.jsxs)("aside",{className:"areas-projects-sidebar ceo-sidepanel ".concat(b?"open":""),"aria-label":"Areas and Projects",role:"complementary",children:[(0,g.jsxs)("div",{className:"sidepanel-header",children:[(0,g.jsx)("button",{className:"icon-btn ghost",onClick:Y,"aria-label":"Close sidebar",children:(0,g.jsx)(v._Jj,{})}),(0,g.jsx)("h3",{className:"panel-title",children:"Areas & Projects"}),(0,g.jsx)("button",{className:"icon-btn primary",onClick:()=>W(!0),children:"Add"})]}),(0,g.jsx)("div",{className:"sidepanel-search-row",children:(0,g.jsx)("input",{type:"text",className:"sidepanel-search",placeholder:"Search area or region...",value:G,onChange:e=>Q(e.target.value)})}),(0,g.jsx)("div",{className:"sidepanel-scroll",children:0===Object.keys($).length?(0,g.jsxs)("div",{className:"empty-state small pad-1rem",children:[(0,g.jsx)("span",{children:"No areas or projects found"}),(0,g.jsx)("p",{children:"Projects will appear here once available."})]}):Object.entries($).filter((e=>{let[,a]=e;return!G||a.name.toLowerCase().includes(G.toLowerCase())||a.region.toLowerCase().includes(G.toLowerCase())})).map((e=>{let[a,s]=e;const n=!!D[a];return(0,g.jsxs)("div",{className:"area-block ".concat(n?"expanded":""),children:[(0,g.jsxs)("button",{className:"area-summary",onClick:()=>P((e=>(0,t.A)((0,t.A)({},e),{},{[a]:!e[a]}))),"aria-expanded":n,children:[(0,g.jsx)("span",{className:"marker",children:(0,g.jsx)(v.vq8,{})}),(0,g.jsxs)("span",{className:"area-texts",children:[(0,g.jsx)("span",{className:"area-name",children:s.name}),(0,g.jsx)("span",{className:"area-region",children:s.region})]}),(0,g.jsx)("span",{className:"count-pill",title:"Projects",children:s.projects.length}),(0,g.jsx)("span",{className:"chevron",children:n?(0,g.jsx)(v.Ucs,{}):(0,g.jsx)(v.Vr3,{})})]}),n&&(0,g.jsx)("div",{className:"projects-collapsible",children:s.projects.map((e=>(0,g.jsxs)(p.N_,{to:"/ceo/proj/".concat(e._id),className:"project-link",onClick:Y,children:[(0,g.jsx)(v.yd7,{className:"pj-ic"}),(0,g.jsx)("span",{className:"pj-name",title:e.name,children:e.name}),(0,g.jsx)("span",{className:"pj-pm",title:e.engineer,children:e.engineer}),(0,g.jsx)(v.Z0P,{className:"arrow"})]},e._id)))})]},a)}))}),(0,g.jsx)("div",{className:"sidepanel-footer",children:(0,g.jsxs)("span",{children:[ee," ongoing projects"]})})]}),document.body),b&&(0,u.createPortal)((0,g.jsx)("div",{className:"sidebar-overlay",onClick:Y,style:{zIndex:2e4}}),document.body),(0,g.jsxs)("div",{className:"dashboard-content ceo-content",children:[(0,g.jsxs)("div",{className:"dashboard-card ceo-welcome-card ceo-welcome",children:[(0,g.jsxs)("div",{className:"welcome-content",children:[(0,g.jsxs)("h2",{className:"welcome-title",children:["Welcome back, ",s,"! \ud83d\udc4b"]}),(0,g.jsx)("p",{className:"welcome-subtitle",children:"Here's the status of all company projects"})]}),(0,g.jsx)("div",{className:"welcome-stats",children:(()=>{const e=C.length,a=C.filter((e=>{const a=String(e.status||"").toLowerCase();return"ongoing"===a||"active"===a||"in progress"===a})).length,s=C.filter((e=>"completed"===String(e.status||"").toLowerCase())).length;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(p.N_,{to:"/ceo/proj",className:"stat-item stat-link no-decoration inherit-color","aria-label":"View all projects",children:[(0,g.jsx)("span",{className:"stat-number",children:e}),(0,g.jsx)("span",{className:"stat-label",children:"Total Projects"})]}),(0,g.jsxs)(p.N_,{to:"/ceo/proj?status=ongoing",className:"stat-item stat-link no-decoration inherit-color","aria-label":"View ongoing projects",children:[(0,g.jsx)("span",{className:"stat-number",children:a}),(0,g.jsx)("span",{className:"stat-label",children:"Ongoing"})]}),(0,g.jsxs)(p.N_,{to:"/ceo/proj?status=completed",className:"stat-item stat-link no-decoration inherit-color","aria-label":"View completed projects",children:[(0,g.jsx)("span",{className:"stat-number",children:s}),(0,g.jsx)("span",{className:"stat-label",children:"Completed"})]}),(0,g.jsxs)(p.N_,{to:"/ceo/material-list",className:"stat-item stat-link no-decoration inherit-color","aria-label":"View material requests",children:[(0,g.jsx)("span",{className:"stat-number",children:R.length}),(0,g.jsx)("span",{className:"stat-label",children:" Material Requests"})]})]})})()}),(0,g.jsxs)("div",{className:"kpi-strip",children:[(0,g.jsxs)(p.N_,{to:"/ceo/material-list",className:"kpi","aria-label":"Pending material requests",children:[(0,g.jsx)("div",{className:"kpi-ico",children:(0,g.jsx)(v.H5e,{})}),(0,g.jsxs)("div",{className:"kpi-body",children:[(0,g.jsx)("div",{className:"kpi-title",children:"Pending Requests"}),(0,g.jsx)("div",{className:"kpi-value",children:R.filter((e=>/pending/i.test(String(e.status||"")))).length})]})]}),(0,g.jsxs)(p.N_,{to:"/ceo/proj",className:"kpi","aria-label":"Active projects",children:[(0,g.jsx)("div",{className:"kpi-ico",children:(0,g.jsx)(v.yd7,{})}),(0,g.jsxs)("div",{className:"kpi-body",children:[(0,g.jsx)("div",{className:"kpi-title",children:"Active Projects"}),(0,g.jsx)("div",{className:"kpi-value",children:C.filter((e=>/ongoing|active|in progress/i.test(String(e.status||"")))).length})]})]}),(0,g.jsxs)("div",{className:"kpi","aria-label":"Avg. progress",children:[(0,g.jsx)("div",{className:"kpi-ico",children:(0,g.jsx)(v.v$b,{})}),(0,g.jsxs)("div",{className:"kpi-body",children:[(0,g.jsx)("div",{className:"kpi-title",children:"Avg. Progress"}),(0,g.jsxs)("div",{className:"kpi-value",children:[Math.round(ae.reduce(((e,a)=>e+(a.progress||0)),0)/(ae.length||1)),"%"]})]})]})]}),(0,g.jsx)("div",{className:"hero-art","aria-hidden":"true",style:{backgroundImage:"radial-gradient(ellipse at 65% 35%, rgba(255,255,255,0.18), transparent 55%), url(".concat("","/images/illustration-construction-site.png)")}})]}),(0,g.jsx)("div",{className:"dashboard-grid single-col",children:(0,g.jsxs)("div",{className:"dashboard-card ceo-project-metrics-card",children:[(0,g.jsxs)("div",{className:"card-header ceo-metrics-header",children:[(0,g.jsx)("h3",{children:"Project Progress"}),(0,g.jsxs)("div",{className:"metrics-filters-row",children:[(0,g.jsx)("span",{className:"metrics-subtitle subtle-text",children:"Based on latest PIC reports"}),(0,g.jsx)("input",{type:"text",placeholder:"Search projects or area...",value:K,onChange:e=>X(e.target.value),className:"input text-input","aria-label":"Search projects or by area name"}),(0,g.jsxs)("select",{value:J,onChange:e=>Z(e.target.value),className:"input select-input",children:[(0,g.jsx)("option",{value:"",children:"All statuses"}),(0,g.jsx)("option",{value:"ontrack",children:"On Track"}),(0,g.jsx)("option",{value:"regressing",children:"Regressing"}),(0,g.jsx)("option",{value:"stale",children:"Stale"}),(0,g.jsx)("option",{value:"pending",children:"Pending"})]})]})]}),(0,g.jsx)("div",{className:"project-metrics-container",children:B?(0,g.jsxs)("div",{className:"metrics-loading fade-in",children:[(0,g.jsx)("div",{className:"loading-spinner"}),(0,g.jsx)("span",{children:"Loading project metrics..."})]}):0===ae.length?(0,g.jsxs)("div",{className:"metrics-empty fade-in",children:[(0,g.jsx)(v.v$b,{}),(0,g.jsx)("span",{children:"No project metrics available"}),(0,g.jsx)("p",{children:"Reports need to be submitted to see progress"})]}):(0,g.jsxs)("div",{className:"project-metrics-scroll",children:[V&&(0,g.jsxs)("div",{className:"active-filter-pill",children:["Filter: ",(0,g.jsx)("b",{children:V})," ",(0,g.jsx)("button",{onClick:()=>H(null),className:"btn-light-xs",children:"Clear"})]}),ae.map((e=>{var a,s;return(0,g.jsxs)(p.N_,{to:"/ceo/proj/".concat(e.projectId),className:"project-metric-item metric-card metric-card-link",children:[(0,g.jsxs)("div",{className:"metric-header",children:[(0,g.jsxs)("div",{className:"metric-project-info",children:[(0,g.jsx)("h4",{className:"metric-project-name",children:e.projectName}),(0,g.jsxs)("p",{className:"metric-project-details",children:[(0,g.jsx)("span",{className:"metric-pm",children:e.pm}),(0,g.jsx)("span",{className:"metric-area",children:e.area})]})]}),(0,g.jsx)("div",{className:"metric-progress-circle",children:(0,g.jsxs)("div",{className:"progress-ring",children:[(0,g.jsxs)("svg",{width:"60",height:"60",children:[(0,g.jsx)("circle",{cx:"30",cy:"30",r:"25",stroke:"#e2e8f0",strokeWidth:"4",fill:"transparent"}),(0,g.jsx)("circle",{cx:"30",cy:"30",r:"25",stroke:e.progress>=80?"#10B981":e.progress>=50?"#3B82F6":"#F59E0B",strokeWidth:"4",fill:"transparent",strokeDasharray:"".concat(2*Math.PI*25),strokeDashoffset:"".concat(2*Math.PI*25*(1-(null!==(a=e.progressPrecise)&&void 0!==a?a:e.progress)/100)),strokeLinecap:"round",transform:"rotate(-90 30 30)"})]}),(0,g.jsx)("div",{className:"progress-text",title:"".concat((null===(s=e.progressPrecise)||void 0===s?void 0:s.toFixed(2))||e.progress,"% exact"),children:(0,g.jsxs)("span",{className:"progress-percentage",children:[e.progress,"%"]})})]})})]}),(0,g.jsxs)("div",{className:"metric-footer",children:[(0,g.jsxs)("div",{className:"metric-stats",children:[(0,g.jsxs)("span",{className:"metric-stat",children:[(0,g.jsx)(v.YXz,{}),e.totalPics," PICs"]}),(0,g.jsxs)("span",{className:"metric-stat",children:[(0,g.jsx)(v.bfZ,{}),e.latestDate?new Date(e.latestDate).toLocaleDateString():"No reports"]}),(0,g.jsx)("span",{className:"metric-status status-".concat(e.status),children:e.waitingForAll?"Waiting for all PICs":"ontrack"===e.status?"On Track":"regressing"===e.status?"Regressing":"stale"===e.status?"Stale":"Pending"})]}),(0,g.jsxs)("div",{className:"metric-badges",style:{marginTop:8,display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(90px,1fr))",gap:6,fontSize:11},children:[(0,g.jsxs)("div",{style:{background:"#f1f5f9",padding:"6px 8px",borderRadius:6,display:"flex",flexDirection:"column",gap:2},children:[(0,g.jsx)("span",{style:{opacity:.6},children:"Progress"}),(0,g.jsxs)("strong",{children:[e.progress,"%"]})]}),(0,g.jsxs)("div",{style:{background:"#f1f5f9",padding:"6px 8px",borderRadius:6,display:"flex",flexDirection:"column",gap:2},children:[(0,g.jsx)("span",{style:{opacity:.6},children:"Reported"}),(0,g.jsxs)("strong",{children:[e.reportingPics,"/",e.totalPics||0]})]}),(0,g.jsxs)("div",{style:{background:"#f1f5f9",padding:"6px 8px",borderRadius:6,display:"flex",flexDirection:"column",gap:2},children:[(0,g.jsx)("span",{style:{opacity:.6},children:"Pending PICs"}),(0,g.jsx)("strong",{children:e.pendingPics})]}),(0,g.jsxs)("div",{style:{background:"#f1f5f9",padding:"6px 8px",borderRadius:6,display:"flex",flexDirection:"column",gap:2},children:[(0,g.jsx)("span",{style:{opacity:.6},children:"Status"}),(0,g.jsx)("strong",{style:{textTransform:"capitalize"},children:e.waitingForAll?"Waiting":e.status})]}),(0,g.jsxs)("div",{style:{background:"#f1f5f9",padding:"6px 8px",borderRadius:6,display:"flex",flexDirection:"column",gap:2},children:[(0,g.jsx)("span",{style:{opacity:.6},children:"Last Report"}),(0,g.jsx)("strong",{children:e.latestDate?new Date(e.latestDate).toLocaleDateString():"\u2014"})]})]}),(0,g.jsx)("div",{className:"metric-mini-chart",style:{marginTop:10,background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:8,padding:"4px 6px"},children:(()=>{const a=(e.picContributions||[]).filter((e=>e.hasReport)).map((e=>({name:e.picName.length>6?e.picName.slice(0,6)+"\u2026":e.picName,value:e.contribution||0})));return a.length?(0,g.jsx)(r.u,{width:"100%",height:90,children:(0,g.jsxs)(i.E,{data:a,margin:{top:4,right:4,left:0,bottom:0},children:[(0,g.jsx)(l.d,{strokeDasharray:"3 3",vertical:!1,stroke:"#e2e8f0"}),(0,g.jsx)(c.W,{dataKey:"name",tick:{fontSize:9},axisLine:!1,tickLine:!1}),(0,g.jsx)(o.h,{hide:!0,domain:[0,100]}),(0,g.jsx)(d.m,{cursor:{fill:"rgba(0,0,0,0.04)"},formatter:e=>[e+"%","Contribution"]}),(0,g.jsx)(m.y,{dataKey:"value",radius:[4,4,0,0],fill:"#3B82F6"})]})}):(0,g.jsx)("div",{style:{fontSize:11,opacity:.6,textAlign:"center",padding:"6px 0"},children:"No PIC reports yet"})})()})]})]},e.projectId)}))]})})]})}),(0,g.jsxs)("div",{className:"dashboard-grid two-col compact-row",children:[(0,g.jsxs)("div",{className:"dashboard-card material-requests-card stretch-card",children:[(0,g.jsxs)("div",{className:"card-header",children:[(0,g.jsx)("h3",{children:"Material Request Tracking"}),(0,g.jsx)(p.N_,{to:"/ceo/material-list",className:"inline-link",children:"View All \u2192"})]}),(0,g.jsxs)("div",{className:"card-body compact-padding",children:[(0,g.jsx)("div",{className:"helper-row",children:(0,g.jsx)("span",{className:"helper-text",children:"\ud83d\udccb Quick access to material request management"})}),M?(0,g.jsx)("div",{className:"muted",children:"Loading material requests..."}):0===R.length?(0,g.jsx)("div",{className:"muted",children:"No material requests found"}):(0,g.jsxs)("div",{className:"mr-list-wrapper",children:[(0,g.jsx)("div",{className:"mr-list-label",children:"Recent Requests with Tracking:"}),(0,g.jsx)("div",{className:"mr-items",children:R.slice(0,3).map((e=>{var a,s,t,n,r,i,l,c,o,d,m,u,h,j,x,v,N,b,f;const y=Array.isArray(e.approvals)?e.approvals:[],w=y.find((e=>/project manager/i.test(e.role)&&"approved"===e.decision)),C=y.find((e=>/area manager/i.test(e.role)&&"approved"===e.decision)),S=null===w||void 0===w?void 0:w.timestamp,A=null===C||void 0===C?void 0:C.timestamp;return(0,g.jsxs)(p.N_,{to:"/ceo/material-request/".concat(e._id),className:"mr-item mr-item-link",children:[(0,g.jsxs)("div",{className:"mr-item-head",children:[(0,g.jsxs)("span",{className:"mr-item-title",children:[(null===(a=e.description)||void 0===a?void 0:a.substring(0,40))||"No description","..."]}),(0,g.jsx)("span",{className:"status-chip ".concat(null!==(s=e.status)&&void 0!==s&&s.includes("approved")?"status-approved":null!==(t=e.status)&&void 0!==t&&t.includes("denied")?"status-denied":"status-pending"),children:e.status||"Pending"})]}),(0,g.jsxs)("div",{className:"mr-tracking",children:[(0,g.jsx)("div",{className:"mr-tracking-label",children:"Tracking Progress:"}),(0,g.jsxs)("div",{className:"mr-tracking-rail",children:[(0,g.jsxs)("div",{className:"track-stage completed",children:[(0,g.jsx)("div",{className:"stage-icon",children:"\u2713"}),(0,g.jsx)("span",{className:"stage-label",children:"Placed"}),(0,g.jsx)("span",{className:"stage-status success",children:"Completed"}),(0,g.jsx)("span",{className:"stage-date",children:new Date(e.createdAt).toLocaleDateString()})]}),(0,g.jsx)("div",{className:"track-connector completed"}),(0,g.jsxs)("div",{className:"track-stage ".concat(S?"completed":null!==(n=e.status)&&void 0!==n&&n.includes("Denied by Project Manager")?"rejected":"pending"),children:[(0,g.jsx)("div",{className:"stage-icon",children:S?"\u2713":null!==(r=e.status)&&void 0!==r&&r.includes("Denied by Project Manager")?"\u2717":"\u25cb"}),(0,g.jsx)("span",{className:"stage-label",children:"Project Manager"}),(0,g.jsx)("span",{className:"stage-status ".concat(S?"success":null!==(i=e.status)&&void 0!==i&&i.includes("Denied by Project Manager")?"error":"pending"),children:S?"Approved":null!==(l=e.status)&&void 0!==l&&l.includes("Denied by Project Manager")?"Rejected":"Pending"}),(0,g.jsx)("span",{className:"stage-date",children:S?new Date(S).toLocaleDateString():"N/A"})]}),(0,g.jsx)("div",{className:"track-connector ".concat(!(null!==(c=e.status)&&void 0!==c&&c.includes("pm")||null!==(o=e.status)&&void 0!==o&&o.includes("project manager"))||null!==(d=e.status)&&void 0!==d&&d.includes("denied")?"":"completed")}),(0,g.jsxs)("div",{className:"track-stage ".concat(A?"completed":null!==(m=e.status)&&void 0!==m&&m.includes("Denied by Area Manager")?"rejected":"pending"),children:[(0,g.jsx)("div",{className:"stage-icon",children:A?"\u2713":null!==(u=e.status)&&void 0!==u&&u.includes("Denied by Area Manager")?"\u2717":"\u25cb"}),(0,g.jsx)("span",{className:"stage-label",children:"Area Manager"}),(0,g.jsx)("span",{className:"stage-status ".concat(A?"success":null!==(h=e.status)&&void 0!==h&&h.includes("Denied by Area Manager")?"error":"pending"),children:A?"Approved":null!==(j=e.status)&&void 0!==j&&j.includes("Denied by Area Manager")?"Rejected":"Pending"}),(0,g.jsx)("span",{className:"stage-date",children:A?new Date(A).toLocaleDateString():"N/A"})]}),(0,g.jsx)("div",{className:"track-connector ".concat(!(null!==(x=e.status)&&void 0!==x&&x.includes("am")||null!==(v=e.status)&&void 0!==v&&v.includes("area manager"))||null!==(N=e.status)&&void 0!==N&&N.includes("denied")?"":"completed")}),(0,g.jsxs)("div",{className:"track-stage ".concat(e.receivedByPIC?"completed":"pending"),children:[(0,g.jsx)("div",{className:"stage-icon",children:e.receivedByPIC?"\u2713":"\u25cb"}),(0,g.jsx)("span",{className:"stage-label",children:"Received"}),(0,g.jsx)("span",{className:"stage-status ".concat(e.receivedByPIC?"success":"pending"),children:e.receivedByPIC?"Received":"Pending"}),(0,g.jsx)("span",{className:"stage-date",children:e.receivedByPIC?new Date(e.receivedByPIC).toLocaleDateString():"N/A"})]})]})]}),(0,g.jsxs)("div",{className:"mr-meta muted",children:[(0,g.jsx)("span",{className:"strong",children:(null===(b=e.createdBy)||void 0===b?void 0:b.name)||"Unknown"})," \u2022 ",new Date(e.createdAt).toLocaleDateString(),(null===(f=e.project)||void 0===f?void 0:f.projectName)&&(0,g.jsxs)("span",{children:[" \u2022 Project: ",e.project.projectName]})]})]},e._id)}))})]})]})]}),(0,g.jsxs)("div",{className:"dashboard-card risks-card stretch-card",children:[(0,g.jsx)("div",{className:"card-header",children:(0,g.jsx)("h3",{children:"Top Risks from AI"})}),(()=>{const e=O.map((e=>({projectId:e.projectId,projectName:e.projectName,risk:(e.aiRisk||"").toString()}))).filter((e=>e.risk)).slice(0,10);return 0===e.length?(0,g.jsx)("div",{className:"muted pad-l",children:"No risks extracted from AI reports"}):(0,g.jsx)("ul",{className:"risk-list",children:e.map((e=>(0,g.jsxs)("li",{children:[(0,g.jsx)("b",{children:e.projectName})," \u2014 ",e.risk]},e.projectId)))})})()]})]})]})]}),z&&(0,g.jsx)("div",{className:"modal-overlay modal-centered",children:(0,g.jsx)("div",{className:"modal-content modal-standard ceo-narrow-modal",children:(0,g.jsx)(j.default,{onSuccess:()=>W(!1),onCancel:()=>W(!1)})})})]})}}}]);
//# sourceMappingURL=ceo.555efa94.chunk.js.map
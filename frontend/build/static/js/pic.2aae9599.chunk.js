"use strict";(self.webpackChunkfadz_web_frontend=self.webpackChunkfadz_web_frontend||[]).push([[889],{342:()=>{},1012:(e,a,t)=>{t.r(a),t.d(a,{default:()=>j});t(3986),t(816),t(9379);var s=t(5043),i=t(3216),n=t(5475),l=t(411),r=t(108),c=t(5748),d=t(7734),o=t(2185),m=t(6026),p=t(6150),u=t(168),h=(t(4947),t(4801),t(8818)),x=t(3204),v=t(579);const j=()=>{const e=(0,i.Zp)(),a=localStorage.getItem("token"),t=localStorage.getItem("user"),j=t?JSON.parse(t):null,g=null===j||void 0===j?void 0:j._id,[f,N]=(0,s.useState)([]),[b,y]=(0,s.useState)((null===j||void 0===j?void 0:j.name)||""),[w,S]=(0,s.useState)((null===j||void 0===j?void 0:j.role)||""),[k,q]=(0,s.useState)(null),[A,C]=(0,s.useState)(!1),[D,P]=(0,s.useState)(1),[M,R]=(0,s.useState)({}),[L,E]=(0,s.useState)(""),[I,B]=(0,s.useState)([]),[_,z]=(0,s.useState)([]),[O,T]=(0,s.useState)({});(0,s.useEffect)((()=>{const e=localStorage.getItem("nudgeCooldowns");if(e){const a=JSON.parse(e),t=Date.now(),s=Object.fromEntries(Object.entries(a).filter((e=>{let[a,s]=e;return s>t})));R(s)}}),[]),(0,s.useEffect)((()=>{localStorage.setItem("nudgeCooldowns",JSON.stringify(M))}),[M]);const W=5*D,U=W-5,F=(f.slice(U,W),Math.ceil(f.length/5),(e,a)=>{switch(a){case"placed":return"completed";case"pm":return["Pending AM","Approved","Received","PENDING AREA MANAGER"].includes(e)?"completed":"pending";case"am":return["Approved","Received"].includes(e)?"completed":"pending";case"done":return["Received"].includes(e)?"completed":"pending";default:return"pending"}});(0,s.useEffect)((()=>{a&&j?y(j.name):e("/")}),[e,a,j]);(0,s.useEffect)((()=>{if(!a||!g)return;(async()=>{try{const{data:e}=await l.Ay.get("/projects/by-user-status?userId=".concat(g,"&role=pic&status=Ongoing"));q(e[0]||null)}catch(e){q(null)}})()}),[a,g]),(0,s.useEffect)((()=>{a&&k&&l.Ay.get("/requests/mine",{headers:{Authorization:"Bearer ".concat(a)}}).then((e=>{let{data:a}=e;console.log("Fetched requests:",a);const t=Array.isArray(a)?a.filter((e=>e.project&&e.project._id===k._id)):[];console.log("Filtered project requests:",t),N(t)})).catch((e=>{console.error("Error fetching requests:",e),N([])}))}),[a,k]),(0,s.useEffect)((()=>{a&&k&&l.Ay.get("/projects/".concat(k._id,"/reports"),{headers:{Authorization:"Bearer ".concat(a)}}).then((e=>{let{data:a}=e;z((null===a||void 0===a?void 0:a.reports)||[])})).catch((()=>z([])))}),[a,k]),(0,s.useEffect)((()=>{const e=e=>{var t;String(null===e||void 0===e||null===(t=e.detail)||void 0===t?void 0:t.projectId)===String(null===k||void 0===k?void 0:k._id)&&a&&l.Ay.get("/projects/".concat(k._id,"/reports"),{headers:{Authorization:"Bearer ".concat(a)}}).then((e=>{let{data:a}=e;return z((null===a||void 0===a?void 0:a.reports)||[])})).catch((()=>{}))};return window.addEventListener("projectReportsUpdated",e),()=>window.removeEventListener("projectReportsUpdated",e)}),[null===k||void 0===k?void 0:k._id,a]);return(0,s.useEffect)((()=>{const e=e=>{e.target.closest(".profile-menu-container")||C(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[]),(0,v.jsxs)("div",{className:"pic-dashboard dashboard-container",children:[(0,v.jsx)(h.A,{roleSegment:"pic"}),(0,v.jsx)("main",{className:"dashboard-main",children:(0,v.jsxs)("div",{className:"dashboard-grid",children:[(0,v.jsxs)("div",{className:"dashboard-card pic-welcome-card",children:[(0,v.jsx)("div",{className:"hero-art","aria-hidden":"true",style:{backgroundImage:"radial-gradient(ellipse at 65% 35%, rgba(255,255,255,0.18), transparent 55%), url(".concat("","/images/illustration-construction-site.png)")}}),(0,v.jsxs)("div",{className:"welcome-content",children:[(0,v.jsxs)("h2",{className:"welcome-title",children:["Welcome back, ",b,"! \ud83d\udc4b"]}),(0,v.jsx)("p",{className:"welcome-subtitle",children:"Here's what's happening with your project today"})]}),(0,v.jsxs)("div",{className:"welcome-stats",children:[(0,v.jsx)(n.N_,{to:"/pic/projects",className:"stat-link",children:(0,v.jsxs)("div",{className:"stat-item",children:[(0,v.jsx)("div",{className:"stat-icon",children:(0,v.jsx)(x.yd7,{})}),(0,v.jsxs)("div",{className:"stat-content",children:[(0,v.jsx)("span",{className:"stat-value",children:k?1:0}),(0,v.jsx)("span",{className:"stat-label",children:"Active Project"})]})]})}),(0,v.jsx)(n.N_,{to:"/pic/requests",className:"stat-link",children:(0,v.jsxs)("div",{className:"stat-item",children:[(0,v.jsx)("div",{className:"stat-icon",children:(0,v.jsx)(x.H5e,{})}),(0,v.jsxs)("div",{className:"stat-content",children:[(0,v.jsx)("span",{className:"stat-value",children:f.length}),(0,v.jsx)("span",{className:"stat-label",children:"Material Requests"})]})]})})]}),(0,v.jsxs)("div",{className:"kpi-strip",children:[(0,v.jsxs)(n.N_,{to:"/pic/requests",className:"kpi",children:[(0,v.jsx)("div",{className:"kpi-ico",children:(0,v.jsx)(x.H5e,{})}),(0,v.jsxs)("div",{className:"kpi-body",children:[(0,v.jsx)("div",{className:"kpi-title",children:"Pending Requests"}),(0,v.jsx)("div",{className:"kpi-value",children:f.length})]})]}),(0,v.jsxs)(n.N_,{to:"/pic/projects",className:"kpi",children:[(0,v.jsx)("div",{className:"kpi-ico",children:(0,v.jsx)(x.yd7,{})}),(0,v.jsxs)("div",{className:"kpi-body",children:[(0,v.jsx)("div",{className:"kpi-title",children:"Active Project"}),(0,v.jsx)("div",{className:"kpi-value",children:k?1:0})]})]}),(0,v.jsxs)(n.N_,{to:"/pic/projects",className:"kpi",children:[(0,v.jsx)("div",{className:"kpi-ico",children:(0,v.jsx)(x.v$b,{})}),(0,v.jsxs)("div",{className:"kpi-body",children:[(0,v.jsx)("div",{className:"kpi-title",children:"Avg. Progress"}),(0,v.jsx)("div",{className:"kpi-value",children:_.length>0?"".concat(Math.round(_.reduce(((e,a)=>{var t;return e+((null===(t=a.ai)||void 0===t?void 0:t.pic_contribution_percent)||0)}),0)/_.length),"%"):"0%"})]})]})]})]}),k&&(0,v.jsxs)("div",{className:"dashboard-card chart-card",children:[(0,v.jsxs)("div",{className:"card-header",children:[(0,v.jsx)("h3",{className:"card-title",children:"Work Progress Trend"}),(0,v.jsxs)("div",{className:"card-subtitle",children:["Based on ",_.length," report",1!==_.length?"s":""]})]}),(0,v.jsx)("div",{className:"chart-container",children:_.length>0?(0,v.jsx)(r.u,{width:"100%",height:200,children:(0,v.jsxs)(c.b,{data:_.slice(0,6).reverse().map((e=>{var a,t,s,i,n;return{name:new Date(e.uploadedAt).toLocaleDateString("en-US",{month:"short",day:"numeric"}),completedTasks:(null===(a=e.ai)||void 0===a||null===(t=a.completed_tasks)||void 0===t?void 0:t.length)||0,workItems:(null===(s=e.ai)||void 0===s||null===(i=s.summary_of_work_done)||void 0===i?void 0:i.length)||0,contribution:(null===(n=e.ai)||void 0===n?void 0:n.pic_contribution_percent)||0}})),children:[(0,v.jsx)(d.d,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,v.jsx)(o.W,{dataKey:"name",tick:{fontSize:12}}),(0,v.jsx)(m.h,{tick:{fontSize:12}}),(0,v.jsx)(p.m,{contentStyle:{fontSize:12}}),(0,v.jsx)(u.N,{type:"monotone",dataKey:"completedTasks",stroke:"#10b981",strokeWidth:2,name:"Completed",dot:{r:3}}),(0,v.jsx)(u.N,{type:"monotone",dataKey:"workItems",stroke:"#3b82f6",strokeWidth:2,name:"Work Items",dot:{r:3}}),(0,v.jsx)(u.N,{type:"monotone",dataKey:"contribution",stroke:"#f59e0b",strokeWidth:2,name:"Contribution %",dot:{r:3}})]})}):(0,v.jsxs)("div",{className:"empty-state",children:[(0,v.jsx)(x.v$b,{}),(0,v.jsx)("span",{children:"No report data yet"}),(0,v.jsx)("p",{children:"Submit your first report to see progress trends"})]})})]}),!k&&(0,v.jsx)("div",{className:"dashboard-card no-project-card",children:(0,v.jsxs)("div",{className:"no-project-content",children:[(0,v.jsx)("div",{className:"no-project-icon",children:"\ud83d\udcca"}),(0,v.jsx)("h3",{className:"no-project-title",children:"No Active Project"}),(0,v.jsx)("p",{className:"no-project-description",children:"You don't have any active projects assigned at the moment. Check back later or contact your project manager for updates."}),(0,v.jsx)("div",{className:"no-project-actions",children:(0,v.jsxs)(n.N_,{to:"/pic/projects",className:"no-project-link",children:["View All Projects ",(0,v.jsx)(x.Z0P,{})]})})]})}),k&&(0,v.jsxs)("div",{className:"dashboard-card requests-card",children:[(0,v.jsxs)("div",{className:"card-header",children:[(0,v.jsx)("h3",{className:"card-title",children:"Material Requests"}),(0,v.jsxs)(n.N_,{to:"/pic/requests",className:"view-all-link",children:["View All ",(0,v.jsx)(x.Z0P,{})]})]}),(0,v.jsx)("div",{className:"requests-content",children:0===f.length?(0,v.jsxs)("div",{className:"empty-state",children:[(0,v.jsx)(x.H5e,{}),(0,v.jsx)("span",{children:"No material requests found"}),(0,v.jsx)("p",{children:"Create a new request to get started"})]}):(0,v.jsx)("div",{className:"requests-list",children:f.slice(0,3).map((e=>{var a,t,s;return(0,v.jsxs)(n.N_,{to:"/pic/material-request/".concat(e._id),className:"request-item-new-layout",style:{textDecoration:"none"},children:[(0,v.jsxs)("div",{className:"request-left-section",children:[(0,v.jsx)("div",{className:"request-icon-new",children:(0,v.jsx)(x.H5e,{})}),(0,v.jsxs)("div",{className:"request-details-new",children:[(0,v.jsx)("h4",{className:"request-title-new",children:null===(a=e.materials)||void 0===a?void 0:a.map((e=>"".concat(e.materialName," (").concat(e.quantity,")"))).join(", ")}),(0,v.jsxs)("div",{className:"request-meta-new",children:[(0,v.jsx)("span",{className:"request-project-new",children:null===(t=e.project)||void 0===t?void 0:t.projectName}),(0,v.jsx)("span",{className:"request-date-new",children:new Date(e.createdAt).toLocaleDateString()})]})]})]}),(0,v.jsx)("div",{className:"request-center-section",children:(0,v.jsxs)("div",{className:"tracking-timeline-new",children:[(0,v.jsxs)("div",{className:"timeline-step-new ".concat(F(e.status,"placed")),children:[(0,v.jsx)("div",{className:"timeline-icon-new",children:(0,v.jsx)(x.A7C,{})}),(0,v.jsx)("span",{className:"timeline-label-new",children:"Placed"})]}),(0,v.jsx)("div",{className:"timeline-connector-new ".concat(["Pending PM","Pending AM","Approved","Received","PENDING PROJECT MANAGER"].includes(e.status)?"completed":"")}),(0,v.jsxs)("div",{className:"timeline-step-new ".concat(F(e.status,"pm")),children:[(0,v.jsx)("div",{className:"timeline-icon-new",children:(0,v.jsx)(x.p7b,{})}),(0,v.jsx)("span",{className:"timeline-label-new",children:"PM"})]}),(0,v.jsx)("div",{className:"timeline-connector-new ".concat(["Pending AM","Approved","Received","PENDING AREA MANAGER"].includes(e.status)?"completed":"")}),(0,v.jsxs)("div",{className:"timeline-step-new ".concat(F(e.status,"am")),children:[(0,v.jsx)("div",{className:"timeline-icon-new",children:(0,v.jsx)(x.ymh,{})}),(0,v.jsx)("span",{className:"timeline-label-new",children:"AM"})]}),(0,v.jsx)("div",{className:"timeline-connector-new ".concat(["Approved","Received"].includes(e.status)?"completed":"")}),(0,v.jsxs)("div",{className:"timeline-step-new ".concat(F(e.status,"done")),children:[(0,v.jsx)("div",{className:"timeline-icon-new",children:(0,v.jsx)(x.A7C,{})}),(0,v.jsx)("span",{className:"timeline-label-new",children:"Done"})]})]})}),(0,v.jsx)("div",{className:"request-right-section",children:(0,v.jsx)("div",{className:"request-status-new",children:(0,v.jsx)("span",{className:"status-text-new ".concat(null===(s=e.status)||void 0===s?void 0:s.replace(/\s/g,"").toLowerCase()),children:e.status})})})]},e._id)}))})})]})]})})]})}},1838:()=>{},2124:(e,a,t)=>{t.r(a),t.d(a,{default:()=>o});var s=t(5043),i=t(3216),n=t(5475),l=t(411),r=(t(4801),t(8818)),c=(t(7508),t(579));const d=8;function o(){(0,i.Zp)();const e=localStorage.getItem("token"),a=JSON.parse(localStorage.getItem("user")||"{}"),t=null===a||void 0===a?void 0:a._id,[o,m]=(0,s.useState)(!1),[p,u]=(0,s.useState)(!1),[h,x]=(0,s.useState)([]),[v,j]=(0,s.useState)(!0),[g,f]=(0,s.useState)(""),[N,b]=(0,s.useState)("All"),[y,w]=(0,s.useState)(""),[S,k]=(0,s.useState)(1),[q,A]=(0,s.useState)(null),[C]=(0,s.useState)((null===a||void 0===a?void 0:a.role)||"Person in Charge");(0,s.useEffect)((()=>{if(!e)return f("Session expired. Please log in."),void j(!1);l.Ay.get("/requests/mine",{headers:{Authorization:"Bearer ".concat(e)}}).then((e=>{let{data:a}=e;const s=Array.isArray(a)?a.filter((e=>{var a;return String((null===(a=e.createdBy)||void 0===a?void 0:a._id)||e.createdBy)===String(t)})):[];x(s),f("")})).catch((()=>{x([]),f("Failed to load requests")})).finally((()=>j(!1)))}),[e,t]),(0,s.useEffect)((()=>{e&&t&&l.Ay.get("/projects/by-user-status?userId=".concat(t,"&role=pic&status=Ongoing")).then((e=>{let{data:a}=e;return A((null===a||void 0===a?void 0:a[0])||null)})).catch((()=>A(null)))}),[e,t]),(0,s.useEffect)((()=>{const e=e=>{e.target.closest(".user-profile")||m(!1)},a=()=>{const e=window.pageYOffset||document.documentElement.scrollTop;u(e>50)};return document.addEventListener("click",e),window.addEventListener("scroll",a),()=>{document.removeEventListener("click",e),window.removeEventListener("scroll",a)}}),[]);const D=(e,a)=>{const t=(e||"").toLowerCase();return a?"#0ea5e9":t.includes("approved")?"#10b981":t.includes("pending")?"#f59e0b":t.includes("denied")||t.includes("cancel")?"#ef4444":"#6b7280"},P=(e,a)=>{if(a)return"Completed";const t=(e||"").toLowerCase();return t.includes("approved")?"Approved":t.includes("pending")?"Pending":t.includes("denied")||t.includes("cancel")?"Rejected":"Unknown"},M=[...h.filter((e=>{var a,t;const s=(e.status||"").toLowerCase(),i=!!e.receivedByPIC,n="All"===N||"Pending"===N&&s.includes("pending")||"Approved"===N&&s.includes("approved")||"Cancelled"===N&&(s.includes("denied")||s.includes("cancel"))||"Completed"===N&&i,l=[(null===(a=e.materials)||void 0===a?void 0:a.map((e=>e.materialName)).join(", "))||"",e.description||"",(null===(t=e.project)||void 0===t?void 0:t.projectName)||""].join(" ").toLowerCase();return n&&l.includes(y.toLowerCase())}))].sort(((e,a)=>{const t=e.receivedByPIC?1:0,s=a.receivedByPIC?1:0;return t!==s?t-s:new Date(a.createdAt||0)-new Date(e.createdAt||0)})),R=Math.ceil(M.length/d),L=(S-1)*d,E=M.slice(L,L+d);return(0,c.jsxs)("div",{children:[(0,c.jsx)(r.A,{roleSegment:"pic"}),(0,c.jsxs)("div",{style:{padding:"1.1rem 1.6rem 0.4rem"},children:[(0,c.jsx)("h1",{style:{margin:"0 0 4px",fontSize:"1.08rem",fontWeight:600,color:"#1e293b"},children:"Material Requests"}),(0,c.jsx)("p",{style:{margin:0,fontSize:".72rem",letterSpacing:.2,color:"#64748b"},children:"Your submitted material requests"})]}),(0,c.jsx)("main",{className:"dashboard-main",children:(0,c.jsxs)("div",{className:"page-container",children:[(0,c.jsxs)("div",{className:"controls-bar",children:[(0,c.jsx)("div",{className:"filter-tabs",children:["All","Pending","Approved","Cancelled","Completed"].map((e=>(0,c.jsx)("button",{className:"filter-tab ".concat(N===e?"active":""),onClick:()=>b(e),children:e},e)))}),(0,c.jsxs)("div",{className:"search-sort-section",children:[(0,c.jsx)("div",{className:"search-wrapper",children:(0,c.jsx)("input",{className:"search-input",placeholder:"Search requests...",value:y,onChange:e=>w(e.target.value)})}),q&&(0,c.jsx)(n.N_,{to:"/pic/projects/".concat(q._id,"/request"),className:"view-details-btn",style:{background:"#2563eb",color:"#fff"},children:"+ New Request"})]})]}),(0,c.jsx)("div",{className:"requests-grid",children:v?(0,c.jsxs)("div",{className:"loading-state",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Loading material requests..."})]}):g?(0,c.jsx)("div",{className:"error-state",children:(0,c.jsx)("p",{children:g})}):0===E.length?(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)("div",{className:"empty-icon",children:"\ud83d\udce6"}),(0,c.jsx)("h3",{children:"No material requests"}),(0,c.jsx)("p",{children:"You have not submitted any requests yet."})]}):(0,c.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:E.map((e=>{var a,t,s,i,l,r,d,o,m,p,u,h,x,v,j,g,f,N,b,y,w,S,k,q,A,C,M,R,L,E,I,B;return(0,c.jsxs)("div",{style:{background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"6px",padding:"12px",fontSize:"13px"},children:[(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[(0,c.jsxs)("div",{style:{flex:1},children:[(0,c.jsx)("h3",{style:{margin:"0 0 4px 0",fontSize:"15px",fontWeight:"600",color:"#1f2937"},children:null!==(a=e.materials)&&void 0!==a&&a.length?e.materials.map((e=>"".concat(e.materialName," (").concat(e.quantity," ").concat(e.unit||"",")"))).join(", "):"Material Request"}),(0,c.jsx)("p",{style:{margin:"0 0 6px 0",color:"#6b7280",fontSize:"13px",lineHeight:"1.3"},children:e.description||"No description provided"})]}),(0,c.jsx)("span",{style:{background:D(e.status,e.receivedByPIC),color:"#ffffff",padding:"3px 10px",borderRadius:"10px",fontSize:"11px",fontWeight:"600",marginLeft:"10px"},children:P(e.status,e.receivedByPIC)})]}),(0,c.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,c.jsx)("div",{style:{fontSize:"12px",color:"#64748b",marginBottom:"4px",fontWeight:"500"},children:"Tracking Progress:"}),(0,c.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0px",background:"#ffffff",padding:"8px",borderRadius:"6px",border:"1px solid #e2e8f0"},children:[(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"3px",minWidth:"75px"},children:[(0,c.jsx)("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"12px",fontWeight:"bold"},children:"\u2713"}),(0,c.jsx)("span",{style:{fontSize:"10px",fontWeight:"600",color:"#1f2937",textAlign:"center"},children:"Placed"}),(0,c.jsx)("span",{style:{fontSize:"9px",color:"#10b981",fontWeight:"500"},children:"Done"}),(0,c.jsx)("span",{style:{fontSize:"8px",color:"#6b7280"},children:new Date(e.createdAt).toLocaleDateString()})]}),(0,c.jsx)("div",{style:{width:"16px",height:"2px",background:"linear-gradient(90deg, #10b981 0%, #d1fae5 100%)",margin:"0 3px"}}),(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"3px",minWidth:"75px"},children:[(0,c.jsx)("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:null!==(t=e.status)&&void 0!==t&&t.includes("pm")||null!==(s=e.status)&&void 0!==s&&s.includes("project manager")?null!==(i=e.status)&&void 0!==i&&i.includes("denied")?"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)":"linear-gradient(135deg, #10b981 0%, #059669 100%)":"linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"12px",fontWeight:"bold"},children:null!==(l=e.status)&&void 0!==l&&l.includes("pm")||null!==(r=e.status)&&void 0!==r&&r.includes("project manager")?null!==(d=e.status)&&void 0!==d&&d.includes("denied")?"\u2717":"\u2713":"\u25cb"}),(0,c.jsx)("span",{style:{fontSize:"10px",fontWeight:"600",color:"#1f2937",textAlign:"center"},children:"Project Manager"}),(0,c.jsx)("span",{style:{fontSize:"9px",color:null!==(o=e.status)&&void 0!==o&&o.includes("pm")||null!==(m=e.status)&&void 0!==m&&m.includes("project manager")?null!==(p=e.status)&&void 0!==p&&p.includes("denied")?"#ef4444":"#10b981":"#6b7280",fontWeight:"500"},children:null!==(u=e.status)&&void 0!==u&&u.includes("pm")||null!==(h=e.status)&&void 0!==h&&h.includes("project manager")?null!==(x=e.status)&&void 0!==x&&x.includes("denied")?"Rejected":"Approved":"Pending"}),(0,c.jsx)("span",{style:{fontSize:"8px",color:"#6b7280"},children:e.pmApprovedAt?new Date(e.pmApprovedAt).toLocaleDateString():"N/A"})]}),(0,c.jsx)("div",{style:{width:"16px",height:"2px",background:!(null!==(v=e.status)&&void 0!==v&&v.includes("pm")||null!==(j=e.status)&&void 0!==j&&j.includes("project manager"))||null!==(g=e.status)&&void 0!==g&&g.includes("denied")?"linear-gradient(90deg, #e5e7eb 0%, #f3f4f6 100%)":"linear-gradient(90deg, #10b981 0%, #d1fae5 100%)",margin:"0 3px"}}),(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"3px",minWidth:"75px"},children:[(0,c.jsx)("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:null!==(f=e.status)&&void 0!==f&&f.includes("am")||null!==(N=e.status)&&void 0!==N&&N.includes("area manager")?null!==(b=e.status)&&void 0!==b&&b.includes("denied")?"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)":"linear-gradient(135deg, #10b981 0%, #059669 100%)":"linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"12px",fontWeight:"bold"},children:null!==(y=e.status)&&void 0!==y&&y.includes("am")||null!==(w=e.status)&&void 0!==w&&w.includes("area manager")?null!==(S=e.status)&&void 0!==S&&S.includes("denied")?"\u2717":"\u2713":"\u25cb"}),(0,c.jsx)("span",{style:{fontSize:"10px",fontWeight:"600",color:"#1f2937",textAlign:"center"},children:"Area Manager"}),(0,c.jsx)("span",{style:{fontSize:"9px",color:null!==(k=e.status)&&void 0!==k&&k.includes("am")||null!==(q=e.status)&&void 0!==q&&q.includes("area manager")?null!==(A=e.status)&&void 0!==A&&A.includes("denied")?"#ef4444":"#10b981":"#6b7280",fontWeight:"500"},children:null!==(C=e.status)&&void 0!==C&&C.includes("am")||null!==(M=e.status)&&void 0!==M&&M.includes("area manager")?null!==(R=e.status)&&void 0!==R&&R.includes("denied")?"Rejected":"Approved":"Pending"}),(0,c.jsx)("span",{style:{fontSize:"8px",color:"#6b7280"},children:e.amApprovedAt?new Date(e.amApprovedAt).toLocaleDateString():"N/A"})]}),(0,c.jsx)("div",{style:{width:"16px",height:"2px",background:!(null!==(L=e.status)&&void 0!==L&&L.includes("am")||null!==(E=e.status)&&void 0!==E&&E.includes("area manager"))||null!==(I=e.status)&&void 0!==I&&I.includes("denied")?"linear-gradient(90deg, #e5e7eb 0%, #f3f4f6 100%)":"linear-gradient(90deg, #10b981 0%, #d1fae5 100%)",margin:"0 3px"}}),(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"3px",minWidth:"75px"},children:[(0,c.jsx)("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:e.receivedByPIC?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"12px",fontWeight:"bold"},children:e.receivedByPIC?"\u2713":"\u25cb"}),(0,c.jsx)("span",{style:{fontSize:"10px",fontWeight:"600",color:"#1f2937",textAlign:"center"},children:"Received"}),(0,c.jsx)("span",{style:{fontSize:"9px",color:e.receivedByPIC?"#10b981":"#6b7280",fontWeight:"500"},children:e.receivedByPIC?"Received":"Pending"}),(0,c.jsx)("span",{style:{fontSize:"8px",color:"#6b7280"},children:e.receivedByPIC?new Date(e.receivedByPIC).toLocaleDateString():"N/A"})]})]})]}),(0,c.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:(0,c.jsxs)("div",{style:{fontSize:"11px",color:"#64748b"},children:[(0,c.jsxs)("span",{style:{fontWeight:"500"},children:["Project: ",(null===(B=e.project)||void 0===B?void 0:B.projectName)||"-"]})," \u2022 ",new Date(e.createdAt).toLocaleDateString()]})}),(0,c.jsxs)("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[(0,c.jsx)(n.N_,{to:"/pic/material-request/".concat(e._id),className:"view-details-btn",children:"View Details"}),(0,c.jsx)(n.N_,{to:"/pic/material-request/edit/".concat(e._id),className:"edit-btn",style:{padding:"6px 12px",backgroundColor:"#3b82f6",color:"white",textDecoration:"none",borderRadius:"4px",fontSize:"11px",fontWeight:"500",transition:"all 0.2s ease",border:"none",cursor:"pointer"},onMouseEnter:e=>{e.target.style.backgroundColor="#2563eb"},onMouseLeave:e=>{e.target.style.backgroundColor="#3b82f6"},children:"Edit"})]})]},e._id)}))})}),M.length>0&&(0,c.jsxs)("div",{className:"pagination-section",children:[(0,c.jsxs)("div",{className:"pagination-info",children:["Showing ",L+1," to ",Math.min(L+d,M.length)," of ",M.length," entries"]}),(0,c.jsxs)("div",{className:"pagination-controls",children:[(0,c.jsx)("button",{className:"pagination-btn",disabled:1===S,onClick:()=>k((e=>Math.max(1,e-1))),children:"Previous"}),Array.from({length:R},((e,a)=>a+1)).map((e=>(0,c.jsx)("button",{className:"pagination-btn ".concat(S===e?"active":""),onClick:()=>k(e),children:e},e))),(0,c.jsx)("button",{className:"pagination-btn",disabled:S===R,onClick:()=>k((e=>Math.min(R,e+1))),children:"Next"})]})]})]})})]})}},2317:(e,a,t)=>{t.r(a),t.d(a,{PicCurrentProject:()=>l,default:()=>n});t(5043);var s=t(1245),i=t(579);function n(){return(0,i.jsx)(s.A,{role:"pic",useUnifiedHeader:!0})}const l=n},4947:(e,a,t)=>{t.r(a),t.d(a,{default:()=>r});var s=t(5043),i=t(579);const n=[{label:"Placed",emoji:"\ud83d\udcdd",key:"placed"},{label:"Project Manager",emoji:"\ud83d\udc64",key:"project manager"},{label:"Area Manager",emoji:"\ud83c\udfe2",key:"area manager"},{label:"Received",emoji:"\u2705",key:"received"}];function l(e){if(!e)return"\u2014";try{const a=new Date(e);return a.toLocaleDateString()+", "+a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(a){return"\u2014"}}function r(e){let{request:a}=e;const t=function(e){if(!e)return n.map((()=>({status:"Pending",date:"\u2014",decision:"pending"})));const a=[];let t=!1;a.push({status:"Completed",date:l(e.createdAt),decision:"placed"});const s=(e.approvals||[]).find((e=>(e.role||"").toLowerCase().includes("project manager")));t?a.push({status:"\u2014",date:"\u2014",decision:"inactive"}):s?"approved"===s.decision?a.push({status:"Approved",date:l(s.timestamp),decision:"approved"}):"denied"===s.decision&&(t=!0,a.push({status:"Denied",date:l(s.timestamp),decision:"denied"})):a.push({status:"Pending",date:"\u2014",decision:"pending"});const i=(e.approvals||[]).find((e=>(e.role||"").toLowerCase().includes("area manager")));return t?a.push({status:"\u2014",date:"\u2014",decision:"inactive"}):i?"approved"===i.decision?a.push({status:"Approved",date:l(i.timestamp),decision:"approved"}):"denied"===i.decision&&(t=!0,a.push({status:"Denied",date:l(i.timestamp),decision:"denied"})):a.push({status:"Pending",date:"\u2014",decision:"pending"}),t?a.push({status:"\u2014",date:"\u2014",decision:"inactive"}):e.receivedByPIC?a.push({status:"Received",date:l(e.receivedDate),decision:"received"}):a.push({status:"Pending",date:"\u2014",decision:"pending"}),a}(a);return(0,i.jsx)("div",{className:"progress-tracker",children:n.map(((e,a)=>{const l=t[a];let r="step-circle";return"approved"===l.decision||"placed"===l.decision||"received"===l.decision?r+=" completed":"denied"===l.decision?r+=" denied":"inactive"===l.decision?r+=" inactive":"Pending"!==l.status||t.slice(a+1).some((e=>"Approved"===e.status))||(r+=" active"),(0,i.jsxs)(s.Fragment,{children:[(0,i.jsxs)("div",{className:"step-vertical",children:[(0,i.jsx)("div",{className:r,children:(0,i.jsx)("span",{style:{fontSize:18},children:e.emoji})}),(0,i.jsx)("div",{className:"step-label",children:e.label}),(0,i.jsx)("div",{className:"step-status step-status-".concat(l.decision),children:l.status}),(0,i.jsx)("div",{className:"step-date",children:l.date})]}),a<n.length-1&&(0,i.jsx)("div",{className:"step-line ".concat("approved"===l.decision||"placed"===l.decision||"received"===l.decision?"completed":"denied"===l.decision?"denied":"inactive"===l.decision?"inactive":"")})]},a)}))})}},5476:(e,a,t)=>{t.r(a),t.d(a,{default:()=>d});var s=t(9379),i=t(5043),n=t(3216),l=t(411),r=(t(4801),t(1838),t(7508),t(8818)),c=t(579);const d=()=>{var e,a;const{projectId:t}=(0,n.g)(),d=(0,n.Zp)(),[o,m]=(0,i.useState)(null),[p,u]=(0,i.useState)(!1),[h,x]=(0,i.useState)([]),[v,j]=(0,i.useState)([]),[g,f]=(0,i.useState)([{id:1,materialName:"",quantity:"",unit:""}]),[N,b]=(0,i.useState)({description:""}),[y,w]=(0,i.useState)({description:"",materials:"",global:""}),[S,k]=(0,i.useState)(!1),q=(0,i.useRef)(!1),A=localStorage.getItem("token"),C=localStorage.getItem("user"),D=C?JSON.parse(C):null,[P,M]=(0,i.useState)((null===D||void 0===D?void 0:D.name)||"PIC"),[R,L]=(0,i.useState)((null===D||void 0===D?void 0:D.role)||"Person in Charge"),[E,I]=(0,i.useState)(!1);(0,i.useEffect)((()=>{A&&D||d("/")}),[d,A,D]),(0,i.useEffect)((()=>{A&&t&&l.Ay.get("/projects/".concat(t),{headers:{Authorization:"Bearer ".concat(A)}}).then((e=>m(e.data))).catch((()=>m(null)))}),[t,A]),(0,i.useEffect)((()=>()=>v.forEach((e=>URL.revokeObjectURL(e)))),[v.length]),(0,i.useEffect)((()=>{const e=e=>{e.target.closest(".user-profile")||u(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[]),(0,i.useEffect)((()=>{const e=()=>{const e=window.pageYOffset||document.documentElement.scrollTop;I(e>50)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[]);const B=(e,a,t)=>{f((i=>i.map((i=>{if(i.id===e){if("quantity"===a){let e=t.replace(/\D/g,"").slice(0,7);return(0,s.A)((0,s.A)({},i),{},{[a]:e})}return(0,s.A)((0,s.A)({},i),{},{[a]:t})}return i}))))};return(0,c.jsxs)("div",{children:[(0,c.jsx)(r.A,{roleSegment:"pic"}),(0,c.jsx)("div",{className:"dashboard-layout",children:(0,c.jsx)("main",{className:"dashboard-main",children:(0,c.jsx)("div",{className:"page-container",children:(0,c.jsxs)("div",{className:"request-materials-container-picmatreq",children:[(0,c.jsxs)("div",{className:"form-header-section",children:[(0,c.jsxs)("div",{className:"page-title-section",children:[(0,c.jsx)("h1",{className:"page-title-picmatreq",children:"Request Materials"}),(0,c.jsx)("p",{className:"page-description",children:"Create a new request for your project"})]}),(0,c.jsx)("div",{className:"back-button-container",children:(0,c.jsx)("button",{onClick:()=>d("/pic/requests"),className:"back-button",children:"\u2190 Back to Requests"})})]}),o&&(0,c.jsxs)("div",{className:"project-details-box",children:[(0,c.jsx)("h2",{className:"project-name",children:o.name}),(0,c.jsxs)("p",{className:"project-location",children:[null===(e=o.location)||void 0===e?void 0:e.name," (",null===(a=o.location)||void 0===a?void 0:a.region,")"]}),(0,c.jsxs)("p",{className:"project-target-date",children:["Target Date: ",o.targetDate]})]}),(0,c.jsxs)("div",{className:"materials-form-picmatreq",children:[(0,c.jsxs)("div",{className:"form-group-picmatreq",children:[(0,c.jsx)("label",{className:"form-label-picmatreq",children:"Material to be Requested"}),(0,c.jsxs)("div",{className:"materials-list-picmatreq",children:[(0,c.jsxs)("div",{className:"material-headers-picmatreq",children:[(0,c.jsx)("span",{className:"material-header-label-picmatreq",children:"MATERIAL NAME"}),(0,c.jsx)("span",{className:"quantity-header-label-picmatreq",children:"QUANTITY"}),(0,c.jsx)("span",{className:"unit-header-label-picmatreq",children:"UNIT"}),(0,c.jsx)("span",{className:"action-header-label-picmatreq"})]}),g.map((e=>(0,c.jsxs)("div",{className:"material-row-picmatreq",children:[(0,c.jsx)("input",{type:"text",value:e.materialName,onChange:a=>B(e.id,"materialName",a.target.value),placeholder:"Enter material name",className:"material-input-picmatreq"}),(0,c.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:e.quantity,onChange:a=>B(e.id,"quantity",a.target.value),placeholder:"Quantity",maxLength:7,className:"quantity-input-picmatreq",onPaste:e=>{const a=e.clipboardData.getData("text");/^\d+$/.test(a)||e.preventDefault(),a.length>7&&e.preventDefault()},onKeyPress:a=>{(!/[0-9]/.test(a.key)||e.quantity.length>=7)&&a.preventDefault()}}),(0,c.jsxs)("select",{value:e.unit,onChange:a=>B(e.id,"unit",a.target.value),className:"unit-select-picmatreq",required:!0,children:[(0,c.jsx)("option",{value:"",children:"Select Unit"}),(0,c.jsx)("option",{value:"kg",children:"Kilograms (kg)"}),(0,c.jsx)("option",{value:"g",children:"Grams (g)"}),(0,c.jsx)("option",{value:"ton",children:"Metric Tons (ton)"}),(0,c.jsx)("option",{value:"bag",children:"Bags"}),(0,c.jsx)("option",{value:"piece",children:"Pieces"}),(0,c.jsx)("option",{value:"box",children:"Boxes"}),(0,c.jsx)("option",{value:"roll",children:"Rolls"}),(0,c.jsx)("option",{value:"sheet",children:"Sheets"}),(0,c.jsx)("option",{value:"m",children:"Meters (m)"}),(0,c.jsx)("option",{value:"cm",children:"Centimeters (cm)"}),(0,c.jsx)("option",{value:"m2",children:"Square Meters (m\xb2)"}),(0,c.jsx)("option",{value:"m3",children:"Cubic Meters (m\xb3)"}),(0,c.jsx)("option",{value:"l",children:"Liters (L)"}),(0,c.jsx)("option",{value:"truck",children:"Truck Loads"}),(0,c.jsx)("option",{value:"set",children:"Sets"}),(0,c.jsx)("option",{value:"pair",children:"Pairs"}),(0,c.jsx)("option",{value:"bundle",children:"Bundles"})]}),(0,c.jsx)("button",{type:"button",onClick:()=>{return a=e.id,void(g.length>1&&f((e=>e.filter((e=>e.id!==a)))));var a},className:"remove-material-btn-picmatreq",disabled:1===g.length,children:"\u2715"})]},e.id))),(0,c.jsx)("button",{type:"button",onClick:()=>{const e=g.length?Math.max(...g.map((e=>e.id)))+1:1;f((a=>[...a,{id:e,materialName:"",quantity:"",unit:""}]))},className:"add-material-btn-picmatreq",children:"+ Add Material"}),y.materials&&(0,c.jsx)("div",{style:{marginTop:8,color:"#dc2626",fontSize:12,fontWeight:500},children:y.materials})]})]}),(0,c.jsxs)("div",{className:"form-group-picmatreq",children:[(0,c.jsx)("label",{className:"form-label-picmatreq",children:"Attachment Proof"}),(0,c.jsxs)("div",{className:"upload-section-picmatreq",children:[(0,c.jsx)("input",{type:"file",id:"file-upload",multiple:!0,accept:"image/*",onChange:e=>{const a=Array.from(e.target.files);x((e=>[...e,...a]));const t=a.map((e=>URL.createObjectURL(e)));j((e=>[...e,...t]))},className:"file-input-picmatreq"}),(0,c.jsxs)("label",{htmlFor:"file-upload",className:"upload-button",children:[(0,c.jsx)("span",{className:"upload-icon-picmatreq",children:"\ud83d\udcce"}),"Upload"]}),v.length>0&&(0,c.jsx)("div",{className:"preview-container",style:{display:"flex",gap:"10px",flexWrap:"wrap",marginTop:"10px"},children:v.map(((e,a)=>(0,c.jsxs)("div",{style:{position:"relative"},children:[(0,c.jsx)("img",{src:e,alt:"preview-".concat(a),style:{width:"200px",height:"200px",objectFit:"cover",borderRadius:"8px",border:"1px solid #ccc"}}),(0,c.jsx)("button",{type:"button",onClick:()=>(e=>{x((a=>a.filter(((a,t)=>t!==e)))),j((a=>(URL.revokeObjectURL(a[e]),a.filter(((a,t)=>t!==e)))))})(a),style:{position:"absolute",top:"-6px",right:"-6px",background:"#ff4d4f",color:"#fff",border:"none",borderRadius:"50%",width:"20px",height:"20px",cursor:"pointer"},children:"\xd7"})]},a)))}),(0,c.jsx)("p",{className:"upload-hint-picmatreq",children:"You can attach files such as documents or images"})]})]}),(0,c.jsxs)("div",{className:"form-group-picmatreq",children:[(0,c.jsx)("label",{className:"form-label-picmatreq",children:"Request Description"}),(0,c.jsx)("textarea",{name:"description",value:N.description,onChange:e=>{const{name:a,value:t}=e.target;b((e=>(0,s.A)((0,s.A)({},e),{},{[a]:t})))},className:"description-textarea-picmatreq",rows:"6",placeholder:"Provide a detailed description of your request"}),y.description&&(0,c.jsx)("div",{style:{marginTop:4,color:"#dc2626",fontSize:12,fontWeight:500},children:y.description})]}),y.global&&(0,c.jsx)("div",{style:{marginTop:12,fontSize:13,color:y.global.includes("successfully")?"#16a34a":"#dc2626",fontWeight:500},children:y.global}),(0,c.jsx)("div",{className:"form-actions-picmatreq",style:{marginTop:16},children:(0,c.jsx)("button",{onClick:async e=>{if(e.preventDefault(),q.current||S)return;if(!A)return w((e=>(0,s.A)((0,s.A)({},e),{},{global:"Session expired. Please login."}))),void d("/");const{ok:a,validMaterials:i}=(()=>{const e={description:"",materials:"",global:""};N.description.trim()||(e.description="Description is required");const a=g.filter((e=>e.materialName.trim()&&e.quantity.trim()&&e.unit.trim()));return 0===a.length&&(e.materials="Add at least one complete material row"),g.some((e=>(e.materialName||"").trim()&&(!e.quantity.trim()||!e.unit.trim())))&&(e.materials=e.materials||"Complete all fields in each row"),w(e),{ok:!e.description&&!e.materials,validMaterials:a}})();if(!a)return;q.current=!0,k(!0),w((e=>(0,s.A)((0,s.A)({},e),{},{global:""})));const n=new FormData;h.forEach((e=>n.append("attachments",e))),n.append("description",N.description.trim()),n.append("materials",JSON.stringify(i)),n.append("project",t);try{var r;const e=await l.Ay.post("/requests",n,{headers:{Authorization:"Bearer ".concat(A)}});if("Invalid token"===(null===e||void 0===e||null===(r=e.data)||void 0===r?void 0:r.msg))return w((e=>(0,s.A)((0,s.A)({},e),{},{global:"Session expired. Please login."}))),localStorage.removeItem("token"),localStorage.removeItem("user"),void d("/");b({description:""}),f([{id:1,materialName:"",quantity:"",unit:""}]),x([]),j([]),w({description:"",materials:"",global:"Request submitted successfully."})}catch(m){var c,o;const e=(null===m||void 0===m||null===(c=m.response)||void 0===c||null===(o=c.data)||void 0===o?void 0:o.message)||"Submission failed";w((a=>(0,s.A)((0,s.A)({},a),{},{global:e})))}finally{q.current=!1,k(!1)}},disabled:S,className:"publish-button-picmatreq",style:{opacity:S?.6:1,cursor:S?"not-allowed":"pointer"},children:S?"Submitting...":"Publish Request"})})]})]})})})})]})}},5532:(e,a,t)=>{t.r(a),t.d(a,{default:()=>m});var s=t(3986),i=t(9379),n=t(5043),l=t(3216),r=t(411),c=(t(4801),t(8818)),d=(t(342),t(7508),t(579));const o=["id"],m=()=>{var e,a,t,m,p,u,h,x,v,j,g,f,N,b,y,w,S,k;const{id:q}=(0,l.g)(),A=(0,l.Zp)(),C=JSON.parse(localStorage.getItem("user")),D=null===C||void 0===C?void 0:C._id,[P,M]=(0,n.useState)(null),[R,L]=(0,n.useState)(!0),[E,I]=(0,n.useState)(""),[B,_]=(0,n.useState)(!1),[z,O]=(0,n.useState)(!1),[T,W]=(0,n.useState)(!1),[U,F]=(0,n.useState)(null),[J,K]=(0,n.useState)([]),[G,Y]=(0,n.useState)(""),[Z,H]=(0,n.useState)([]),[Q,V]=(0,n.useState)([]),$=(0,n.useRef)(null),X=(null===C||void 0===C?void 0:C._id)===(null===P||void 0===P||null===(e=P.createdBy)||void 0===e?void 0:e._id);(0,n.useEffect)((()=>{r.Ay.get("/requests/".concat(q)).then((e=>{const a=e.data;M(a);const t=(a.materials||[]).map(((e,a)=>(0,i.A)((0,i.A)({},e),{},{id:e.id||Date.now()+a})));K(t),Y(a.description||""),H(a.attachments||[]),I("")})).catch((()=>I("Failed to load request details."))).finally((()=>L(!1)))}),[q]),(0,n.useEffect)((()=>{const e=e=>{$.current&&!$.current.contains(e.target)&&O(!1)},a=()=>{const e=window.pageYOffset||document.documentElement.scrollTop;_(e>50)};return document.addEventListener("click",e),window.addEventListener("scroll",a),()=>{document.removeEventListener("click",e),window.removeEventListener("scroll",a)}}),[]);const ee=()=>A(-1),ae=!!P&&X&&!P.receivedByPIC&&!/denied|cancel|received/i.test(P.status||"")&&!(null!==(a=P.approvals)&&void 0!==a&&null!==(t=a.projectManager)&&void 0!==t&&t.approved||null!==(m=P.approvals)&&void 0!==m&&null!==(p=m.areaManager)&&void 0!==p&&p.approved),te=async()=>{if(P&&!P.receivedByPIC&&window.confirm("Mark all materials in this request as received?"))try{await r.Ay.patch("/requests/".concat(P._id,"/received")),M((e=>e?(0,i.A)((0,i.A)({},e),{},{receivedByPIC:!0,receivedDate:(new Date).toISOString(),status:"Received"}):e)),alert("Marked as received.")}catch(t){var e,a;alert((null===t||void 0===t||null===(e=t.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||"Failed to mark as received")}},se=async()=>{if(P&&window.confirm("Cancel (delete) this material request? This cannot be undone."))try{await r.Ay.delete("/requests/".concat(P._id)),alert("Request cancelled."),A("/pic/requests")}catch(t){var e,a;alert((null===t||void 0===t||null===(e=t.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||"Failed to cancel request")}};return(0,n.useEffect)((()=>{if(!D)return;(async()=>{try{const{data:e}=await r.Ay.get("/projects/by-user-status?userId=".concat(D,"&role=pic&status=Ongoing"));F(e[0]||null)}catch(e){F(null)}})()}),[D]),R?(0,d.jsxs)("div",{className:"loading-container",children:[(0,d.jsx)("div",{className:"loading-spinner"}),(0,d.jsx)("p",{children:"Loading request details..."})]}):E?(0,d.jsxs)("div",{className:"error-container",children:[(0,d.jsx)("p",{children:E}),(0,d.jsx)("button",{onClick:ee,className:"back-button",children:"Go Back"})]}):P?(0,d.jsxs)("div",{className:"dashboard-container",children:[(0,d.jsx)(c.A,{roleSegment:"pic"}),(0,d.jsxs)("div",{className:"header-content",style:{padding:"1.5rem 2rem 0"},children:[(0,d.jsxs)("div",{className:"header-left",children:[(0,d.jsx)("h1",{className:"header-title",children:"Material Request Details"}),(0,d.jsx)("p",{className:"header-subtitle",children:"View and manage material request information"})]}),(0,d.jsx)("div",{className:"header-right",children:(0,d.jsxs)("div",{className:"header-actions",children:[(0,d.jsxs)("button",{onClick:ee,className:"btn-secondary",children:[(0,d.jsx)("i",{className:"fas fa-arrow-left"}),"Back to List"]}),!T&&ae&&X&&(0,d.jsx)("button",{onClick:()=>W(!0),className:"btn-primary",children:"Edit"}),T&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{onClick:async()=>{const e=new FormData,a=J.map((e=>{let{id:a}=e;return(0,s.A)(e,o)}));e.append("materials",JSON.stringify(a)),e.append("description",G),e.append("attachments",JSON.stringify(Z)),Q.forEach((a=>e.append("newAttachments",a)));try{const a=(await r.Ay.put("/requests/".concat(q),e,{headers:{"Content-Type":"multipart/form-data"}})).data,t=(a.materials||[]).map(((e,a)=>(0,i.A)((0,i.A)({},e),{},{id:e.id||Date.now()+a})));M(a),K(t),Y(a.description||""),H(a.attachments||[]),V([]),W(!1),alert("Request updated!")}catch(t){alert("Failed to update request"),console.error(t)}},className:"btn-primary",children:"Save"}),(0,d.jsx)("button",{onClick:()=>W(!1),className:"btn-secondary",children:"Cancel"})]}),!P.receivedByPIC&&(null===(u=P.status)||void 0===u?void 0:u.includes("Approved"))&&X&&(0,d.jsx)("button",{onClick:te,className:"btn-success",children:"Mark Received"}),X&&!P.receivedByPIC&&(0,d.jsx)("button",{onClick:se,className:"btn-danger",children:"Cancel Request"})]})})]}),(0,d.jsx)("div",{className:"dashboard-main",children:(0,d.jsx)("div",{className:"page-container",children:P&&(0,d.jsxs)("div",{className:"material-request-detail",children:[(0,d.jsx)("div",{className:"status-section",children:(0,d.jsxs)("div",{className:"status-badge",style:{backgroundColor:((e,a)=>{const t=(e||"").toLowerCase();return a?"#0ea5e9":t.includes("approved")?"#10b981":t.includes("pending")?"#f59e0b":t.includes("denied")||t.includes("cancel")?"#ef4444":"#6b7280"})(P.status,P.receivedByPIC),color:"white"},children:[(0,d.jsx)("i",{className:"fas fa-circle"}),((e,a)=>{if(a)return"Completed";const t=(e||"").toLowerCase();return t.includes("approved")?"Approved":t.includes("pending")?"Pending":t.includes("denied")||t.includes("cancel")?"Rejected":"Unknown"})(P.status,P.receivedByPIC)]})}),(0,d.jsxs)("div",{className:"detail-grid",children:[(0,d.jsxs)("div",{className:"detail-column",children:[(0,d.jsxs)("div",{className:"detail-card",children:[(0,d.jsx)("div",{className:"card-header",children:(0,d.jsxs)("h3",{children:[(0,d.jsx)("i",{className:"fas fa-info-circle"})," Request Information"]})}),(0,d.jsxs)("div",{className:"card-content",children:[(0,d.jsxs)("div",{className:"info-row",children:[(0,d.jsx)("span",{className:"info-label",children:"Request ID:"}),(0,d.jsx)("span",{className:"info-value",children:P._id})]}),(0,d.jsxs)("div",{className:"info-row",children:[(0,d.jsx)("span",{className:"info-label",children:"Request Number:"}),(0,d.jsx)("span",{className:"info-value",children:P.requestNumber})]}),(0,d.jsxs)("div",{className:"info-row",children:[(0,d.jsx)("span",{className:"info-label",children:"Description:"}),(0,d.jsx)("span",{className:"info-value description-text",children:P.description})]}),(0,d.jsxs)("div",{className:"info-row",children:[(0,d.jsx)("span",{className:"info-label",children:"Priority:"}),(0,d.jsx)("span",{className:"info-value",children:(0,d.jsx)("span",{className:"priority-badge priority-".concat(null===(h=P.priority)||void 0===h?void 0:h.toLowerCase()),children:P.priority})})]}),(0,d.jsxs)("div",{className:"info-row",children:[(0,d.jsx)("span",{className:"info-label",children:"Requested Date:"}),(0,d.jsx)("span",{className:"info-value",children:new Date(P.createdAt).toLocaleDateString()})]})]})]}),(0,d.jsxs)("div",{className:"detail-card",children:[(0,d.jsx)("div",{className:"card-header",children:(0,d.jsxs)("h3",{children:[(0,d.jsx)("i",{className:"fas fa-user"})," Requester Details"]})}),(0,d.jsxs)("div",{className:"card-content",children:[(0,d.jsxs)("div",{className:"info-row",children:[(0,d.jsx)("span",{className:"info-label",children:"Name:"}),(0,d.jsx)("span",{className:"info-value",children:null===(x=P.createdBy)||void 0===x?void 0:x.name})]}),(0,d.jsxs)("div",{className:"info-row",children:[(0,d.jsx)("span",{className:"info-label",children:"Email:"}),(0,d.jsx)("span",{className:"info-value",children:null===(v=P.createdBy)||void 0===v?void 0:v.email})]}),(0,d.jsxs)("div",{className:"info-row",children:[(0,d.jsx)("span",{className:"info-label",children:"Role:"}),(0,d.jsx)("span",{className:"info-value",children:null===(j=P.createdBy)||void 0===j?void 0:j.role})]}),(0,d.jsxs)("div",{className:"info-row",children:[(0,d.jsx)("span",{className:"info-label",children:"Project:"}),(0,d.jsx)("span",{className:"info-value",children:null===(g=P.project)||void 0===g?void 0:g.projectName})]}),(0,d.jsxs)("div",{className:"info-row",children:[(0,d.jsx)("span",{className:"info-label",children:"Location:"}),(0,d.jsx)("span",{className:"info-value",children:null===(f=P.project)||void 0===f?void 0:f.location})]})]})]})]}),(0,d.jsxs)("div",{className:"detail-column",children:[(0,d.jsxs)("div",{className:"detail-card",children:[(0,d.jsx)("div",{className:"card-header",children:(0,d.jsxs)("h3",{children:[(0,d.jsx)("i",{className:"fas fa-boxes"})," Requested Materials"]})}),(0,d.jsx)("div",{className:"card-content",children:P.materials&&P.materials.length>0?(0,d.jsx)("div",{className:"materials-list",children:P.materials.map(((e,a)=>(0,d.jsxs)("div",{className:"material-item",children:[(0,d.jsxs)("div",{className:"material-info",children:[(0,d.jsx)("span",{className:"material-name",children:e.materialName}),(0,d.jsxs)("span",{className:"material-quantity",children:["Qty: ",e.quantity]})]}),e.specifications&&(0,d.jsxs)("div",{className:"material-specs",children:[(0,d.jsx)("span",{className:"specs-label",children:"Specifications:"}),(0,d.jsx)("span",{className:"specs-value",children:e.specifications})]})]},a)))}):(0,d.jsx)("p",{className:"no-data",children:"No materials specified"})})]}),(0,d.jsxs)("div",{className:"detail-card",children:[(0,d.jsx)("div",{className:"card-header",children:(0,d.jsxs)("h3",{children:[(0,d.jsx)("i",{className:"fas fa-paperclip"})," Attachments"]})}),(0,d.jsx)("div",{className:"card-content",children:P.attachments&&P.attachments.length>0?(0,d.jsx)("div",{className:"attachments-list",children:P.attachments.map(((e,a)=>{return(0,d.jsxs)("div",{className:"attachment-item",children:[(0,d.jsx)("div",{className:"attachment-icon",children:(0,d.jsx)("i",{className:"fas fa-file"})}),(0,d.jsxs)("div",{className:"attachment-info",children:[(0,d.jsx)("span",{className:"attachment-name",children:e}),(0,d.jsxs)("a",{href:(t=e,t.startsWith("http")?t:"http://localhost:5000/uploads/".concat(t)),target:"_blank",rel:"noopener noreferrer",className:"attachment-link",children:[(0,d.jsx)("i",{className:"fas fa-download"}),"Download"]})]})]},a);var t}))}):(0,d.jsx)("p",{className:"no-data",children:"No attachments"})})]})]})]}),(0,d.jsxs)("div",{className:"detail-card full-width",children:[(0,d.jsx)("div",{className:"card-header",children:(0,d.jsxs)("h3",{children:[(0,d.jsx)("i",{className:"fas fa-tasks"})," Approval Status"]})}),(0,d.jsx)("div",{className:"card-content",children:(0,d.jsxs)("div",{className:"approval-timeline",children:[(0,d.jsxs)("div",{className:"timeline-item",children:[(0,d.jsx)("div",{className:"timeline-marker completed",children:(0,d.jsx)("i",{className:"fas fa-check"})}),(0,d.jsxs)("div",{className:"timeline-content",children:[(0,d.jsx)("h4",{children:"Request Submitted"}),(0,d.jsxs)("p",{children:["Request was submitted by ",null===(N=P.createdBy)||void 0===N?void 0:N.name]}),(0,d.jsx)("span",{className:"timeline-date",children:new Date(P.createdAt).toLocaleString()})]})]}),(null===(b=P.approvals)||void 0===b?void 0:b.projectManager)&&(0,d.jsxs)("div",{className:"timeline-item",children:[(0,d.jsx)("div",{className:"timeline-marker ".concat(P.approvals.projectManager.approved?"completed":"pending"),children:(0,d.jsx)("i",{className:P.approvals.projectManager.approved?"fas fa-check":"fas fa-clock"})}),(0,d.jsxs)("div",{className:"timeline-content",children:[(0,d.jsx)("h4",{children:"Project Manager Review"}),(0,d.jsx)("p",{children:P.approvals.projectManager.approved?"Approved by ".concat((null===(y=P.approvals.projectManager.reviewer)||void 0===y?void 0:y.name)||"Project Manager"):"Pending Project Manager approval"}),P.approvals.projectManager.reviewedAt&&(0,d.jsx)("span",{className:"timeline-date",children:new Date(P.approvals.projectManager.reviewedAt).toLocaleString()})]})]}),(null===(w=P.approvals)||void 0===w?void 0:w.areaManager)&&(0,d.jsxs)("div",{className:"timeline-item",children:[(0,d.jsx)("div",{className:"timeline-marker ".concat(P.approvals.areaManager.approved?"completed":"pending"),children:(0,d.jsx)("i",{className:P.approvals.areaManager.approved?"fas fa-check":"fas fa-clock"})}),(0,d.jsxs)("div",{className:"timeline-content",children:[(0,d.jsx)("h4",{children:"Area Manager Review"}),(0,d.jsx)("p",{children:P.approvals.areaManager.approved?"Approved by ".concat((null===(S=P.approvals.areaManager.reviewer)||void 0===S?void 0:S.name)||"Area Manager"):"Pending Area Manager approval"}),P.approvals.areaManager.reviewedAt&&(0,d.jsx)("span",{className:"timeline-date",children:new Date(P.approvals.areaManager.reviewedAt).toLocaleString()})]})]}),(0,d.jsxs)("div",{className:"timeline-item",children:[(0,d.jsx)("div",{className:"timeline-marker ".concat(P.receivedByPIC?"completed":"pending"),children:(0,d.jsx)("i",{className:P.receivedByPIC?"fas fa-check":"fas fa-clock"})}),(0,d.jsxs)("div",{className:"timeline-content",children:[(0,d.jsx)("h4",{children:"Materials Received"}),(0,d.jsx)("p",{children:P.receivedByPIC?"Materials received by ".concat(null===(k=P.createdBy)||void 0===k?void 0:k.name):"Pending materials receipt"}),P.receivedAt&&(0,d.jsx)("span",{className:"timeline-date",children:new Date(P.receivedAt).toLocaleString()})]})]})]})})]}),(0,d.jsxs)("div",{className:"detail-card full-width",children:[(0,d.jsx)("div",{className:"card-header",children:(0,d.jsxs)("h3",{children:[(0,d.jsx)("i",{className:"fas fa-tools"})," Actions"]})}),(0,d.jsx)("div",{className:"card-content",children:(0,d.jsxs)("div",{className:"action-buttons",style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[ae&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("button",{onClick:()=>W(!0),className:"btn-primary",children:[(0,d.jsx)("i",{className:"fas fa-edit"}),"Edit Request"]}),(0,d.jsxs)("button",{onClick:se,className:"btn-danger",children:[(0,d.jsx)("i",{className:"fas fa-times"}),"Cancel Request"]})]}),"Approved"===P.status&&X&&(P.receivedByPIC?(0,d.jsxs)("div",{className:"received-badge",style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 16px",backgroundColor:"#10b981",color:"white",borderRadius:"6px",fontWeight:"600"},children:[(0,d.jsx)("i",{className:"fas fa-check"}),"Received by PIC",P.receivedDate&&(0,d.jsxs)("span",{children:["(",new Date(P.receivedDate).toLocaleString(),")"]})]}):(0,d.jsxs)("button",{onClick:te,className:"btn-success",children:[(0,d.jsx)("i",{className:"fas fa-check"}),"Mark as Received"]}))]})})]})]})})})]}):(0,d.jsxs)("div",{className:"error-container",children:[(0,d.jsx)("p",{children:"Request not found"}),(0,d.jsx)("button",{onClick:ee,className:"back-button",children:"Go Back"})]})}},6016:()=>{},6077:(e,a,t)=>{t.r(a),t.d(a,{default:()=>o});var s=t(9379),i=t(5043),n=t(3216),l=t(411),r=(t(4801),t(6016),t(3204)),c=t(8818),d=t(579);const o=()=>{const e=localStorage.getItem("token"),a=localStorage.getItem("user"),o=a?JSON.parse(a):null,m=null===o||void 0===o?void 0:o._id,p=(0,n.Zp)(),[u,h]=(0,i.useState)([]),[x,v]=(0,i.useState)("All"),[j,g]=(0,i.useState)([]),[f,N]=(0,i.useState)([]),[b,y]=(0,i.useState)(!0),[w,S]=(0,i.useState)(null),[k,q]=(0,i.useState)(""),[A,C]=(0,i.useState)("startDate"),[D,P]=(0,i.useState)("asc"),[M,R]=(0,i.useState)(!1),[L,E]=(0,i.useState)((null===o||void 0===o?void 0:o.name)||"");((null===o||void 0===o?void 0:o.role)||(null===o||void 0===o?void 0:o.userType)||(null===o||void 0===o?void 0:o.position)||(null===o||void 0===o?void 0:o.designation)||"").toString();(0,i.useEffect)((()=>{const e=e=>{e.target.closest(".profile-menu-container")||R(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[]);(0,i.useEffect)((()=>{m&&(y(!0),Promise.all([l.Ay.get("/projects/by-user-status?userId=".concat(m,"&role=pic&status=Ongoing")),l.Ay.get("/projects/by-user-status?userId=".concat(m,"&role=pic&status=Completed"))]).then((e=>{let[a,t]=e;g(a.data||[]),N(t.data||[]),y(!1)})).catch((()=>{g([]),N([]),y(!1)})))}),[m]),(0,i.useEffect)((()=>{if(!e||!m)return;(async()=>{try{const{data:e}=await l.Ay.get("/projects/by-user-status?userId=".concat(m,"&role=pic&status=Ongoing"));S(e[0]||null)}catch(e){S(null)}})()}),[e,m]),(0,i.useEffect)((()=>{e&&w&&l.Ay.get("/requests/mine",{headers:{Authorization:"Bearer ".concat(e)}}).then((e=>{let{data:a}=e;const t=Array.isArray(a)?a.filter((e=>e.project&&e.project._id===w._id)):[];h(t)})).catch((()=>h([])))}),[e,w]);const I=e=>{const a=e.startDate?new Date(e.startDate):null,t=e.endDate?new Date(e.endDate):null,i=new Date;let n=null,l=null,r=null,c=null;return a&&t&&t>a&&(n=Math.round((t-a)/864e5)||1,l=Math.min(n,Math.max(0,Math.round((i-a)/864e5))),r=Math.min(100,Math.max(0,l/n*100)),c=Math.max(0,Math.round((t-i)/864e5))),(0,s.A)((0,s.A)({},e),{},{totalDays:n,elapsedDays:l,pctTime:r,daysLeft:c})},B=(0,i.useMemo)((()=>({ongoing:j.length,completed:f.length,total:j.length+f.length})),[j,f]),_=(e,a)=>{const t="asc"===D?1:-1,s=e=>{var a;switch(A){case"name":return(null===(a=e.projectName)||void 0===a?void 0:a.toLowerCase())||"";case"startDate":default:return e.startDate||"";case"endDate":return e.endDate||"";case"status":return e.status||""}},i=s(e),n=s(a);return i<n?-1*t:i>n?1*t:0},z=(0,i.useMemo)((()=>j.filter((e=>e.projectName.toLowerCase().includes(k.toLowerCase()))).map(I).sort(_)),[j,k,A,D]),O=(0,i.useMemo)((()=>f.filter((e=>e.projectName.toLowerCase().includes(k.toLowerCase()))).map(I).sort(_)),[f,k,A,D]),T=(0,i.useMemo)((()=>[...j,...f].filter((e=>e.projectName.toLowerCase().includes(k.toLowerCase()))).map(I).sort(_)),[j,f,k,A,D]),W=e=>{A===e?P((e=>"asc"===e?"desc":"asc")):(C(e),P("asc"))};if(b)return(0,d.jsx)("div",{className:"dashboard-container",children:(0,d.jsx)("div",{className:"professional-loading-screen",children:(0,d.jsxs)("div",{className:"loading-content",children:[(0,d.jsx)("div",{className:"loading-logo",children:(0,d.jsx)("img",{src:t(8370),alt:"FadzTrack Logo",className:"loading-logo-img"})}),(0,d.jsx)("div",{className:"loading-spinner-container",children:(0,d.jsx)("div",{className:"loading-spinner"})}),(0,d.jsxs)("div",{className:"loading-text",children:[(0,d.jsx)("h2",{className:"loading-title",children:"Loading Projects"}),(0,d.jsx)("p",{className:"loading-subtitle",children:"Fetching your project list..."})]})]})})});const U=e=>{let{projects:a,showBadges:t}=e;return(0,d.jsxs)("div",{className:"projects-table-wrapper glass-card",children:[(0,d.jsxs)("table",{className:"projects-table",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{onClick:()=>W("name"),className:"name"===A?"sorted":"",children:"Project"}),(0,d.jsx)("th",{onClick:()=>W("status"),className:"".concat("status"===A?"sorted ":"","status-col"),children:"Status"}),(0,d.jsx)("th",{children:"Timeline"}),(0,d.jsx)("th",{onClick:()=>W("startDate"),className:"startDate"===A?"sorted":"",children:"Start"}),(0,d.jsx)("th",{onClick:()=>W("endDate"),className:"endDate"===A?"sorted":"",children:"End"}),(0,d.jsx)("th",{style:{textAlign:"right"},children:"Action"})]})}),(0,d.jsxs)("tbody",{children:[0===a.length&&(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:6,className:"empty-row",children:"No projects found."})}),a.map((e=>{var a;return(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:(0,d.jsxs)("div",{className:"proj-main",children:[(0,d.jsx)("div",{className:"proj-title",children:e.projectName}),(0,d.jsxs)("div",{className:"proj-meta",children:[(null===(a=e.location)||void 0===a?void 0:a.name)||"No location"," \u2022 ",null!=e.daysLeft?"".concat(e.daysLeft,"d left"):"\u2014"]})]})}),(0,d.jsx)("td",{className:"status-col",children:t?(0,d.jsx)("span",{className:"status-badge badge-".concat((e.status||"").toLowerCase()),children:e.status||"\u2014"}):(0,d.jsx)("span",{className:"status-plain",children:e.status||"\u2014"})}),(0,d.jsx)("td",{children:null!=e.pctTime?(0,d.jsx)("div",{className:"timeline-bar",title:e.totalDays?"".concat(e.elapsedDays,"/").concat(e.totalDays," days (").concat(e.pctTime.toFixed(0),"%)"):"",children:(0,d.jsx)("div",{className:"timeline-fill",style:{width:"".concat(e.pctTime,"%")}})}):(0,d.jsx)("span",{className:"muted",children:"\u2014"})}),(0,d.jsx)("td",{children:e.startDate?new Date(e.startDate).toLocaleDateString():"\u2014"}),(0,d.jsx)("td",{children:e.endDate?new Date(e.endDate).toLocaleDateString():"\u2014"}),(0,d.jsx)("td",{style:{textAlign:"right"},children:(0,d.jsx)("button",{className:"btn-view",onClick:()=>p("/pic/".concat(e._id)),children:"View"})})]},e._id)}))]})]}),(0,d.jsxs)("div",{className:"projects-cards",children:[a.map((e=>{var a;return(0,d.jsxs)("div",{className:"project-card",onClick:()=>p("/pic/".concat(e._id)),children:[t?(0,d.jsx)("div",{className:"pc-status",children:(0,d.jsx)("span",{className:"status-badge badge-".concat((e.status||"").toLowerCase()),children:e.status||"\u2014"})}):(0,d.jsx)("div",{className:"pc-status-plain",children:e.status||"\u2014"}),(0,d.jsx)("div",{className:"pc-header",children:(0,d.jsx)("h4",{children:e.projectName})}),(0,d.jsx)("div",{className:"pc-meta",children:(null===(a=e.location)||void 0===a?void 0:a.name)||"No location"}),(0,d.jsx)("div",{className:"pc-timeline",children:null!=e.pctTime?(0,d.jsx)("div",{className:"timeline-bar small",children:(0,d.jsx)("div",{className:"timeline-fill",style:{width:"".concat(e.pctTime,"%")}})}):(0,d.jsx)("div",{className:"muted",children:"No timeline"})}),(0,d.jsxs)("div",{className:"pc-dates",children:[(0,d.jsx)("span",{children:e.startDate?new Date(e.startDate).toLocaleDateString():"\u2014"}),(0,d.jsx)("span",{children:"\u2192"}),(0,d.jsx)("span",{children:e.endDate?new Date(e.endDate).toLocaleDateString():"\u2014"})]}),(0,d.jsx)("div",{className:"pc-footer",children:(0,d.jsx)("button",{className:"btn-view ghost",onClick:a=>{a.stopPropagation(),p("/pic/".concat(e._id))},children:"Open"})})]},e._id)})),0===a.length&&(0,d.jsx)("div",{className:"empty-placeholder",children:"No projects found."})]})]})};return(0,d.jsxs)("div",{className:"pic-projects-page",children:[(0,d.jsx)(c.A,{roleSegment:"pic"}),(0,d.jsx)("section",{className:"pp-hero",children:(0,d.jsxs)("div",{className:"pp-hero-inner",children:[(0,d.jsx)("h1",{children:"My Projects"}),(0,d.jsx)("p",{children:"Quick overview of all projects you are assigned to. Search, filter and open a project instantly."}),(0,d.jsxs)("div",{className:"pp-stats",children:[(0,d.jsxs)("div",{className:"stat-card stat-click ".concat("Ongoing"===x?"active":""),onClick:()=>v("Ongoing"),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(v("Ongoing"),e.preventDefault())},"aria-pressed":"Ongoing"===x,children:[(0,d.jsx)("div",{className:"sc-icon ongoing",children:(0,d.jsx)(r.lhZ,{})}),(0,d.jsxs)("div",{className:"sc-body",children:[(0,d.jsx)("span",{className:"sc-label",children:"Ongoing"}),(0,d.jsx)("span",{className:"sc-value",children:B.ongoing})]})]}),(0,d.jsxs)("div",{className:"stat-card stat-click ".concat("Completed"===x?"active":""),onClick:()=>v("Completed"),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(v("Completed"),e.preventDefault())},"aria-pressed":"Completed"===x,children:[(0,d.jsx)("div",{className:"sc-icon completed",children:(0,d.jsx)(r.A7C,{})}),(0,d.jsxs)("div",{className:"sc-body",children:[(0,d.jsx)("span",{className:"sc-label",children:"Completed"}),(0,d.jsx)("span",{className:"sc-value",children:B.completed})]})]}),(0,d.jsxs)("div",{className:"stat-card stat-click ".concat("All"===x?"active":""),onClick:()=>v("All"),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(v("All"),e.preventDefault())},"aria-pressed":"All"===x,children:[(0,d.jsx)("div",{className:"sc-icon total",children:(0,d.jsx)(r.yd7,{})}),(0,d.jsxs)("div",{className:"sc-body",children:[(0,d.jsx)("span",{className:"sc-label",children:"Total"}),(0,d.jsx)("span",{className:"sc-value",children:B.total})]})]})]})]})}),(0,d.jsxs)("main",{className:"pp-main",children:[(0,d.jsxs)("div",{className:"pp-controls",children:[(0,d.jsxs)("div",{className:"search-box",children:[(0,d.jsx)(r.KSO,{className:"icon"}),(0,d.jsx)("input",{value:k,onChange:e=>q(e.target.value),placeholder:"Search project name..."})]}),(0,d.jsxs)("div",{className:"filters",children:[(0,d.jsxs)("div",{className:"tab-group",children:[(0,d.jsxs)("button",{className:"All"===x?"tg-btn active":"tg-btn",onClick:()=>v("All"),children:["All (",B.total,")"]}),(0,d.jsxs)("button",{className:"Ongoing"===x?"tg-btn active":"tg-btn",onClick:()=>v("Ongoing"),children:["Ongoing (",B.ongoing,")"]}),(0,d.jsxs)("button",{className:"Completed"===x?"tg-btn active":"tg-btn",onClick:()=>v("Completed"),children:["Completed (",B.completed,")"]})]}),(0,d.jsxs)("div",{className:"sort-box",children:[(0,d.jsx)(r.EDF,{className:"icon"}),(0,d.jsxs)("select",{value:A,onChange:e=>C(e.target.value),children:[(0,d.jsx)("option",{value:"startDate",children:"Sort: Start Date"}),(0,d.jsx)("option",{value:"endDate",children:"Sort: End Date"}),(0,d.jsx)("option",{value:"name",children:"Sort: Name"}),(0,d.jsx)("option",{value:"status",children:"Sort: Status"})]}),(0,d.jsx)("button",{className:"dir-btn",onClick:()=>P((e=>"asc"===e?"desc":"asc")),"aria-label":"Toggle direction",children:"asc"===D?"\u2191":"\u2193"})]})]})]}),(0,d.jsx)("div",{className:"pp-table-area",children:(0,d.jsx)(U,{projects:"All"===x?T:"Ongoing"===x?z:O,showBadges:"All"!==x})})]})]})}},6746:(e,a,t)=>{t.r(a),t.d(a,{default:()=>o});var s=t(9379),i=t(5043),n=t(3216),l=t(411),r=(t(1838),t(7508),t(3204)),c=t(8818),d=t(579);const o=()=>{var e,a,t,o,m,p;const{id:u}=(0,n.g)(),h=(0,n.Zp)(),[x,v]=(0,i.useState)(null),[j,g]=(0,i.useState)(!0),[f,N]=(0,i.useState)(!1),[b,y]=(0,i.useState)(""),[w,S]=(0,i.useState)(!1),[k,q]=(0,i.useState)(!1),A=(0,i.useRef)(null),[C,D]=(0,i.useState)((()=>{const e=localStorage.getItem("user");return e?JSON.parse(e):null})),[P,M]=(0,i.useState)({description:"",materials:[{id:1,materialName:"",quantity:"",unit:""}],attachments:[]}),[R,L]=(0,i.useState)([]),[E,I]=(0,i.useState)([]),[B,_]=(0,i.useState)([]);(0,i.useEffect)((()=>{l.Ay.get("/requests/".concat(u)).then((e=>{console.log("Material Request Data for Edit:",e.data);const a=e.data;v(a),M({description:a.description||"",materials:a.materials&&a.materials.length>0?a.materials.map(((e,a)=>({id:e.id||Date.now()+a,materialName:e.materialName||"",quantity:e.quantity||"",unit:e.unit||""}))):[{id:1,materialName:"",quantity:"",unit:""}],attachments:a.attachments||[]}),y("")})).catch((e=>{console.error("Error fetching request:",e),y("Failed to load request details.")})).finally((()=>g(!1)))}),[u]),(0,i.useEffect)((()=>{const e=e=>{A.current&&!A.current.contains(e.target)&&S(!1)},a=()=>{const e=window.pageYOffset||document.documentElement.scrollTop;q(e>50)};return document.addEventListener("click",e),window.addEventListener("scroll",a),()=>{document.removeEventListener("click",e),window.removeEventListener("scroll",a)}}),[]),(0,i.useEffect)((()=>()=>E.forEach((e=>URL.revokeObjectURL(e)))),[E.length]);const z=()=>h("/pic/material-request/".concat(u)),O=(e,a,t)=>{M((i=>(0,s.A)((0,s.A)({},i),{},{materials:i.materials.map((i=>{if(i.id===e){if("quantity"===a){let e=t.replace(/\D/g,"").slice(0,7);return(0,s.A)((0,s.A)({},i),{},{[a]:e})}return(0,s.A)((0,s.A)({},i),{},{[a]:t})}return i}))})))};return j?(0,d.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,d.jsx)("div",{children:"Loading..."})}):b?(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",flexDirection:"column",gap:"20px"},children:[(0,d.jsx)("div",{style:{color:"red"},children:b}),(0,d.jsx)("button",{onClick:z,children:"Go Back"})]}):(0,d.jsxs)("div",{children:[(0,d.jsx)(c.A,{roleSegment:"pic"}),(0,d.jsxs)("div",{style:{padding:"1.05rem 1.6rem .3rem"},children:[(0,d.jsx)("h1",{style:{margin:"0 0 4px",fontSize:"1.06rem",fontWeight:600,color:"#1e293b"},children:"Edit Material Request"}),(0,d.jsx)("p",{style:{margin:0,fontSize:".7rem",letterSpacing:.2,color:"#64748b"},children:"Update materials and request details"})]}),(0,d.jsx)("div",{className:"dashboard-layout",children:(0,d.jsx)("main",{className:"dashboard-main",children:(0,d.jsx)("div",{className:"page-container",children:(0,d.jsxs)("div",{className:"request-materials-container-picmatreq",children:[(0,d.jsx)("div",{className:"back-button-container",style:{marginBottom:"20px"},children:(0,d.jsxs)("button",{onClick:z,className:"back-button",style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",backgroundColor:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"6px",color:"#495057",cursor:"pointer",fontSize:"14px",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:e=>{e.target.style.backgroundColor="#e9ecef",e.target.style.borderColor="#adb5bd"},onMouseLeave:e=>{e.target.style.backgroundColor="#f8f9fa",e.target.style.borderColor="#dee2e6"},children:[(0,d.jsx)(r.QVr,{})," Back to Request Details"]})}),(0,d.jsx)("h1",{className:"page-title-picmatreq",children:"Edit Material Request"}),x&&(0,d.jsxs)("div",{className:"project-details-box",style:{marginBottom:"20px",background:"#ffffff",padding:"16px",borderRadius:"8px",border:"1px solid #e2e8f0",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},children:[(0,d.jsx)("h2",{style:{margin:"0 0 8px 0",fontSize:"18px",color:"#1f2937"},children:(null===(e=x.project)||void 0===e?void 0:e.projectName)||"Project"}),(0,d.jsxs)("p",{style:{margin:"0 0 4px 0",fontStyle:"italic",color:"#6b7280"},children:[null===(a=x.project)||void 0===a||null===(t=a.location)||void 0===t?void 0:t.name," (",null===(o=x.project)||void 0===o||null===(m=o.location)||void 0===m?void 0:m.region,")"]}),(0,d.jsxs)("p",{style:{margin:0,color:"#9ca3af",fontSize:"14px"},children:["Requested by: ",(null===(p=x.createdBy)||void 0===p?void 0:p.name)||"Unknown"]})]}),(0,d.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),N(!0);try{const e=new FormData;e.append("description",P.description),e.append("materials",JSON.stringify(P.materials)),B.forEach((a=>e.append("attachments",a))),P.attachments.forEach((a=>{e.append("existingAttachments",a)}));(await l.Ay.put("/requests/".concat(u),e,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(localStorage.getItem("token"))}})).data.success?(alert("\u2705 Material request updated successfully!"),h("/pic/material-request/".concat(u))):y("Failed to update request. Please try again.")}catch(a){console.error("Error updating request:",a),y("Failed to update request. Please try again.")}finally{N(!1)}},className:"materials-form-picmatreq",children:[(0,d.jsxs)("div",{className:"form-group-picmatreq",children:[(0,d.jsx)("label",{className:"form-label-picmatreq",children:"Request Description"}),(0,d.jsx)("textarea",{name:"description",value:P.description,onChange:e=>{const{name:a,value:t}=e.target;M((e=>(0,s.A)((0,s.A)({},e),{},{[a]:t})))},className:"description-textarea-picmatreq",rows:"6",placeholder:"Provide a detailed description of your request",required:!0})]}),(0,d.jsxs)("div",{className:"form-group-picmatreq",children:[(0,d.jsx)("label",{className:"form-label-picmatreq",children:"Materials"}),(0,d.jsxs)("div",{className:"materials-list-picmatreq",children:[(0,d.jsxs)("div",{className:"material-headers-picmatreq",children:[(0,d.jsx)("span",{className:"material-header-label-picmatreq",children:"Material Name"}),(0,d.jsx)("span",{className:"quantity-header-label-picmatreq",children:"Quantity"}),(0,d.jsx)("span",{className:"unit-header-label-picmatreq",children:"Unit"}),(0,d.jsx)("span",{className:"action-header-label-picmatreq"})]}),P.materials.map((e=>(0,d.jsxs)("div",{className:"material-row-picmatreq",children:[(0,d.jsx)("input",{type:"text",value:e.materialName,onChange:a=>O(e.id,"materialName",a.target.value),placeholder:"Enter material name",className:"material-input-picmatreq",required:!0}),(0,d.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:e.quantity,onChange:a=>O(e.id,"quantity",a.target.value),placeholder:"Quantity",maxLength:7,className:"quantity-input-picmatreq",required:!0,onPaste:e=>{const a=e.clipboardData.getData("text");/^\d+$/.test(a)||e.preventDefault(),a.length>7&&e.preventDefault()},onKeyPress:a=>{(!/[0-9]/.test(a.key)||e.quantity.length>=7)&&a.preventDefault()}}),(0,d.jsxs)("select",{value:e.unit,onChange:a=>O(e.id,"unit",a.target.value),className:"unit-select-picmatreq",required:!0,children:[(0,d.jsx)("option",{value:"",children:"Select Unit"}),(0,d.jsx)("option",{value:"kg",children:"Kilograms (kg)"}),(0,d.jsx)("option",{value:"g",children:"Grams (g)"}),(0,d.jsx)("option",{value:"ton",children:"Metric Tons (ton)"}),(0,d.jsx)("option",{value:"bag",children:"Bags"}),(0,d.jsx)("option",{value:"piece",children:"Pieces"}),(0,d.jsx)("option",{value:"box",children:"Boxes"}),(0,d.jsx)("option",{value:"roll",children:"Rolls"}),(0,d.jsx)("option",{value:"sheet",children:"Sheets"}),(0,d.jsx)("option",{value:"m",children:"Meters (m)"}),(0,d.jsx)("option",{value:"cm",children:"Centimeters (cm)"}),(0,d.jsx)("option",{value:"m2",children:"Square Meters (m\xb2)"}),(0,d.jsx)("option",{value:"m3",children:"Cubic Meters (m\xb3)"}),(0,d.jsx)("option",{value:"l",children:"Liters (L)"}),(0,d.jsx)("option",{value:"truck",children:"Truck Loads"}),(0,d.jsx)("option",{value:"set",children:"Sets"}),(0,d.jsx)("option",{value:"pair",children:"Pairs"}),(0,d.jsx)("option",{value:"bundle",children:"Bundles"})]}),(0,d.jsx)("button",{type:"button",onClick:()=>(e=>{P.materials.length>1&&M((a=>(0,s.A)((0,s.A)({},a),{},{materials:a.materials.filter((a=>a.id!==e))})))})(e.id),className:"remove-material-btn-picmatreq",disabled:1===P.materials.length,children:"\xd7"})]},e.id))),(0,d.jsx)("button",{type:"button",onClick:()=>{const e=P.materials.length?Math.max(...P.materials.map((e=>e.id)))+1:1;M((a=>(0,s.A)((0,s.A)({},a),{},{materials:[...a.materials,{id:e,materialName:"",quantity:"",unit:""}]})))},className:"add-material-btn-picmatreq",children:"+ Add Material"})]})]}),(0,d.jsxs)("div",{className:"form-group-picmatreq",children:[(0,d.jsx)("label",{className:"form-label-picmatreq",children:"Attachments"}),(0,d.jsxs)("div",{className:"upload-section-picmatreq",children:[P.attachments.length>0&&(0,d.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,d.jsx)("h4",{style:{fontSize:"14px",marginBottom:"8px",color:"#374151"},children:"Current Attachments:"}),(0,d.jsx)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:P.attachments.map(((e,a)=>(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",backgroundColor:"#f3f4f6",borderRadius:"6px",border:"1px solid #d1d5db"},children:[(0,d.jsx)(r.EHs,{style:{color:"#6b7280"}}),(0,d.jsx)("span",{style:{fontSize:"12px",color:"#374151"},children:e.name||"Attachment ".concat(a+1)}),(0,d.jsx)("button",{type:"button",onClick:()=>(e=>{M((a=>(0,s.A)((0,s.A)({},a),{},{attachments:a.attachments.filter(((a,t)=>t!==e))})))})(a),style:{background:"none",border:"none",color:"#ef4444",cursor:"pointer",fontSize:"14px",padding:"2px 6px"},children:"\xd7"})]},a)))})]}),(0,d.jsx)("input",{type:"file",id:"file-upload",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:e=>{const a=Array.from(e.target.files);_((e=>[...e,...a]));const t=a.map((e=>URL.createObjectURL(e)));I((e=>[...e,...t]))},className:"file-input-picmatreq"}),(0,d.jsxs)("label",{htmlFor:"file-upload",className:"upload-button",children:[(0,d.jsx)("span",{className:"upload-icon-picmatreq",children:"\ud83d\udcce"}),"Upload New Files"]}),E.length>0&&(0,d.jsx)("div",{className:"preview-container",style:{display:"flex",gap:"10px",flexWrap:"wrap",marginTop:"10px"},children:E.map(((e,a)=>(0,d.jsxs)("div",{style:{position:"relative"},children:[(0,d.jsx)("img",{src:e,alt:"preview-".concat(a),style:{width:"200px",height:"200px",objectFit:"cover",borderRadius:"8px",border:"1px solid #ccc"}}),(0,d.jsx)("button",{type:"button",onClick:()=>(e=>{_((a=>a.filter(((a,t)=>t!==e)))),I((a=>(URL.revokeObjectURL(a[e]),a.filter(((a,t)=>t!==e)))))})(a),style:{position:"absolute",top:"-6px",right:"-6px",background:"#ff4d4f",color:"#fff",border:"none",borderRadius:"50%",width:"20px",height:"20px",cursor:"pointer"},children:"\xd7"})]},a)))}),(0,d.jsx)("p",{className:"upload-hint-picmatreq",children:"You can attach files such as documents or images"})]})]}),(0,d.jsx)("div",{className:"form-actions-picmatreq",children:(0,d.jsx)("button",{type:"submit",className:"publish-button-picmatreq",disabled:f,style:{opacity:f?.7:1,cursor:f?"not-allowed":"pointer"},children:f?"Saving...":"Save Changes"})})]})]})})})})]})}},8227:(e,a,t)=>{t.r(a),t.d(a,{default:()=>n});t(5043);var s=t(8153),i=t(579);function n(){return(0,i.jsx)(s.default,{baseSegment:"pic"})}},8561:(e,a,t)=>{t.r(a),t.d(a,{default:()=>n});t(5043);var s=t(3182),i=t(579);const n=()=>(0,i.jsx)(s.A,{role:"Person in Charge",rootClass:"pic-request-detail",headerTitle:"Material Request Detail",headerSubtitle:"View lifecycle and receive materials"})},9278:(e,a,t)=>{t.r(a),t.d(a,{default:()=>n});t(5043);var s=t(5111),i=t(579);const n=()=>(0,i.jsx)(s.A,{role:"Person in Charge",fetchUrl:"/requests/mine",detailLinkBase:"/pic/material-request",rootClass:"pic-request-list",headerTitle:"My Material Requests",headerSubtitle:"Track, create and receive materials"})}}]);
//# sourceMappingURL=pic.2aae9599.chunk.js.map
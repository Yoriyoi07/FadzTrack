"use strict";(self.webpackChunkfadz_web_frontend=self.webpackChunkfadz_web_frontend||[]).push([[362],{64:()=>{},912:(e,s,a)=>{a.r(s),a.d(s,{default:()=>m});var t=a(9379),n=a(5043),i=a(3216),r=a(411),l=a(8818),o=a(3204),c=a(579);const d={approved:{label:"Approved",icon:(0,c.jsx)(o.A7C,{}),tone:"approved"},rejected:{label:"Rejected",icon:(0,c.jsx)(o.QCr,{}),tone:"rejected"},pending:{label:"Pending",icon:(0,c.jsx)(o.lhZ,{}),tone:"pending"},archived:{label:"Archived",icon:(0,c.jsx)(o.t69,{}),tone:"archived"}};function m(){var e,s,a,m,h,p,v,j,x,g,N,y,f,b,w;const{id:A}=(0,i.g)(),k=(0,i.Zp)(),C=localStorage.getItem("token"),S=localStorage.getItem("user"),D=S?JSON.parse(S):null,q=(null===D||void 0===D?void 0:D._id)||(null===D||void 0===D?void 0:D.id)||null,R=null===D||void 0===D?void 0:D.role,[P]=(0,n.useState)((()=>(null===D||void 0===D?void 0:D.name)||"User")),[_,M]=(0,n.useState)(null),[L,I]=(0,n.useState)(null),[T,E]=(0,n.useState)(!0),[B,F]=(0,n.useState)(""),[z,U]=(0,n.useState)(!1),[O,W]=(0,n.useState)(!1),[H,Z]=(0,n.useState)(""),[V,J]=(0,n.useState)(!1),[G,K]=(0,n.useState)(!1),[Y,Q]=(0,n.useState)(!1),[X,$]=(0,n.useState)(""),[ee,se]=(0,n.useState)({open:!1,title:"",message:"",type:"info",actions:[]}),ae=e=>se((0,t.A)((0,t.A)({open:!0},e),{},{actions:e.actions||[]})),te=()=>se((e=>(0,t.A)((0,t.A)({},e),{},{open:!1}))),[ne,ie]=(0,n.useState)(!1),[re,le]=(0,n.useState)(""),[oe,ce]=(0,n.useState)(!1),[de,me]=(0,n.useState)(!1),[ue,he]=(0,n.useState)([]),[pe,ve]=(0,n.useState)([]),je="Project Manager"===R;(0,n.useEffect)((()=>{(async()=>{E(!0),F("");try{const{data:e}=await r.Ay.get("/manpower-requests/".concat(A));M(e),U(!!e.received)}catch(e){F("Failed to load request")}finally{E(!1)}})()}),[A]);const xe=(0,n.useMemo)((()=>{var e,s;const a=(null===_||void 0===_||null===(e=_.createdBy)||void 0===e?void 0:e._id)||(null===_||void 0===_||null===(s=_.createdBy)||void 0===s?void 0:s.id)||(null===_||void 0===_?void 0:_.createdBy);return a&&q&&a===q}),[_,q]),ge="approved"===((null===_||void 0===_?void 0:_.status)||"").toLowerCase(),Ne=((0,n.useMemo)((()=>{if(null===_||void 0===_||!_.returnDate)return!1;try{return new Date>=new Date(_.returnDate)}catch(e){return!1}}),[null===_||void 0===_?void 0:_.returnDate]),(0,n.useMemo)((()=>((null===_||void 0===_?void 0:_.originalAssignments)||[]).map((e=>{var s;return(null===(s=e.donorProjectManager)||void 0===s?void 0:s._id)||e.donorProjectManager})).filter(Boolean)),[_])),ye=je&&!xe&&Ne.includes(q);(0,n.useEffect)((()=>{if(!C||!q||!je)return;(async()=>{try{const{data:e}=await r.Ay.get("/projects/assigned/projectmanager/".concat(q),{headers:{Authorization:"Bearer ".concat(C)}});I(e&&e._id?e:null)}catch(e){I(null)}})()}),[C,q,je]),(0,n.useEffect)((()=>{if(!_||xe||!je||null===L||void 0===L||!L._id)return;(async()=>{try{const{data:e}=await r.Ay.get("/manpower"),s=Array.isArray(e)?e:[],a=(_.manpowers||[]).map((e=>e.type)),t=s.filter((e=>{var s;const t=(null===(s=e.assignedProject)||void 0===s?void 0:s._id)||e.assignedProject||e.project||e.homeProject,n=t&&String(t)===String(L._id),i=a.includes(e.position);return n&&i}));he(t)}catch(e){console.error("Manpower fetch failed",e),he([])}})()}),[_,xe,je,L]);const fe=(null===L||void 0===L?void 0:L.projectName)||"your project",be=(null===_||void 0===_||null===(e=_.project)||void 0===e?void 0:e.projectName)||"this project",we=()=>{const e=((null===_||void 0===_?void 0:_.status)||"pending").toLowerCase(),s=d[e]||d.pending;return(0,c.jsxs)("span",{className:"revamp-status revamp-status--".concat(s.tone),children:[s.icon,(0,c.jsx)("span",{children:s.label})]})};return T?(0,c.jsxs)("div",{className:"dashboard-container",children:[(0,c.jsx)(l.A,{roleSegment:"pm"}),(0,c.jsx)("main",{className:"dashboard-main",children:(0,c.jsxs)("div",{className:"loading-container modern",children:[(0,c.jsx)("div",{className:"loading-spinner modern"}),(0,c.jsx)("h3",{children:"Loading Request Details"}),(0,c.jsx)("p",{children:"Please wait while we fetch the manpower request information..."})]})})]}):B||!_?(0,c.jsxs)("div",{className:"dashboard-container",children:[(0,c.jsx)(l.A,{roleSegment:"pm"}),(0,c.jsx)("main",{className:"dashboard-main",children:(0,c.jsxs)("div",{className:"error-container modern",children:[(0,c.jsx)(o.BS8,{className:"error-icon modern"}),(0,c.jsx)("h3",{children:"Unable to Load Request"}),(0,c.jsx)("p",{children:B||"The requested manpower request could not be found."}),(0,c.jsxs)("button",{className:"revamp-btn revamp-btn--primary",onClick:()=>k("/pm/manpower-list"),children:[(0,c.jsx)(o.QVr,{}),(0,c.jsx)("span",{children:"Back to Manpower List"})]})]})})]}):(0,c.jsxs)("div",{className:"dashboard-container",children:[(0,c.jsx)(l.A,{roleSegment:"pm"}),(0,c.jsxs)("main",{className:"dashboard-main revamp-detail",children:[(0,c.jsxs)("div",{className:"revamp-header",children:[(0,c.jsxs)("div",{className:"revamp-header__left",children:[(0,c.jsxs)("button",{className:"revamp-btn revamp-btn--ghost",onClick:()=>k("/pm/manpower-list"),children:[(0,c.jsx)(o.QVr,{}),(0,c.jsx)("span",{children:"Back"})]}),(0,c.jsxs)("h1",{children:["Manpower Request ",we()]}),(0,c.jsxs)("ul",{className:"revamp-meta",children:[(0,c.jsxs)("li",{children:[(0,c.jsx)(o.yd7,{})," ",(null===(s=_.project)||void 0===s?void 0:s.projectName)||"N/A"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)(o.p7b,{})," ",(null===(a=_.createdBy)||void 0===a?void 0:a.name)||"Unknown"]}),(0,c.jsxs)("li",{children:["#",_.requestNumber||(null===A||void 0===A?void 0:A.slice(-4))]})]})]}),(0,c.jsxs)("div",{className:"revamp-header__actions",children:[xe&&!ge&&(0,c.jsxs)("button",{className:"revamp-btn revamp-btn--outline",onClick:()=>k("/pm/request-manpower/edit/".concat(A)),children:[(0,c.jsx)(o.uO9,{})," Edit"]}),xe&&(0,c.jsx)("button",{className:"revamp-btn revamp-btn--danger-outline",disabled:V,onClick:()=>{K(!0)},children:V?"Deleting\u2026":"Delete"})]})]}),(0,c.jsxs)("section",{className:"revamp-cards-grid",children:[(0,c.jsxs)("div",{className:"revamp-card mini",children:[(0,c.jsx)("span",{className:"label",children:"Target Date"}),(0,c.jsx)("strong",{children:_.acquisitionDate?new Date(_.acquisitionDate).toLocaleDateString():"\u2014"})]}),(0,c.jsxs)("div",{className:"revamp-card mini",children:[(0,c.jsx)("span",{className:"label",children:"Duration"}),(0,c.jsxs)("strong",{children:[_.duration," ",_.duration>1?"days":"day"]})]}),_.returnDate&&(0,c.jsxs)("div",{className:"revamp-card mini",children:[(0,c.jsx)("span",{className:"label",children:"Return Date"}),(0,c.jsx)("strong",{children:new Date(_.returnDate).toLocaleDateString()})]}),!_.returnDate&&(null===(m=_.returnWindow)||void 0===m?void 0:m.maxReturnDate)&&(0,c.jsxs)("div",{className:"revamp-card mini",children:[(0,c.jsx)("span",{className:"label",children:"Latest Return"}),(0,c.jsx)("strong",{children:new Date(_.returnWindow.maxReturnDate).toLocaleDateString()})]}),(0,c.jsxs)("div",{className:"revamp-card mini",children:[(0,c.jsx)("span",{className:"label",children:"Project"}),(0,c.jsx)("strong",{children:(null===(h=_.project)||void 0===h?void 0:h.projectName)||"\u2014"})]}),(0,c.jsxs)("div",{className:"revamp-card mini",children:[(0,c.jsx)("span",{className:"label",children:"Status"}),we(),ge&&xe&&!z&&(0,c.jsx)("button",{type:"button",className:"revamp-btn revamp-btn--xs revamp-btn--pending",onClick:()=>{z||ce(!0)},title:"Confirm that the manpower has arrived",children:"Mark Received"}),ge&&xe&&z&&(0,c.jsx)("span",{className:"revamp-badge revamp-badge--received",title:"Manpower arrival confirmed",children:"Received"})]})]}),(0,c.jsxs)("div",{className:"revamp-sections-grid",children:[(0,c.jsxs)("section",{className:"revamp-section",children:[(0,c.jsxs)("header",{children:[(0,c.jsx)(o.YXz,{}),(0,c.jsx)("h2",{children:"Requested Manpower"})]}),null!==(p=_.manpowers)&&void 0!==p&&p.length?(0,c.jsx)("ul",{className:"revamp-manpower-list",children:_.manpowers.map(((e,s)=>(0,c.jsxs)("li",{children:[(0,c.jsx)("span",{className:"qty",children:e.quantity}),(0,c.jsx)("span",{className:"type",children:e.type})]},s)))}):(0,c.jsx)("div",{className:"revamp-empty",children:"No manpower entries"})]}),(0,c.jsxs)("section",{className:"revamp-section",children:[(0,c.jsxs)("header",{children:[(0,c.jsx)(o.t69,{}),(0,c.jsx)("h2",{children:"Description"})]}),(0,c.jsx)("p",{className:"revamp-description",children:_.description||"No description provided."})]}),!xe&&je&&!ge&&"Archived"!==(null===_||void 0===_?void 0:_.status)&&"Completed"!==(null===_||void 0===_?void 0:_.status)&&(0,c.jsxs)("section",{className:"revamp-section emphasize span-2",children:[(0,c.jsxs)("header",{children:[(0,c.jsx)(o.CMH,{}),(0,c.jsx)("h2",{children:"Approve & Assign"})]}),(0,c.jsxs)("p",{className:"hint",children:["Provide manpower from ",(0,c.jsx)("strong",{children:fe})," to ",(0,c.jsx)("strong",{children:be})]}),(0,c.jsxs)("div",{className:"hint requested",children:["Requested: ",_.manpowers.map((e=>"".concat(e.type," (").concat(e.quantity,")"))).join(", ")]}),(0,c.jsxs)("div",{className:"assign-row revamp",children:[(0,c.jsxs)("select",{defaultValue:"",onChange:e=>{const s=e.target.value;s&&ve((e=>e.includes(s)?e:[...e,s]))},children:[(0,c.jsx)("option",{value:"",children:L?ue.length?"Select manpower\u2026":"No matching manpower":"No PM project found"}),ue.filter((e=>!pe.includes(e._id))).map((e=>(0,c.jsxs)("option",{value:e._id,children:[e.name," (",e.position,")"]},e._id)))]}),(0,c.jsx)("button",{type:"button",className:"revamp-btn revamp-btn--ghost",onClick:()=>ve([]),children:"Clear"})]}),pe.length>0&&(0,c.jsx)("div",{className:"revamp-selected",children:pe.map((e=>{const s=ue.find((s=>s._id===e));return(0,c.jsxs)("span",{className:"pill",children:[s?"".concat(s.name," (").concat(s.position,")"):e,(0,c.jsx)("button",{onClick:()=>ve((s=>s.filter((s=>s!==e)))),children:"\xd7"})]},e)}))}),(0,c.jsxs)("div",{className:"revamp-actions",children:[(0,c.jsxs)("button",{className:"revamp-btn revamp-btn--danger-outline",disabled:V,onClick:()=>{je&&!xe&&ie(!0)},children:[(0,c.jsx)(o.QCr,{})," Reject"]}),(0,c.jsx)("button",{className:"revamp-btn revamp-btn--primary",disabled:V||0===pe.length,onClick:async()=>{var e;if(je&&!xe)if(null!==_&&void 0!==_&&null!==(e=_.project)&&void 0!==e&&e._id)if(0!==pe.length){J(!0);try{await r.Ay.put("/manpower-requests/".concat(A,"/approve"),{manpowerProvided:pe,project:_.project._id});const{data:e}=await r.Ay.get("/manpower-requests/".concat(A));M(e),ve([]),ae({title:"Request Approved",type:"success",message:"Manpower successfully transferred to the requesting project.",actions:[{label:"Close",primary:!0,onClick:()=>te()}]})}catch(t){var s,a;ae({title:"Approval Failed",type:"error",message:(null===t||void 0===t||null===(s=t.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.message)||"Could not approve request."})}finally{J(!1)}}else ae({title:"Selection Required",type:"warning",message:"Please select at least one manpower to assign before approving."});else ae({title:"Missing Data",type:"error",message:"Destination project id not found."})},children:V?"Processing\u2026":"Approve & Assign"})]})]}),_.rejectedBy&&_.rejectedBy.length>0&&(0,c.jsxs)("section",{className:"revamp-section danger span-2",children:[(0,c.jsxs)("header",{children:[(0,c.jsx)(o.QCr,{}),(0,c.jsx)("h2",{children:"Rejection Details"})]}),(0,c.jsxs)("p",{className:"hint",children:[(0,c.jsx)("strong",{children:"Reason:"})," ",_.rejectionReason||"No reason provided"]}),(0,c.jsx)("ul",{className:"revamp-rejections",children:_.rejectedBy.map(((e,s)=>{var a;return(0,c.jsxs)("li",{children:[e.userName||(null===(a=e.userId)||void 0===a?void 0:a.name)||"Unknown PM"," ",(0,c.jsx)("time",{children:new Date(e.rejectedAt).toLocaleDateString()})]},s)}))})]}),"Archived"===(null===_||void 0===_?void 0:_.status)&&(0,c.jsxs)("section",{className:"revamp-section archived span-2",children:[(0,c.jsxs)("header",{children:[(0,c.jsx)(o.t69,{}),(0,c.jsx)("h2",{children:"Archived"})]}),_.archivedReason&&(0,c.jsxs)("p",{className:"hint",children:[(0,c.jsx)("strong",{children:"Reason:"})," ",_.archivedReason]}),_.originalRequestDetails&&(0,c.jsxs)("div",{className:"revamp-orig",children:[(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Original Acquisition:"})," ",new Date(_.originalRequestDetails.acquisitionDate).toLocaleDateString()]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Original Duration:"})," ",_.originalRequestDetails.duration," days"]})]})]}),!xe&&je&&"Archived"!==(null===_||void 0===_?void 0:_.status)&&(0,c.jsx)("section",{className:"revamp-section subtle span-2",children:(0,c.jsx)("div",{className:"revamp-actions end",children:(0,c.jsxs)("button",{onClick:()=>{Q(!0)},className:"revamp-btn revamp-btn--outline purple",disabled:V,children:[(0,c.jsx)(o.t69,{})," ",V?"Processing\u2026":"Archive Request"]})})})]}),(0,c.jsxs)("div",{className:"revamp-footer",children:[ge&&xe&&z&&!_.returnDate&&(0,c.jsxs)("button",{className:"revamp-btn revamp-btn--primary",disabled:!z,onClick:()=>W(!0),children:[(0,c.jsx)(o.W5v,{})," Schedule Return"]}),ge&&ye&&z&&"Approved"===_.status&&(0,c.jsx)("button",{className:"revamp-btn revamp-btn--primary",disabled:V,onClick:()=>{me(!0)},title:"Return manpower and complete request",children:"Mark Manpower Returned"}),ge&&ye&&!z&&(0,c.jsx)("span",{style:{fontSize:".7rem",color:"#64748b"},children:"Waiting for requester to mark received\u2026"}),oe&&(0,c.jsx)("div",{className:"center-modal-overlay",role:"dialog","aria-modal":"true",children:(0,c.jsxs)("div",{className:"center-modal",children:[(0,c.jsx)("div",{className:"center-modal-header",children:(0,c.jsx)("h2",{children:"Confirm Manpower Received"})}),(0,c.jsxs)("div",{className:"center-modal-body",children:[(0,c.jsx)("p",{style:{marginBottom:12},children:"Please confirm that the manpower provided for this request has physically arrived and the duration is acceptable."}),(0,c.jsxs)("div",{className:"modal-warning-box info",style:{marginBottom:16},children:[(0,c.jsxs)("div",{className:"warning-header",children:[(0,c.jsx)(o.A7C,{className:"warning-icon"}),(0,c.jsx)("strong",{children:"Request Summary"})]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Requested:"})," ",_.manpowers.map((e=>"".concat(e.quantity," ").concat(e.type))).join(", ")]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Duration:"})," ",_.duration," ",_.duration>1?"days":"day"]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Target Date:"})," ",_.acquisitionDate?new Date(_.acquisitionDate).toLocaleDateString():"\u2014"]}),(null===(v=_.returnWindow)||void 0===v?void 0:v.maxReturnDate)&&(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Latest Return:"})," ",new Date(_.returnWindow.maxReturnDate).toLocaleDateString()]})]}),(0,c.jsx)("p",{style:{fontSize:13,color:"#334155"},children:"After confirming, you'll be able to schedule the return date."})]}),(0,c.jsxs)("div",{className:"center-modal-actions",children:[(0,c.jsx)("button",{type:"button",className:"modal-btn",onClick:()=>ce(!1),children:"Cancel"}),(0,c.jsx)("button",{type:"button",className:"modal-btn primary",disabled:V,onClick:async()=>{J(!0);try{await r.Ay.put("/manpower-requests/".concat(A,"/received"),{received:!0}),U(!0);const{data:e}=await r.Ay.get("/manpower-requests/".concat(A));M(e),ce(!1),ae({title:"Received Confirmed",type:"success",message:"Manpower arrival confirmed. You can now schedule a return date.",actions:[{label:"Close",primary:!0,onClick:()=>te()}]})}catch(a){var e,s;ae({title:"Failed",type:"error",message:(null===a||void 0===a||null===(e=a.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"Could not confirm reception."})}finally{J(!1)}},children:V?"Saving\u2026":"Confirm Received"})]})]})}),de&&(0,c.jsx)("div",{className:"center-modal-overlay",role:"dialog","aria-modal":"true",children:(0,c.jsxs)("div",{className:"center-modal",children:[(0,c.jsx)("div",{className:"center-modal-header",children:(0,c.jsx)("h2",{children:"Confirm Manpower Returned"})}),(0,c.jsxs)("div",{className:"center-modal-body",children:[(0,c.jsx)("p",{style:{marginBottom:12},children:"This will reclaim all manpower provided back to their original project assignments and complete the request."}),(0,c.jsxs)("div",{className:"modal-warning-box info",style:{marginBottom:16},children:[(0,c.jsxs)("div",{className:"warning-header",children:[(0,c.jsx)(o.A7C,{className:"warning-icon"}),(0,c.jsx)("strong",{children:"Return Summary"})]}),_.returnDate&&(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Scheduled Return:"})," ",new Date(_.returnDate).toLocaleDateString()]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Resources Provided:"})," ",Array.isArray(_.manpowerProvided)?_.manpowerProvided.length:0]}),(0,c.jsx)("p",{style:{fontSize:13,color:"#334155"},children:"You are identified as a donor Project Manager."})]})]}),(0,c.jsxs)("div",{className:"center-modal-actions",children:[(0,c.jsx)("button",{type:"button",className:"modal-btn",onClick:()=>me(!1),children:"Cancel"}),(0,c.jsx)("button",{type:"button",className:"modal-btn primary",disabled:V,onClick:async()=>{J(!0);try{await r.Ay.put("/manpower-requests/".concat(A,"/complete"));const{data:e}=await r.Ay.get("/manpower-requests/".concat(A));M(e),me(!1),ae({title:"Request Completed",type:"success",message:"Manpower returned and request marked completed.",actions:[{label:"Close",primary:!0,onClick:()=>te()}]})}catch(a){var e,s;ae({title:"Completion Failed",type:"error",message:(null===a||void 0===a||null===(e=a.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"Could not complete request."})}finally{J(!1)}},children:V?"Completing\u2026":"Confirm Returned"})]})]})})]}),O&&(0,c.jsx)("div",{className:"center-modal-overlay",role:"dialog","aria-modal":"true",children:(0,c.jsxs)("div",{className:"center-modal",children:[(0,c.jsx)("div",{className:"center-modal-header",children:(0,c.jsx)("h2",{children:"Schedule Return Date"})}),(0,c.jsx)("div",{className:"center-modal-body",children:(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{className:"form-label",children:"Select Return Date:"}),(0,c.jsx)("input",{type:"date",value:H,min:null!==(j=_.returnWindow)&&void 0!==j&&j.earliestReturnDate?_.returnWindow.earliestReturnDate.split("T")[0]:(new Date).toISOString().split("T")[0],max:null!==(x=_.returnWindow)&&void 0!==x&&x.maxReturnDate?_.returnWindow.maxReturnDate.split("T")[0]:void 0,onChange:e=>Z(e.target.value),className:"form-input date-input"}),(null===(g=_.returnWindow)||void 0===g?void 0:g.maxReturnDate)&&(0,c.jsxs)("p",{className:"small muted",style:{marginTop:".4rem"},children:["Latest allowed return: ",new Date(_.returnWindow.maxReturnDate).toLocaleDateString()," (",null!==(N=_.returnWindow.daysRemainingInWindow)&&void 0!==N?N:""," days remaining)"]})]})}),(0,c.jsxs)("div",{className:"center-modal-actions",children:[(0,c.jsx)("button",{type:"button",className:"modal-btn",onClick:()=>W(!1),children:"Cancel"}),(0,c.jsx)("button",{type:"button",className:"modal-btn primary",disabled:!H,onClick:async()=>{if(H)try{await r.Ay.put("/manpower-requests/".concat(A,"/return"),{returnDate:H}),W(!1);const{data:e}=await r.Ay.get("/manpower-requests/".concat(A));M(e),ae({title:"Return Scheduled",type:"success",message:"Return scheduled for ".concat(H,"."),actions:[{label:"Close",primary:!0,onClick:()=>te()}]})}catch(e){ae({title:"Failed",type:"error",message:"Failed to set return date."})}},children:"Confirm"})]})]})}),(0,c.jsx)(u,{requestId:_._id})]}),G&&(0,c.jsx)("div",{className:"center-modal-overlay error",role:"dialog","aria-modal":"true",children:(0,c.jsxs)("div",{className:"center-modal",children:[(0,c.jsx)("div",{className:"center-modal-header",children:(0,c.jsx)("h2",{children:"Confirm Request Cancellation"})}),(0,c.jsxs)("div",{className:"center-modal-body",children:[(0,c.jsxs)("div",{className:"modal-warning-box error",children:[(0,c.jsxs)("div",{className:"warning-header",children:[(0,c.jsx)(o.BS8,{className:"warning-icon"}),(0,c.jsx)("strong",{children:"Cancellation Warning"})]}),(0,c.jsx)("p",{children:"This will permanently cancel the manpower request. This action cannot be undone."})]}),(0,c.jsxs)("div",{className:"request-details-summary",children:[(0,c.jsx)("h4",{children:"Request Details:"}),(0,c.jsxs)("div",{className:"details-grid",children:[(0,c.jsxs)("div",{className:"detail-item",children:[(0,c.jsx)("span",{className:"label",children:"Project:"}),(0,c.jsx)("span",{className:"value",children:(null===_||void 0===_||null===(y=_.project)||void 0===y?void 0:y.projectName)||"Unknown"})]}),(0,c.jsxs)("div",{className:"detail-item",children:[(0,c.jsx)("span",{className:"label",children:"Manpower Requested:"}),(0,c.jsx)("span",{className:"value",children:(null===_||void 0===_||null===(f=_.manpowers)||void 0===f?void 0:f.map((e=>"".concat(e.quantity," ").concat(e.type))).join(", "))||"Unknown"})]}),(0,c.jsxs)("div",{className:"detail-item",children:[(0,c.jsx)("span",{className:"label",children:"Status:"}),(0,c.jsx)("span",{className:"value",children:(null===_||void 0===_?void 0:_.status)||"Unknown"})]}),(0,c.jsxs)("div",{className:"detail-item",children:[(0,c.jsx)("span",{className:"label",children:"Created:"}),(0,c.jsx)("span",{className:"value",children:null!==_&&void 0!==_&&_.createdAt?new Date(_.createdAt).toLocaleDateString():"Unknown"})]})]})]}),(0,c.jsxs)("p",{className:"confirmation-text",children:["Are you sure you want to ",(0,c.jsx)("strong",{children:"cancel"})," this manpower request?"]})]}),(0,c.jsxs)("div",{className:"center-modal-actions",children:[(0,c.jsx)("button",{type:"button",className:"modal-btn",onClick:()=>K(!1),children:"Keep Request"}),(0,c.jsx)("button",{type:"button",className:"modal-btn primary danger",disabled:V,onClick:async()=>{J(!0);try{await r.Ay.delete("/manpower-requests/".concat(A)),k("/pm/manpower-list")}catch(e){ae({title:"Cancel Failed",type:"error",message:"Could not cancel request."})}finally{J(!1)}},children:V?"Cancelling...":"Yes, Cancel Request"})]})]})}),Y&&(0,c.jsx)("div",{className:"center-modal-overlay warning",role:"dialog","aria-modal":"true",children:(0,c.jsxs)("div",{className:"center-modal",children:[(0,c.jsx)("div",{className:"center-modal-header",children:(0,c.jsx)("h2",{children:"Archive Manpower Request"})}),(0,c.jsxs)("div",{className:"center-modal-body",children:[(0,c.jsxs)("div",{className:"modal-warning-box warning",children:[(0,c.jsxs)("div",{className:"warning-header",children:[(0,c.jsx)(o.t69,{className:"warning-icon"}),(0,c.jsx)("strong",{children:"Archive Request"})]}),(0,c.jsx)("p",{children:"This will archive the request for record-keeping purposes. The request will be marked as archived but preserved in the system."})]}),(0,c.jsxs)("div",{className:"request-details-summary",children:[(0,c.jsx)("h4",{children:"Request Details:"}),(0,c.jsxs)("div",{className:"details-grid",children:[(0,c.jsxs)("div",{className:"detail-item",children:[(0,c.jsx)("span",{className:"label",children:"Project:"}),(0,c.jsx)("span",{className:"value",children:(null===_||void 0===_||null===(b=_.project)||void 0===b?void 0:b.projectName)||"Unknown"})]}),(0,c.jsxs)("div",{className:"detail-item",children:[(0,c.jsx)("span",{className:"label",children:"Manpower Requested:"}),(0,c.jsx)("span",{className:"value",children:(null===_||void 0===_||null===(w=_.manpowers)||void 0===w?void 0:w.map((e=>"".concat(e.quantity," ").concat(e.type))).join(", "))||"Unknown"})]}),(0,c.jsxs)("div",{className:"detail-item",children:[(0,c.jsx)("span",{className:"label",children:"Status:"}),(0,c.jsx)("span",{className:"value",children:(null===_||void 0===_?void 0:_.status)||"Unknown"})]}),(0,c.jsxs)("div",{className:"detail-item",children:[(0,c.jsx)("span",{className:"label",children:"Created:"}),(0,c.jsx)("span",{className:"value",children:null!==_&&void 0!==_&&_.createdAt?new Date(_.createdAt).toLocaleDateString():"Unknown"})]})]})]}),(0,c.jsxs)("div",{className:"archive-reason-section",children:[(0,c.jsx)("label",{className:"form-label",children:"Archive Reason (Optional):"}),(0,c.jsx)("textarea",{value:X,onChange:e=>$(e.target.value),placeholder:"Enter reason for archiving this request...",className:"form-textarea"})]})]}),(0,c.jsxs)("div",{className:"center-modal-actions",children:[(0,c.jsx)("button",{type:"button",className:"modal-btn",onClick:()=>{Q(!1),$("")},children:"Cancel"}),(0,c.jsx)("button",{type:"button",className:"modal-btn primary warning",disabled:V,onClick:async()=>{J(!0);try{await r.Ay.put("/manpower-requests/".concat(A,"/archive"),{reason:X});const{data:e}=await r.Ay.get("/manpower-requests/".concat(A));M(e),Q(!1),$(""),ae({title:"Archived",type:"success",message:"Request archived successfully.",actions:[{label:"Close",primary:!0,onClick:()=>te()}]})}catch(a){var e,s;ae({title:"Archive Failed",type:"error",message:(null===a||void 0===a||null===(e=a.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"Failed to archive request."})}finally{J(!1)}},children:V?"Archiving...":"Archive Request"})]})]})}),ne&&(0,c.jsx)("div",{className:"center-modal-overlay warning",role:"dialog","aria-modal":"true",children:(0,c.jsxs)("div",{className:"center-modal",children:[(0,c.jsx)("div",{className:"center-modal-header",children:(0,c.jsx)("h2",{children:"Reject Request"})}),(0,c.jsxs)("div",{className:"center-modal-body",children:[(0,c.jsx)("p",{style:{marginBottom:12},children:"You can optionally provide a reason for rejecting this request."}),(0,c.jsx)("textarea",{value:re,onChange:e=>le(e.target.value),placeholder:"Reason (optional)",style:{width:"100%",minHeight:90,padding:10,border:"1px solid #d1d5db",borderRadius:8,fontSize:14}})]}),(0,c.jsxs)("div",{className:"center-modal-actions",children:[(0,c.jsx)("button",{type:"button",className:"modal-btn",onClick:()=>{ie(!1),le("")},children:"Cancel"}),(0,c.jsx)("button",{type:"button",className:"modal-btn primary",disabled:V,onClick:async()=>{J(!0);try{var e;const s=await r.Ay.put("/manpower-requests/".concat(A,"/reject"),{reason:re});ie(!1),le(""),ae({title:"Request Rejected",type:"success",message:(null===(e=s.data)||void 0===e?void 0:e.message)||"The request was rejected.",actions:[{label:"Back to List",primary:!0,onClick:()=>{te(),k("/pm/manpower-list")}}]})}catch(t){var s,a;ae({title:"Rejection Failed",type:"error",message:(null===t||void 0===t||null===(s=t.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.message)||"Could not reject request."})}finally{J(!1)}},children:V?"Processing\u2026":"Reject Request"})]})]})}),ee.open&&(0,c.jsx)("div",{className:"center-modal-overlay ".concat(ee.type),role:"dialog","aria-modal":"true",children:(0,c.jsxs)("div",{className:"center-modal",children:[(0,c.jsx)("div",{className:"center-modal-header",children:(0,c.jsx)("h2",{children:ee.title})}),(0,c.jsx)("div",{className:"center-modal-body",children:(0,c.jsx)("p",{children:ee.message})}),(0,c.jsxs)("div",{className:"center-modal-actions",children:[0===ee.actions.length&&(0,c.jsx)("button",{className:"modal-btn primary",onClick:te,children:"Close"}),ee.actions.map(((e,s)=>(0,c.jsx)("button",{className:e.primary?"modal-btn primary":"modal-btn",onClick:e.onClick,children:e.label},s)))]})]})})]})}const u=e=>{let{requestId:s}=e;const[a,t]=n.useState([]),[i,l]=n.useState(!1),[d,m]=n.useState(!1),u=localStorage.getItem("token");return(0,n.useEffect)((()=>{if(!i)return;(async()=>{m(!0);try{const{data:e}=await r.Ay.get("/audit-logs",{headers:{Authorization:"Bearer ".concat(u)}}),a=e.filter((e=>{var a;return(null===(a=e.meta)||void 0===a?void 0:a.requestId)===s}));t(a)}catch(e){console.error("Audit fetch failed",e),t([])}finally{m(!1)}})()}),[i,s,u]),(0,c.jsxs)("div",{className:"revamp-audit",children:[(0,c.jsxs)("button",{className:"revamp-btn revamp-btn--ghost",onClick:()=>l(!i),style:{marginBottom:"1rem"},children:[(0,c.jsx)(o.t69,{}),(0,c.jsxs)("span",{children:[i?"Hide":"Show"," Audit Trail"]})]}),i&&(0,c.jsxs)("div",{className:"revamp-audit__panel",children:[d&&(0,c.jsx)("div",{className:"revamp-empty small",children:"Loading audit entries..."}),!d&&0===a.length&&(0,c.jsx)("div",{className:"revamp-empty small",children:"No audit entries for this request."}),!d&&a.map((e=>{var s;return(0,c.jsxs)("div",{className:"revamp-audit__row",children:[(0,c.jsx)("div",{className:"act",children:e.action}),(0,c.jsx)("div",{className:"desc",children:e.description}),(0,c.jsxs)("div",{className:"meta",children:[new Date(e.timestamp).toLocaleString()," \u2022 ",null===(s=e.performedBy)||void 0===s?void 0:s.name," (",e.performedByRole,")"]})]},e._id||e.timestamp)}))]})]})}},994:(e,s,a)=>{a.r(s),a.d(s,{default:()=>m});var t=a(5043),n=a(3216),i=a(5475),r=a(4801),l=a(7762),o=a(411),c=a(3204),d=a(579);function m(e){let{userName:s="Z",handleLogout:m}=e;const{id:u}=(0,n.g)(),[h,p]=(0,t.useState)(null),[v,j]=(0,t.useState)(""),[x,g]=(0,t.useState)(!1),[N,y]=(0,t.useState)(""),[f,b]=(0,t.useState)([]),[w,A]=(0,t.useState)(!1);(0,t.useEffect)((()=>{u&&o.Ay.get("/projects/".concat(u)).then((e=>p(e.data))).catch((e=>y("Project not found.")))}),[u]);return(0,d.jsxs)("div",{children:[(0,d.jsxs)("header",{className:"header",children:[(0,d.jsxs)("div",{className:"logo-container",children:[(0,d.jsx)("img",{src:a(8370),alt:"FadzTrack Logo",className:"logo-img"}),(0,d.jsx)("h1",{className:"brand-name",children:"FadzTrack"})]}),(0,d.jsxs)("nav",{className:"nav-menu",children:[(0,d.jsxs)(i.N_,{to:"/pm",className:"nav-link",children:[(0,d.jsx)(c.$BV,{})," Dashboard"]}),(0,d.jsxs)(i.N_,{to:"/pm/chat",className:"nav-link",children:[(0,d.jsx)(c.uN,{})," Chat"]}),(0,d.jsxs)(i.N_,{to:"/pm/request/:id",className:"nav-link",children:[(0,d.jsx)(c.H5e,{})," Material"]}),(0,d.jsxs)(i.N_,{to:"/pm/manpower-list",className:"nav-link",children:[(0,d.jsx)(c.YXz,{})," Manpower"]}),h&&(0,d.jsxs)(i.N_,{to:"/pm/viewprojects/".concat(h._id||h.id),className:"nav-link",children:[(0,d.jsx)(c.yd7,{})," View Project"]}),(0,d.jsxs)(i.N_,{to:"/pm/daily-logs",className:"nav-link",children:[(0,d.jsx)(c.kkc,{})," Logs"]}),h&&(0,d.jsxs)(i.N_,{to:"/pm/progress-report/".concat(h._id),className:"nav-link",children:[(0,d.jsx)(c.v$b,{})," Reports"]}),(0,d.jsxs)(i.N_,{to:"/pm/daily-logs-list",className:"nav-link",children:[(0,d.jsx)(c.bfZ,{})," Daily Logs"]})]}),(0,d.jsxs)("div",{className:"profile-menu-container",style:{display:"flex",alignItems:"center",gap:18},children:[(0,d.jsx)(r.A,{}),(0,d.jsx)("div",{className:"profile-circle",onClick:()=>A(!w),children:s?s.charAt(0).toUpperCase():"Z"}),w&&(0,d.jsx)("div",{className:"profile-menu",children:(0,d.jsx)("button",{onClick:m,children:"Logout"})})]})]}),(0,d.jsx)("div",{className:"pm-progress-bg",children:(0,d.jsxs)("div",{className:"pm-progress-container",children:[(0,d.jsx)("h1",{className:"pm-progress-title",children:"Progress Report"}),(0,d.jsxs)("div",{style:{margin:"24px 0"},children:[(0,d.jsx)("button",{className:"pm-btn pm-submit-btn",onClick:async()=>{g(!0),y(""),j("");try{const e=await o.Ay.get("/daily-reports/project/".concat(u)),s=[...e.data||[]].sort(((e,s)=>new Date(s.date)-new Date(e.date))).slice(0,7);b(s);const a=await o.Ay.post("/dss-report/generate-dss-report",{logs:s});j(a.data.result)}catch(e){y("Failed to generate AI analysis. Please try again."),j("")}g(!1)},disabled:x,children:x?"Generating AI Analysis...":"Generate AI Progress Report (DSS)"}),v&&(0,d.jsx)("button",{className:"pm-btn pm-download-btn",onClick:async()=>{var e;if(!v)return;const a=new l.Ay({unit:"pt",format:"a4"}),t=a.internal.pageSize.getWidth(),n=a.internal.pageSize.getHeight(),i=40;let r=40;const o="".concat("","/images/Fadz-logo.png");let c=null;try{const e=new Image;e.crossOrigin="anonymous",c=await new Promise((s=>{e.onload=()=>{const a=document.createElement("canvas");a.width=e.naturalWidth,a.height=e.naturalHeight,a.getContext("2d").drawImage(e,0,0),s({dataUrl:a.toDataURL("image/png"),w:e.naturalWidth,h:e.naturalHeight})},e.onerror=()=>s(null),e.src=o}))}catch(N){console.warn("Failed to load logo:",N)}const d=()=>{var e,n;if(r=40,null!==(e=c)&&void 0!==e&&e.dataUrl){const e=200,s=60,t=c.w/c.h;let n=e,l=e/t;l>s&&(l=s,n=s*t),a.addImage(c.dataUrl,"PNG",i,r-12,n,l),r+=l+20}(a.setFontSize(20),a.setFont("helvetica","bold"),a.setTextColor(20),a.text("FadzTrack",i,r),r+=25,a.setFontSize(16),a.setFont("helvetica","bold"),a.setTextColor(40),a.text("AI Progress Report",i,r),r+=20,h)&&(a.setFontSize(12),a.setFont("helvetica","normal"),a.setTextColor(60),a.text("Project: ".concat(h.projectName||"Unknown Project"),i,r),r+=15,null!==(n=h.location)&&void 0!==n&&n.name&&(a.text("Location: ".concat(h.location.name),i,r),r+=15));a.setFontSize(10),a.setFont("helvetica","normal"),a.setTextColor(80);const l=(new Date).toLocaleString();a.text("Generated by: ".concat(s||"Unknown User"),i,r),r+=12,a.text("Generated on: ".concat(l),i,r),r+=12,a.text("Exported by: ".concat(s||"Unknown User"),i,r),r+=12,a.text("Export Date & Time: ".concat(l),i,r),r+=20,a.setFontSize(9),a.setFont("helvetica","italic"),a.setTextColor(120),a.text("\u26a0\ufe0f DISCLAIMER: This report is generated by AI and should be reviewed for accuracy.",i,r),r+=15,a.text("The analysis is based on available data and may not reflect all project nuances.",i,r),r+=20,a.setDrawColor(200),a.setLineWidth(1),a.line(i,r,t-i,r),r+=20};d(),a.setFontSize(12),a.setFont("helvetica","normal"),a.setTextColor(20);const m=v.split("\n").filter((e=>e.trim()));let u=r;for(const s of m){u>n-100&&(a.addPage(),d(),u=r);const e=a.splitTextToSize(s,t-80);a.text(e,i,u),u+=14*e.length+10}f.length>0&&(u>n-150&&(a.addPage(),d(),u=r),a.setFontSize(14),a.setFont("helvetica","bold"),a.setTextColor(40),a.text("Daily Logs Used for Analysis:",i,u),u+=20,a.setFontSize(10),a.setFont("helvetica","normal"),a.setTextColor(60),f.forEach(((e,s)=>{u>n-100&&(a.addPage(),d(),u=r),a.text("Log ".concat(s+1," - Date: ").concat(e.date),i,u),u+=12,e.workPerformed&&Array.isArray(e.workPerformed)&&e.workPerformed.forEach((e=>{u>n-100&&(a.addPage(),d(),u=r),a.text("  \u2022 ".concat(e.task||"Unknown Task"," - Status: ").concat(e.status||"Unknown"),60,u),u+=10})),u+=10})));const p=e=>{const s=a.internal.getCurrentPageInfo().pageNumber;a.setPage(e),a.setFontSize(8),a.setFont("helvetica","normal"),a.setTextColor(120);const r="Generated: ".concat((new Date).toLocaleString()),l="Page ".concat(e," of ").concat(a.internal.getNumberOfPages());a.text(r,i,n-20),a.text(l,t-i-a.getTextWidth(l),n-20),a.setPage(s)};for(let s=1;s<=a.internal.getNumberOfPages();s++)p(s);const j="AI_Progress_Report_".concat((null===h||void 0===h||null===(e=h.projectName)||void 0===e?void 0:e.replace(/[^a-zA-Z0-9]/g,"_"))||"Unknown","_").concat((new Date).toISOString().split("T")[0],".pdf");a.save(j)},style:{marginLeft:18},children:"Download as PDF"})]}),N&&(0,d.jsx)("div",{style:{color:"red",margin:"12px 0"},children:N}),v&&(0,d.jsxs)("div",{className:"ai-report",style:{background:"#fff",padding:"18px",borderRadius:10,margin:"24px 0",boxShadow:"0 2px 12px #0002"},children:[(0,d.jsx)("h2",{children:"AI Decision Support Analysis:"}),(0,d.jsx)("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"inherit",fontSize:15},children:v})]})]})})]})}},1476:(e,s,a)=>{a.r(s),a.d(s,{default:()=>i});a(5043);var t=a(8153),n=a(579);const i=()=>(0,n.jsx)(t.default,{baseSegment:"pm"})},1501:(e,s,a)=>{a.r(s),a.d(s,{default:()=>r});a(5043);var t=a(3182),n=a(8818),i=a(579);const r=()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.A,{roleSegment:"pm"}),(0,i.jsx)(t.A,{role:"Project Manager",rootClass:"pm-request-detail",disableHeader:!0})]})},2037:(e,s,a)=>{a.r(s),a.d(s,{default:()=>h});var t=a(5043),n=a(3216),i=a(5475),r=a(411),l=a(579);const o={background:"#fff",borderRadius:12,boxShadow:"0 2px 16px rgba(0,0,0,0.07)",maxWidth:900,margin:"30px auto",padding:"32px 30px 24px 30px",display:"flex",flexDirection:"column",gap:"24px"},c={display:"flex",justifyContent:"space-between",alignItems:"flex-start"},d={display:"grid",gridTemplateColumns:"1fr 1fr",gap:22,marginBottom:12},m={fontWeight:600,fontSize:17,color:"#222",margin:"10px 0 4px"};function u(e){return e?e[0].toUpperCase()+e.slice(1):""}const h=()=>{var e;const{id:s}=(0,n.g)(),[h,p]=(0,t.useState)(null),[v,j]=(0,t.useState)(!0);if((0,t.useEffect)((()=>{r.Ay.get("/daily-reports/".concat(s)).then((e=>{p(e.data),j(!1)})).catch((()=>j(!1)))}),[s]),v)return(0,l.jsx)("div",{style:{textAlign:"center",marginTop:60,color:"#888"},children:"Loading Daily Log..."});if(!h)return(0,l.jsx)("div",{style:{textAlign:"center",marginTop:60,color:"#888"},children:"Daily Log not found."});const x=(h.siteAttendance||[]).filter((e=>"Present"===e.status)).map((e=>{var s,a;return(null===(s=e.manpower)||void 0===s?void 0:s.name)||(null===(a=e.manpower)||void 0===a?void 0:a.fullName)||e.manpower||""})),g=(h.siteAttendance||[]).filter((e=>"Absent"===e.status)).map((e=>{var s,a;return(null===(s=e.manpower)||void 0===s?void 0:s.name)||(null===(a=e.manpower)||void 0===a?void 0:a.fullName)||e.manpower||""})),N=h.attachmentProof||[];return(0,l.jsxs)("div",{children:[(0,l.jsxs)("header",{className:"header",children:[(0,l.jsxs)("div",{className:"logo-container",children:[(0,l.jsx)("img",{src:a(8370),alt:"FadzTrack Logo",className:"logo-img"}),(0,l.jsx)("h1",{className:"brand-name",children:"FadzTrack"})]}),(0,l.jsxs)("nav",{className:"nav-menu",children:[(0,l.jsx)(i.N_,{to:"/pm",className:"nav-link",children:"Dashboard"}),(0,l.jsx)(i.N_,{to:"/pm/request/:id",className:"nav-link",children:"Material"}),(0,l.jsx)(i.N_,{to:"/pm/manpower-list",className:"nav-link",children:"Manpower"}),(0,l.jsx)(i.N_,{to:"/pm/viewprojects",className:"nav-link",children:"View Project"}),(0,l.jsx)(i.N_,{to:"/chat",className:"nav-link",children:"Chat"}),(0,l.jsx)(i.N_,{to:"/pm/daily-logs",className:"nav-link",children:"Logs"}),(0,l.jsx)(i.N_,{to:"/pm/progress-report/:id",className:"nav-link",children:"Reports"}),(0,l.jsx)(i.N_,{to:"/pm/daily-logs-list",className:"nav-link",children:"Daily Logs"})]})]}),(0,l.jsxs)("div",{style:o,children:[(0,l.jsx)("h1",{style:{textAlign:"center",margin:0,fontSize:36,fontWeight:700},children:h.title||h.logTitle||"Daily Log No. ".concat(h.logNumber||"")}),(0,l.jsxs)("div",{style:{textAlign:"center",fontWeight:600,color:"#191970",fontSize:17},children:[(null===(e=h.project)||void 0===e?void 0:e.projectName)||h.projectName||"\u2014",h.site&&" | ".concat(h.site),h.engineer&&(0,l.jsxs)(l.Fragment,{children:[" | Engr. ",h.engineer]})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:24,justifyContent:"center",marginBottom:6},children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{style:{fontWeight:600},children:"Date:"})," ",h.date?new Date(h.date).toLocaleDateString("en-US"):"\u2014"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{style:{fontWeight:600},children:"Weather:"})," ",u(h.weatherCondition)||"\u2014"]})]}),(0,l.jsxs)("div",{style:d,children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:m,children:"Attendance Summary"}),(0,l.jsxs)("div",{style:{display:"flex",gap:14,marginTop:8},children:[(0,l.jsxs)("div",{style:{flex:1,textAlign:"center",background:"#fafbff",borderRadius:9,padding:10,border:"1px solid #ececec"},children:[(0,l.jsx)("div",{style:{fontWeight:600,color:"#43af43",marginBottom:4},children:"Present"}),0===x.length?(0,l.jsx)("span",{style:{color:"#aaa"},children:"\u2014"}):x.map(((e,s)=>(0,l.jsx)("div",{children:e},s)))]}),(0,l.jsxs)("div",{style:{flex:1,textAlign:"center",background:"#fafbff",borderRadius:9,padding:10,border:"1px solid #ececec"},children:[(0,l.jsx)("div",{style:{fontWeight:600,color:"#b34e2c",marginBottom:4},children:"Absent"}),0===g.length?(0,l.jsx)("span",{style:{color:"#aaa"},children:"\u2014"}):g.map(((e,s)=>(0,l.jsx)("div",{children:e},s)))]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:m,children:"Material Deliveries"}),(0,l.jsx)("div",{style:{background:"#fafbff",borderRadius:9,padding:10,minHeight:50,border:"1px solid #ececec",display:"flex",alignItems:"center",minWidth:0},children:0===(h.materialDeliveries||[]).length?(0,l.jsx)("span",{style:{color:"#aaa"},children:"\u2014"}):h.materialDeliveries.map(((e,s)=>{var a;return(0,l.jsx)("div",{children:null!==(a=e.delivery)&&void 0!==a&&a.requestNumber?(0,l.jsxs)(l.Fragment,{children:["Request number ",e.delivery.requestNumber," - ",e.delivery.poNumber]}):"string"===typeof e.delivery?e.delivery:"\u2014"},s)}))})]})]}),(0,l.jsxs)("div",{style:c,children:[(0,l.jsxs)("div",{style:{flex:1,marginRight:18},children:[(0,l.jsx)("div",{style:m,children:"Work Performed Today"}),(0,l.jsx)("div",{style:{background:"#fafbff",borderRadius:9,padding:10,minHeight:60,border:"1px solid #ececec",whiteSpace:"pre-line"},children:0===(h.workPerformed||[]).length?(0,l.jsx)("span",{style:{color:"#aaa"},children:"\u2014"}):h.workPerformed.map(((e,s)=>(0,l.jsxs)("div",{children:[e.task," - ",u(e.status)]},s)))})]}),(0,l.jsxs)("div",{style:{flex:1,marginLeft:18},children:[(0,l.jsx)("div",{style:m,children:"Additional Remarks"}),(0,l.jsx)("div",{style:{background:"#fafbff",borderRadius:9,padding:10,minHeight:60,border:"1px solid #ececec",maxHeight:90,overflow:"auto"},children:h.remarks||(0,l.jsx)("span",{style:{color:"#aaa"},children:"\u2014"})})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:m,children:"Attachment Proof"}),(0,l.jsx)("div",{style:{display:"flex",gap:24,justifyContent:"flex-start",marginTop:8,flexWrap:"wrap"},children:0===N.length?(0,l.jsx)("span",{style:{color:"#aaa"},children:"\u2014"}):N.map(((e,s)=>(0,l.jsx)("img",{src:e,alt:"proof-".concat(s),style:{width:180,height:120,objectFit:"cover",borderRadius:9,border:"1px solid #e6e6e6"}},s)))})]})]})]})}},2393:(e,s,a)=>{a.r(s),a.d(s,{default:()=>d});var t=a(5043),n=a(3216),i=a(5475),r=(a(2660),a(64),a(411)),l=a(3204),o=a(8818),c=a(579);const d=()=>{const e=(0,n.Zp)(),s=(0,t.useRef)(null);if(null===s.current){const e=localStorage.getItem("user");s.current=e?JSON.parse(e):null}const a=s.current,[d,m]=(0,t.useState)([]),[u,h]=(0,t.useState)(!0),[p,v]=(0,t.useState)(""),[j,x]=(0,t.useState)("All"),[g,N]=(0,t.useState)(""),[y,f]=(0,t.useState)(1),[b,w]=(0,t.useState)("cards"),[A,k]=(0,t.useState)(!0),[C,S]=(0,t.useState)("mine");(0,t.useEffect)((()=>{if(!a||"Project Manager"!==a.role)return;let e=!0;return(async()=>{h(!0),v("");try{if("mine"===C){const{data:s}=await r.Ay.get("/manpower-requests/mine");if(!e)return;m(Array.isArray(s)?s:[])}else{const{data:s}=await r.Ay.get("/manpower-requests");if(!e)return;const t=(Array.isArray(s)?s:[]).filter((e=>{var s,t;const n=(null===(s=e.createdBy)||void 0===s?void 0:s._id)||(null===(t=e.createdBy)||void 0===t?void 0:t.id)||e.createdBy;return n&&n!==a._id}));m(t)}}catch(s){if(!e)return;console.error("Failed to load manpower requests:",s),!s.response||401!==s.response.status&&403!==s.response.status?v("Failed to load manpower requests"):v("Session expired or unauthorized. Please login.")}finally{e&&(h(!1),f(1))}})(),()=>{e=!1}}),[a,C]);const D=(0,t.useMemo)((()=>{let e=d;if(e="All"!==j?"Archived"===j?e.filter((e=>(e.status||"Pending").toLowerCase().includes("archived"))):e.filter((e=>(e.status||"Pending").toLowerCase().includes(j.toLowerCase()))):e.filter((e=>!(e.status||"Pending").toLowerCase().includes("archived"))),g){const s=g.toLowerCase();e=e.filter((e=>{var a,t;const n=(null===(a=e.project)||void 0===a?void 0:a.projectName)||"",i=(null===(t=e.createdBy)||void 0===t?void 0:t.name)||"",r=(e.manpowers||[]).map((e=>"".concat(e.quantity," ").concat(e.type))).join(", ");return n.toLowerCase().includes(s)||i.toLowerCase().includes(s)||r.toLowerCase().includes(s)||(e.description||"").toLowerCase().includes(s)}))}return e}),[d,j,g]),q=(0,t.useMemo)((()=>[...D].sort(((e,s)=>{const a=new Date(e.createdAt||0).getTime(),t=new Date(s.createdAt||0).getTime();return A?t-a:a-t}))),[D,A]),R=Math.max(1,Math.ceil(q.length/8)),P=(0,t.useMemo)((()=>{const e=8*(y-1);return q.slice(e,e+8)}),[q,y]),_=(0,t.useMemo)((()=>{let e=0,s=0,a=0,t=0,n=0,i=0;return d.forEach((r=>{const l=(r.status||"Pending").toLowerCase(),o="pending"===l&&r.acquisitionDate&&new Date(r.acquisitionDate)<new Date;l.includes("archived")?i++:l.includes("completed")?a++:l.includes("approved")?s++:l.includes("reject")||l.includes("denied")||l.includes("cancel")?t++:o||l.includes("overdue")?n++:e++})),{total:d.length,pending:e,approved:s,rejected:t,overdue:n,completed:a,archived:i}}),[d]),M=(0,t.useMemo)((()=>({All:_.total-_.archived,Pending:_.pending,Overdue:_.overdue,Approved:_.approved,Completed:_.completed,Rejected:_.rejected,Archived:_.archived})),[_]);return a&&"Project Manager"===a.role?(0,c.jsxs)("div",{className:"dashboard-container ceo-manpower-requests-page",children:[(0,c.jsx)(o.A,{roleSegment:"pm"}),(0,c.jsx)("main",{className:"dashboard-main",children:(0,c.jsxs)("div",{className:"page-container",children:[(0,c.jsxs)("div",{className:"dashboard-card ceo-mr-header-card",children:[(0,c.jsxs)("div",{className:"card-header mr-header-row",children:[(0,c.jsxs)("div",{className:"mr-header-texts",children:[(0,c.jsx)("h1",{className:"card-title",children:"Manpower Requests"}),(0,c.jsx)("p",{className:"card-subtitle",children:"Manage and track manpower requests for your project"})]}),(0,c.jsxs)("div",{className:"layout-toggle-wrapper",children:[(0,c.jsx)("button",{type:"button",className:"btn-primary request-manpower-btn",onClick:()=>e("/pm/request-manpower"),style:{marginRight:12},children:"+ Request Manpower"}),(0,c.jsx)("button",{onClick:()=>k(!A),className:"btn-secondary sort-btn",title:"Toggle sort by Created date",children:A?"\u2193 Newest":"\u2191 Oldest"})]})]}),(0,c.jsx)("div",{className:"card-body mr-filters-row",children:(0,c.jsxs)("div",{className:"horizontal-controls",children:[(0,c.jsx)("div",{className:"filter-tabs compact",children:["All","Pending","Overdue","Approved","Completed","Rejected","Archived"].map((e=>{var s;return(0,c.jsxs)("button",{className:"filter-tab ".concat(j===e?"active":""),onClick:()=>{x(e),f(1)},children:[(0,c.jsx)("span",{children:e}),(0,c.jsx)("span",{className:"count",children:null!==(s=M[e])&&void 0!==s?s:0})]},e)}))}),(0,c.jsxs)("div",{className:"search-wrapper",children:[(0,c.jsx)(l.KSO,{className:"search-icon"}),(0,c.jsx)("input",{type:"text",placeholder:"Search requests...",value:g,onChange:e=>{N(e.target.value),f(1)},className:"search-input"})]}),(0,c.jsxs)("div",{className:"view-mode-toggle small",children:[(0,c.jsx)("button",{onClick:()=>S("mine"),className:"view-mode-btn ".concat("mine"===C?"active":""),title:"My Requests",children:"Mine"}),(0,c.jsx)("button",{onClick:()=>S("others"),className:"view-mode-btn ".concat("others"===C?"active":""),title:"Others' Requests",children:"Others"})]}),(0,c.jsxs)("div",{className:"layout-toggle small",children:[(0,c.jsx)("button",{onClick:()=>w("cards"),className:"layout-btn ".concat("cards"===b?"active":""),title:"Card View",children:(0,c.jsx)(l.QJV,{})}),(0,c.jsx)("button",{onClick:()=>w("table"),className:"layout-btn ".concat("table"===b?"active":""),title:"Table View",children:(0,c.jsx)(l.svy,{})})]})]})})]}),(0,c.jsxs)("div",{className:"dashboard-card ceo-mr-list-card",children:[(0,c.jsx)("div",{className:"card-header list-header",children:(0,c.jsxs)("h3",{className:"card-title-sm",children:["Requests ",(0,c.jsxs)("span",{className:"muted",children:["(",q.length,")"]})]})}),(0,c.jsx)("div",{className:"requests-grid ceo-mr-grid ".concat("table"===b?"table-view":""),children:u?(0,c.jsxs)("div",{className:"loading-state",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Loading manpower requests..."})]}):p?(0,c.jsx)("div",{className:"error-state",children:(0,c.jsx)("p",{children:p})}):0===P.length?(0,c.jsxs)("div",{className:"empty-state",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"300px",textAlign:"center"},children:[(0,c.jsx)("div",{className:"empty-icon",style:{fontSize:"48px",marginBottom:"16px"},children:"\ud83d\udc65"}),(0,c.jsx)("h3",{style:{marginBottom:"8px",color:"#374151"},children:"No manpower requests found"}),(0,c.jsx)("p",{style:{color:"#6b7280",margin:0},children:"No requests match your current filters. Try adjusting your search criteria."})]}):(0,c.jsxs)(c.Fragment,{children:["table"===b&&(0,c.jsxs)("div",{className:"mr-table-header",role:"row","aria-label":"Table Header",children:[(0,c.jsx)("div",{children:"Project"}),(0,c.jsx)("div",{children:"Requester"}),(0,c.jsx)("div",{children:"Description"}),(0,c.jsx)("div",{children:"Manpower"}),(0,c.jsx)("div",{children:"Target"}),(0,c.jsx)("div",{children:"Dur"}),(0,c.jsx)("div",{children:"Created"}),(0,c.jsx)("div",{children:"Status"}),(0,c.jsx)("div",{children:"Actions"})]}),P.map((e=>{var s,a,t,n;const r=(e.manpowers||[]).map((e=>"".concat(e.quantity," ").concat(e.type))).join(", "),l=(e=>{const s=(e.status||"Pending").toLowerCase();return"pending"===s&&e.acquisitionDate&&new Date(e.acquisitionDate)<new Date?"Overdue":s.includes("archived")?"Archived":s.includes("completed")?"Completed":s.includes("approved")?"Approved":s.includes("pending")?"Pending":s.includes("reject")||s.includes("denied")||s.includes("cancel")?"Rejected":s.includes("overdue")?"Overdue":"Unknown"})(e);(e=>{const s=(e.status||"Pending").toLowerCase();"pending"===s&&e.acquisitionDate&&new Date(e.acquisitionDate)<new Date||(s.includes("archived")||(s.includes("completed")||(s.includes("approved")||(s.includes("pending")||(s.includes("reject")||s.includes("denied")||s.includes("cancel")||s.includes("overdue"))))))})(e);var o,d,m,u;return"table"===b?(0,c.jsxs)("div",{className:"mr-table-row",role:"row",title:"View details",children:[(0,c.jsx)("div",{className:"rt-title",title:(null===(o=e.project)||void 0===o?void 0:o.projectName)||"(No Project Name)",children:(null===(d=e.project)||void 0===d?void 0:d.projectName)||"(No Project Name)"}),(0,c.jsx)("div",{className:"rt-req",title:(null===(m=e.createdBy)||void 0===m?void 0:m.name)||"Unknown",children:(null===(u=e.createdBy)||void 0===u?void 0:u.name)||"Unknown"}),(0,c.jsx)("div",{className:"rt-desc",title:e.description||"No description",children:e.description||"No description"}),(0,c.jsx)("div",{className:"rt-man",title:r||"\u2014",children:r||"\u2014"}),(0,c.jsx)("div",{className:"rt-date",title:"Target Date",children:e.acquisitionDate?new Date(e.acquisitionDate).toLocaleDateString():"\u2014"}),(0,c.jsxs)("div",{className:"rt-date",title:"Duration",children:[e.duration||"\u2014","d"]}),(0,c.jsx)("div",{className:"rt-date",title:"Created",children:e.createdAt?new Date(e.createdAt).toLocaleDateString():"\u2014"}),(0,c.jsx)("div",{className:"rt-btn",children:(0,c.jsx)("span",{className:"status-chip ".concat(l.toLowerCase()),children:l})}),(0,c.jsx)("div",{className:"rt-actions",children:(0,c.jsx)(i.N_,{to:"/pm/manpower-request/".concat(e._id),className:"view-details-btn",children:"View Details"})})]},e._id):(0,c.jsxs)("div",{className:"request-card ceo-mr-card",children:[(0,c.jsxs)("div",{className:"card-body",children:[(0,c.jsxs)("div",{className:"mr-card-top-row",children:[(0,c.jsx)("h3",{className:"request-title",title:(null===(s=e.project)||void 0===s?void 0:s.projectName)||"(No Project Name)",children:(null===(a=e.project)||void 0===a?void 0:a.projectName)||"(No Project Name)"}),(0,c.jsx)("span",{className:"status-chip ".concat(l.toLowerCase()),children:l})]}),(0,c.jsx)("p",{className:"request-description",title:e.description||"No description provided",children:e.description||"No description provided"}),(0,c.jsxs)("div",{className:"request-meta",children:[(0,c.jsxs)("div",{className:"meta-item",children:[(0,c.jsx)("span",{className:"meta-label",children:"Requested by:"}),(0,c.jsx)("span",{className:"meta-value",title:(null===(t=e.createdBy)||void 0===t?void 0:t.name)||"Unknown",children:(null===(n=e.createdBy)||void 0===n?void 0:n.name)||"Unknown"})]}),(0,c.jsxs)("div",{className:"meta-item",children:[(0,c.jsx)("span",{className:"meta-label",children:"Manpower:"}),(0,c.jsx)("span",{className:"meta-value",title:r||"\u2014",children:r||"\u2014"})]}),(0,c.jsxs)("div",{className:"meta-item",children:[(0,c.jsx)("span",{className:"meta-label",children:"Date:"}),(0,c.jsx)("span",{className:"meta-value",children:e.createdAt?new Date(e.createdAt).toLocaleDateString():"\u2014"})]}),(0,c.jsxs)("div",{className:"meta-item",children:[(0,c.jsx)("span",{className:"meta-label",children:"Target:"}),(0,c.jsx)("span",{className:"meta-value",children:e.acquisitionDate?new Date(e.acquisitionDate).toLocaleDateString():"\u2014"})]}),(0,c.jsxs)("div",{className:"meta-item",children:[(0,c.jsx)("span",{className:"meta-label",children:"Duration:"}),(0,c.jsxs)("span",{className:"meta-value",children:[e.duration||"\u2014"," d"]})]})]}),e.rejectedBy&&e.rejectedBy.length>0&&(0,c.jsxs)("div",{className:"rejection-info",children:[(0,c.jsxs)("div",{className:"meta-item",children:[(0,c.jsx)("span",{className:"meta-label",children:"Rejected by:"}),(0,c.jsx)("span",{className:"meta-value rejection-list",children:e.rejectedBy.map(((s,a)=>{var t;return(0,c.jsxs)("span",{className:"rejection-item",children:[s.userName||(null===(t=s.userId)||void 0===t?void 0:t.name)||"Unknown PM",a<e.rejectedBy.length-1?", ":""]},a)}))})]}),e.rejectionReason&&(0,c.jsxs)("div",{className:"meta-item",children:[(0,c.jsx)("span",{className:"meta-label",children:"Reason:"}),(0,c.jsx)("span",{className:"meta-value rejection-reason",children:e.rejectionReason})]})]})]}),(0,c.jsx)("div",{className:"card-footer",children:(0,c.jsx)(i.N_,{to:"/pm/manpower-request/".concat(e._id),className:"view-details-btn",children:"View Details"})})]},e._id)}))]})}),q.length>0&&(0,c.jsxs)("div",{className:"pagination-section inside-card",children:[(0,c.jsxs)("div",{className:"pagination-info",children:["Showing ",8*(y-1)+1," to ",Math.min(8*y,q.length)," of ",q.length," entries"]}),(0,c.jsxs)("div",{className:"pagination-controls",children:[(0,c.jsx)("button",{onClick:()=>f((e=>Math.max(e-1,1))),disabled:1===y,className:"pagination-btn",children:"Previous"}),Array.from({length:R},((e,s)=>s+1)).map((e=>(0,c.jsx)("button",{className:"pagination-btn ".concat(e===y?"active":""),onClick:()=>f(e),children:e},e))),(0,c.jsx)("button",{onClick:()=>f((e=>Math.min(e+1,R))),disabled:y===R,className:"pagination-btn",children:"Next"})]})]})]})]})})]}):(0,c.jsxs)("div",{style:{padding:24},children:[(0,c.jsx)("h2",{children:"Forbidden"}),(0,c.jsx)("p",{children:"You must be a Project Manager to view this page."})]})}},2660:()=>{},2869:(e,s,a)=>{a.r(s),a.d(s,{default:()=>i});a(5043);var t=a(1245),n=(a(8818),a(579));function i(){return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(t.A,{role:"pm",useUnifiedHeader:!0})})}},3011:(e,s,a)=>{a.r(s),a.d(s,{default:()=>d});var t=a(9379),n=a(5043),i=a(3216),r=a(411),l=a(8818),o=a(3204),c=a(579);const d=()=>{const e=(0,i.Zp)(),s=localStorage.getItem("user"),a=s?JSON.parse(s):null,d=localStorage.getItem("token"),m=null===a||void 0===a?void 0:a._id,{id:u}=(0,i.g)(),[h,p]=(0,n.useState)(null),[v,j]=(0,n.useState)(""),[x,g]=(0,n.useState)(!0),[N,y]=(0,n.useState)(!!u),[f,b]=(0,n.useState)({acquisitionDate:"",duration:"",project:"",manpowers:[{type:"",quantity:""}],description:""}),[w,A]=(0,n.useState)([]),[k,C]=(0,n.useState)(null),[S,D]=(0,n.useState)({}),[q,R]=(0,n.useState)({open:!1,title:"",message:"",type:"info",actions:[]}),P=e=>{let{title:s,message:a,type:t="info",actions:n}=e;R({open:!0,title:s,message:a,type:t,actions:n||[]})},_=()=>R((e=>(0,t.A)((0,t.A)({},e),{},{open:!1})));(0,n.useEffect)((()=>{(async()=>{try{const{data:e}=await r.Ay.get("/manpower/types/list"),s=e.types||[];A(s),console.log("[Autocomplete] Loaded manpower types:",s.length)}catch(e){console.error("Failed to load manpower types",e)}})()}),[]),(0,n.useEffect)((()=>{const e=JSON.parse(localStorage.getItem("user"));e&&e._id&&r.Ay.get("/projects/assigned/projectmanager/".concat(e._id)).then((e=>{const s=e.data;s&&s._id&&(p(s),b((e=>(0,t.A)((0,t.A)({},e),{},{project:s._id}))))})).catch((e=>console.error("Error fetching project",e)))}),[]),(0,n.useEffect)((()=>{u?r.Ay.get("/manpower-requests/".concat(u)).then((e=>{const s=e.data;var a;s&&(y(!0),b({acquisitionDate:s.acquisitionDate?s.acquisitionDate.split("T")[0]:"",duration:s.duration||"",project:(null===(a=s.project)||void 0===a?void 0:a._id)||s.project||"",manpowers:s.manpowers&&s.manpowers.length>0?s.manpowers:[{type:"",quantity:""}],description:s.description||""}),p(s.project))})).finally((()=>g(!1))):(y(!1),g(!1))}),[u]);const M=(e,s,a)=>{b((n=>{const i=n.manpowers.map(((n,i)=>i===e?(0,t.A)((0,t.A)({},n),{},{[s]:a}):n));return(0,t.A)((0,t.A)({},n),{},{manpowers:i})}))},L=e=>{const{name:s,value:a}=e.target;b((e=>(0,t.A)((0,t.A)({},e),{},{[s]:a})))};(0,n.useEffect)((()=>{if(!d||!a)return;(async()=>{try{const{data:e}=await r.Ay.get("/projects"),s=e.filter((e=>e.projectManager&&("object"===typeof e.projectManager&&(e.projectManager._id===m||e.projectManager.id===m)||e.projectManager===m)));j(s)}catch(e){console.error("Failed to fetch projects:",e)}})()}),[a,m]);return x?(0,c.jsx)("div",{className:"dashboard-container",children:(0,c.jsxs)("div",{className:"loading-container",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Loading manpower request form..."})]})}):(0,c.jsxs)("div",{className:"dashboard-container",children:[(0,c.jsx)(l.A,{roleSegment:"pm"}),(0,c.jsx)("main",{className:"dashboard-main",children:(0,c.jsxs)("div",{className:"content-wrapper",children:[(0,c.jsx)("div",{className:"page-header",children:(0,c.jsxs)("div",{className:"page-header-content",children:[(0,c.jsxs)("button",{onClick:()=>e("/pm/manpower-list"),className:"back-button",children:[(0,c.jsx)(o.QVr,{}),(0,c.jsx)("span",{children:"Back to Manpower List"})]}),(0,c.jsxs)("div",{className:"page-title-section",children:[(0,c.jsx)("h1",{className:"page-title",children:N?"Edit Manpower Request":"Request Manpower"}),(0,c.jsx)("p",{className:"page-subtitle",children:N?"Update your manpower request details":"Submit a new manpower request for your project"})]})]})}),(0,c.jsx)("div",{className:"form-container",children:(0,c.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),!f.acquisitionDate||!f.duration||!f.project||!f.description)return void P({title:"Incomplete Form",message:"All fields are required before submitting the manpower request.",type:"warning",actions:[{label:"Close",onClick:()=>_(),primary:!0}]});if(!f.manpowers.every((e=>"string"===typeof e.type&&""!==e.type.trim()&&""!==e.quantity&&!isNaN(Number(e.quantity))&&Number(e.quantity)>0)))return void P({title:"Invalid Manpower Entries",message:"Each manpower row must have a type (text) and a quantity greater than 0.",type:"warning",actions:[{label:"Fix Entries",onClick:()=>_(),primary:!0}]});const a={acquisitionDate:f.acquisitionDate,duration:Number(f.duration),project:f.project,description:f.description,manpowers:f.manpowers.map((e=>({type:e.type.trim(),quantity:Number(e.quantity)})))};try{let s="/manpower-requests",n="post";N&&(s="/manpower-requests/".concat(u),n="put");const i=await r.Ay[n](s,a);var t;if(200===i.status||201===i.status)P({title:N?"Request Updated":"Request Submitted",type:"success",message:N?"The manpower request has been successfully updated.":"Your manpower request has been submitted successfully.",actions:[{label:"Go to Manpower List",onClick:()=>{_(),e("/pm/manpower-list")},primary:!0},N?null:{label:"Create Another",onClick:()=>{_(),b({acquisitionDate:"",duration:"",project:f.project,manpowers:[{type:"",quantity:""}],description:""})}}].filter(Boolean)});else P({title:"Submission Error",type:"error",message:(null===(t=i.data)||void 0===t?void 0:t.message)||"Failed to submit request. Please try again.",actions:[{label:"Close",onClick:()=>_(),primary:!0}]})}catch(n){console.error("\u274c Submission error:",n),P({title:"Network Error",type:"error",message:"Failed to connect to server. Please check your connection and try again.",actions:[{label:"Close",onClick:()=>_(),primary:!0}]})}},className:"manpower-form",children:[h&&(0,c.jsxs)("div",{className:"form-section",children:[(0,c.jsx)("div",{className:"section-header",children:(0,c.jsx)("h3",{children:"Project Information"})}),(0,c.jsx)("div",{className:"form-row",children:(0,c.jsxs)("div",{className:"form-group full-width",children:[(0,c.jsx)("label",{htmlFor:"projectName",children:"Project Name"}),(0,c.jsx)("input",{type:"text",id:"projectName",value:h.projectName||"Project Name Not Available",readOnly:!0,className:"readonly-input"})]})})]}),(0,c.jsx)("div",{className:"form-section",children:(0,c.jsxs)("div",{style:{display:"flex",gap:"1rem",alignItems:"end"},children:[(0,c.jsxs)("div",{style:{flex:"1"},children:[(0,c.jsx)("label",{htmlFor:"acquisitionDate",style:{display:"block",marginBottom:"0.5rem",fontWeight:"500"},children:"Target Date"}),(0,c.jsx)("input",{type:"date",id:"acquisitionDate",name:"acquisitionDate",value:f.acquisitionDate,onChange:L,required:!0,className:"form-input"})]}),(0,c.jsxs)("div",{style:{flex:"1"},children:[(0,c.jsx)("label",{htmlFor:"duration",style:{display:"block",marginBottom:"0.5rem",fontWeight:"500"},children:"Duration"}),(0,c.jsx)("input",{type:"number",id:"duration",name:"duration",min:"1",placeholder:"Days",value:f.duration,onChange:L,required:!0,className:"form-input"})]})]})}),(0,c.jsxs)("div",{className:"form-section",children:[(0,c.jsxs)("div",{className:"section-header",children:[(0,c.jsx)("h3",{children:"Manpower Requirements"}),(0,c.jsx)("p",{className:"section-description",children:"Add the types and quantities of manpower needed"})]}),(0,c.jsxs)("div",{className:"manpower-table",children:[(0,c.jsxs)("div",{className:"table-header",children:[(0,c.jsx)("div",{className:"header-cell",children:"Type"}),(0,c.jsx)("div",{className:"header-cell",children:"Qty"}),(0,c.jsx)("div",{className:"header-cell actions",children:"Actions"})]}),f.manpowers.map(((e,s)=>{var a;const n=(w||[]).filter((s=>!e.type||s.toLowerCase().includes(e.type.toLowerCase()))).slice(0,15),i=k===s,r=null!==(a=S[s])&&void 0!==a?a:-1;return(0,c.jsxs)("div",{className:"table-row",style:{position:"relative"},children:[(0,c.jsxs)("div",{className:"table-cell",style:{position:"relative"},children:[(0,c.jsx)("input",{type:"text",placeholder:"e.g., Electrician, Plumber",value:e.type,onChange:e=>M(s,"type",e.target.value),onFocus:()=>{C(s)},onBlur:()=>{setTimeout((()=>{C((e=>e===s?null:e))}),160)},onKeyDown:e=>{if(i)if(["ArrowDown","ArrowUp","Enter","Tab","Escape"].includes(e.key)&&e.preventDefault(),"ArrowDown"===e.key){if(0===n.length)return;D((e=>(0,t.A)((0,t.A)({},e),{},{[s]:(r+1)%n.length})))}else if("ArrowUp"===e.key){if(0===n.length)return;D((e=>(0,t.A)((0,t.A)({},e),{},{[s]:(r-1+n.length)%n.length})))}else"Enter"===e.key?r>=0&&n[r]&&(M(s,"type",n[r]),C(null),D((e=>(0,t.A)((0,t.A)({},e),{},{[s]:-1})))):"Escape"===e.key&&(C(null),D((e=>(0,t.A)((0,t.A)({},e),{},{[s]:-1}))))},required:!0,autoComplete:"off",className:"form-input"}),i&&(0,c.jsxs)("ul",{id:"mp-type-dd-".concat(s),className:"type-suggestions",style:{listStyle:"none",margin:0,padding:"4px 0",position:"absolute",top:"100%",left:0,right:0,background:"#fff",border:"1px solid #e5e7eb",zIndex:1e3,maxHeight:200,overflowY:"auto",borderRadius:6,boxShadow:"0 4px 12px rgba(0,0,0,0.08)"},children:[0===n.length&&(0,c.jsx)("li",{style:{padding:"6px 10px",fontSize:12,color:"#6b7280"},children:"No types found"}),n.map(((e,a)=>(0,c.jsx)("li",{style:{padding:"6px 10px",cursor:"pointer",fontSize:13,background:a===r?"#f3f4f6":"#fff"},onMouseDown:a=>{a.preventDefault(),M(s,"type",e),C(null),D((e=>(0,t.A)((0,t.A)({},e),{},{[s]:-1})))},onMouseEnter:()=>D((e=>(0,t.A)((0,t.A)({},e),{},{[s]:a}))),children:e},e)))]})]}),(0,c.jsx)("div",{className:"table-cell",children:(0,c.jsx)("input",{type:"number",placeholder:"Qty",min:"1",value:e.quantity,onChange:e=>M(s,"quantity",e.target.value),required:!0,className:"form-input"})}),(0,c.jsx)("div",{className:"table-cell actions",children:(0,c.jsx)("button",{type:"button",onClick:()=>(e=>{b((s=>(0,t.A)((0,t.A)({},s),{},{manpowers:s.manpowers.filter(((s,a)=>a!==e))})))})(s),className:"remove-btn",title:"Remove this manpower requirement",disabled:1===f.manpowers.length,children:(0,c.jsx)(o.qbC,{})})})]},s)}))]}),(0,c.jsx)("div",{className:"add-manpower-section",children:(0,c.jsxs)("button",{type:"button",onClick:()=>{b((e=>(0,t.A)((0,t.A)({},e),{},{manpowers:[...e.manpowers,{type:"",quantity:""}]})))},className:"add-manpower-btn",children:[(0,c.jsx)(o.OiG,{}),(0,c.jsx)("span",{children:"Add Manpower Type"})]})})]}),(0,c.jsxs)("div",{className:"form-section",children:[(0,c.jsxs)("div",{className:"section-header",children:[(0,c.jsx)("h3",{children:"Description"}),(0,c.jsx)("p",{className:"section-description",children:"Provide details about the manpower request"})]}),(0,c.jsx)("div",{className:"form-row",children:(0,c.jsxs)("div",{className:"form-group full-width",children:[(0,c.jsx)("label",{htmlFor:"description",children:"Request Details"}),(0,c.jsx)("textarea",{id:"description",name:"description",placeholder:"Describe requirements, skills needed, work scope, and other relevant details...",value:f.description,onChange:L,rows:4,required:!0,className:"form-textarea"})]})})]}),(0,c.jsx)("div",{className:"form-section submit-section",children:(0,c.jsxs)("div",{className:"submit-actions",children:[(0,c.jsx)("button",{type:"button",onClick:()=>e("/pm/manpower-list"),className:"cancel-btn",children:"Cancel"}),(0,c.jsxs)("button",{type:"submit",className:"submit-btn",children:[(0,c.jsx)(o.dIn,{}),(0,c.jsx)("span",{children:N?"Update Request":"Submit Request"})]})]})})]})})]})}),q.open&&(0,c.jsx)("div",{className:"center-modal-overlay ".concat(q.type),role:"dialog","aria-modal":"true",children:(0,c.jsxs)("div",{className:"center-modal",children:[(0,c.jsx)("div",{className:"center-modal-header",children:(0,c.jsx)("h2",{children:q.title})}),(0,c.jsx)("div",{className:"center-modal-body",children:(0,c.jsx)("p",{children:q.message})}),(0,c.jsx)("div",{className:"center-modal-actions",children:q.actions.map(((e,s)=>(0,c.jsx)("button",{type:"button",className:e.primary?"modal-btn primary":"modal-btn",onClick:e.onClick,children:e.label},s)))})]})})]})}},3943:(e,s,a)=>{a.r(s),a.d(s,{default:()=>d});var t=a(9379),n=a(5043),i=a(3216),r=a(5475),l=a(411),o=a(4801),c=a(579);const d=()=>{const e=(0,i.Zp)(),[s,d]=(0,n.useState)(!1),[m,u]=(0,n.useState)(null),[h,p]=(0,n.useState)([]),[v,j]=(0,n.useState)(!1),x=localStorage.getItem("token"),g=localStorage.getItem("user"),N=g?JSON.parse(g):null,y=null===N||void 0===N?void 0:N._id,[f,b]=(0,n.useState)((null===N||void 0===N?void 0:N.name)||"ALECK"),[w,A]=(0,n.useState)(null),[k,C]=(0,n.useState)([]),[S,D]=(0,n.useState)([]),[q,R]=(0,n.useState)([]),[P,_]=(0,n.useState)({siteAttendance:[],materialDeliveries:[],workPerformed:[],weatherCondition:"Sunny",remarks:""});(0,n.useEffect)((()=>{if(!x||!y)return;(async()=>{try{const{data:e}=await l.Ay.get("/projects/assigned/projectmanager/".concat(y),{headers:{Authorization:"Bearer ".concat(x)}});u(e)}catch(e){console.error("Error fetching assigned PM project:",e),u(null)}})()}),[x,y]),(0,n.useEffect)((()=>{y?(async()=>{try{console.log("Fetching project for user:",y);const e=(await l.Ay.get("/projects/assigned/projectmanager/".concat(y))).data;if(A(e),e._id){console.log("Fetching additional project data for:",e._id);const s=await l.Ay.get("/daily-reports/project/".concat(e._id,"/manpower"));C(s.data);const a=await l.Ay.get("/daily-reports/project/".concat(e._id,"/material-deliveries"));D(a.data);const t=await l.Ay.get("/daily-reports/project/".concat(e._id,"/tasks"));R(t.data)}}catch(a){var e,s;console.error("Error details:",{message:null===a||void 0===a?void 0:a.message,userId:y,hasToken:!!localStorage.getItem("token")}),alert("Error loading project data: ".concat((null===a||void 0===a||null===(e=a.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||a.message))}})():(console.error("No user ID found"),alert("User ID not found. Please log in again."))}),[y]),(0,n.useEffect)((()=>{q.length>0&&_((e=>{const s=q.map(((s,a)=>{const t="string"===typeof s?s:s.name;return e.workPerformed.find((e=>e.task===t))||{task:t,status:"",remarks:""}}));return(0,t.A)((0,t.A)({},e),{},{workPerformed:s})}))}),[q]);const M=(e,s)=>{_((a=>(0,t.A)((0,t.A)({},a),{},{[e]:s})))},L=(e,s,a)=>{_((n=>{const i=[...n.workPerformed];return i[e]||(i[e]={task:"",status:"",remarks:""}),i[e][s]=a,(0,t.A)((0,t.A)({},n),{},{workPerformed:i})}))};(0,n.useEffect)((()=>{const e=e=>{e.target.closest(".profile-menu-container")||j(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[]);return s?(0,c.jsxs)("div",{className:"loading-container",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Submitting daily report..."})]}):(0,c.jsxs)("div",{children:[(0,c.jsxs)("header",{className:"header",children:[(0,c.jsxs)("div",{className:"logo-container",children:[(0,c.jsx)("img",{src:a(8370),alt:"FadzTrack Logo",className:"logo-img"}),(0,c.jsx)("h1",{className:"brand-name",children:"FadzTrack"})]}),(0,c.jsxs)("nav",{className:"nav-menu",children:[(0,c.jsx)(r.N_,{to:"/pm",className:"nav-link",children:"Dashboard"}),(0,c.jsx)(r.N_,{to:"/pm/chat",className:"nav-link",children:"Chat"}),(0,c.jsx)(r.N_,{to:"/pm/request/:id",className:"nav-link",children:"Material"}),(0,c.jsx)(r.N_,{to:"/pm/manpower-list",className:"nav-link",children:"Manpower"}),m&&(0,c.jsx)(r.N_,{to:"/pm/viewprojects/".concat(m._id||m.id),className:"nav-link",children:"View Project"}),(0,c.jsx)(r.N_,{to:"/pm/daily-logs",className:"nav-link",children:"Logs"}),(0,c.jsx)(r.N_,{to:"/reports",className:"nav-link",children:"Reports"})]}),(0,c.jsxs)("div",{className:"profile-menu-container",style:{display:"flex",alignItems:"center",gap:18},children:[(0,c.jsx)(o.A,{}),(0,c.jsx)("div",{className:"profile-circle",onClick:()=>j(!v),children:f?f.charAt(0).toUpperCase():"Z"}),v&&(0,c.jsx)("div",{className:"profile-menu",children:(0,c.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),e("/")},children:"Logout"})})]})]}),(0,c.jsxs)("div",{className:"dashboard-layout",style:{display:"flex",minHeight:"100vh"},children:[(0,c.jsxs)("div",{className:"sidebar",style:{minWidth:270,background:"#f7f9fa",borderRight:"1px solid #ececec",minHeight:"100vh",display:"flex",flexDirection:"column",boxShadow:"none",padding:0,margin:0},children:[(0,c.jsx)("div",{style:{fontWeight:600,fontSize:20,margin:"28px 0 22px 0",marginLeft:24},children:"Chats"}),(0,c.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[{id:1,name:"Rychea Miralles",initial:"R",message:"Hello Good Morning po! As...",color:"#4A6AA5"},{id:2,name:"Third Castellar",initial:"T",message:"Hello Good Morning po! As...",color:"#2E7D32"},{id:3,name:"Zenarose Miranda",initial:"Z",message:"Hello Good Morning po! As...",color:"#9C27B0"}].map((e=>(0,c.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:14,padding:"13px 22px",borderRadius:10,background:"#fff",margin:"0 18px 8px 12px",boxShadow:"0 1px 5px 0 rgba(25,25,25,0.04)",cursor:"pointer",transition:"background .2s"},children:[(0,c.jsx)("div",{style:{width:36,height:36,borderRadius:"50%",background:e.color,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600,fontSize:20},children:e.initial}),(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{style:{fontWeight:500,fontSize:15},children:e.name}),(0,c.jsx)("div",{style:{fontSize:13,color:"#767676",marginTop:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:135},children:e.message})]})]},e.id)))})]}),(0,c.jsx)("div",{style:{flex:1,minHeight:"100vh"},children:(0,c.jsxs)("main",{className:"main-content-dailylogs",children:[(0,c.jsx)("h1",{className:"page-title-dailylogs",children:"Daily Logs"}),(0,c.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),d(!0);try{await l.Ay.post("/daily-reports",(0,t.A)((0,t.A)({},P),{},{project:w._id,submittedBy:y,date:new Date})),alert("Daily report submitted successfully!"),_({siteAttendance:[],materialDeliveries:[],workPerformed:[],weatherCondition:"Sunny",remarks:""})}catch(s){console.error("Error submitting daily report:",s),alert("Error submitting daily report. Please try again.")}finally{d(!1)}},className:"daily-logs-grid grid-flow",children:[(0,c.jsxs)("div",{className:"log-section",children:[(0,c.jsx)("h2",{className:"section-title",children:"Site Attendance Log"}),(0,c.jsx)("div",{style:{maxHeight:240,overflowY:k.length>5?"auto":"unset",border:k.length>5?"1px solid #eee":"none",borderRadius:8,paddingRight:8,marginBottom:8},children:k.length>0?k.map((e=>{var s;return(0,c.jsxs)("div",{className:"attendance-entry",children:[(0,c.jsx)("span",{children:e.name}),(0,c.jsxs)("select",{className:"form-input",value:(null===(s=P.siteAttendance.find((s=>s.manpower===e._id)))||void 0===s?void 0:s.status)||"",onChange:s=>{return a=e._id,n=s.target.value,void _((e=>{const s=[...e.siteAttendance],i=s.findIndex((e=>e.manpower===a));return i>=0?s[i].status=n:s.push({manpower:a,status:n}),(0,t.A)((0,t.A)({},e),{},{siteAttendance:s})}));var a,n},children:[(0,c.jsx)("option",{value:"",children:"Select Status"}),(0,c.jsx)("option",{value:"Present",children:"Present"}),(0,c.jsx)("option",{value:"Absent",children:"Absent"}),(0,c.jsx)("option",{value:"Late",children:"Late"})]})]},e._id)})):(0,c.jsx)("p",{children:"No manpower assigned to this project"})})]}),(0,c.jsxs)("div",{className:"log-section",children:[(0,c.jsx)("h2",{className:"section-title",children:"Material Deliveries"}),S.length>0?S.map((e=>{var s;return(0,c.jsxs)("div",{className:"delivery-entry",children:[(0,c.jsx)("span",{children:e.materialName||e.name}),(0,c.jsxs)("select",{className:"form-input",value:(null===(s=P.materialDeliveries.find((s=>s.delivery===(e._id||e.requestId))))||void 0===s?void 0:s.status)||"",onChange:s=>{return a=e._id||e.requestId,n=s.target.value,void _((e=>{const s=[...e.materialDeliveries],i=s.findIndex((e=>e.delivery===a));return i>=0?s[i].status=n:s.push({delivery:a,status:n}),(0,t.A)((0,t.A)({},e),{},{materialDeliveries:s})}));var a,n},children:[(0,c.jsx)("option",{value:"",children:"Select Status"}),(0,c.jsx)("option",{value:"Received",children:"Received"}),(0,c.jsx)("option",{value:"Pending",children:"Pending"}),(0,c.jsx)("option",{value:"Rejected",children:"Rejected"})]})]},e._id||e.requestId)})):(0,c.jsx)("p",{children:"No approved material deliveries for this project"})]}),(0,c.jsxs)("div",{className:"log-section",children:[(0,c.jsx)("h2",{className:"section-title",children:"Work Performed Today"}),(0,c.jsx)("div",{style:{overflowX:"auto"},children:(0,c.jsxs)("table",{className:"work-table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"Task"}),(0,c.jsx)("th",{children:"Status"}),(0,c.jsx)("th",{children:"Remarks"})]})}),(0,c.jsx)("tbody",{children:P.workPerformed.map(((e,s)=>(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:e.task}),(0,c.jsxs)("td",{children:[(0,c.jsxs)("label",{style:{marginRight:10},children:[(0,c.jsx)("input",{type:"radio",name:"status-".concat(s),value:"In Progress",checked:"In Progress"===e.status,onChange:()=>L(s,"status","In Progress")})," In Progress"]}),(0,c.jsxs)("label",{style:{marginRight:10},children:[(0,c.jsx)("input",{type:"radio",name:"status-".concat(s),value:"Completed",checked:"Completed"===e.status,onChange:()=>L(s,"status","Completed")})," Completed"]}),(0,c.jsxs)("label",{children:[(0,c.jsx)("input",{type:"radio",name:"status-".concat(s),value:"Not Started",checked:"Not Started"===e.status,onChange:()=>L(s,"status","Not Started")})," Not Started"]})]}),(0,c.jsx)("td",{children:(0,c.jsx)("input",{type:"text",className:"form-input",placeholder:"Remarks",value:e.remarks||"",onChange:e=>L(s,"remarks",e.target.value)})})]},e.task)))})]})})]}),(0,c.jsxs)("div",{className:"log-section",children:[(0,c.jsx)("h2",{className:"section-title",children:"Weather Conditions"}),(0,c.jsxs)("select",{className:"form-input",value:P.weatherCondition,onChange:e=>M("weatherCondition",e.target.value),children:[(0,c.jsx)("option",{value:"Sunny",children:"Sunny"}),(0,c.jsx)("option",{value:"Cloudy",children:"Cloudy"}),(0,c.jsx)("option",{value:"Rainy",children:"Rainy"}),(0,c.jsx)("option",{value:"Stormy",children:"Stormy"}),(0,c.jsx)("option",{value:"Overcast",children:"Overcast"})]})]}),(0,c.jsxs)("div",{className:"log-section",children:[(0,c.jsx)("h2",{className:"section-title",children:"Additional Remarks"}),(0,c.jsx)("textarea",{className:"form-textarea",value:P.remarks,onChange:e=>M("remarks",e.target.value),placeholder:"Enter any additional remarks..."})]}),(0,c.jsx)("div",{className:"form-actions",children:(0,c.jsx)("button",{type:"submit",className:"submit-btn",disabled:s,children:s?"Submitting...":"Submit Daily Report"})})]})]})})]})]})}},6016:()=>{},7362:(e,s,a)=>{a.r(s),a.d(s,{default:()=>d});var t=a(5043),n=a(3216),i=a(5475),r=a(4801),l=a(411),o=a(579);const c={All:()=>!0},d=()=>{const e=(0,n.Zp)(),[s,d]=(0,t.useState)("Z"),[m,u]=(0,t.useState)(!1),[h,p]=(0,t.useState)([]),[v,j]=(0,t.useState)(!0),[x,g]=(0,t.useState)("All"),[N,y]=(0,t.useState)(1),[f,b]=(0,t.useState)(null),[w,A]=(0,t.useState)((()=>{const e=localStorage.getItem("user");return e?JSON.parse(e):null})),[k,C]=(0,t.useState)((()=>localStorage.getItem("token")||"")),[S,D]=(0,t.useState)((()=>null===w||void 0===w?void 0:w._id));(0,t.useEffect)((()=>{const e=JSON.parse(localStorage.getItem("user"));d((null===e||void 0===e?void 0:e.name)||"Z")}),[]),(0,t.useEffect)((()=>{l.Ay.get("/daily-reports/mine").then((e=>{p(Array.isArray(e.data)?e.data:[]),j(!1)})).catch((()=>j(!1)))}),[]),(0,t.useEffect)((()=>{k&&S&&l.Ay.get("/projects/assigned/projectmanager/".concat(S),{headers:{Authorization:"Bearer ".concat(k)}}).then((e=>{let{data:s}=e;return b(s)})).catch((()=>b(null)))}),[k,S]);const q=h.filter(c[x]||(()=>!0)),R=Math.ceil(q.length/7),P=7*(N-1),_=q.slice(P,P+7);return(0,o.jsxs)("div",{children:[(0,o.jsxs)("header",{className:"header",children:[(0,o.jsxs)("div",{className:"logo-container",children:[(0,o.jsx)("img",{src:a(8370),alt:"FadzTrack Logo",className:"logo-img"}),(0,o.jsx)("h1",{className:"brand-name",children:"FadzTrack"})]}),(0,o.jsxs)("nav",{className:"nav-menu",children:[(0,o.jsx)(i.N_,{to:"/pm",className:"nav-link",children:"Dashboard"}),(0,o.jsx)(i.N_,{to:"/pm/request/:id",className:"nav-link",children:"Material"}),(0,o.jsx)(i.N_,{to:"/pm/manpower-list",className:"nav-link",children:"Manpower"}),f&&(0,o.jsx)(i.N_,{to:"/pm/viewprojects/".concat(f._id||f.id),className:"nav-link",children:"View Project"}),(0,o.jsx)(i.N_,{to:"/chat",className:"nav-link",children:"Chat"}),(0,o.jsx)(i.N_,{to:"/pm/daily-logs",className:"nav-link",children:"Logs"}),(0,o.jsx)(i.N_,{to:"/pm/progress-report/:id",className:"nav-link",children:"Reports"}),(0,o.jsx)(i.N_,{to:"/pm/daily-logs-list",className:"nav-link",children:"Daily Logs"})]}),(0,o.jsxs)("div",{className:"profile-menu-container",style:{display:"flex",alignItems:"center",gap:18},children:[(0,o.jsx)(r.A,{}),(0,o.jsx)("div",{className:"profile-circle",onClick:()=>u(!m),children:s?s.charAt(0).toUpperCase():"Z"}),m&&(0,o.jsx)("div",{className:"profile-menu",children:(0,o.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/"},children:"Logout"})})]})]}),(0,o.jsxs)("div",{style:{maxWidth:1e3,margin:"36px auto 0",background:"#fff",borderRadius:12,boxShadow:"0 2px 16px rgba(0,0,0,0.07)",padding:"20px 0 0 0"},children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"0 24px",marginBottom:6},children:[(0,o.jsx)("button",{className:"date-filter-btn",style:{border:"1px solid #bbb",borderRadius:6,background:"#fff",color:"#1e2852",fontWeight:500,padding:"5px 20px",marginRight:22,cursor:"pointer"},children:"\ud83d\uddd3 Date Filter"}),["All"].map((e=>(0,o.jsx)("button",{onClick:()=>g(e),className:x===e?"tab-btn active":"tab-btn",style:{border:"none",background:"none",color:x===e?"#191970":"#64688a",fontWeight:x===e?700:500,fontSize:16,marginRight:12,padding:"6px 10px",borderBottom:x===e?"2.5px solid #191970":"none",cursor:"pointer"},children:e},e))),(0,o.jsxs)("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[(0,o.jsx)("span",{style:{width:30,height:30,display:"inline-flex",alignItems:"center",justifyContent:"center",border:"1.5px solid #d4d8e2",borderRadius:6,marginRight:3,color:"#191970",background:"#f2f4fa"},children:(0,o.jsxs)("svg",{width:"16",height:"16",children:[(0,o.jsx)("rect",{width:"16",height:"3",fill:"#191970"}),(0,o.jsx)("rect",{y:"6",width:"16",height:"3",fill:"#d4d8e2"}),(0,o.jsx)("rect",{y:"12",width:"16",height:"3",fill:"#d4d8e2"})]})}),(0,o.jsx)("span",{style:{width:30,height:30,display:"inline-flex",alignItems:"center",justifyContent:"center",border:"1.5px solid #d4d8e2",borderRadius:6,color:"#bbb",background:"#f2f4fa"},children:(0,o.jsxs)("svg",{width:"16",height:"16",children:[(0,o.jsx)("rect",{width:"6",height:"6",fill:"#d4d8e2"}),(0,o.jsx)("rect",{x:"10",width:"6",height:"6",fill:"#d4d8e2"}),(0,o.jsx)("rect",{y:"10",width:"6",height:"6",fill:"#d4d8e2"}),(0,o.jsx)("rect",{x:"10",y:"10",width:"6",height:"6",fill:"#d4d8e2"})]})})]})]}),(0,o.jsx)("div",{style:{borderBottom:"1px solid #eaeaea",marginTop:8}}),(0,o.jsx)("div",{style:{padding:"12px 0"},children:v?(0,o.jsx)("div",{style:{textAlign:"center",color:"#888",margin:50},children:"Loading..."}):0===_.length?(0,o.jsx)("div",{style:{textAlign:"center",color:"#888",margin:50},children:"No logs found."}):_.map(((s,a)=>{var t,n,i,r;return(0,o.jsxs)("div",{className:"log-list-row",style:{display:"flex",alignItems:"center",padding:"14px 24px",borderBottom:"1px solid #eee",cursor:"pointer",background:"#fff"},onClick:()=>e("/pm/daily-logs/".concat(s._id)),children:[(0,o.jsx)("div",{style:{flex:"0 0 46px",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,o.jsx)("span",{style:{width:42,height:42,display:"flex",alignItems:"center",justifyContent:"center",fontSize:30,background:"#ece7df",borderRadius:"50%"},children:(r=s.title||s.logTitle,null!==r&&void 0!==r&&r.toLowerCase().includes("no. 1")||null!==r&&void 0!==r&&r.toLowerCase().includes("no. 2")||null!==r&&void 0!==r&&r.toLowerCase().includes("no. 3")?"\ud83d\udce6":null!==r&&void 0!==r&&r.toLowerCase().includes("no. 32")||null!==r&&void 0!==r&&r.toLowerCase().includes("no. 15")||null!==r&&void 0!==r&&r.toLowerCase().includes("no. 84")?"\u270f\ufe0f":null!==r&&void 0!==r&&r.toLowerCase().includes("no. 31")?"\ud83e\uddf1":"\ud83d\udce6")})}),(0,o.jsxs)("div",{style:{flex:1,minWidth:0,marginLeft:16},children:[(0,o.jsx)("div",{style:{fontWeight:700,color:"#23232e",fontSize:16,lineHeight:"20px"},children:s.title||s.logTitle||"Daily Log no. ".concat(s.logNumber||a+1)}),(0,o.jsx)("div",{style:{color:"#6c757d",fontWeight:500,fontSize:14,marginTop:1},children:(null===(t=s.submittedBy)||void 0===t?void 0:t.name)||"\u2014"})]}),(0,o.jsxs)("div",{style:{minWidth:170,textAlign:"right",marginLeft:12},children:[(0,o.jsx)("div",{style:{fontWeight:600,color:"#343357",fontSize:15},children:(null===(n=s.project)||void 0===n?void 0:n.projectName)||"\u2014"}),(0,o.jsx)("div",{style:{color:"#7b7b8b",fontWeight:500,fontSize:14,marginTop:2},children:(i=s.date||s.createdAt,new Date(i).toLocaleDateString("en-US"))})]})]},s._id||a)}))}),R>1&&(0,o.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",margin:"18px 0"},children:(0,o.jsxs)("div",{className:"pagination",style:{display:"flex",gap:3},children:[(0,o.jsx)("button",{disabled:1===N,onClick:()=>y((e=>Math.max(1,e-1))),style:{border:"none",background:"none",fontSize:16,color:"#191970",padding:"4px 8px",minWidth:26,fontWeight:700,opacity:1===N?.35:1},children:"<"}),Array.from({length:R}).map(((e,s)=>(0,o.jsx)("button",{className:N===s+1?"active":"",onClick:()=>y(s+1),style:{border:"none",background:N===s+1?"#3a48a6":"none",color:N===s+1?"#fff":"#191970",fontWeight:700,fontSize:15,borderRadius:5,padding:"4px 10px",margin:"0 2px"},children:s+1},s))),(0,o.jsx)("button",{disabled:N===R,onClick:()=>y((e=>Math.min(R,e+1))),style:{border:"none",background:"none",fontSize:16,color:"#191970",padding:"4px 8px",minWidth:26,fontWeight:700,opacity:N===R?.35:1},children:">"})]})})]})]})}},8765:(e,s,a)=>{a.r(s),a.d(s,{default:()=>d});var t=a(9379),n=a(5043),i=a(3216),r=(a(2660),a(64),a(411)),l=a(3204),o=a(8818),c=a(579);const d=()=>{(0,i.Zp)();const e=(0,n.useRef)(null);if(null===e.current){const s=localStorage.getItem("user");e.current=s?JSON.parse(s):null}const s=e.current,[a,d]=(0,n.useState)([]),[m,u]=(0,n.useState)(!0),[h,p]=(0,n.useState)(""),[v,j]=(0,n.useState)("All"),[x,g]=(0,n.useState)(""),[N,y]=(0,n.useState)(1),[f,b]=(0,n.useState)("cards"),[w,A]=(0,n.useState)(!0),[k,C]=(0,n.useState)({}),[S,D]=(0,n.useState)(null);(0,n.useEffect)((()=>{if(!s||"Project Manager"!==s.role)return;let e=!0;return(async()=>{u(!0),p("");try{const{data:s}=await r.Ay.get("/manpower-requests/pm");if(!e)return;d(Array.isArray(s)?s:[])}catch(s){if(!e)return;console.error("Failed to load manpower requests:",s),!s.response||401!==s.response.status&&403!==s.response.status?p("Failed to load manpower requests"):p("Session expired or unauthorized. Please login.")}finally{e&&(u(!1),y(1))}})(),()=>{e=!1}}),[s]);const q=(0,n.useMemo)((()=>{let e=a;if(e="All"!==v?"Archived"===v?e.filter((e=>(e.status||"Pending").toLowerCase().includes("archived"))):e.filter((e=>(e.status||"Pending").toLowerCase().includes(v.toLowerCase()))):e.filter((e=>!(e.status||"Pending").toLowerCase().includes("archived"))),x){const s=x.toLowerCase();e=e.filter((e=>{var a,t;const n=(null===(a=e.project)||void 0===a?void 0:a.projectName)||"",i=(null===(t=e.createdBy)||void 0===t?void 0:t.name)||"",r=(e.manpowers||[]).map((e=>"".concat(e.quantity," ").concat(e.type))).join(", ");return n.toLowerCase().includes(s)||i.toLowerCase().includes(s)||r.toLowerCase().includes(s)||(e.description||"").toLowerCase().includes(s)}))}return e}),[a,v,x]),R=(0,n.useMemo)((()=>[...q].sort(((e,s)=>{const a=new Date(e.createdAt||0).getTime(),t=new Date(s.createdAt||0).getTime();return w?t-a:a-t}))),[q,w]),P=Math.max(1,Math.ceil(R.length/8)),_=(0,n.useMemo)((()=>{const e=8*(N-1);return R.slice(e,e+8)}),[R,N]),M=e=>{const s=(e.status||"Pending").toLowerCase();return"pending"===s&&e.acquisitionDate&&new Date(e.acquisitionDate)<new Date?"Overdue":s.includes("archived")?"Archived":s.includes("completed")?"Completed":s.includes("approved")?"Approved":s.includes("pending")?"Pending":s.includes("reject")||s.includes("denied")||s.includes("cancel")?"Rejected":s.includes("overdue")?"Overdue":"Unknown"},L=(0,n.useMemo)((()=>{let e=0,s=0,t=0,n=0,i=0,r=0;return a.forEach((a=>{const l=(a.status||"Pending").toLowerCase(),o="pending"===l&&a.acquisitionDate&&new Date(a.acquisitionDate)<new Date;l.includes("archived")?r++:l.includes("completed")?t++:l.includes("approved")?s++:l.includes("reject")||l.includes("denied")||l.includes("cancel")?n++:o||l.includes("overdue")?i++:e++})),{total:a.length,pending:e,approved:s,rejected:n,overdue:i,completed:t,archived:r}}),[a]),I=(0,n.useMemo)((()=>({All:L.total-L.archived,Pending:L.pending,Overdue:L.overdue,Approved:L.approved,Completed:L.completed,Rejected:L.rejected,Archived:L.archived})),[L]),T=async e=>{const s=(k[e._id]||"").split(",").map((e=>e.trim())).filter(Boolean);if(0!==s.length){D(e._id);try{var a,t;await r.Ay.put("/manpower-requests/".concat(e._id,"/approve"),{manpowerProvided:s,project:null===(a=e.project)||void 0===a?void 0:a._id,area:null===(t=e.project)||void 0===t?void 0:t.location}),alert("\u2705 Approved");const{data:n}=await r.Ay.get("/manpower-requests/pm");d(Array.isArray(n)?n:[])}catch(l){var n,i;console.error(l),alert((null===l||void 0===l||null===(n=l.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)||"Approval failed.")}finally{D(null)}}else alert("Please enter at least one manpower ID to assign.")},E=async e=>{const s=prompt("Please provide a reason for rejection (optional):");if(null===s)return;if(window.confirm("Confirm Rejection?\n\nRejecting this request will remove this from your list of Other's Request.")){D(e._id);try{const a=await r.Ay.put("/manpower-requests/".concat(e._id,"/reject"),{reason:s});alert(a.data.message);const{data:t}=await r.Ay.get("/manpower-requests/pm");d(Array.isArray(t)?t:[])}catch(n){var a,t;console.error(n),alert((null===n||void 0===n||null===(a=n.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.message)||"Failed to reject request.")}finally{D(null)}}};return s&&"Project Manager"===s.role?(0,c.jsxs)("div",{className:"dashboard-container ceo-manpower-requests-page",children:[(0,c.jsx)(o.A,{roleSegment:"pm"}),(0,c.jsx)("main",{className:"dashboard-main",children:(0,c.jsxs)("div",{className:"page-container",children:[(0,c.jsxs)("div",{className:"dashboard-card ceo-mr-header-card",children:[(0,c.jsxs)("div",{className:"card-header mr-header-row",children:[(0,c.jsxs)("div",{className:"mr-header-texts",children:[(0,c.jsx)("h1",{className:"card-title",children:"Manpower Requests"}),(0,c.jsx)("p",{className:"card-subtitle",children:"Manage and track manpower requests for your project"})]}),(0,c.jsxs)("div",{className:"layout-toggle-wrapper",children:[(0,c.jsx)("button",{onClick:()=>b((e=>"cards"===e?"table":"cards")),className:"btn-secondary toggle-layout-btn",children:"cards"===f?"Table View":"Card View"}),(0,c.jsx)("button",{onClick:()=>A(!w),className:"btn-secondary sort-btn",title:"Toggle sort by Created date",children:w?"\u2193 Newest":"\u2191 Oldest"})]})]}),(0,c.jsxs)("div",{className:"card-body mr-filters-row",children:[(0,c.jsx)("div",{className:"filter-tabs compact",children:["All","Pending","Overdue","Approved","Completed","Rejected","Archived"].map((e=>{var s;return(0,c.jsxs)("button",{className:"filter-tab ".concat(v===e?"active":""),onClick:()=>{j(e),y(1)},children:[(0,c.jsx)("span",{children:e}),(0,c.jsx)("span",{className:"count",children:null!==(s=I[e])&&void 0!==s?s:0})]},e)}))}),(0,c.jsxs)("div",{className:"search-wrapper stretch",children:[(0,c.jsx)(l.KSO,{className:"search-icon"}),(0,c.jsx)("input",{type:"text",placeholder:"Search requests...",value:x,onChange:e=>{g(e.target.value),y(1)},className:"search-input"})]})]})]}),(0,c.jsxs)("div",{className:"dashboard-card ceo-mr-summary-card",children:[(0,c.jsx)("div",{className:"card-header",children:(0,c.jsx)("h3",{className:"card-title-sm",children:"Summary"})}),(0,c.jsx)("div",{className:"mr-summary-grid",children:[{label:"Total",value:L.total,color:"#334155"},{label:"Pending",value:L.pending,color:"#f59e0b"},{label:"Overdue",value:L.overdue,color:"#d97706"},{label:"Approved",value:L.approved,color:"#10b981"},{label:"Completed",value:L.completed,color:"#059669"},{label:"Rejected",value:L.rejected,color:"#ef4444"},{label:"Archived",value:L.archived,color:"#8b5cf6"}].map((e=>(0,c.jsxs)("div",{className:"mr-summary-item",children:[(0,c.jsx)("span",{className:"mr-summary-label",children:e.label}),(0,c.jsx)("span",{className:"mr-summary-value",style:{color:e.color},children:e.value}),(0,c.jsx)("div",{className:"mr-summary-bar",style:{background:e.color}})]},e.label)))})]}),(0,c.jsxs)("div",{className:"dashboard-card ceo-mr-list-card",children:[(0,c.jsx)("div",{className:"card-header list-header",children:(0,c.jsxs)("h3",{className:"card-title-sm",children:["Requests ",(0,c.jsxs)("span",{className:"muted",children:["(",R.length,")"]})]})}),(0,c.jsx)("div",{className:"requests-grid ceo-mr-grid ".concat("table"===f?"table-view":""),children:m?(0,c.jsxs)("div",{className:"loading-state",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Loading manpower requests..."})]}):h?(0,c.jsx)("div",{className:"error-state",children:(0,c.jsx)("p",{children:h})}):0===_.length?(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)("div",{className:"empty-icon",children:"\ud83d\udc65"}),(0,c.jsx)("h3",{children:"No manpower requests found"}),(0,c.jsx)("p",{children:"No requests match your current filters. Try adjusting your search criteria."})]}):(0,c.jsxs)(c.Fragment,{children:["table"===f&&(0,c.jsxs)("div",{className:"mr-table-header",role:"row","aria-label":"Table Header",children:[(0,c.jsx)("div",{children:"Project"}),(0,c.jsx)("div",{children:"Requester"}),(0,c.jsx)("div",{children:"Description"}),(0,c.jsx)("div",{children:"Manpower"}),(0,c.jsx)("div",{children:"Target"}),(0,c.jsx)("div",{children:"Dur"}),(0,c.jsx)("div",{children:"Created"}),(0,c.jsx)("div",{children:"Status"}),(0,c.jsx)("div",{children:"Actions"})]}),_.map((e=>{var s,a,n,i;const r=(e.manpowers||[]).map((e=>"".concat(e.quantity," ").concat(e.type))).join(", "),o=M(e);(e=>{const s=(e.status||"Pending").toLowerCase();"pending"===s&&e.acquisitionDate&&new Date(e.acquisitionDate)<new Date||(s.includes("archived")||(s.includes("completed")||(s.includes("approved")||(s.includes("pending")||(s.includes("reject")||s.includes("denied")||s.includes("cancel")||s.includes("overdue"))))))})(e);var d,m,u,h;return"table"===f?(0,c.jsxs)("div",{className:"mr-table-row",role:"row",title:"View details",children:[(0,c.jsx)("div",{className:"rt-title",title:(null===(d=e.project)||void 0===d?void 0:d.projectName)||"(No Project Name)",children:(null===(m=e.project)||void 0===m?void 0:m.projectName)||"(No Project Name)"}),(0,c.jsx)("div",{className:"rt-req",title:(null===(u=e.createdBy)||void 0===u?void 0:u.name)||"Unknown",children:(null===(h=e.createdBy)||void 0===h?void 0:h.name)||"Unknown"}),(0,c.jsx)("div",{className:"rt-desc",title:e.description||"No description",children:e.description||"No description"}),(0,c.jsx)("div",{className:"rt-man",title:r||"\u2014",children:r||"\u2014"}),(0,c.jsx)("div",{className:"rt-date",title:"Target Date",children:e.acquisitionDate?new Date(e.acquisitionDate).toLocaleDateString():"\u2014"}),(0,c.jsxs)("div",{className:"rt-date",title:"Duration",children:[e.duration||"\u2014","d"]}),(0,c.jsx)("div",{className:"rt-date",title:"Created",children:e.createdAt?new Date(e.createdAt).toLocaleDateString():"\u2014"}),(0,c.jsx)("div",{className:"rt-btn",children:(0,c.jsx)("span",{className:"status-chip ".concat(o.toLowerCase()),children:o})}),(0,c.jsx)("div",{className:"rt-actions",children:"Pending"===e.status&&(0,c.jsxs)("div",{className:"table-approval-section",children:[(0,c.jsx)("input",{type:"text",value:k[e._id]||"",onChange:s=>C((a=>(0,t.A)((0,t.A)({},a),{},{[e._id]:s.target.value}))),placeholder:"Manpower IDs...",className:"table-manpower-input"}),(0,c.jsx)("button",{onClick:()=>T(e),disabled:S===e._id,className:"table-approve-btn",title:"Approve",children:(0,c.jsx)(l.CMH,{})}),(0,c.jsx)("button",{onClick:()=>E(e),disabled:S===e._id,className:"table-deny-btn",title:"Reject",children:(0,c.jsx)(l.QCr,{})})]})})]},e._id):(0,c.jsxs)("div",{className:"request-card ceo-mr-card",children:[(0,c.jsxs)("div",{className:"card-body",children:[(0,c.jsxs)("div",{className:"mr-card-top-row",children:[(0,c.jsx)("h3",{className:"request-title",title:(null===(s=e.project)||void 0===s?void 0:s.projectName)||"(No Project Name)",children:(null===(a=e.project)||void 0===a?void 0:a.projectName)||"(No Project Name)"}),(0,c.jsx)("span",{className:"status-chip ".concat(o.toLowerCase()),children:o})]}),(0,c.jsx)("p",{className:"request-description",title:e.description||"No description provided",children:e.description||"No description provided"}),(0,c.jsxs)("div",{className:"request-meta",children:[(0,c.jsxs)("div",{className:"meta-item",children:[(0,c.jsx)("span",{className:"meta-label",children:"Requested by:"}),(0,c.jsx)("span",{className:"meta-value",title:(null===(n=e.createdBy)||void 0===n?void 0:n.name)||"Unknown",children:(null===(i=e.createdBy)||void 0===i?void 0:i.name)||"Unknown"})]}),(0,c.jsxs)("div",{className:"meta-item",children:[(0,c.jsx)("span",{className:"meta-label",children:"Manpower:"}),(0,c.jsx)("span",{className:"meta-value",title:r||"\u2014",children:r||"\u2014"})]}),(0,c.jsxs)("div",{className:"meta-item",children:[(0,c.jsx)("span",{className:"meta-label",children:"Date:"}),(0,c.jsx)("span",{className:"meta-value",children:e.createdAt?new Date(e.createdAt).toLocaleDateString():"\u2014"})]}),(0,c.jsxs)("div",{className:"meta-item",children:[(0,c.jsx)("span",{className:"meta-label",children:"Target:"}),(0,c.jsx)("span",{className:"meta-value",children:e.acquisitionDate?new Date(e.acquisitionDate).toLocaleDateString():"\u2014"})]}),(0,c.jsxs)("div",{className:"meta-item",children:[(0,c.jsx)("span",{className:"meta-label",children:"Duration:"}),(0,c.jsxs)("span",{className:"meta-value",children:[e.duration||"\u2014"," d"]})]})]}),e.rejectedBy&&e.rejectedBy.length>0&&(0,c.jsxs)("div",{className:"rejection-info",children:[(0,c.jsxs)("div",{className:"meta-item",children:[(0,c.jsx)("span",{className:"meta-label",children:"Rejected by:"}),(0,c.jsx)("span",{className:"meta-value rejection-list",children:e.rejectedBy.map(((s,a)=>{var t;return(0,c.jsxs)("span",{className:"rejection-item",children:[s.userName||(null===(t=s.userId)||void 0===t?void 0:t.name)||"Unknown PM",a<e.rejectedBy.length-1?", ":""]},a)}))})]}),e.rejectionReason&&(0,c.jsxs)("div",{className:"meta-item",children:[(0,c.jsx)("span",{className:"meta-label",children:"Reason:"}),(0,c.jsx)("span",{className:"meta-value rejection-reason",children:e.rejectionReason})]})]})]}),(0,c.jsx)("div",{className:"card-footer",children:"Pending"===e.status?(0,c.jsxs)("div",{className:"pm-approval-section",children:[(0,c.jsxs)("div",{className:"manpower-input-section",children:[(0,c.jsx)("label",{className:"manpower-label",children:"Manpower IDs to assign:"}),(0,c.jsx)("input",{type:"text",value:k[e._id]||"",onChange:s=>C((a=>(0,t.A)((0,t.A)({},a),{},{[e._id]:s.target.value}))),placeholder:"e.g. 668f0..., 668f1...",className:"manpower-input"})]}),(0,c.jsxs)("div",{className:"action-buttons",children:[(0,c.jsxs)("button",{onClick:()=>T(e),disabled:S===e._id,className:"approve-btn",children:[(0,c.jsx)(l.CMH,{}),(0,c.jsx)("span",{children:S===e._id?"Processing\u2026":"Approve"})]}),(0,c.jsxs)("button",{onClick:()=>E(e),disabled:S===e._id,className:"deny-btn",children:[(0,c.jsx)(l.QCr,{}),(0,c.jsx)("span",{children:"Reject"})]})]})]}):"Archived"===e.status?(0,c.jsx)("div",{className:"archived-status",children:(0,c.jsxs)("span",{className:"archived-badge",children:[M(e.status)," - Project Completed"]})}):(0,c.jsx)("div",{className:"status-display",children:(0,c.jsx)("span",{className:"final-status",children:M(e.status)})})})]},e._id)}))]})}),R.length>0&&(0,c.jsxs)("div",{className:"pagination-section inside-card",children:[(0,c.jsxs)("div",{className:"pagination-info",children:["Showing ",8*(N-1)+1," to ",Math.min(8*N,R.length)," of ",R.length," entries"]}),(0,c.jsxs)("div",{className:"pagination-controls",children:[(0,c.jsx)("button",{onClick:()=>y((e=>Math.max(e-1,1))),disabled:1===N,className:"pagination-btn",children:"Previous"}),Array.from({length:P},((e,s)=>s+1)).map((e=>(0,c.jsx)("button",{className:"pagination-btn ".concat(e===N?"active":""),onClick:()=>y(e),children:e},e))),(0,c.jsx)("button",{onClick:()=>y((e=>Math.min(e+1,P))),disabled:N===P,className:"pagination-btn",children:"Next"})]})]})]})]})})]}):(0,c.jsxs)("div",{style:{padding:24},children:[(0,c.jsx)("h2",{children:"Forbidden"}),(0,c.jsx)("p",{children:"You must be a Project Manager to view this page."})]})}},9585:(e,s,a)=>{a.r(s),a.d(s,{default:()=>d});var t=a(9379),n=a(5043),i=a(3216),r=a(411),l=a(8818),o=(a(6016),a(3204)),c=a(579);const d=()=>{const e=localStorage.getItem("token"),s=localStorage.getItem("user"),d=s?JSON.parse(s):null,m=null===d||void 0===d?void 0:d._id,u=(0,i.Zp)(),[h,p]=(0,n.useState)("All"),[v,j]=(0,n.useState)([]),[x,g]=(0,n.useState)([]),[N,y]=(0,n.useState)(!0),[f,b]=(0,n.useState)(null),[w,A]=(0,n.useState)(""),[k,C]=(0,n.useState)("startDate"),[S,D]=(0,n.useState)("asc");(0,n.useEffect)((()=>{m&&(y(!0),Promise.all([r.Ay.get("/projects/by-user-status?userId=".concat(m,"&role=projectmanager&status=Ongoing")),r.Ay.get("/projects/by-user-status?userId=".concat(m,"&role=projectmanager&status=Completed"))]).then((e=>{let[s,a]=e;j(s.data||[]),g(a.data||[])})).catch((()=>{j([]),g([])})).finally((()=>y(!1))))}),[m]),(0,n.useEffect)((()=>{e&&m&&r.Ay.get("/projects/by-user-status?userId=".concat(m,"&role=projectmanager&status=Ongoing")).then((e=>{let{data:s}=e;return b(s[0]||null)})).catch((()=>b(null)))}),[e,m]);const q=e=>{const s=e.startDate?new Date(e.startDate):null,a=e.endDate?new Date(e.endDate):null,n=new Date;let i=null,r=null,l=null,o=null;return s&&a&&a>s&&(i=Math.round((a-s)/864e5)||1,r=Math.min(i,Math.max(0,Math.round((n-s)/864e5))),l=Math.min(100,Math.max(0,r/i*100)),o=Math.max(0,Math.round((a-n)/864e5))),(0,t.A)((0,t.A)({},e),{},{totalDays:i,elapsedDays:r,pctTime:l,daysLeft:o})},R=(e,s)=>{const a="asc"===S?1:-1,t=e=>{var s;switch(k){case"name":return(null===(s=e.projectName)||void 0===s?void 0:s.toLowerCase())||"";case"startDate":default:return e.startDate||"";case"endDate":return e.endDate||"";case"status":return e.status||""}},n=t(e),i=t(s);return n<i?-1*a:n>i?1*a:0},P=(0,n.useMemo)((()=>v.filter((e=>{var s;return null===(s=e.projectName)||void 0===s?void 0:s.toLowerCase().includes(w.toLowerCase())})).map(q).sort(R)),[v,w,k,S]),_=(0,n.useMemo)((()=>x.filter((e=>{var s;return null===(s=e.projectName)||void 0===s?void 0:s.toLowerCase().includes(w.toLowerCase())})).map(q).sort(R)),[x,w,k,S]),M=(0,n.useMemo)((()=>[...v,...x].filter((e=>{var s;return null===(s=e.projectName)||void 0===s?void 0:s.toLowerCase().includes(w.toLowerCase())})).map(q).sort(R)),[v,x,w,k,S]),L=(0,n.useMemo)((()=>({ongoing:v.length,completed:x.length,total:v.length+x.length})),[v,x]),I=e=>{k===e?D((e=>"asc"===e?"desc":"asc")):(C(e),D("asc"))};if(N)return(0,c.jsx)("div",{className:"dashboard-container",children:(0,c.jsx)("div",{className:"professional-loading-screen",children:(0,c.jsxs)("div",{className:"loading-content",children:[(0,c.jsx)("div",{className:"loading-logo",children:(0,c.jsx)("img",{src:a(8370),alt:"FadzTrack Logo",className:"loading-logo-img"})}),(0,c.jsx)("div",{className:"loading-spinner-container",children:(0,c.jsx)("div",{className:"loading-spinner"})}),(0,c.jsxs)("div",{className:"loading-text",children:[(0,c.jsx)("h2",{className:"loading-title",children:"Loading Projects"}),(0,c.jsx)("p",{className:"loading-subtitle",children:"Fetching your project list..."})]})]})})});const T=e=>{let{projects:s,showBadges:a}=e;return(0,c.jsxs)("div",{className:"projects-table-wrapper glass-card",children:[(0,c.jsxs)("table",{className:"projects-table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{onClick:()=>I("name"),className:"name"===k?"sorted":"",children:"Project"}),(0,c.jsx)("th",{onClick:()=>I("status"),className:"".concat("status"===k?"sorted ":"","status-col"),children:"Status"}),(0,c.jsx)("th",{children:"Timeline"}),(0,c.jsx)("th",{onClick:()=>I("startDate"),className:"startDate"===k?"sorted":"",children:"Start"}),(0,c.jsx)("th",{onClick:()=>I("endDate"),className:"endDate"===k?"sorted":"",children:"End"}),(0,c.jsx)("th",{style:{textAlign:"right"},children:"Action"})]})}),(0,c.jsxs)("tbody",{children:[0===s.length&&(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:6,className:"empty-row",children:"No projects found."})}),s.map((e=>{var s;return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:(0,c.jsxs)("div",{className:"proj-main",children:[(0,c.jsx)("div",{className:"proj-title",children:e.projectName}),(0,c.jsxs)("div",{className:"proj-meta",children:[(null===(s=e.location)||void 0===s?void 0:s.name)||"No location"," \u2022 ",null!=e.daysLeft?"".concat(e.daysLeft,"d left"):"\u2014"]})]})}),(0,c.jsx)("td",{className:"status-col",children:a?(0,c.jsx)("span",{className:"status-badge badge-".concat((e.status||"").toLowerCase()),children:e.status||"\u2014"}):(0,c.jsx)("span",{className:"status-plain",children:e.status||"\u2014"})}),(0,c.jsx)("td",{children:null!=e.pctTime?(0,c.jsx)("div",{className:"timeline-bar",title:e.totalDays?"".concat(e.elapsedDays,"/").concat(e.totalDays," days (").concat(e.pctTime.toFixed(0),"%)"):"",children:(0,c.jsx)("div",{className:"timeline-fill",style:{width:"".concat(e.pctTime,"%")}})}):(0,c.jsx)("span",{className:"muted",children:"\u2014"})}),(0,c.jsx)("td",{children:e.startDate?new Date(e.startDate).toLocaleDateString():"\u2014"}),(0,c.jsx)("td",{children:e.endDate?new Date(e.endDate).toLocaleDateString():"\u2014"}),(0,c.jsx)("td",{style:{textAlign:"right"},children:(0,c.jsx)("button",{className:"btn-view",onClick:()=>u("/pm/viewprojects/".concat(e._id)),children:"View"})})]},e._id)}))]})]}),(0,c.jsxs)("div",{className:"projects-cards",children:[s.map((e=>{var s;return(0,c.jsxs)("div",{className:"project-card",onClick:()=>u("/pm/viewprojects/".concat(e._id)),children:[a?(0,c.jsx)("div",{className:"pc-status",children:(0,c.jsx)("span",{className:"status-badge badge-".concat((e.status||"").toLowerCase()),children:e.status||"\u2014"})}):(0,c.jsx)("div",{className:"pc-status-plain",children:e.status||"\u2014"}),(0,c.jsx)("div",{className:"pc-header",children:(0,c.jsx)("h4",{children:e.projectName})}),(0,c.jsx)("div",{className:"pc-meta",children:(null===(s=e.location)||void 0===s?void 0:s.name)||"No location"}),(0,c.jsx)("div",{className:"pc-timeline",children:null!=e.pctTime?(0,c.jsx)("div",{className:"timeline-bar small",children:(0,c.jsx)("div",{className:"timeline-fill",style:{width:"".concat(e.pctTime,"%")}})}):(0,c.jsx)("div",{className:"muted",children:"No timeline"})}),(0,c.jsxs)("div",{className:"pc-dates",children:[(0,c.jsx)("span",{children:e.startDate?new Date(e.startDate).toLocaleDateString():"\u2014"}),(0,c.jsx)("span",{children:"\u2192"}),(0,c.jsx)("span",{children:e.endDate?new Date(e.endDate).toLocaleDateString():"\u2014"})]}),(0,c.jsx)("div",{className:"pc-footer",children:(0,c.jsx)("button",{className:"btn-view ghost",onClick:s=>{s.stopPropagation(),u("/pm/viewprojects/".concat(e._id))},children:"Open"})})]},e._id)})),0===s.length&&(0,c.jsx)("div",{className:"empty-placeholder",children:"No projects found."})]})]})};return(0,c.jsxs)("div",{className:"pic-projects-page",children:[(0,c.jsx)(l.A,{roleSegment:"pm"}),(0,c.jsx)("section",{className:"pp-hero",children:(0,c.jsxs)("div",{className:"pp-hero-inner",children:[(0,c.jsx)("h1",{children:"My Projects"}),(0,c.jsx)("p",{children:"Overview of all projects you manage. Search, filter and open a project instantly."}),(0,c.jsxs)("div",{className:"pp-stats",children:[(0,c.jsxs)("div",{className:"stat-card stat-click ".concat("Ongoing"===h?"active":""),onClick:()=>p("Ongoing"),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(p("Ongoing"),e.preventDefault())},"aria-pressed":"Ongoing"===h,children:[(0,c.jsx)("div",{className:"sc-icon ongoing",children:(0,c.jsx)(o.lhZ,{})}),(0,c.jsxs)("div",{className:"sc-body",children:[(0,c.jsx)("span",{className:"sc-label",children:"Ongoing"}),(0,c.jsx)("span",{className:"sc-value",children:L.ongoing})]})]}),(0,c.jsxs)("div",{className:"stat-card stat-click ".concat("Completed"===h?"active":""),onClick:()=>p("Completed"),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(p("Completed"),e.preventDefault())},"aria-pressed":"Completed"===h,children:[(0,c.jsx)("div",{className:"sc-icon completed",children:(0,c.jsx)(o.A7C,{})}),(0,c.jsxs)("div",{className:"sc-body",children:[(0,c.jsx)("span",{className:"sc-label",children:"Completed"}),(0,c.jsx)("span",{className:"sc-value",children:L.completed})]})]}),(0,c.jsxs)("div",{className:"stat-card stat-click ".concat("All"===h?"active":""),onClick:()=>p("All"),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(p("All"),e.preventDefault())},"aria-pressed":"All"===h,children:[(0,c.jsx)("div",{className:"sc-icon total",children:(0,c.jsx)(o.yd7,{})}),(0,c.jsxs)("div",{className:"sc-body",children:[(0,c.jsx)("span",{className:"sc-label",children:"Total"}),(0,c.jsx)("span",{className:"sc-value",children:L.total})]})]})]})]})}),(0,c.jsxs)("main",{className:"pp-main",children:[(0,c.jsxs)("div",{className:"pp-controls",children:[(0,c.jsxs)("div",{className:"search-box",children:[(0,c.jsx)(o.KSO,{className:"icon"}),(0,c.jsx)("input",{placeholder:"Search project name...",value:w,onChange:e=>A(e.target.value)})]}),(0,c.jsxs)("div",{className:"filters",children:[(0,c.jsxs)("div",{className:"tab-group",children:[(0,c.jsxs)("button",{className:"All"===h?"tg-btn active":"tg-btn",onClick:()=>p("All"),children:["All (",L.total,")"]}),(0,c.jsxs)("button",{className:"Ongoing"===h?"tg-btn active":"tg-btn",onClick:()=>p("Ongoing"),children:["Ongoing (",L.ongoing,")"]}),(0,c.jsxs)("button",{className:"Completed"===h?"tg-btn active":"tg-btn",onClick:()=>p("Completed"),children:["Completed (",L.completed,")"]})]}),(0,c.jsxs)("div",{className:"sort-box",children:[(0,c.jsx)(o.EDF,{className:"icon"}),(0,c.jsxs)("select",{value:k,onChange:e=>C(e.target.value),children:[(0,c.jsx)("option",{value:"startDate",children:"Sort: Start Date"}),(0,c.jsx)("option",{value:"endDate",children:"Sort: End Date"}),(0,c.jsx)("option",{value:"name",children:"Sort: Name"}),(0,c.jsx)("option",{value:"status",children:"Sort: Status"})]}),(0,c.jsx)("button",{className:"dir-btn",onClick:()=>D((e=>"asc"===e?"desc":"asc")),"aria-label":"Toggle direction",children:"asc"===S?"\u2191":"\u2193"})]})]})]}),(0,c.jsx)("div",{className:"pp-table-area",children:(0,c.jsx)(T,{projects:"All"===h?M:"Ongoing"===h?P:_,showBadges:"All"!==h})})]})]})}},9786:(e,s,a)=>{a.r(s),a.d(s,{default:()=>r});a(5043);var t=a(5111),n=a(8818),i=a(579);const r=()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.A,{roleSegment:"pm"}),(0,i.jsx)(t.A,{role:"Project Manager",fetchUrl:"/requests/mine",detailLinkBase:"/pm/material-request",rootClass:"pm-request-list",disableHeader:!0})]})},9846:(e,s,a)=>{a.r(s),a.d(s,{default:()=>p});var t=a(5043),n=a(3216),i=a(5475),r=(a(7508),a(411)),l=a(108),o=a(163),c=a(4240),d=a(7869),m=a(8818),u=a(3204),h=a(579);const p=e=>{var s;let{forceUserUpdate:a}=e;const p=(0,n.Zp)(),[v,j]=(0,t.useState)((()=>{const e=localStorage.getItem("user");return e?JSON.parse(e):null})),[x,g]=(0,t.useState)((()=>localStorage.getItem("token")||"")),[N,y]=(0,t.useState)((()=>null===v||void 0===v?void 0:v._id));(0,t.useEffect)((()=>{const e=()=>{const e=localStorage.getItem("user");j(e?JSON.parse(e):null),y(e?JSON.parse(e)._id:void 0),g(localStorage.getItem("token")||"")};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}),[]);const[f,b]=(0,t.useState)((null===v||void 0===v?void 0:v.name)||"ALECK"),[w,A]=(0,t.useState)((null===v||void 0===v?void 0:v.role)||"");(0,t.useEffect)((()=>{b((null===v||void 0===v?void 0:v.name)||"ALECK"),A((null===v||void 0===v?void 0:v.role)||"")}),[v]);const[k,C]=(0,t.useState)(null),[S,D]=(0,t.useState)([]),[q,R]=(0,t.useState)(!0),[P,_]=(0,t.useState)(null),[M,L]=(0,t.useState)([]),[I,T]=(0,t.useState)(!0),[E,B]=(0,t.useState)(null),F=(e,s)=>{const a=(null===e||void 0===e?void 0:e.toLowerCase())||"";if(a.includes("rejected"))return"rejected";switch(s){case"placed":return a.includes("pending pm")||a.includes("project manager")?"completed one-step-behind":(a.includes("pending am")||a.includes("area manager")||a.includes("approved")||a.includes("received"),"completed");case"pm":if(a.includes("rejected pm")||a.includes("pm rejected"))return"rejected";if(a.includes("pending pm")||a.includes("project manager"))return"pending";if(a.includes("pending am")||a.includes("area manager"))return"completed one-step-behind";if(a.includes("approved")||a.includes("received"))return"completed";break;case"am":if(a.includes("rejected am")||a.includes("am rejected"))return"rejected";if(a.includes("pending am")||a.includes("area manager"))return"pending";if(a.includes("approved"))return"completed one-step-behind";if(a.includes("received"))return"completed";break;case"done":if(a.includes("received"))return"completed"}return""};(0,t.useEffect)((()=>{x&&N||p("/")}),[x,N,p]),(0,t.useEffect)((()=>{if(!x||!N)return;(async()=>{try{const{data:s}=await r.Ay.get("/projects/assigned/projectmanager/".concat(N),{headers:{Authorization:"Bearer ".concat(x)}});let a=s;if(a&&a.status&&!/ongoing/i.test(a.status))try{const e=await r.Ay.get("/projects/assigned/allroles/".concat(N),{headers:{Authorization:"Bearer ".concat(x)}}),s=(Array.isArray(e.data)?e.data:[]).find((e=>/ongoing/i.test(e.status||"")));s&&(a=s)}catch(e){}C(a||null)}catch(s){C(null)}})()}),[x,N]),(0,t.useEffect)((()=>{if(!x)return B("Session expired. Please log in again."),void T(!1);(async()=>{try{const{data:e}=await r.Ay.get("/requests/mine",{headers:{Authorization:"Bearer ".concat(x)}});L(Array.isArray(e)?e:[]),B(null)}catch(e){B("Error loading material requests"),L([])}T(!1)})()}),[x]);const z=(0,t.useCallback)((async()=>{if(!x)return console.log("No token available for fetchChats"),_("Session expired. Please log in again."),void R(!1);if(!N)return console.log("No userId available for fetchChats"),_("User ID not available"),void R(!1);console.log("Starting fetchChats with token and userId:",{token:x.substring(0,20)+"...",userId:N}),R(!0);try{try{const e=await r.Ay.get("/auth/me",{headers:{Authorization:"Bearer ".concat(x)}});console.log("Backend user info:",e.data),console.log("Backend user ID:",e.data._id),console.log("Frontend userId:",N),console.log("Are they the same?",e.data._id===N)}catch(e){console.log("Could not get backend user info:",e.message)}const s={Authorization:"Bearer ".concat(x)};console.log("Making API call to /chats with headers:",s);const{data:a}=await r.Ay.get("/chats",{headers:s});if(console.log("Raw chat data received:",a),console.log("Data type:",typeof a),console.log("Is array?",Array.isArray(a)),Array.isArray(a)){console.log("Chat data is array, length:",a.length),a.length>0&&(console.log("First chat item structure:",a[0]),console.log("First chat users:",a[0].users),console.log("Current userId:",N));const e=a.map(((e,s)=>{var a,t,n,i,r,l;console.log("Processing chat ".concat(s,":"),e);let o=null===(a=e.users)||void 0===a?void 0:a.find((e=>e._id!==N));!o&&(null===(t=e.users)||void 0===t?void 0:t.length)>0&&(o=e.users.find((e=>e._id.toString()!==N.toString()))),!o&&(null===(n=e.users)||void 0===n?void 0:n.length)>0&&(o=e.users.find((e=>e._id!==N))),console.log("Other user for chat ".concat(s,":"),o),console.log("Other user _id:",null===(i=o)||void 0===i?void 0:i._id),console.log("Current userId:",N),console.log("Comparison result:",(null===(r=o)||void 0===r?void 0:r._id)!==N);let c="Unknown User";if(o)c=o.name||"".concat(o.firstname||""," ").concat(o.lastname||"").trim()||"Unknown User";else if((null===(l=e.users)||void 0===l?void 0:l.length)>0){const s=e.users.map((e=>e.name||"".concat(e.firstname||""," ").concat(e.lastname||"").trim()||"Unknown")).filter((e=>"Unknown"!==e));c=s.length>0?s.join(", "):"Unknown User"}console.log("Other user name for chat ".concat(s,":"),c);let d="No messages yet",m=new Date;e.lastMessage&&(d=e.lastMessage.content||"No messages yet",m=e.lastMessage.timestamp||new Date,console.log("Last message for chat ".concat(s,":"),{content:d,time:m}));const u={_id:e._id,name:e.isGroup?e.name:c,isGroup:e.isGroup||!1,lastMessage:d,lastMessageTime:m,users:e.users||[],color:"#4A6AA5"};return console.log("Processed chat ".concat(s,":"),u),u}));console.log("All processed chats:",e),D(e)}else console.log("No valid chat data found, setting empty array"),console.log("Data received was:",a),D([]);_(null)}catch(s){console.log("Chat fetch error:",s),console.log("Error response:",s.response),console.log("Error message:",s.message),D([]),_("Failed to load conversations: ".concat(s.message))}R(!1)}),[x,N]);(0,t.useEffect)((()=>{z()}),[z]),(0,t.useEffect)((()=>{if(!x||!N)return;const e=setInterval((()=>{console.log("Auto-refreshing conversations..."),z()}),3e4);return()=>clearInterval(e)}),[x,N,z]),(0,t.useEffect)((()=>{const e=()=>{x&&N&&(console.log("Dashboard focused, refreshing conversations..."),z())};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)}),[x,N,z]);const[U,O]=(0,t.useState)([]),[W,H]=(0,t.useState)(!1),Z=(0,t.useCallback)((async()=>{if(null!==k&&void 0!==k&&k._id&&x)try{H(!0);const{data:e}=await r.Ay.get("/projects/".concat(k._id,"/reports"),{headers:{Authorization:"Bearer ".concat(x)}});O((null===e||void 0===e?void 0:e.reports)||[])}catch(e){console.error("Failed to fetch reports:",e),O([])}finally{H(!1)}}),[null===k||void 0===k?void 0:k._id,x]);(0,t.useEffect)((()=>{Z()}),[Z]),(0,t.useEffect)((()=>{const e=e=>{var s;String(null===e||void 0===e||null===(s=e.detail)||void 0===s?void 0:s.projectId)===String(null===k||void 0===k?void 0:k._id)&&Z()};return window.addEventListener("projectReportsUpdated",e),()=>window.removeEventListener("projectReportsUpdated",e)}),[null===k||void 0===k?void 0:k._id,Z]);const V=t.useMemo((()=>{var e;if(!U.length)return{data:[],totalReports:0,completedWorkItems:0,inProgressWorkItems:0,totalWorkItems:0,averageContribution:0,reportingPics:0,lastReportDate:null,overallAdjustedProgress:0};const s=[...U].sort(((e,s)=>new Date(s.uploadedAt||0)-new Date(e.uploadedAt||0))),a=new Map;for(const v of s){const e=v.uploadedBy||v.uploadedByName||v._id;a.has(e)||a.set(e,v)}const t=[...a.values()];let n=0,i=0,r=0,l=0,o=0;const c=new Map;t.forEach((e=>{var s,a;const t=e.ai||{},d=(null===(s=t.completed_tasks)||void 0===s?void 0:s.length)||0,m=(null===(a=t.summary_of_work_done)||void 0===a?void 0:a.length)||0,u=Number(t.pic_contribution_percent_raw),h=Number(t.pic_contribution_percent),p=isFinite(u)&&u>=0?u:isFinite(h)&&h>=0?h:0;n+=d,i+=m,r+=d+m,p>0&&(l+=p,o++);const v=e.uploadedBy||e.uploadedByName||e._id;c.set(String(v),Math.max(0,Math.min(100,Math.round(p))))}));const d=o>0?l/o:0,m=(null===(e=s[0])||void 0===e?void 0:e.uploadedAt)||null,u=Array.isArray(null===k||void 0===k?void 0:k.pic)?k.pic.map((e=>String((null===e||void 0===e?void 0:e._id)||e.id||e))):[];let h=0,p=0;if(u.length>0){h=u.reduce(((e,s)=>e+(c.get(s)||0)),0)/u.length,p=h}else h=d,p=d;h=Math.round(Math.max(0,Math.min(100,h))),p=Math.round(Math.max(0,Math.min(100,p)));return{data:[{name:"Completed",value:n,color:"#22c55e"},{name:"In Progress",value:i,color:"#3b82f6"}].filter((e=>e.value>0)),totalReports:U.length,completedWorkItems:n,inProgressWorkItems:i,totalWorkItems:r,averageContribution:Math.round(d),reportingPics:t.length,lastReportDate:m,overallAdjustedProgress:h,headcountAverage:p}}),[U,null===k||void 0===k?void 0:k.pic]),J=t.useMemo((()=>{const e=Array.isArray(null===k||void 0===k?void 0:k.pic)?k.pic.length:0;V.reportingPics;let s=V.headcountAverage||0;return 0===e&&(s=(null===k||void 0===k?void 0:k.progress)||s),Math.min(100,Math.max(0,Math.round(s)))}),[null===k||void 0===k?void 0:k.pic,null===k||void 0===k?void 0:k.progress,V.headcountAverage]),G=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!e||"string"!==typeof e)return"No messages yet";const a=e.trim().split(/\s+/);return a.length<=s?e:a.slice(0,s).join(" ")+"..."};return(0,h.jsxs)("div",{className:"pm-dashboard dashboard-container",children:[(0,h.jsx)(m.A,{roleSegment:"pm"}),(0,h.jsx)("main",{className:"dashboard-main",children:(0,h.jsxs)("div",{className:"dashboard-grid",children:[(0,h.jsxs)("div",{className:"dashboard-card pm-welcome-card",children:[(0,h.jsx)("div",{className:"hero-art","aria-hidden":"true",style:{backgroundImage:"radial-gradient(ellipse at 65% 35%, rgba(255,255,255,0.18), transparent 55%), url(".concat("","/images/illustration-construction-site.png)")}}),(0,h.jsxs)("div",{className:"welcome-content",children:[(0,h.jsxs)("h2",{className:"welcome-title",children:["Welcome back, ",f,"! \ud83d\udc4b"]}),(0,h.jsx)("p",{className:"welcome-subtitle",children:"Here's what's happening with your project today"})]}),(0,h.jsxs)("div",{className:"welcome-stats",children:[(0,h.jsx)(i.N_,{to:"/pm/viewproj",className:"stat-link",children:(0,h.jsxs)("div",{className:"stat-item",children:[(0,h.jsx)("div",{className:"stat-icon",children:(0,h.jsx)(u.yd7,{})}),(0,h.jsxs)("div",{className:"stat-content",children:[(0,h.jsx)("div",{className:"stat-value",children:k?1:0}),(0,h.jsx)("div",{className:"stat-label",children:"TOTAL PROJECTS"})]})]})}),(0,h.jsx)(i.N_,{to:"/pm/viewproj",className:"stat-link",children:(0,h.jsxs)("div",{className:"stat-item",children:[(0,h.jsx)("div",{className:"stat-icon",children:(0,h.jsx)(u.YXz,{})}),(0,h.jsxs)("div",{className:"stat-content",children:[(0,h.jsx)("div",{className:"stat-value",children:(null===k||void 0===k||null===(s=k.manpower)||void 0===s?void 0:s.length)||0}),(0,h.jsx)("div",{className:"stat-label",children:"TEAM MEMBERS"})]})]})})]}),(0,h.jsxs)("div",{className:"kpi-strip",children:[(0,h.jsxs)(i.N_,{to:"/pm/request/:id",className:"kpi",children:[(0,h.jsx)("div",{className:"kpi-ico",children:(0,h.jsx)(u.H5e,{})}),(0,h.jsxs)("div",{className:"kpi-body",style:{color:"#fff"},children:[(0,h.jsx)("div",{className:"kpi-title",style:{color:"#fff"},children:"Pending Requests"}),(0,h.jsx)("div",{className:"kpi-value",style:{color:"#fff"},children:M.filter((e=>"Pending"===e.status)).length})]})]}),(0,h.jsxs)(i.N_,{to:"/pm/viewproj",className:"kpi",children:[(0,h.jsx)("div",{className:"kpi-ico",children:(0,h.jsx)(u.v$b,{})}),(0,h.jsxs)("div",{className:"kpi-body",style:{color:"#fff"},children:[(0,h.jsx)("div",{className:"kpi-title",style:{color:"#fff"},children:"Active Projects"}),(0,h.jsx)("div",{className:"kpi-value",style:{color:"#fff"},children:k?1:0})]})]}),(0,h.jsxs)(i.N_,{to:"/pm/viewproj",className:"kpi",children:[(0,h.jsx)("div",{className:"kpi-ico",children:(0,h.jsx)(u.yd7,{})}),(0,h.jsxs)("div",{className:"kpi-body",style:{color:"#fff"},children:[(0,h.jsx)("div",{className:"kpi-title",style:{color:"#fff"},children:"Avg. Progress"}),(0,h.jsxs)("div",{className:"kpi-value",style:{color:"#fff"},children:[J,"%"]})]})]})]})]}),k&&(0,h.jsxs)("div",{className:"dashboard-card chart-card",children:[(0,h.jsxs)("div",{className:"card-header",children:[(0,h.jsx)("h3",{className:"card-title",children:"Work Progress Overview"}),(0,h.jsx)("div",{className:"card-subtitle",children:"Overall progress based on latest PIC reports"})]}),(()=>{const e=Array.isArray(null===k||void 0===k?void 0:k.pic)?k.pic.length:0,s=V.reportingPics||0,a=J,t=[{name:"Completed",value:a,color:"#22c55e"},{name:"Remaining",value:100-a,color:"#e2e8f0"}];return(0,h.jsxs)("div",{className:"chart-container",style:{position:"relative"},children:[(0,h.jsx)(l.u,{width:"100%",height:200,children:(0,h.jsx)(o.r,{children:(0,h.jsx)(c.F,{data:t,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,startAngle:90,endAngle:-270,paddingAngle:1,dataKey:"value",children:t.map(((e,s)=>(0,h.jsx)(d.f,{fill:e.color},"cell-".concat(s))))})})}),(0,h.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center"},children:[(0,h.jsxs)("div",{style:{fontSize:32,fontWeight:700,color:"#0f172a"},children:[a,"%"]}),(0,h.jsx)("div",{style:{fontSize:12,color:"#64748b"},children:s<e?"".concat(s,"/").concat(e," PICs"):"Overall"})]})]})})(),V.lastReportDate&&(0,h.jsxs)("div",{className:"chart-footer",children:[(0,h.jsxs)("span",{className:"last-report",children:["Last report: ",new Date(V.lastReportDate).toLocaleDateString()]}),Array.isArray(null===k||void 0===k?void 0:k.pic)&&k.pic.length>0&&(0,h.jsxs)("span",{style:{marginLeft:12,fontSize:12,color:"#64748b"},children:["Coverage: ",V.reportingPics,"/",k.pic.length," PICs"]})]})]}),(0,h.jsxs)("div",{className:"dashboard-card requests-card",children:[(0,h.jsxs)("div",{className:"card-header",children:[(0,h.jsx)("h3",{className:"card-title",children:"Material Requests"}),(0,h.jsxs)(i.N_,{to:"/pm/request/:id",className:"view-all-link",children:["View All ",(0,h.jsx)(u.Z0P,{})]})]}),(0,h.jsx)("div",{className:"requests-content",children:I?(0,h.jsxs)("div",{className:"loading-state",children:[(0,h.jsx)("div",{className:"loading-spinner"}),(0,h.jsx)("span",{children:"Loading requests..."})]}):E?(0,h.jsxs)("div",{className:"error-state",children:[(0,h.jsx)(u.BS8,{}),(0,h.jsx)("span",{children:E})]}):0===M.length?(0,h.jsxs)("div",{className:"empty-state",children:[(0,h.jsx)(u.H5e,{}),(0,h.jsx)("span",{children:"No material requests found"}),(0,h.jsx)("p",{children:"All requests have been processed or none are pending"})]}):(0,h.jsx)("div",{className:"requests-list",children:M.slice(0,3).map((e=>{var s,a,t;return(0,h.jsxs)(i.N_,{to:"/pm/request/".concat(e._id),className:"request-item-new-layout",style:{textDecoration:"none"},children:[(0,h.jsxs)("div",{className:"request-left-section",children:[(0,h.jsx)("div",{className:"request-icon-new",children:(0,h.jsx)(u.H5e,{})}),(0,h.jsxs)("div",{className:"request-details-new",children:[(0,h.jsx)("h4",{className:"request-title-new",children:null===(s=e.materials)||void 0===s?void 0:s.map((e=>"".concat(e.materialName," (").concat(e.quantity,")"))).join(", ")}),(0,h.jsxs)("div",{className:"request-meta-new",children:[(0,h.jsx)("span",{className:"request-project-new",children:null===(a=e.project)||void 0===a?void 0:a.projectName}),(0,h.jsx)("span",{className:"request-date-new",children:new Date(e.createdAt).toLocaleDateString()})]})]})]}),(0,h.jsx)("div",{className:"request-center-section",children:(0,h.jsxs)("div",{className:"tracking-timeline-new",children:[(0,h.jsxs)("div",{className:"timeline-step-new ".concat(F(e.status,"placed")),children:[(0,h.jsx)("div",{className:"timeline-icon-new",children:(0,h.jsx)(u.A7C,{})}),(0,h.jsx)("span",{className:"timeline-label-new",children:"Placed"})]}),(0,h.jsx)("div",{className:"timeline-connector-new ".concat(["Pending PM","Pending AM","Approved","Received","PENDING PROJECT MANAGER"].includes(e.status)?"completed":"")}),(0,h.jsxs)("div",{className:"timeline-step-new ".concat(F(e.status,"pm")),children:[(0,h.jsx)("div",{className:"timeline-icon-new",children:(0,h.jsx)(u.p7b,{})}),(0,h.jsx)("span",{className:"timeline-label-new",children:"PM"})]}),(0,h.jsx)("div",{className:"timeline-connector-new ".concat(["Pending AM","Approved","Received","PENDING AREA MANAGER"].includes(e.status)?"completed":"")}),(0,h.jsxs)("div",{className:"timeline-step-new ".concat(F(e.status,"am")),children:[(0,h.jsx)("div",{className:"timeline-icon-new",children:(0,h.jsx)(u.ymh,{})}),(0,h.jsx)("span",{className:"timeline-label-new",children:"AM"})]}),(0,h.jsx)("div",{className:"timeline-connector-new ".concat(["Approved","Received"].includes(e.status)?"completed":"")}),(0,h.jsxs)("div",{className:"timeline-step-new ".concat(F(e.status,"done")),children:[(0,h.jsx)("div",{className:"timeline-icon-new",children:(0,h.jsx)(u.A7C,{})}),(0,h.jsx)("span",{className:"timeline-label-new",children:"Done"})]})]})}),(0,h.jsx)("div",{className:"request-right-section",children:(0,h.jsx)("div",{className:"request-status-new",children:(0,h.jsx)("span",{className:"status-text-new ".concat(null===(t=e.status)||void 0===t?void 0:t.replace(/\s/g,"").toLowerCase()),children:e.status})})})]},e._id)}))})})]}),(0,h.jsxs)("div",{className:"dashboard-card chats-card",children:[(0,h.jsxs)("div",{className:"card-header",children:[(0,h.jsx)("h3",{className:"card-title",children:"Recent Conversations"}),(0,h.jsxs)("div",{className:"card-actions",children:[(0,h.jsx)("button",{className:"refresh-btn",onClick:z,title:"Refresh conversations",disabled:q,children:(0,h.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,h.jsx)("path",{d:"M1 4v6h6M23 20v-6h-6"}),(0,h.jsx)("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})]})}),(0,h.jsxs)(i.N_,{to:"/pm/chat",className:"view-all-link",children:["View All ",(0,h.jsx)(u.Z0P,{})]})]})]}),(0,h.jsx)("div",{className:"chats-list",children:q?(0,h.jsxs)("div",{className:"loading-state",children:[(0,h.jsx)("div",{className:"loading-spinner"}),(0,h.jsx)("span",{children:"Loading conversations..."})]}):P?(0,h.jsxs)("div",{className:"error-state",children:[(0,h.jsx)(u.BS8,{}),(0,h.jsx)("span",{children:P})]}):0===S.length?(0,h.jsxs)("div",{className:"empty-state",children:[(0,h.jsx)(u.uN,{}),(0,h.jsx)("span",{children:"No recent conversations"}),(0,h.jsx)("p",{children:"Start chatting with your team members"})]}):S.slice(0,3).map(((e,s)=>(console.log("Chat data for time debugging:",{chatId:e._id||s,lastMessageTime:e.lastMessageTime,timestamp:e.timestamp,createdAt:e.createdAt,fullChat:e}),(0,h.jsxs)(i.N_,{to:"/pm/chat/".concat(e._id||e.chatId||s),className:"chat-item",style:{textDecoration:"none"},children:[(0,h.jsx)("div",{className:"chat-avatar",style:{backgroundColor:e.color||"#3b82f6"},children:"string"===typeof e.name?e.name.charAt(0).toUpperCase():"U"}),(0,h.jsxs)("div",{className:"chat-content",children:[(0,h.jsxs)("div",{className:"chat-header",children:[(0,h.jsx)("span",{className:"chat-name",children:"string"===typeof e.name?e.name:"Unknown User"}),(0,h.jsx)("span",{className:"chat-time",children:(()=>{const s=e.lastMessageTime||e.timestamp||e.createdAt;if(!s)return"Just now";try{if("string"===typeof s){const e=new Date(s);return isNaN(e.getTime())?"Just now":e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}if(s instanceof Date)return s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});if("number"===typeof s){return new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return"Just now"}catch(a){return console.log("Time formatting error:",a,"for time:",s),"Just now"}})()})]}),(0,h.jsx)("p",{className:"chat-message",children:G("string"===typeof e.lastMessage?e.lastMessage:"No messages yet")})]})]},e._id||s))))})]})]})})]})}}}]);
//# sourceMappingURL=pm.fae67ea1.chunk.js.map
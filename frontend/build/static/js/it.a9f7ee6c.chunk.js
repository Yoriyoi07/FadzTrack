"use strict";(self.webpackChunkfadz_web_frontend=self.webpackChunkfadz_web_frontend||[]).push([[688],{64:()=>{},254:(e,t,a)=>{a.r(t),a.d(t,{default:()=>r});a(5043);var n=a(5111),s=(a(9389),a(579));const r=()=>(0,s.jsx)(n.A,{role:"IT",fetchUrl:"/requests/all",detailLinkBase:"/it/material-request",rootClass:"it-request-list",headerTitle:"Material Requests",headerSubtitle:"All material requests (IT view)",enableExport:!0,exportTitle:"Material Requests Export (IT View)"})},342:()=>{},530:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});a(5043);var n=a(3182),s=a(8818),r=a(579);const i=()=>(0,r.jsx)(n.A,{role:"IT",rootClass:"it-request-detail",customHeader:(0,r.jsx)(s.A,{roleSegment:"it"}),headerTitle:"Material Request Detail",headerSubtitle:"Full lifecycle view (IT)"})},852:(e,t,a)=>{a.r(t),a.d(t,{default:()=>g});var n=a(9379),s=a(5043),r=a(411),i=a(3216),o=(a(2544),a(3204)),l=a(7762),c=a(4857),d=a(8818),p=a(579);const u={textAlign:"left",padding:"10px 8px",fontWeight:600,borderBottom:"2px solid #eee"},h={padding:"8px 8px",borderBottom:"1px solid #eee"},m={textAlign:"left",padding:"6px 8px",fontWeight:600,fontSize:12,borderBottom:"1px solid #e2e8f0",color:"#334155"},x={padding:"6px 8px",borderBottom:"1px solid #f1f5f9",fontSize:12,verticalAlign:"top",fontFamily:"system-ui, sans-serif"},g=()=>{(0,i.Zp)();const[e,t]=(0,s.useState)(!1),[a,g]=(0,s.useState)(!1),[j,f]=(0,s.useState)([]),[v,b]=(0,s.useState)(!0),[y,S]=(0,s.useState)(""),[w,N]=(0,s.useState)(""),[C,A]=(0,s.useState)(""),[T,I]=(0,s.useState)(""),[E,D]=(0,s.useState)(""),[k,R]=(0,s.useState)(!1),[P,_]=(0,s.useState)(!1),[q,L]=(0,s.useState)(null),F=(()=>{try{const e=new URLSearchParams(window.location.search),t=parseInt(e.get("page")||"1",10),a=parseInt(e.get("pageSize")||"30",10);return{p:isFinite(t)&&t>0?t:1,ps:[30,50,100].includes(a)?a:30}}catch(e){return{p:1,ps:30}}})(),[M,z]=(0,s.useState)(F.p),[O,U]=(0,s.useState)(F.ps),[W,B]=(0,s.useState)(""),H=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{padding:"6px 12px",fontSize:13,borderRadius:6,border:t?"1px solid #2563eb":"1px solid #d1d5db",backgroundColor:e?"#f1f5f9":t?"#3b82f6":"#ffffff",color:e?"#94a3b8":t?"#ffffff":"#374151",cursor:e?"not-allowed":"pointer",fontWeight:t?600:500,lineHeight:1.2,transition:"all .15s ease",minWidth:42}},J={padding:"6px 4px",color:"#64748b",fontSize:13,userSelect:"none"},[V,Q]=(0,s.useState)((()=>{const e=localStorage.getItem("user");return e?JSON.parse(e):null})),[Y,G]=(0,s.useState)((()=>localStorage.getItem("token")||"")),[Z,K]=(0,s.useState)((()=>null===V||void 0===V?void 0:V._id)),[X,$]=(0,s.useState)((null===V||void 0===V?void 0:V.name)||"IT Manager"),[ee,te]=(0,s.useState)((null===V||void 0===V?void 0:V.role)||"");(0,s.useEffect)((()=>{const e=()=>{const e=localStorage.getItem("user");Q(e?JSON.parse(e):null),K(e?JSON.parse(e)._id:void 0),G(localStorage.getItem("token")||"")};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}),[]),(0,s.useEffect)((()=>{$((null===V||void 0===V?void 0:V.name)||"IT Manager"),te((null===V||void 0===V?void 0:V.role)||"")}),[V]),(0,s.useEffect)((()=>{const e=()=>{const e=window.pageYOffset||document.documentElement.scrollTop;g(e>50)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[a]),(0,s.useEffect)((()=>{r.Ay.get("/audit-logs").then((e=>{f(e.data),b(!1)})).catch((()=>b(!1)))}),[]),(0,s.useEffect)((()=>{const e=e=>{e.target.closest(".user-profile")||t(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}}),[]);const ae=e=>{const t=e.meta||{};return Array.isArray(t.changedFields)&&t.changedFields.length?(0,p.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,p.jsxs)("div",{style:{fontWeight:600,fontSize:14},children:["Changed Fields (",t.changedFields.length,")"]}),(0,p.jsx)("div",{style:{overflowX:"auto"},children:(0,p.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{style:{background:"#f1f5f9"},children:[(0,p.jsx)("th",{style:m,children:"Field"}),(0,p.jsx)("th",{style:m,children:"Before"}),(0,p.jsx)("th",{style:m,children:"After"})]})}),(0,p.jsx)("tbody",{children:t.changedFields.map(((e,t)=>{const a=e.before!==e.after;return(0,p.jsxs)("tr",{style:{background:t%2?"#ffffff":"#f8fafc"},children:[(0,p.jsx)("td",{style:x,children:e.field}),(0,p.jsx)("td",{style:(0,n.A)((0,n.A)({},x),{},{color:a?"#dc2626":"#475569"}),children:ne(e.before)}),(0,p.jsx)("td",{style:(0,n.A)((0,n.A)({},x),{},{color:a?"#16a34a":"#475569"}),children:ne(e.after)})]},t)}))})]})})]}):t.fileNames||t.filesCount?(0,p.jsxs)("div",{style:{fontSize:12,display:"flex",flexDirection:"column",gap:6},children:[null!=t.filesCount&&(0,p.jsxs)("div",{children:[(0,p.jsx)("b",{children:"Files Count:"})," ",t.filesCount]}),Array.isArray(t.fileNames)&&t.fileNames.length>0&&(0,p.jsxs)("div",{children:[(0,p.jsx)("b",{children:"Files:"}),(0,p.jsx)("ul",{style:{margin:"4px 0 0 16px",padding:0},children:t.fileNames.map(((e,t)=>(0,p.jsx)("li",{style:{fontFamily:"monospace"},children:e},t)))})]}),t.fileTypes&&(0,p.jsxs)("div",{children:[(0,p.jsx)("b",{children:"Types:"})," ",Array.isArray(t.fileTypes)?t.fileTypes.join(", "):t.fileTypes]}),t.totalSize&&(0,p.jsxs)("div",{children:[(0,p.jsx)("b",{children:"Total Size:"})," ",t.totalSize," bytes"]})]}):(0,p.jsx)("pre",{style:{whiteSpace:"pre-wrap",fontSize:12,margin:0},children:JSON.stringify(t,null,2)})},ne=e=>null===e||void 0===e?"":"object"===typeof e?JSON.stringify(e):String(e),se=j.filter((e=>{var t,a,n,s,r,i,o;const l=new Date(e.timestamp),c=T?new Date(T):null,d=E?new Date(E+"T23:59:59"):null;return(!c||l>=c)&&(!d||l<=d)&&(!w||(null===(t=e.performedByRole)||void 0===t?void 0:t.toLowerCase().includes(w.toLowerCase())))&&(!C||(null===(a=e.action)||void 0===a?void 0:a.toLowerCase().includes(C.toLowerCase())))&&(!y||(null===(n=e.description)||void 0===n?void 0:n.toLowerCase().includes(y.toLowerCase()))||(null===(s=e.performedBy)||void 0===s||null===(r=s.name)||void 0===r?void 0:r.toLowerCase().includes(y.toLowerCase()))||(null===(i=e.performedByRole)||void 0===i?void 0:i.toLowerCase().includes(y.toLowerCase()))||(null===(o=e.action)||void 0===o?void 0:o.toLowerCase().includes(y.toLowerCase())))}));(0,s.useEffect)((()=>{z(1)}),[y,w,C,T,E,O]),(0,s.useEffect)((()=>{const e=new URLSearchParams(window.location.search);e.set("page",String(M)),e.set("pageSize",String(O));const t="".concat(window.location.pathname,"?").concat(e.toString());window.history.replaceState(null,"",t)}),[M,O]);const re=se.length,ie=Math.max(1,Math.ceil(re/O)),oe=Math.min(M,ie),le=se.slice((oe-1)*O,oe*O),ce=e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"login":case"login_trusted":case"complete_manpower_request":return"#10b981";case"logout":return"#ef4444";case"create_material_request":case"create_manpower_request":case"add_project":return"#3b82f6";case"update_material_request":case"update_manpower_request":case"update_project":case"update_project_tasks":return"#f59e0b";case"delete_material_request":case"delete_manpower_request":case"delete_project":case"delete_project_document":return"#dc2626";case"approve_material_request":case"approve_manpower_request":return"#059669";case"add_project_documents":case"generate_attendance_report":case"upload_project_discussion":case"upload_project_files":case"upload_chat_files":return"#8b5cf6";case"submit_daily_report":case"submit_attendance_report":case"generate_dss_report":return"#06b6d4";default:return"#6b7280"}},de=async e=>{try{const t=new l.uE,a=new Image;a.src="/images/Fadz-logo.png",await new Promise(((e,n)=>{a.onload=()=>{try{t.addImage(a,"PNG",20,20,50,50),e()}catch(n){console.warn("Could not add logo to PDF:",n),e()}},a.onerror=()=>{console.warn("Could not load logo for PDF"),e()}})),t.setFontSize(26),t.setFont("helvetica","bold"),t.text("FadzTrack",80,40),t.setFontSize(20),t.setFont("helvetica","bold"),t.text("IT Audit Logs Report",80,55),t.setFontSize(10),t.setFont("helvetica","normal"),t.text("Exported by: ".concat(X," (").concat(ee,")"),20,70),t.text("Export Date: ".concat((new Date).toLocaleString()),20,80);let n=95;t.setFontSize(12),t.setFont("helvetica","bold"),t.text("Active Filters:",20,n),n+=10,t.setFontSize(10),t.setFont("helvetica","normal"),y&&(t.text('Search: "'.concat(y,'"'),20,n),n+=8),w&&(t.text("Role: ".concat(w),20,n),n+=8),C&&(t.text("Action: ".concat(C),20,n),n+=8),T&&(t.text("Start Date: ".concat(T),20,n),n+=8),E&&(t.text("End Date: ".concat(E),20,n),n+=8),n+=5,t.setFontSize(12),t.setFont("helvetica","bold"),t.text("Total Records: ".concat(e.length),20,n);const s=n+20,r=["Date/Time","Action","Performed By","Role","Description"],i=e.map((e=>{var t;return[new Date(e.timestamp).toLocaleString(),e.action||"",(null===(t=e.performedBy)||void 0===t?void 0:t.name)||"Unknown",e.performedByRole||"",e.description||""]}));(0,c.Ay)(t,{head:[r],body:i,startY:s,margin:{top:20,right:20,bottom:20,left:20},styles:{fontSize:8,cellPadding:2,overflow:"linebreak"},headStyles:{fillColor:[59,130,246],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{0:{cellWidth:35},1:{cellWidth:30},2:{cellWidth:35},3:{cellWidth:25},4:{cellWidth:50}}});const o="audit-logs-".concat((new Date).toISOString().split("T")[0],".pdf");t.save(o)}catch(t){throw console.error("Error generating PDF:",t),new Error("Failed to generate PDF")}};return(0,p.jsxs)("div",{className:"dashboard-container",style:{overflow:"visible"},children:[(0,p.jsx)(d.A,{roleSegment:"it"}),(0,p.jsx)("main",{className:"dashboard-main",style:{marginTop:"1rem",overflow:"visible",maxHeight:"none"},children:(0,p.jsxs)("div",{style:{maxWidth:1200,margin:"30px auto",padding:24,background:"#fff",borderRadius:12,boxShadow:"0 2px 16px #0001"},children:[(0,p.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24,borderBottom:"2px solid #f0f0f0",paddingBottom:16},children:[(0,p.jsxs)("div",{children:[(0,p.jsxs)("h2",{style:{margin:0,fontSize:"28px",fontWeight:"600",color:"#1f2937",display:"flex",alignItems:"center",gap:"12px"},children:[(0,p.jsx)(o.kkc,{style:{color:"#3b82f6"}}),"IT Audit Log"]}),(0,p.jsx)("p",{style:{margin:"8px 0 0 0",color:"#6b7280",fontSize:"14px",fontWeight:"500"},children:"Monitor and track all system activities and user actions"})]}),(0,p.jsxs)("button",{onClick:()=>R(!0),style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 2px 4px rgba(59, 130, 246, 0.2)"},onMouseEnter:e=>{e.target.style.backgroundColor="#2563eb",e.target.style.transform="translateY(-1px)",e.target.style.boxShadow="0 4px 8px rgba(59, 130, 246, 0.3)"},onMouseLeave:e=>{e.target.style.backgroundColor="#3b82f6",e.target.style.transform="translateY(0)",e.target.style.boxShadow="0 2px 4px rgba(59, 130, 246, 0.2)"},children:[(0,p.jsx)(o.Mbn,{}),"Export PDF"]})]}),(0,p.jsxs)("div",{style:{display:"flex",gap:16,marginBottom:24,flexWrap:"wrap",padding:"20px",backgroundColor:"#f8fafc",borderRadius:"12px",border:"1px solid #e2e8f0"},children:[(0,p.jsxs)("div",{style:{flex:2,minWidth:250},children:[(0,p.jsx)("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#374151"},children:"Search"}),(0,p.jsx)("input",{placeholder:"Search by description, user, role, or action...",value:y,onChange:e=>S(e.target.value),style:{width:"100%",padding:"12px 16px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"14px",transition:"all 0.2s ease",outline:"none"},onFocus:e=>{e.target.style.borderColor="#3b82f6",e.target.style.boxShadow="0 0 0 3px rgba(59, 130, 246, 0.1)"},onBlur:e=>{e.target.style.borderColor="#d1d5db",e.target.style.boxShadow="none"}})]}),(0,p.jsxs)("div",{style:{flex:1,minWidth:150},children:[(0,p.jsx)("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#374151"},children:"Start Date"}),(0,p.jsx)("input",{type:"date",value:T,onChange:e=>I(e.target.value),style:{width:"100%",padding:"12px 16px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"14px",transition:"all 0.2s ease",outline:"none",backgroundColor:"white",cursor:"pointer"},onFocus:e=>{e.target.style.borderColor="#3b82f6",e.target.style.boxShadow="0 0 0 3px rgba(59, 130, 246, 0.1)"},onBlur:e=>{e.target.style.borderColor="#d1d5db",e.target.style.boxShadow="none"}})]}),(0,p.jsxs)("div",{style:{flex:1,minWidth:150},children:[(0,p.jsx)("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#374151"},children:"End Date"}),(0,p.jsx)("input",{type:"date",value:E,onChange:e=>D(e.target.value),style:{width:"100%",padding:"12px 16px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"14px",transition:"all 0.2s ease",outline:"none",backgroundColor:"white",cursor:"pointer"},onFocus:e=>{e.target.style.borderColor="#3b82f6",e.target.style.boxShadow="0 0 0 3px rgba(59, 130, 246, 0.1)"},onBlur:e=>{e.target.style.borderColor="#d1d5db",e.target.style.boxShadow="none"}})]}),(0,p.jsxs)("div",{style:{flex:1,minWidth:150},children:[(0,p.jsx)("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#374151"},children:"Role Filter"}),(0,p.jsxs)("select",{value:w,onChange:e=>N(e.target.value),style:{width:"100%",padding:"12px 16px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"14px",transition:"all 0.2s ease",outline:"none",backgroundColor:"white",cursor:"pointer"},onFocus:e=>{e.target.style.borderColor="#3b82f6",e.target.style.boxShadow="0 0 0 3px rgba(59, 130, 246, 0.1)"},onBlur:e=>{e.target.style.borderColor="#d1d5db",e.target.style.boxShadow="none"},children:[(0,p.jsx)("option",{value:"",children:"All Roles"}),(0,p.jsx)("option",{value:"IT",children:"IT"}),(0,p.jsx)("option",{value:"HR",children:"HR"}),(0,p.jsx)("option",{value:"Project Manager",children:"Project Manager"}),(0,p.jsx)("option",{value:"Area Manager",children:"Area Manager"}),(0,p.jsx)("option",{value:"Person in Charge",children:"Person in Charge"}),(0,p.jsx)("option",{value:"CEO",children:"CEO"}),(0,p.jsx)("option",{value:"Admin",children:"Admin"})]})]}),(0,p.jsxs)("div",{style:{flex:1,minWidth:150},children:[(0,p.jsx)("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#374151"},children:"Action Filter"}),(0,p.jsxs)("select",{value:C,onChange:e=>A(e.target.value),style:{width:"100%",padding:"12px 16px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"14px",transition:"all 0.2s ease",outline:"none",backgroundColor:"white",cursor:"pointer"},onFocus:e=>{e.target.style.borderColor="#3b82f6",e.target.style.boxShadow="0 0 0 3px rgba(59, 130, 246, 0.1)"},onBlur:e=>{e.target.style.borderColor="#d1d5db",e.target.style.boxShadow="none"},children:[(0,p.jsx)("option",{value:"",children:"All Actions"}),(0,p.jsx)("option",{value:"login",children:"Login"}),(0,p.jsx)("option",{value:"login_trusted",children:"Login (Trusted Device)"}),(0,p.jsx)("option",{value:"logout",children:"Logout"}),(0,p.jsx)("option",{value:"CREATE_MATERIAL_REQUEST",children:"Create Material Request"}),(0,p.jsx)("option",{value:"CEO_CREATE_MATERIAL_REQUEST",children:"CEO Create Material Request"}),(0,p.jsx)("option",{value:"UPDATE_MATERIAL_REQUEST",children:"Update Material Request"}),(0,p.jsx)("option",{value:"CEO_UPDATE_MATERIAL_REQUEST",children:"CEO Update Material Request"}),(0,p.jsx)("option",{value:"DELETE_MATERIAL_REQUEST",children:"Delete Material Request"}),(0,p.jsx)("option",{value:"CEO_DELETE_MATERIAL_REQUEST",children:"CEO Delete Material Request"}),(0,p.jsx)("option",{value:"APPROVE_MATERIAL_REQUEST",children:"Approve Material Request"}),(0,p.jsx)("option",{value:"CEO_APPROVE_MATERIAL_REQUEST",children:"CEO Approve Material Request"}),(0,p.jsx)("option",{value:"CREATED_MANPOWER_REQUEST",children:"Create Manpower Request"}),(0,p.jsx)("option",{value:"CEO_CREATED_MANPOWER_REQUEST",children:"CEO Create Manpower Request"}),(0,p.jsx)("option",{value:"UPDATE_MANPOWER_REQUEST",children:"Update Manpower Request"}),(0,p.jsx)("option",{value:"CEO_UPDATED_MANPOWER_REQUEST",children:"CEO Update Manpower Request"}),(0,p.jsx)("option",{value:"DELETE_MANPOWER_REQUEST",children:"Delete Manpower Request"}),(0,p.jsx)("option",{value:"CEO_DELETED_MANPOWER_REQUEST",children:"CEO Delete Manpower Request"}),(0,p.jsx)("option",{value:"APPROVE_MANPOWER_REQUEST",children:"Approve Manpower Request"}),(0,p.jsx)("option",{value:"COMPLETE_MANPOWER_REQUEST",children:"Complete Manpower Request"}),(0,p.jsx)("option",{value:"ADD_PROJECT",children:"Add Project"}),(0,p.jsx)("option",{value:"CEO_ADD_PROJECT",children:"CEO Add Project"}),(0,p.jsx)("option",{value:"UPDATE_PROJECT",children:"Update Project"}),(0,p.jsx)("option",{value:"CEO_UPDATE_PROJECT",children:"CEO Update Project"}),(0,p.jsx)("option",{value:"DELETE_PROJECT",children:"Delete Project"}),(0,p.jsx)("option",{value:"CEO_DELETE_PROJECT",children:"CEO Delete Project"}),(0,p.jsx)("option",{value:"UPDATE_PROJECT_TASKS",children:"Update Project Tasks"}),(0,p.jsx)("option",{value:"ADD_PROJECT_DOCUMENTS",children:"Add Project Documents"}),(0,p.jsx)("option",{value:"DELETE_PROJECT_DOCUMENT",children:"Delete Project Document"}),(0,p.jsx)("option",{value:"CEO_DELETE_PROJECT_DOCUMENT",children:"CEO Delete Project Document"}),(0,p.jsx)("option",{value:"SUBMIT_DAILY_REPORT",children:"Submit Daily Report"}),(0,p.jsx)("option",{value:"GENERATE_ATTENDANCE_REPORT",children:"Generate Attendance Report"}),(0,p.jsx)("option",{value:"SUBMIT_ATTENDANCE_REPORT",children:"Submit Attendance Report"}),(0,p.jsx)("option",{value:"UPLOAD_PROJECT_DISCUSSION",children:"Upload Project Discussion"}),(0,p.jsx)("option",{value:"UPLOAD_PROJECT_FILES",children:"Upload Project Files"}),(0,p.jsx)("option",{value:"GENERATE_DSS_REPORT",children:"Generate DSS Report"}),(0,p.jsx)("option",{value:"UPLOAD_CHAT_FILES",children:"Upload Chat Files"})]})]}),(0,p.jsx)("div",{style:{flex:1,minWidth:150,display:"flex",alignItems:"end"},children:(0,p.jsx)("button",{onClick:()=>{S(""),N(""),A(""),I(""),D("")},style:{width:"100%",padding:"12px 16px",backgroundColor:"#f3f4f6",color:"#374151",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease",marginTop:"24px"},onMouseEnter:e=>{e.target.style.backgroundColor="#e5e7eb",e.target.style.borderColor="#adb5bd"},onMouseLeave:e=>{e.target.style.backgroundColor="#f3f4f6",e.target.style.borderColor="#d1d5db"},children:"Clear Filters"})})]}),(y||w||C||T||E)&&(0,p.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px",padding:"12px 16px",backgroundColor:"#eff6ff",border:"1px solid #dbeafe",borderRadius:"8px",fontSize:"14px",color:"#1e40af"},children:[(0,p.jsx)("span",{style:{fontWeight:"500"},children:"Active Filters:"}),y&&(0,p.jsxs)("span",{style:{backgroundColor:"#dbeafe",padding:"4px 8px",borderRadius:"4px",fontSize:"12px"},children:['Search: "',y,'"']}),w&&(0,p.jsxs)("span",{style:{backgroundColor:"#dbeafe",padding:"4px 8px",borderRadius:"4px",fontSize:"12px"},children:["Role: ",w]}),C&&(0,p.jsxs)("span",{style:{backgroundColor:"#dbeafe",padding:"4px 8px",borderRadius:"4px",fontSize:"12px"},children:["Action: ",C]}),T&&(0,p.jsxs)("span",{style:{backgroundColor:"#dbeafe",padding:"4px 8px",borderRadius:"4px",fontSize:"12px"},children:["From: ",new Date(T).toLocaleDateString()]}),E&&(0,p.jsxs)("span",{style:{backgroundColor:"#dbeafe",padding:"4px 8px",borderRadius:"4px",fontSize:"12px"},children:["To: ",new Date(E).toLocaleDateString()]}),(0,p.jsxs)("span",{style:{marginLeft:"auto",fontSize:"12px",opacity:.8},children:[se.length," of ",j.length," records"]})]}),v?(0,p.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",color:"#6b7280"},children:[(0,p.jsx)("div",{style:{width:"40px",height:"40px",border:"3px solid #e5e7eb",borderTop:"3px solid #3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"16px"}}),(0,p.jsx)("span",{style:{fontSize:"16px",fontWeight:"500"},children:"Loading audit logs..."})]}):(0,p.jsxs)("div",{style:{overflowX:"auto",overflowY:"visible",backgroundColor:"white",borderRadius:"12px",border:"1px solid #e5e7eb",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:[(0,p.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14,fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:[(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white"},children:[(0,p.jsx)("th",{style:(0,n.A)((0,n.A)({},u),{},{background:"transparent",color:"white",fontSize:"14px",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.5px",padding:"16px 12px"}),children:"Date/Time"}),(0,p.jsx)("th",{style:(0,n.A)((0,n.A)({},u),{},{background:"transparent",color:"white",fontSize:"14px",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.5px",padding:"16px 12px"}),children:"Action"}),(0,p.jsx)("th",{style:(0,n.A)((0,n.A)({},u),{},{background:"transparent",color:"white",fontSize:"14px",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.5px",padding:"16px 12px"}),children:"Performed By"}),(0,p.jsx)("th",{style:(0,n.A)((0,n.A)({},u),{},{background:"transparent",color:"white",fontSize:"14px",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.5px",padding:"16px 12px"}),children:"Role"}),(0,p.jsx)("th",{style:(0,n.A)((0,n.A)({},u),{},{background:"transparent",color:"white",fontSize:"14px",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.5px",padding:"16px 12px"}),children:"Description"}),(0,p.jsx)("th",{style:(0,n.A)((0,n.A)({},u),{},{background:"transparent",color:"white",fontSize:"14px",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.5px",padding:"16px 12px"}),children:"Details"})]})}),(0,p.jsx)("tbody",{children:0===re?(0,p.jsx)("tr",{children:(0,p.jsx)("td",{colSpan:6,style:{textAlign:"center",color:"#9ca3af",padding:"40px 20px",fontSize:"16px",fontStyle:"italic"},children:(0,p.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[(0,p.jsx)(o.kkc,{style:{fontSize:"24px",opacity:.5}}),"No audit logs found matching your criteria"]})})}):le.map(((e,t)=>{var a;const r=(oe-1)*O+t;return(0,p.jsxs)(s.Fragment,{children:[(0,p.jsxs)("tr",{style:{background:r%2?"#fafbfc":"#fff",transition:"all 0.2s ease",borderBottom:q===(e._id||t)?"none":"1px solid #f3f4f6"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f9ff",e.currentTarget.style.transform="scale(1.01)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=r%2?"#fafbfc":"#fff",e.currentTarget.style.transform="scale(1)"},children:[(0,p.jsx)("td",{style:(0,n.A)((0,n.A)({},h),{},{padding:"16px 12px",fontWeight:"500",color:"#374151"}),children:new Date(e.timestamp).toLocaleString()}),(0,p.jsx)("td",{style:(0,n.A)((0,n.A)({},h),{},{padding:"16px 12px"}),children:(0,p.jsx)("span",{style:{background:ce(e.action),color:"white",borderRadius:"20px",padding:"6px 12px",fontSize:"12px",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.5px",display:"inline-block",minWidth:"80px",textAlign:"center"},children:e.action})}),(0,p.jsx)("td",{style:(0,n.A)((0,n.A)({},h),{},{padding:"16px 12px",fontWeight:"500",color:"#1f2937"}),children:(null===(a=e.performedBy)||void 0===a?void 0:a.name)||"Unknown"}),(0,p.jsx)("td",{style:(0,n.A)((0,n.A)({},h),{},{padding:"16px 12px",color:"#6b7280"}),children:e.performedByRole}),(0,p.jsx)("td",{style:(0,n.A)((0,n.A)({},h),{},{padding:"16px 12px",color:"#374151",maxWidth:"300px"}),children:(0,p.jsx)("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.description})}),(0,p.jsx)("td",{style:(0,n.A)((0,n.A)({},h),{},{padding:"16px 12px"}),children:(0,p.jsxs)("button",{onClick:()=>{return a=e._id||t,void L((e=>e===a?null:a));var a},style:{cursor:"pointer",color:"#3b82f6",fontWeight:500,fontSize:13,padding:"6px 12px",borderRadius:6,backgroundColor:q===(e._id||t)?"#dbeafe":"#eff6ff",border:"1px solid #dbeafe",transition:"all .2s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#dbeafe"},onMouseLeave:a=>{q!==(e._id||t)&&(a.currentTarget.style.backgroundColor="#eff6ff")},children:[q===(e._id||t)?"Hide":"View"," Details"]})})]}),q===(e._id||t)&&(0,p.jsx)("tr",{style:{background:"#f8fafc"},children:(0,p.jsx)("td",{colSpan:6,style:{padding:"20px 24px",borderTop:"1px solid #f1f5f9",borderBottom:"1px solid #f3f4f6"},children:(0,p.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[ae(e),(0,p.jsxs)("div",{style:{fontSize:11,color:"#64748b"},children:["Log ID: ",e._id," | Source: ",e.source||"N/A"]})]})})})]},e._id||t)}))})]}),re>0&&(0,p.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:12,alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderTop:"1px solid #e5e7eb",background:"#fff"},children:[(0,p.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:6,fontSize:13,color:"#475569"},children:[(0,p.jsxs)("span",{children:["Showing ",(oe-1)*O+1,"-",Math.min(oe*O,re)," of ",re," logs"]}),(0,p.jsxs)("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center"},children:[(0,p.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,p.jsx)("span",{style:{color:"#64748b"},children:"Per page:"}),(0,p.jsx)("select",{value:O,onChange:e=>{const t=parseInt(e.target.value,10);U(t),z(1)},style:{padding:"4px 8px",border:"1px solid #d1d5db",borderRadius:4,fontSize:12},children:[30,50,100].map((e=>(0,p.jsx)("option",{value:e,children:e},e)))})]}),(0,p.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=parseInt(W,10);isFinite(t)&&t>=1&&t<=ie&&z(t)},style:{display:"flex",alignItems:"center",gap:6},children:[(0,p.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:4},children:[(0,p.jsx)("span",{style:{color:"#64748b"},children:"Jump to:"}),(0,p.jsx)("input",{value:W,onChange:e=>B(e.target.value.replace(/[^0-9]/g,"")),placeholder:"#",style:{width:60,padding:"4px 6px",border:"1px solid #d1d5db",borderRadius:4,fontSize:12}})]}),(0,p.jsx)("button",{type:"submit",style:H(!1,!1),children:"Go"})]})]})]}),(0,p.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap",justifyContent:"flex-end"},children:[(0,p.jsx)("button",{onClick:()=>z((e=>Math.max(1,e-1))),disabled:1===oe,style:H(1===oe),children:"Prev"}),Array.from({length:ie}).map(((e,t)=>{const a=t+1;return 1===a||a===ie||Math.abs(a-oe)<=1?(0,p.jsx)("button",{onClick:()=>z(a),style:H(!1,a===oe),"aria-current":a===oe?"page":void 0,children:a},a):2===a&&oe>3?(0,p.jsx)("span",{style:J,children:"\u2026"},"start-ellipsis"):a===ie-1&&oe<ie-2?(0,p.jsx)("span",{style:J,children:"\u2026"},"end-ellipsis"):null})),(0,p.jsx)("button",{onClick:()=>z((e=>Math.min(ie,e+1))),disabled:oe===ie,style:H(oe===ie),children:"Next"})]})]})]})]})}),k&&(0,p.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>R(!1),children:(0,p.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},onClick:e=>e.stopPropagation(),children:[(0,p.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,p.jsx)("h3",{style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#1f2937"},children:"Export to PDF"}),(0,p.jsx)("button",{onClick:()=>R(!1),style:{background:"none",border:"none",fontSize:"20px",cursor:"pointer",color:"#9ca3af",padding:"4px"},children:"\xd7"})]}),(0,p.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,p.jsx)("p",{style:{margin:"0 0 16px 0",color:"#6b7280",fontSize:"14px"},children:"Export the filtered audit logs to PDF format with company branding."}),(0,p.jsxs)("div",{style:{padding:"16px",backgroundColor:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0"},children:[(0,p.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[(0,p.jsx)("span",{style:{fontSize:"14px",color:"#374151"},children:"Total Records:"}),(0,p.jsx)("span",{style:{fontSize:"14px",fontWeight:"600",color:"#1f2937"},children:se.length})]}),(0,p.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,p.jsx)("span",{style:{fontSize:"14px",color:"#374151"},children:"Format:"}),(0,p.jsx)("span",{style:{fontSize:"14px",fontWeight:"600",color:"#1f2937"},children:"PDF"})]})]})]}),(0,p.jsxs)("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[(0,p.jsx)("button",{onClick:()=>R(!1),style:{padding:"10px 16px",backgroundColor:"#f3f4f6",color:"#374151",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.target.style.backgroundColor="#e5e7eb"},onMouseLeave:e=>{e.target.style.backgroundColor="#f3f4f6"},children:"Cancel"}),(0,p.jsx)("button",{onClick:async()=>{_(!0);try{await de(se),R(!1)}catch(e){console.error("Export error:",e),alert("Failed to export PDF. Please try again.")}finally{_(!1)}},disabled:P||0===se.length,style:{padding:"10px 16px",backgroundColor:0===se.length?"#9ca3af":"#3b82f6",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:0===se.length?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:e=>{se.length>0&&(e.target.style.backgroundColor="#2563eb")},onMouseLeave:e=>{se.length>0&&(e.target.style.backgroundColor="#3b82f6")},children:P?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{style:{width:"16px",height:"16px",border:"2px solid #ffffff",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Exporting..."]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(o.WCW,{}),"Export ",se.length," Records to PDF"]})})]})]})})]})},j=document.createElement("style");j.textContent="\n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n",document.head.appendChild(j)},1254:()=>{},1301:(e,t,a)=>{a.d(t,{k:()=>c});var n=a(7762),s=a(4857);function r(e,t,a,n){return new Promise((s=>{try{const r="".concat("","/fonts/").concat(t);fetch(r).then((e=>e.arrayBuffer())).then((r=>{try{e.addFileToVFS(t,r),e.addFont(t,a,n),s(!0)}catch(i){s(!1)}})).catch((()=>s(!1)))}catch(r){s(!1)}}))}function i(e,t,a){try{const n=e.getFontList();return n&&n[t]&&n[t][a]}catch(n){return!1}}function o(e){if(!e)return"N/A";const t=new Date(e);return Number.isNaN(t.getTime())?"N/A":t.toLocaleString()}function l(e){return String(e).padStart(2,"0")}async function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{companyName:a="FadzTrack",logoPath:c="".concat("","/images/Fadz-logo.png"),exporterName:d="Unknown",exporterRole:p="",filters:u={},reportTitle:h="Manpower Requests Export"}=t,m=new n.Ay({unit:"pt",format:"a4"}),x="NotoSans",g=await r(m,"NotoSans-Regular.ttf",x,"normal"),j=await r(m,"NotoSans-Bold.ttf",x,"bold"),f=g&&i(m,x,"normal"),v=j&&i(m,x,"bold"),b=f?x:"helvetica",y=v?"bold":"normal",S=40;let w=40;const N=await(C=c,new Promise((e=>{if(!C)return e(null);try{const t=new Image;t.crossOrigin="anonymous",t.onload=()=>{const a=document.createElement("canvas");a.width=t.naturalWidth,a.height=t.naturalHeight,a.getContext("2d").drawImage(t,0,0),e({dataUrl:a.toDataURL("image/png"),w:t.naturalWidth,h:t.naturalHeight})},t.onerror=()=>e(null),t.src=C}catch(t){e(null)}})));var C;let A=S;if(null!==N&&void 0!==N&&N.dataUrl){const{w:e,h:t}=function(e,t,a,n){if(!e||!t)return{w:a,h:n};const s=Math.min(a/e,n/t,1);return{w:e*s,h:t*s}}(N.w,N.h,180,60);m.addImage(N.dataUrl,"PNG",S,w-12,e,t,void 0,"FAST"),A=S+e+16}m.setFont(b,y),m.setFontSize(20),m.setTextColor(20),m.text(String(a),A,w+16),m.setFont(b,"normal"),m.setFontSize(12),m.setTextColor(90),m.text(h,A,w+26),m.setDrawColor(220),m.setLineWidth(1),m.line(S,w+38,555,w+38),w+=54,m.setFont(b,y),m.setFontSize(12),m.setTextColor(20),m.text("Export Details",S,w),m.setFont(b,"normal"),m.setTextColor(60);const T=["Exported by: ".concat(d).concat(p?" (".concat(p,")"):""),"Date exported: ".concat(o(new Date))],I=function(e){const t=[];return e.status&&"all"!==e.status&&t.push("Status: ".concat(e.status)),e.search&&t.push('Search: "'.concat(e.search,'"')),e.dateFrom&&t.push("From: ".concat(e.dateFrom)),e.dateTo&&t.push("To: ".concat(e.dateTo)),t.length?t.join(", "):null}(u);I&&T.push("Filters: ".concat(I));let E=w+16;T.forEach((e=>{m.text(e,S,E),E+=16}));const D=E+6,k=e.map((e=>{var t,a;const n=Array.isArray(e.manpowerRequested)?e.manpowerRequested.map((e=>"".concat(e.name||"").concat(e.position?" (".concat(e.position,")"):""))).join(", "):"";return[e.createdAt?new Date(e.createdAt).toLocaleDateString():"",String((null===(t=e.createdBy)||void 0===t?void 0:t.name)||""),String((null===(a=e.project)||void 0===a?void 0:a.projectName)||""),n,(s=e,"Approved"===s.status?"Approved":"Pending"===s.status?"Pending":"Rejected"===s.status?"Rejected":"Completed"===s.status?"Completed":"In Progress"===s.status?"In Progress":"Unknown"),e.acquisitionDate?new Date(e.acquisitionDate).toLocaleDateString():""];var s}));(0,s.Ay)(m,{startY:D,head:[["Date","Requester","Project","Manpower Requested","Status","Acquisition Date"]],body:k,styles:{font:b,fontStyle:"normal",fontSize:10,cellPadding:5,halign:"left",overflow:"linebreak"},headStyles:{font:b,fontStyle:y,fillColor:[59,130,246],textColor:255},theme:"grid",margin:{left:S,right:S},columnStyles:{3:{cellWidth:180}},didDrawPage:()=>{const e="Generated: ".concat(o(new Date));m.setFont(b,"normal"),m.setFontSize(9),m.setTextColor(120),m.text(e,S,818);const t=m.getCurrentPageInfo().pageNumber||1,a=m.getNumberOfPages(),n="Page ".concat(t," of ").concat(a),s=m.getTextWidth(n);m.text(n,555-s,818)}}),m.save(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Manpower-Requests-Export";const t=new Date,a="_".concat(l(t.getHours())).concat(l(t.getMinutes()));return"".concat(e,"-").concat(a,".pdf")}())}},2544:()=>{},2660:()=>{},2739:()=>{},2867:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var n=a(9379),s=a(5043),r=a(3216),i=a(411),o=a(3204),l=a(8818),c=a(579);const d={width:"100%",padding:"10px 12px",border:"1px solid #d1d5db",borderRadius:6,fontSize:14},p=function(e){return{background:e,color:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#111827",padding:"4px 10px",borderRadius:20,fontSize:12,fontWeight:600,display:"inline-flex",alignItems:"center",gap:6}},u={display:"block",fontWeight:600,marginBottom:6,fontSize:13,letterSpacing:".25px",color:"#374151"},h={padding:"12px 14px",border:"1px solid #e5e7eb",borderRadius:8,background:"#fff",fontSize:14,minHeight:44,display:"flex",alignItems:"center"},m=e=>({background:e,color:"#fff",border:"none",padding:"10px 12px",borderRadius:8,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}),x={marginTop:8,display:"inline-flex",alignItems:"center",gap:8,background:"#1d4ed8",color:"#fff",border:"none",borderRadius:8,padding:"10px 16px",cursor:"pointer",fontWeight:600,fontSize:14},g=e=>{const t={display:"inline-flex",alignItems:"center",gap:8,padding:"10px 18px",fontSize:14,fontWeight:600,borderRadius:8,border:"none",cursor:"pointer"};switch(e){case"primary":return(0,n.A)((0,n.A)({},t),{},{background:"#2563eb",color:"#fff"});case"danger":return(0,n.A)((0,n.A)({},t),{},{background:"#dc2626",color:"#fff"});case"neutral":return(0,n.A)((0,n.A)({},t),{},{background:"#6b7280",color:"#fff"});default:return(0,n.A)((0,n.A)({},t),{},{background:"#e5e7eb",color:"#111827"})}},j=e=>{let{requestId:t}=e;const[a,r]=s.useState([]),[o,l]=s.useState(!1),d=localStorage.getItem("token");return(0,s.useEffect)((()=>{if(!o)return;(async()=>{try{const{data:e}=await i.Ay.get("/audit-logs",{headers:{Authorization:"Bearer ".concat(d)}}),a=e.filter((e=>{var a;return(null===(a=e.meta)||void 0===a?void 0:a.requestId)===t}));r(a)}catch(e){console.error("Audit fetch failed",e)}})()}),[o,t,d]),(0,c.jsxs)("div",{style:{marginTop:48},children:[(0,c.jsxs)("button",{onClick:()=>l((e=>!e)),style:(0,n.A)((0,n.A)({},g("neutral")),{},{background:"#f3f4f6",color:"#111827"}),children:[o?"Hide":"Show"," Audit Log"]}),o&&(0,c.jsxs)("div",{style:{marginTop:16,maxHeight:260,overflowY:"auto",border:"1px solid #e5e7eb",borderRadius:12,padding:16,background:"#fafafa"},children:[0===a.length&&(0,c.jsx)("div",{style:{fontSize:13,color:"#6b7280"},children:"No audit entries for this request."}),a.map((e=>{var t;return(0,c.jsxs)("div",{style:{padding:"10px 12px",borderBottom:"1px solid #e5e7eb",fontSize:13,lineHeight:1.4},children:[(0,c.jsx)("div",{style:{fontWeight:600},children:e.action}),(0,c.jsx)("div",{style:{color:"#374151"},children:e.description}),(0,c.jsxs)("div",{style:{color:"#6b7280",fontSize:12,marginTop:4},children:[new Date(e.timestamp).toLocaleString()," \u2022 ",null===(t=e.performedBy)||void 0===t?void 0:t.name," (",e.performedByRole,")"]})]},e._id||e.timestamp)}))]})]})},f=()=>{var e,t,a,f;const{id:v}=(0,r.g)(),b=(0,r.Zp)(),y=(0,r.zy)(),S=(JSON.parse(localStorage.getItem("user")||"null"),localStorage.getItem("token")),[w,N]=(0,s.useState)(!0),[C,A]=(0,s.useState)(!1),[T,I]=(0,s.useState)(!1),[E,D]=(0,s.useState)(""),[k,R]=(0,s.useState)(null),[P,_]=(0,s.useState)((()=>"1"===new URLSearchParams(y.search).get("edit"))),[q,L]=(0,s.useState)({acquisitionDate:"",duration:"",project:"",projectName:"",manpowers:[{type:"",quantity:""}],description:""});(0,s.useEffect)((()=>{(async()=>{try{var e,t,a;const{data:n}=await i.Ay.get("/manpower-requests/".concat(v),{headers:{Authorization:"Bearer ".concat(S)}});R(n),L({acquisitionDate:n.acquisitionDate?n.acquisitionDate.split("T")[0]:"",duration:n.duration||"",project:(null===(e=n.project)||void 0===e?void 0:e._id)||n.project||"",projectName:"object"===typeof n.project&&null!==(t=n.project)&&void 0!==t&&t.projectName?n.project.projectName:n.projectName||"",manpowers:null!==(a=n.manpowers)&&void 0!==a&&a.length?n.manpowers.map((e=>({type:e.type||"",quantity:e.quantity||""}))):[{type:"",quantity:""}],description:n.description||""})}catch(n){console.error(n),D("Failed to load request")}finally{N(!1)}})()}),[v,S]);const F=(e,t)=>L((a=>(0,n.A)((0,n.A)({},a),{},{[e]:t}))),M=(e,t,a)=>L((s=>(0,n.A)((0,n.A)({},s),{},{manpowers:s.manpowers.map(((s,r)=>r===e?(0,n.A)((0,n.A)({},s),{},{[t]:a}):s))}))),z={Pending:p("#fef3c7","#92400e"),Approved:p("#dcfce7","#065f46"),Overdue:p("#fee2e2","#991b1b"),Completed:p("#e0f2fe","#075985")};if(w)return(0,c.jsxs)("div",{className:"dashboard-container",children:[(0,c.jsx)("div",{className:"loading-spinner"}),"Loading..."]});if(E||!k)return(0,c.jsx)("div",{style:{color:"red",padding:24},children:E||"Request not found"});const O=!["Rejected"].includes(k.status);return(0,c.jsxs)("div",{className:"dashboard-container",children:[(0,c.jsx)(l.A,{roleSegment:"it",onLogout:()=>{i.Ay.post("/auth/logout",{},{headers:{Authorization:"Bearer ".concat(S)}}).finally((()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),b("/")}))}}),(0,c.jsx)("main",{className:"dashboard-main",children:(0,c.jsxs)("div",{className:"form-container",style:{maxWidth:900,margin:"40px auto",background:"#fff",borderRadius:16,padding:"32px 40px",boxShadow:"0 4px 16px rgba(0,0,0,0.06)"},children:[(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:24},children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{style:{margin:0,fontSize:30,fontWeight:700},children:"Manpower Request"}),(0,c.jsxs)("div",{style:{marginTop:8,fontSize:14,color:"#4b5563"},children:["Project: ",(0,c.jsx)("strong",{children:(null===(e=k.project)||void 0===e?void 0:e.projectName)||"N/A"})," \xa0\u2022\xa0 Requested by ",null===(t=k.createdBy)||void 0===t?void 0:t.name]}),(0,c.jsx)("div",{style:{marginTop:12},children:(0,c.jsx)("span",{style:z[k.status]||p("#e5e7eb"),children:k.status})})]}),(0,c.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[(0,c.jsx)("button",{onClick:()=>b(-1),style:g("secondary"),children:"Back"}),O&&!P&&(0,c.jsxs)("button",{onClick:()=>_(!0),style:g("primary"),children:[(0,c.jsx)(o.uO9,{})," Edit"]}),P&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("button",{disabled:C,onClick:async()=>{const e=q.acquisitionDate&&q.duration&&q.project&&q.description?q.manpowers.length?q.manpowers.some((e=>!e.type.trim()||!e.quantity||isNaN(Number(e.quantity))||Number(e.quantity)<=0))?"Fix manpower rows":"":"At least one manpower row":"All fields are required";if(e)alert(e);else{A(!0);try{const e={acquisitionDate:q.acquisitionDate,duration:Number(q.duration),project:q.project,description:q.description,manpowers:q.manpowers.map((e=>({type:e.type.trim(),quantity:Number(e.quantity)})))},a=await i.Ay.put("/manpower-requests/".concat(v),e,{headers:{Authorization:"Bearer ".concat(S)}});var t;if(200===a.status)alert("\u2705 Updated"),R(a.data.data||a.data),_(!1);else alert((null===(t=a.data)||void 0===t?void 0:t.message)||"Update failed")}catch(a){console.error(a),alert("Server error")}finally{A(!1)}}},style:g("primary"),children:[(0,c.jsx)(o.dIn,{}),C?" Saving...":" Save"]}),(0,c.jsxs)("button",{disabled:C,onClick:()=>{var e,t,a;_(!1),L({acquisitionDate:k.acquisitionDate?k.acquisitionDate.split("T")[0]:"",duration:k.duration||"",project:(null===(e=k.project)||void 0===e?void 0:e._id)||k.project||"",projectName:(null===(t=k.project)||void 0===t?void 0:t.projectName)||"",manpowers:null!==(a=k.manpowers)&&void 0!==a&&a.length?k.manpowers.map((e=>({type:e.type||"",quantity:e.quantity||""}))):[{type:"",quantity:""}],description:k.description||""})},style:g("neutral"),children:[(0,c.jsx)(o.QCr,{})," Cancel"]})]}),(0,c.jsx)("button",{disabled:T,onClick:async()=>{if(window.confirm("Delete this manpower request? This cannot be undone.")){I(!0);try{await i.Ay.delete("/manpower-requests/".concat(v),{headers:{Authorization:"Bearer ".concat(S)}}),alert("\ud83d\uddd1\ufe0f Deleted"),b("/it/manpower-list")}catch(e){alert("Delete failed")}finally{I(!1)}}},style:g("danger"),children:T?"Deleting...":"Delete"})]})]}),(0,c.jsxs)("div",{style:{marginTop:32,display:"grid",gap:32,gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))"},children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{style:u,children:"Target Acquisition Date"}),P&&O?(0,c.jsx)("input",{type:"date",value:q.acquisitionDate,onChange:e=>F("acquisitionDate",e.target.value),style:d}):(0,c.jsx)("div",{style:h,children:k.acquisitionDate?new Date(k.acquisitionDate).toLocaleDateString():"\u2014"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{style:u,children:"Duration (days)"}),P&&O?(0,c.jsx)("input",{type:"number",min:1,value:q.duration,onChange:e=>F("duration",e.target.value),style:d}):(0,c.jsxs)("div",{style:h,children:[k.duration," days"]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{style:u,children:"Project"}),(0,c.jsx)("div",{style:(0,n.A)((0,n.A)({},h),{},{background:"#f3f4f6"}),children:q.projectName||(null===(a=k.project)||void 0===a?void 0:a.projectName)||"\u2014"})]})]}),(0,c.jsxs)("div",{style:{marginTop:40},children:[(0,c.jsx)("label",{style:u,children:"Manpower Needed"}),P&&O?(0,c.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:16,background:"#f9fafb"},children:[q.manpowers.map(((e,t)=>(0,c.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center",marginBottom:8},children:[(0,c.jsx)("input",{placeholder:"Type",value:e.type,onChange:e=>M(t,"type",e.target.value),style:(0,n.A)((0,n.A)({},d),{},{flex:2})}),(0,c.jsx)("input",{type:"number",min:1,placeholder:"Qty",value:e.quantity,onChange:e=>M(t,"quantity",e.target.value),style:(0,n.A)((0,n.A)({},d),{},{width:120})}),q.manpowers.length>1&&(0,c.jsx)("button",{type:"button",onClick:()=>(e=>L((t=>(0,n.A)((0,n.A)({},t),{},{manpowers:t.manpowers.filter(((t,a)=>a!==e))}))))(t),style:m("#dc2626"),children:(0,c.jsx)(o.qbC,{})})]},t))),(0,c.jsxs)("button",{type:"button",onClick:()=>L((e=>(0,n.A)((0,n.A)({},e),{},{manpowers:[...e.manpowers,{type:"",quantity:""}]}))),style:x,children:[(0,c.jsx)(o.OiG,{})," Add Row"]})]}):(0,c.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:12},children:null!==(f=k.manpowers)&&void 0!==f&&f.length?k.manpowers.map(((e,t)=>(0,c.jsxs)("span",{style:p("#eef2ff","#3730a3"),children:[e.quantity," ",e.type]},t))):(0,c.jsx)("span",{style:{color:"#6b7280"},children:"No manpower entries"})})]}),(0,c.jsxs)("div",{style:{marginTop:40},children:[(0,c.jsx)("label",{style:u,children:"Description / Purpose"}),P&&O?(0,c.jsx)("textarea",{value:q.description,onChange:e=>F("description",e.target.value),style:(0,n.A)((0,n.A)({},d),{},{minHeight:140,resize:"vertical"})}):(0,c.jsx)("div",{style:(0,n.A)((0,n.A)({},h),{},{minHeight:80}),children:k.description})]}),!O&&(0,c.jsxs)("div",{style:{marginTop:32,padding:"12px 16px",background:"#fff7ed",border:"1px solid #fed7aa",borderRadius:12,fontSize:14,color:"#92400e"},children:["This request is ",(0,c.jsx)("strong",{children:k.status})," and cannot be edited by IT."]}),(0,c.jsx)(j,{requestId:k._id})]})})]})}},4418:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var n=a(1245),s=a(8818),r=a(579);const i=()=>(0,r.jsx)(n.A,{role:"it",useUnifiedHeader:!0,navPathOverrides:{dashboard:"/it",projects:"/it/projects",chat:"/it/chat",materials:"/it/material-list",manpower:"/it/manpower-list",audit:"/it/auditlogs"},customHeader:(0,r.jsx)(s.A,{roleSegment:"it"})})},4618:(e,t,a)=>{a.r(t),a.d(t,{default:()=>d});var n=a(9379),s=a(5043),r=a(3216),i=a(5475),o=a(411),l=(a(342),a(3204)),c=a(579);const d=()=>{var e;const{id:t}=(0,r.g)(),d=(0,r.Zp)(),[p,u]=(0,s.useState)(null),[h,m]=(0,s.useState)(!0),[x,g]=(0,s.useState)(!1),[j,f]=(0,s.useState)(""),[v,b]=(0,s.useState)(!1),[y,S]=(0,s.useState)(!1),w=(0,s.useRef)(null),[N,C]=(0,s.useState)((()=>{const e=localStorage.getItem("user");return e?JSON.parse(e):null})),[A,T]=(0,s.useState)({description:"",materials:[{id:1,materialName:"",quantity:"",unit:""}],attachments:[]}),[I,E]=(0,s.useState)([]),[D,k]=(0,s.useState)([]),[R,P]=(0,s.useState)([]);(0,s.useEffect)((()=>{o.Ay.get("/requests/".concat(t)).then((e=>{console.log("Material Request Data for Edit:",e.data);const t=e.data;u(t),T({description:t.description||"",materials:t.materials&&t.materials.length>0?t.materials.map(((e,t)=>({id:e.id||Date.now()+t,materialName:e.materialName||"",quantity:e.quantity||"",unit:e.unit||""}))):[{id:1,materialName:"",quantity:"",unit:""}],attachments:t.attachments||[]}),f("")})).catch((e=>{console.error("Error fetching request:",e),f("Failed to load request details.")})).finally((()=>m(!1)))}),[t]),(0,s.useEffect)((()=>{const e=e=>{w.current&&!w.current.contains(e.target)&&b(!1)},t=()=>{const e=window.pageYOffset||document.documentElement.scrollTop;S(e>50)};return document.addEventListener("click",e),window.addEventListener("scroll",t),()=>{document.removeEventListener("click",e),window.removeEventListener("scroll",t)}}),[]),(0,s.useEffect)((()=>()=>D.forEach((e=>URL.revokeObjectURL(e)))),[D.length]);const _=()=>d("/it/material-request/".concat(t)),q=()=>d("/it/material-request/".concat(t)),L=(e,t,a)=>{T((s=>(0,n.A)((0,n.A)({},s),{},{materials:s.materials.map((s=>{if(s.id===e){if("quantity"===t){let e=a.replace(/\D/g,"").slice(0,7);return(0,n.A)((0,n.A)({},s),{},{[t]:e})}return(0,n.A)((0,n.A)({},s),{},{[t]:a})}return s}))})))};return h?(0,c.jsx)("div",{className:"fadztrack-app-IT",children:(0,c.jsxs)("div",{className:"loading-container-IT",children:[(0,c.jsx)("div",{className:"loading-spinner-IT"}),(0,c.jsx)("p",{children:"Loading request details..."})]})}):p?(0,c.jsxs)("div",{className:"fadztrack-app-IT",children:[(0,c.jsx)("div",{className:"head-IT",children:(0,c.jsxs)("header",{className:"dashboard-header ".concat(y?"collapsed":""),children:[(0,c.jsxs)("div",{className:"header-top",children:[(0,c.jsxs)("div",{className:"logo-section",children:[(0,c.jsx)("img",{src:a(8370),alt:"FadzTrack Logo",className:"header-logo"}),(0,c.jsx)("h1",{className:"header-brand",children:"FadzTrack"})]}),(0,c.jsxs)("div",{className:"user-profile",onClick:()=>b(!v),children:[(0,c.jsx)("div",{className:"profile-avatar",children:null!==N&&void 0!==N&&N.name?N.name.charAt(0).toUpperCase():"I"}),(0,c.jsxs)("div",{className:"profile-info ".concat(y?"hidden":""),children:[(0,c.jsx)("span",{className:"profile-name",children:(null===N||void 0===N?void 0:N.name)||"User"}),(0,c.jsx)("span",{className:"profile-role",children:(null===N||void 0===N?void 0:N.role)||"IT Administrator"})]}),v&&(0,c.jsx)("div",{className:"profile-dropdown",children:(0,c.jsx)("button",{onClick:()=>{const e=localStorage.getItem("token");o.Ay.post("/auth/logout",{},{headers:{Authorization:"Bearer ".concat(e)}}).finally((()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),d("/")}))},className:"logout-btn",children:(0,c.jsx)("span",{children:"Logout"})})})]})]}),(0,c.jsx)("div",{className:"header-bottom",children:(0,c.jsxs)("nav",{className:"header-nav",children:[(0,c.jsxs)(i.N_,{to:"/it",className:"nav-item",children:[(0,c.jsx)(l.$BV,{}),(0,c.jsx)("span",{className:y?"hidden":"",children:"Dashboard"})]}),(0,c.jsxs)(i.N_,{to:"/it/chat",className:"nav-item",children:[(0,c.jsx)(l.uN,{}),(0,c.jsx)("span",{className:y?"hidden":"",children:"Chat"})]}),(0,c.jsxs)(i.N_,{to:"/it/material-list",className:"nav-item active",children:[(0,c.jsx)(l.H5e,{}),(0,c.jsx)("span",{className:y?"hidden":"",children:"Materials"})]}),(0,c.jsxs)(i.N_,{to:"/it/manpower-list",className:"nav-item",children:[(0,c.jsx)(l.YXz,{}),(0,c.jsx)("span",{className:y?"hidden":"",children:"Manpower"})]}),(0,c.jsxs)(i.N_,{to:"/it/auditlogs",className:"nav-item",children:[(0,c.jsx)(l.kkc,{}),(0,c.jsx)("span",{className:y?"hidden":"",children:"Audit Logs"})]})]})})]})}),(0,c.jsx)("div",{className:"main-content-IT no-sidebar-IT",children:(0,c.jsx)("main",{className:"dashboard-content-IT",children:(0,c.jsxs)("div",{className:"dashboard-card-IT",children:[(0,c.jsxs)("div",{className:"welcome-header-IT",children:[(0,c.jsxs)("div",{className:"header-left-IT",children:[(0,c.jsx)("h2",{children:"Edit Material Request"}),(0,c.jsxs)("p",{style:{fontSize:"14px",color:"#666",marginTop:"4px"},children:["Request ID: ",p._id]})]}),(0,c.jsx)("div",{className:"header-right-IT",children:(0,c.jsx)("div",{className:"action-buttons-header-IT",children:(0,c.jsxs)("button",{className:"back-btn-header-IT",onClick:q,children:[(0,c.jsx)(l.QVr,{style:{marginRight:8}}),"Cancel"]})})})]}),j&&(0,c.jsxs)("div",{className:"error-message-IT",children:[(0,c.jsx)("i",{className:"fas fa-exclamation-triangle"}),j]}),(0,c.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!A.description.trim())return void f("Description is required");const a=A.materials.filter((e=>e.materialName.trim()&&e.quantity.trim()&&e.unit.trim()));if(0!==a.length){g(!0),f("");try{const e=new FormData;e.append("description",A.description),e.append("materials",JSON.stringify(a)),e.append("attachments",JSON.stringify(A.attachments)),R.forEach((t=>{e.append("files",t)}));const n=await o.Ay.put("/requests/".concat(t),e,{headers:{"Content-Type":"multipart/form-data"}});console.log("Request updated successfully:",n.data),alert("Material request updated successfully!"),d("/it/material-request/".concat(t))}catch(r){var n,s;console.error("Error updating request:",r),f((null===(n=r.response)||void 0===n||null===(s=n.data)||void 0===s?void 0:s.message)||"Failed to update request")}finally{g(!1)}}else f("At least one material is required")},children:[(0,c.jsxs)("div",{className:"detail-grid-IT",children:[(0,c.jsx)("div",{className:"detail-column-IT",children:(0,c.jsxs)("div",{className:"detail-card-IT",children:[(0,c.jsx)("div",{className:"card-header-IT",children:(0,c.jsxs)("h3",{children:[(0,c.jsx)(l.__w,{})," Request Information"]})}),(0,c.jsxs)("div",{className:"card-content-IT",children:[(0,c.jsxs)("div",{className:"info-row-IT",children:[(0,c.jsx)("span",{className:"info-label-IT",children:"Description:"}),(0,c.jsx)("div",{className:"info-value-IT",style:{textAlign:"left",marginLeft:0},children:(0,c.jsx)("textarea",{name:"description",value:A.description,onChange:e=>{const{name:t,value:a}=e.target;T((e=>(0,n.A)((0,n.A)({},e),{},{[t]:a})))},className:"description-input-IT",placeholder:"Enter request description...",rows:"4",required:!0})})]}),(0,c.jsxs)("div",{className:"info-row-IT",children:[(0,c.jsx)("span",{className:"info-label-IT",children:"Project:"}),(0,c.jsx)("span",{className:"info-value-IT",children:(null===(e=p.project)||void 0===e?void 0:e.projectName)||"No project specified"})]}),(0,c.jsxs)("div",{className:"info-row-IT",children:[(0,c.jsx)("span",{className:"info-label-IT",children:"Status:"}),(0,c.jsx)("span",{className:"info-value-IT",children:(0,c.jsx)("span",{className:"priority-badge-IT priority-".concat((p.status||"pending").toLowerCase().replace(/\s+/g,"-")),children:p.status||"Pending"})})]})]})]})}),(0,c.jsx)("div",{className:"detail-column-IT",children:(0,c.jsxs)("div",{className:"detail-card-IT",children:[(0,c.jsx)("div",{className:"card-header-IT",children:(0,c.jsxs)("h3",{children:[(0,c.jsx)(l.H5e,{})," Requested Materials"]})}),(0,c.jsxs)("div",{className:"card-content-IT",children:[A.materials.map(((e,t)=>(0,c.jsx)("div",{className:"material-edit-item-IT",children:(0,c.jsxs)("div",{className:"material-edit-row-IT",children:[(0,c.jsxs)("div",{className:"material-edit-field-IT",children:[(0,c.jsx)("label",{children:"Material Name:"}),(0,c.jsx)("input",{type:"text",value:e.materialName,onChange:t=>L(e.id,"materialName",t.target.value),placeholder:"Enter material name",required:!0})]}),(0,c.jsxs)("div",{className:"material-edit-field-IT",children:[(0,c.jsx)("label",{children:"Quantity:"}),(0,c.jsx)("input",{type:"text",value:e.quantity,onChange:t=>L(e.id,"quantity",t.target.value),placeholder:"Enter quantity",required:!0})]}),(0,c.jsxs)("div",{className:"material-edit-field-IT",children:[(0,c.jsx)("label",{children:"Unit:"}),(0,c.jsxs)("select",{value:e.unit,onChange:t=>L(e.id,"unit",t.target.value),required:!0,children:[(0,c.jsx)("option",{value:"",children:"Select unit"}),(0,c.jsx)("option",{value:"pcs",children:"Pieces"}),(0,c.jsx)("option",{value:"kg",children:"Kilograms"}),(0,c.jsx)("option",{value:"m",children:"Meters"}),(0,c.jsx)("option",{value:"l",children:"Liters"}),(0,c.jsx)("option",{value:"box",children:"Boxes"}),(0,c.jsx)("option",{value:"roll",children:"Rolls"}),(0,c.jsx)("option",{value:"set",children:"Sets"}),(0,c.jsx)("option",{value:"pair",children:"Pairs"}),(0,c.jsx)("option",{value:"unit",children:"Units"}),(0,c.jsx)("option",{value:"bundle",children:"Bundles"})]})]}),(0,c.jsx)("button",{type:"button",onClick:()=>(e=>{A.materials.length>1&&T((t=>(0,n.A)((0,n.A)({},t),{},{materials:t.materials.filter((t=>t.id!==e))})))})(e.id),className:"remove-material-btn-IT",disabled:1===A.materials.length,children:(0,c.jsx)(l.qbC,{})})]})},e.id))),(0,c.jsxs)("button",{type:"button",onClick:()=>{const e=A.materials.length?Math.max(...A.materials.map((e=>e.id)))+1:1;T((t=>(0,n.A)((0,n.A)({},t),{},{materials:[...t.materials,{id:e,materialName:"",quantity:"",unit:""}]})))},className:"add-material-btn-IT",children:[(0,c.jsx)(l.OiG,{style:{marginRight:8}}),"Add Material"]})]})]})})]}),(0,c.jsxs)("div",{className:"detail-card-IT full-width-IT",children:[(0,c.jsx)("div",{className:"card-header-IT",children:(0,c.jsxs)("h3",{children:[(0,c.jsx)(l.EHs,{})," Attachments"]})}),(0,c.jsxs)("div",{className:"card-content-IT",children:[A.attachments.length>0&&(0,c.jsxs)("div",{className:"existing-attachments-IT",children:[(0,c.jsx)("h4",{children:"Current Attachments:"}),(0,c.jsx)("div",{className:"attachments-list-IT",children:A.attachments.map(((e,t)=>(0,c.jsxs)("div",{className:"attachment-item-IT",children:[(0,c.jsx)("div",{className:"attachment-icon-IT",children:(0,c.jsx)(l.WCW,{})}),(0,c.jsxs)("div",{className:"attachment-info-IT",children:[(0,c.jsx)("span",{className:"attachment-name-IT",children:e}),(0,c.jsx)("button",{type:"button",onClick:()=>(e=>{T((t=>(0,n.A)((0,n.A)({},t),{},{attachments:t.attachments.filter(((t,a)=>a!==e))})))})(t),className:"remove-attachment-btn-IT",children:(0,c.jsx)(l.qbC,{})})]})]},t)))})]}),(0,c.jsxs)("div",{className:"file-upload-section-IT",children:[(0,c.jsx)("h4",{children:"Add New Files:"}),(0,c.jsx)("input",{type:"file",multiple:!0,onChange:e=>{const t=Array.from(e.target.files);P((e=>[...e,...t]));const a=t.map((e=>URL.createObjectURL(e)));k((e=>[...e,...a]))},className:"file-input-IT",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.txt"}),R.length>0&&(0,c.jsxs)("div",{className:"new-files-preview-IT",children:[(0,c.jsx)("h5",{children:"New Files to Upload:"}),(0,c.jsx)("div",{className:"attachments-list-IT",children:R.map(((e,t)=>(0,c.jsxs)("div",{className:"attachment-item-IT",children:[(0,c.jsx)("div",{className:"attachment-icon-IT",children:(0,c.jsx)(l.EHs,{})}),(0,c.jsxs)("div",{className:"attachment-info-IT",children:[(0,c.jsx)("span",{className:"attachment-name-IT",children:e.name}),(0,c.jsx)("button",{type:"button",onClick:()=>(e=>{P((t=>t.filter(((t,a)=>a!==e)))),k((t=>(URL.revokeObjectURL(t[e]),t.filter(((t,a)=>a!==e)))))})(t),className:"remove-attachment-btn-IT",children:(0,c.jsx)(l.qbC,{})})]})]},t)))})]})]})]})]}),(0,c.jsxs)("div",{className:"submit-actions-IT",children:[(0,c.jsxs)("button",{type:"submit",className:"save-btn-IT",disabled:x,children:[(0,c.jsx)(l.dIn,{style:{marginRight:8}}),x?"Saving...":"Save Changes"]}),(0,c.jsx)("button",{type:"button",onClick:q,className:"cancel-btn-IT",children:"Cancel"})]})]})]})})})]}):(0,c.jsx)("div",{className:"fadztrack-app-IT",children:(0,c.jsxs)("div",{className:"error-container-IT",children:[(0,c.jsx)("p",{children:j||"Request not found."}),(0,c.jsx)("button",{onClick:_,className:"back-button-IT",children:"Go Back"})]})})}},4843:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});var n=a(5043),s=a(3216),r=a(5475),i=(a(2660),a(64),a(411)),o=a(3204),l=a(8818),c=a(1301),d=a(579);const p=()=>{const e=(0,s.Zp)(),t=(0,n.useRef)(null);if(null===t.current){const e=localStorage.getItem("user");t.current=e?JSON.parse(e):null}const a=t.current,[p,u]=(0,n.useState)([]),[h,m]=(0,n.useState)(!0),[x,g]=(0,n.useState)(""),[j,f]=(0,n.useState)("All"),[v,b]=(0,n.useState)(""),[y,S]=(0,n.useState)(1),[w,N]=(0,n.useState)("cards"),[C,A]=(0,n.useState)(!1);(0,n.useEffect)((()=>{if(!a||"IT"!==a.role)return;let e=!0;return(async()=>{m(!0),g("");try{const{data:t}=await i.Ay.get("/manpower-requests");if(!e)return;u(Array.isArray(t)?t:[])}catch(t){if(!e)return;console.error("Failed to load manpower requests:",t),!t.response||401!==t.response.status&&403!==t.response.status?g("Failed to load manpower requests"):g("Session expired or unauthorized. Please login.")}finally{e&&(m(!1),S(1))}})(),()=>{e=!1}}),[a]);const T=(0,n.useMemo)((()=>{let e=p;if(e="All"!==j?"Archived"===j?e.filter((e=>(e.status||"Pending").toLowerCase().includes("archived"))):e.filter((e=>(e.status||"Pending").toLowerCase().includes(j.toLowerCase()))):e.filter((e=>!(e.status||"Pending").toLowerCase().includes("archived"))),v){const t=v.toLowerCase();e=e.filter((e=>{var a,n;const s=(null===(a=e.project)||void 0===a?void 0:a.projectName)||"",r=(null===(n=e.createdBy)||void 0===n?void 0:n.name)||"",i=(e.manpowers||[]).map((e=>"".concat(e.quantity," ").concat(e.type))).join(", ");return s.toLowerCase().includes(t)||r.toLowerCase().includes(t)||i.toLowerCase().includes(t)||(e.description||"").toLowerCase().includes(t)}))}return e}),[p,j,v]),I=Math.max(1,Math.ceil(T.length/8)),E=(0,n.useMemo)((()=>{const e=8*(y-1);return T.slice(e,e+8)}),[T,y]),D=(0,n.useMemo)((()=>{let e=0,t=0,a=0,n=0,s=0,r=0;return p.forEach((i=>{const o=(i.status||"Pending").toLowerCase(),l="pending"===o&&i.acquisitionDate&&new Date(i.acquisitionDate)<new Date;o.includes("archived")?r++:o.includes("completed")?a++:o.includes("approved")?t++:o.includes("reject")||o.includes("denied")||o.includes("cancel")?n++:l||o.includes("overdue")?s++:e++})),{total:p.length,pending:e,approved:t,rejected:n,overdue:s,completed:a,archived:r}}),[p]),k=(0,n.useMemo)((()=>({All:D.total-D.archived,Pending:D.pending,Overdue:D.overdue,Approved:D.approved,Completed:D.completed,Rejected:D.rejected,Archived:D.archived})),[D]);return a&&"IT"===a.role?(0,d.jsxs)("div",{className:"dashboard-container ceo-manpower-requests-page",children:[(0,d.jsx)(l.A,{roleSegment:"it"}),(0,d.jsx)("main",{className:"dashboard-main",children:(0,d.jsxs)("div",{className:"page-container",children:[(0,d.jsxs)("div",{className:"dashboard-card ceo-mr-header-card",children:[(0,d.jsxs)("div",{className:"card-header mr-header-row",children:[(0,d.jsxs)("div",{className:"mr-header-texts",children:[(0,d.jsx)("h1",{className:"card-title",children:"Manpower Requests"}),(0,d.jsx)("p",{className:"card-subtitle",children:"Monitor and manage manpower requests across all projects"})]}),(0,d.jsx)("div",{className:"layout-toggle-wrapper",children:(0,d.jsx)("button",{onClick:()=>N((e=>"cards"===e?"table":"cards")),className:"btn-secondary toggle-layout-btn",children:"cards"===w?"Table View":"Card View"})})]}),(0,d.jsxs)("div",{className:"card-body mr-filters-row",children:[(0,d.jsx)("div",{className:"filter-tabs compact",children:["All","Pending","Overdue","Approved","Completed","Rejected","Archived"].map((e=>{var t;return(0,d.jsxs)("button",{className:"filter-tab ".concat(j===e?"active":""),onClick:()=>{f(e),S(1)},children:[(0,d.jsx)("span",{children:e}),(0,d.jsx)("span",{className:"count",children:null!==(t=k[e])&&void 0!==t?t:0})]},e)}))}),(0,d.jsxs)("div",{className:"search-wrapper stretch",children:[(0,d.jsx)(o.KSO,{className:"search-icon"}),(0,d.jsx)("input",{type:"text",placeholder:"Search requests...",value:v,onChange:e=>{b(e.target.value),S(1)},className:"search-input"})]}),(0,d.jsxs)("button",{onClick:async()=>{try{A(!0),await(0,c.k)(T,{companyName:"FadzTrack",logoPath:"".concat("","/images/Fadz-logo.png"),exporterName:(null===a||void 0===a?void 0:a.name)||"Unknown",exporterRole:(null===a||void 0===a?void 0:a.role)||"",filters:{status:j,searchTerm:v},reportTitle:"Manpower Requests Export (IT View)"})}catch(x){console.error("Export failed:",x),alert("Failed to export PDF")}finally{A(!1)}},disabled:C||0===T.length,className:"btn-primary export-btn",style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",minWidth:"auto"},children:[(0,d.jsx)(o.WCW,{}),C?"Exporting...":"Export PDF"]})]})]}),(0,d.jsxs)("div",{className:"dashboard-card ceo-mr-summary-card",children:[(0,d.jsx)("div",{className:"card-header",children:(0,d.jsx)("h3",{className:"card-title-sm",children:"Summary"})}),(0,d.jsx)("div",{className:"mr-summary-grid",children:[{label:"Total",value:D.total,color:"#334155"},{label:"Pending",value:D.pending,color:"#f59e0b"},{label:"Overdue",value:D.overdue,color:"#d97706"},{label:"Approved",value:D.approved,color:"#10b981"},{label:"Completed",value:D.completed,color:"#059669"},{label:"Rejected",value:D.rejected,color:"#ef4444"},{label:"Archived",value:D.archived,color:"#8b5cf6"}].map((e=>(0,d.jsxs)("div",{className:"mr-summary-item",children:[(0,d.jsx)("span",{className:"mr-summary-label",children:e.label}),(0,d.jsx)("span",{className:"mr-summary-value",style:{color:e.color},children:e.value}),(0,d.jsx)("div",{className:"mr-summary-bar",style:{background:e.color}})]},e.label)))})]}),(0,d.jsxs)("div",{className:"dashboard-card ceo-mr-list-card",children:[(0,d.jsx)("div",{className:"card-header list-header",children:(0,d.jsxs)("h3",{className:"card-title-sm",children:["Requests ",(0,d.jsxs)("span",{className:"muted",children:["(",T.length,")"]})]})}),(0,d.jsx)("div",{className:"requests-grid ceo-mr-grid ".concat("table"===w?"table-view":""),children:h?(0,d.jsxs)("div",{className:"loading-state",children:[(0,d.jsx)("div",{className:"loading-spinner"}),(0,d.jsx)("p",{children:"Loading manpower requests..."})]}):x?(0,d.jsx)("div",{className:"error-state",children:(0,d.jsx)("p",{children:x})}):0===E.length?(0,d.jsxs)("div",{className:"empty-state",children:[(0,d.jsx)("div",{className:"empty-icon",children:"\ud83d\udc65"}),(0,d.jsx)("h3",{children:"No manpower requests found"}),(0,d.jsx)("p",{children:"No requests match your current filters. Try adjusting your search criteria."})]}):(0,d.jsxs)(d.Fragment,{children:["table"===w&&(0,d.jsxs)("div",{className:"mr-table-header",role:"row","aria-label":"Table Header",children:[(0,d.jsx)("div",{children:"Project"}),(0,d.jsx)("div",{children:"Requester"}),(0,d.jsx)("div",{children:"Description"}),(0,d.jsx)("div",{children:"Manpower"}),(0,d.jsx)("div",{children:"Target"}),(0,d.jsx)("div",{children:"Dur"}),(0,d.jsx)("div",{children:"Created"}),(0,d.jsx)("div",{children:"Status"})]}),E.map((t=>{var a,n,s,i;const o=(t.manpowers||[]).map((e=>"".concat(e.quantity," ").concat(e.type))).join(", "),l=(e=>{const t=(e.status||"Pending").toLowerCase();return"pending"===t&&e.acquisitionDate&&new Date(e.acquisitionDate)<new Date?"Overdue":t.includes("archived")?"Archived":t.includes("completed")?"Completed":t.includes("approved")?"Approved":t.includes("pending")?"Pending":t.includes("reject")||t.includes("denied")||t.includes("cancel")?"Rejected":t.includes("overdue")?"Overdue":"Unknown"})(t);(e=>{const t=(e.status||"Pending").toLowerCase();"pending"===t&&e.acquisitionDate&&new Date(e.acquisitionDate)<new Date||(t.includes("archived")||(t.includes("completed")||(t.includes("approved")||(t.includes("pending")||(t.includes("reject")||t.includes("denied")||t.includes("cancel")||t.includes("overdue"))))))})(t);var c,p,u,h;return"table"===w?(0,d.jsxs)("div",{className:"mr-table-row",role:"row",onClick:()=>e("/it/manpower-list/".concat(t._id)),style:{cursor:"pointer"},title:"View details",children:[(0,d.jsx)("div",{className:"rt-title",title:(null===(c=t.project)||void 0===c?void 0:c.projectName)||"(No Project Name)",children:(null===(p=t.project)||void 0===p?void 0:p.projectName)||"(No Project Name)"}),(0,d.jsx)("div",{className:"rt-req",title:(null===(u=t.createdBy)||void 0===u?void 0:u.name)||"Unknown",children:(null===(h=t.createdBy)||void 0===h?void 0:h.name)||"Unknown"}),(0,d.jsx)("div",{className:"rt-desc",title:t.description||"No description",children:t.description||"No description"}),(0,d.jsx)("div",{className:"rt-man",title:o||"\u2014",children:o||"\u2014"}),(0,d.jsx)("div",{className:"rt-date",title:"Target Date",children:t.acquisitionDate?new Date(t.acquisitionDate).toLocaleDateString():"\u2014"}),(0,d.jsxs)("div",{className:"rt-date",title:"Duration",children:[t.duration||"\u2014","d"]}),(0,d.jsx)("div",{className:"rt-date",title:"Created",children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"\u2014"}),(0,d.jsx)("div",{className:"rt-btn",children:(0,d.jsx)("span",{className:"status-chip ".concat(l.toLowerCase()),children:l})})]},t._id):(0,d.jsxs)("div",{className:"request-card ceo-mr-card",children:[(0,d.jsxs)("div",{className:"card-body",children:[(0,d.jsxs)("div",{className:"mr-card-top-row",children:[(0,d.jsx)("h3",{className:"request-title",title:(null===(a=t.project)||void 0===a?void 0:a.projectName)||"(No Project Name)",children:(null===(n=t.project)||void 0===n?void 0:n.projectName)||"(No Project Name)"}),(0,d.jsx)("span",{className:"status-chip ".concat(l.toLowerCase()),children:l})]}),(0,d.jsx)("p",{className:"request-description",title:t.description||"No description provided",children:t.description||"No description provided"}),(0,d.jsxs)("div",{className:"request-meta",children:[(0,d.jsxs)("div",{className:"meta-item",children:[(0,d.jsx)("span",{className:"meta-label",children:"Requested by:"}),(0,d.jsx)("span",{className:"meta-value",title:(null===(s=t.createdBy)||void 0===s?void 0:s.name)||"Unknown",children:(null===(i=t.createdBy)||void 0===i?void 0:i.name)||"Unknown"})]}),(0,d.jsxs)("div",{className:"meta-item",children:[(0,d.jsx)("span",{className:"meta-label",children:"Manpower:"}),(0,d.jsx)("span",{className:"meta-value",title:o||"\u2014",children:o||"\u2014"})]}),(0,d.jsxs)("div",{className:"meta-item",children:[(0,d.jsx)("span",{className:"meta-label",children:"Date:"}),(0,d.jsx)("span",{className:"meta-value",children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"\u2014"})]}),(0,d.jsxs)("div",{className:"meta-item",children:[(0,d.jsx)("span",{className:"meta-label",children:"Target:"}),(0,d.jsx)("span",{className:"meta-value",children:t.acquisitionDate?new Date(t.acquisitionDate).toLocaleDateString():"\u2014"})]}),(0,d.jsxs)("div",{className:"meta-item",children:[(0,d.jsx)("span",{className:"meta-label",children:"Duration:"}),(0,d.jsxs)("span",{className:"meta-value",children:[t.duration||"\u2014"," d"]})]})]})]}),(0,d.jsx)("div",{className:"card-footer",children:(0,d.jsx)(r.N_,{to:"/it/manpower-list/".concat(t._id),className:"view-details-btn",children:"View Details"})})]},t._id)}))]})}),T.length>0&&(0,d.jsxs)("div",{className:"pagination-section inside-card",children:[(0,d.jsxs)("div",{className:"pagination-info",children:["Showing ",8*(y-1)+1," to ",Math.min(8*y,T.length)," of ",T.length," entries"]}),(0,d.jsxs)("div",{className:"pagination-controls",children:[(0,d.jsx)("button",{onClick:()=>S((e=>Math.max(e-1,1))),disabled:1===y,className:"pagination-btn",children:"Previous"}),Array.from({length:I},((e,t)=>t+1)).map((e=>(0,d.jsx)("button",{className:"pagination-btn ".concat(e===y?"active":""),onClick:()=>S(e),children:e},e))),(0,d.jsx)("button",{onClick:()=>S((e=>Math.min(e+1,I))),disabled:y===I,className:"pagination-btn",children:"Next"})]})]})]})]})})]}):(0,d.jsxs)("div",{style:{padding:24},children:[(0,d.jsx)("h2",{children:"Forbidden"}),(0,d.jsx)("p",{children:"You must be an IT user to view this page."})]})}},6594:(e,t,a)=>{a.r(t),a.d(t,{default:()=>r});a(5043);var n=a(8153),s=a(579);function r(){return(0,s.jsx)(n.default,{baseSegment:"it"})}},7192:(e,t,a)=>{a.r(t),a.d(t,{default:()=>m});var n=a(9379),s=a(5043),r=a(3216),i=a(411),o=a(5766),l=a.n(o),c=(a(2544),a(1254),a(2739),a(4801),a(6837)),d=a(8818),p=a(3204),u=a(579);const h={projectName:"",contractor:"",budget:"",location:"",startDate:"",endDate:"",status:"Ongoing",projectmanager:"",areamanager:"",area:"",pic:[],staff:[],hrsite:[],manpower:[]};function m(){const[e,t]=(0,s.useState)(h),[a,o]=(0,s.useState)("");(0,s.useEffect)((()=>{if(""===e.budget)return void o("");const t=String(e.budget).split("."),n=(t[0]||"0").replace(/\B(?=(\d{3})+(?!\d))/g,",")+(t[1]?"."+t[1]:"");n!==a&&o(n)}),[e.budget]);const m=(0,r.Zp)(),g=(0,s.useMemo)((()=>JSON.parse(localStorage.getItem("user")||"{}")),[]),[j,f]=(0,s.useState)(!1),[v,b]=(0,s.useState)(!1),[y,S]=(0,s.useState)((null===g||void 0===g?void 0:g.name)||""),[w,N]=(0,s.useState)((null===g||void 0===g?void 0:g.role)||""),[C,A]=(0,s.useState)([]),[T,I]=(0,s.useState)(!0),[E,D]=(0,s.useState)(""),[k,R]=(0,s.useState)(!1),[P,_]=(0,s.useState)(null),[q,L]=(0,s.useState)(!1),[F,M]=(0,s.useState)([]),[z,O]=(0,s.useState)({}),[U,W]=(0,s.useState)({}),[B,H]=(0,s.useState)(!1),[J,V]=(0,s.useState)([]),[Q,Y]=(0,s.useState)(!1),[G,Z]=(0,s.useState)(null),[K,X]=(0,s.useState)([]),[$,ee]=(0,s.useState)([]),[te,ae]=(0,s.useState)([]),[ne,se]=(0,s.useState)([]),[re,ie]=(0,s.useState)([]),[oe,le]=(0,s.useState)([]),[ce,de]=(0,s.useState)([]),[pe,ue]=(0,s.useState)({}),[he,me]=(0,s.useState)(!1),[xe,ge]=(0,s.useState)(""),[je,fe]=(0,s.useState)(null),[ve,be]=(0,s.useState)([]),[ye,Se]=(0,s.useState)(""),[we,Ne]=(0,s.useState)([]),[Ce,Ae]=(0,s.useState)(""),[Te,Ie]=(0,s.useState)([]),[Ee,De]=(0,s.useState)(""),[ke,Re]=(0,s.useState)([]),[Pe,_e]=(0,s.useState)(""),[qe,Le]=(0,s.useState)(""),[Fe,Me]=(0,s.useState)(!1),[ze,Oe]=(0,s.useState)(!1),[Ue,We]=(0,s.useState)({status:"all",search:"",dateFrom:"",dateTo:""}),Be=(0,s.useMemo)((()=>C.filter((e=>{if("all"!==Ue.status){const t=(e.status||"").toLowerCase();if("completed"===Ue.status&&"completed"!==t)return!1;if("ongoing"===Ue.status&&!["ongoing","on going"].includes(t))return!1;if("pending"===Ue.status&&!["pending","not started"].includes(t))return!1}if(Ue.search){var t,a;const n=Ue.search.toLowerCase();if(![e.projectName,null===(t=e.location)||void 0===t?void 0:t.name,null===(a=e.projectmanager)||void 0===a?void 0:a.name,e.contractor].some((e=>(e||"").toLowerCase().includes(n))))return!1}if(Ue.dateFrom){const t=e.startDate?new Date(e.startDate):null;if(t&&t<new Date(Ue.dateFrom))return!1}if(Ue.dateTo){const t=e.startDate?new Date(e.startDate):null;if(t&&t>new Date(Ue.dateTo))return!1}return!0}))),[C,Ue]),[He,Je]=(0,s.useState)("all"),[Ve,Qe]=(0,s.useState)("grid"),[Ye,Ge]=(0,s.useState)(""),Ze=(0,s.useDeferredValue)(Ye),[Ke,Xe]=(0,s.useState)("name"),[$e,et]=(0,s.useState)("asc"),[tt,at]=(0,s.useState)(1),[nt,st]=(0,s.useState)(12),rt=(0,s.useMemo)((()=>{const e={pm:new Set,am:new Set,pic:new Set,staff:new Set,hr:new Set};return C.forEach((t=>{t.projectmanager&&e.pm.add(String(t.projectmanager._id||t.projectmanager)),t.areamanager&&e.am.add(String(t.areamanager._id||t.areamanager)),(t.pic||[]).forEach((t=>e.pic.add(String(t._id||t)))),(t.staff||[]).forEach((t=>e.staff.add(String(t._id||t)))),(t.hrsite||[]).forEach((t=>e.hr.add(String(t._id||t))))})),e}),[C]),it=(0,s.useMemo)((()=>{const t={};return Object.entries(z).forEach((a=>{let[n,s]=a,r=null;if("Project Manager"===n?r=rt.pm:"Area Manager"===n?r=rt.am:"Person in Charge"===n?r=rt.pic:"Staff"===n?r=rt.staff:"HR - Site"===n&&(r=rt.hr),!r)return void(t[n]=s);const i=new Set;P&&("Project Manager"===n&&e.projectmanager&&i.add(e.projectmanager),"Area Manager"===n&&e.areamanager&&i.add(e.areamanager),"Person in Charge"===n&&e.pic.forEach((e=>i.add(e))),"Staff"===n&&e.staff.forEach((e=>i.add(e))),"HR - Site"===n&&e.hrsite.forEach((e=>i.add(e)))),t[n]=(s||[]).filter((e=>!r.has(String(e._id))||i.has(String(e._id))))})),t}),[z,rt,P,e.projectmanager,e.areamanager,e.pic,e.staff,e.hrsite]);(0,s.useEffect)((()=>{if("IT"!==(null===g||void 0===g?void 0:g.role))return D("Forbidden"),void I(!1);ot(),async function(){try{const[e,t,a]=await Promise.all([i.Ay.get("/locations"),i.Ay.get("/users"),i.Ay.get("/areas")]);M(e.data||[]);const n={},s={},r=e=>e&&"pic"===e.toLowerCase()?"Person in Charge":e;(t.data||[]).forEach((e=>{const t=e._id||e.id;if(!t)return;const a=r(e.role||"");n[a]||(n[a]=[]);const i={_id:String(t),name:e.name,role:a};n[a].push(i),s[String(t)]=e.name})),O(n),W(s);const o={};(a.data||[]).forEach((e=>{if(e&&e._id&&e.areaManager){const t=e.areaManager._id||e.areaManager,a=String(t);o[a]||(o[a]=[]),o[a].push(e)}})),ue(o)}catch(e){console.error(e)}}(),async function(){try{const{data:e}=await i.Ay.get("/manpower/unassigned");X(Array.isArray(e)?e:[])}catch(e){console.error("Failed to load manpower",e)}}()}),[]),(0,s.useEffect)((()=>{const e=()=>b((window.pageYOffset||document.documentElement.scrollTop)>50);return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[]),(0,s.useEffect)((()=>{const e=e=>{e.target.closest(".user-profile")||f(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[]),(0,s.useEffect)((()=>{S((null===g||void 0===g?void 0:g.name)||""),N((null===g||void 0===g?void 0:g.role)||"")}),[g]);async function ot(){I(!0),D("");try{const{data:e}=await i.Ay.get("/projects");A(Array.isArray(e)?e:[])}catch(e){D("Failed to load projects")}finally{I(!1)}}(0,s.useEffect)((()=>{const e=re.map((e=>({name:e.name,url:URL.createObjectURL(e),file:e})));return le(e),()=>{e.forEach((e=>URL.revokeObjectURL(e.url)))}}),[re]),(0,s.useEffect)((()=>{const e=te.map((e=>({name:e.name,ext:(e.name.split(".").pop()||"").toUpperCase(),file:e})));de(e)}),[te]);function lt(e){const{name:a,value:s,multiple:r,options:i}=e.target;if(r){const e=Array.from(i).filter((e=>e.selected)).map((e=>e.value));t((t=>(0,n.A)((0,n.A)({},t),{},{[a]:e})))}else t((e=>(0,n.A)((0,n.A)({},e),{},{[a]:s})))}function ct(){fe(null)}const dt=(0,s.useMemo)((()=>{const e=Ze.trim().toLowerCase();return C.filter((e=>{const t=(e.status||"").toLowerCase();return"completed"===He?"completed"===t:"ongoing"===He?["ongoing","on going"].includes(t):"pending"!==He||["pending","not started"].includes(t)})).filter((t=>{var a,n;return!e||[t.projectName,null===(a=t.location)||void 0===a?void 0:a.name,null===(n=t.projectmanager)||void 0===n?void 0:n.name,t.contractor].some((t=>(t||"").toLowerCase().includes(e)))})).sort(((e,t)=>{const a=e=>{var t,a;switch(Ke){case"location":return(null===(t=e.location)||void 0===t?void 0:t.name)||"";case"manager":return(null===(a=e.projectmanager)||void 0===a?void 0:a.name)||"";case"status":return e.status||"";case"startDate":return e.startDate?new Date(e.startDate).getTime():0;default:return e.projectName||""}},n=a(e),s=a(t);return n===s?0:(n>s?1:-1)*("asc"===$e?1:-1)}))}),[C,He,Ze,Ke,$e]);(0,s.useEffect)((()=>{at(1)}),[He,Ze,Ke,$e]);const pt=dt.length,ut=Math.max(1,Math.ceil(pt/nt)),ht=Math.min(tt,ut),mt=(0,s.useMemo)((()=>dt.slice((ht-1)*nt,ht*nt)),[dt,ht,nt]),xt=(0,s.useMemo)((()=>({total:C.length,ongoing:C.filter((e=>["ongoing","on going"].includes((e.status||"").toLowerCase()))).length,completed:C.filter((e=>"completed"===(e.status||"").toLowerCase())).length,pending:C.filter((e=>["pending","not started"].includes((e.status||"").toLowerCase()))).length})),[C]),gt=e=>{let{n:t=8}=e;return(0,u.jsx)("div",{className:"projects-display ".concat(Ve),children:Array.from({length:t}).map(((e,t)=>(0,u.jsxs)("div",{className:"project-card skeleton",children:[(0,u.jsx)("div",{className:"project-image-wrapper shimmer"}),(0,u.jsxs)("div",{className:"project-content",children:[(0,u.jsx)("div",{className:"skeleton-line w60"}),(0,u.jsx)("div",{className:"skeleton-line w40"}),(0,u.jsx)("div",{className:"skeleton-line w80"}),(0,u.jsx)("div",{className:"skeleton-line w50"})]})]},t)))})};return T?(0,u.jsxs)("div",{className:"loading-container",children:[(0,u.jsx)("div",{className:"loading-spinner"}),(0,u.jsx)("p",{children:"Loading projects..."})]}):(0,u.jsxs)("div",{className:"dashboard-container no-inner-scroll it-projects-page",children:[(0,u.jsx)(d.A,{roleSegment:"it"}),(0,u.jsxs)("main",{className:"dashboard-main auto-height",children:[he&&(0,u.jsx)("div",{className:"success-message",style:{position:"fixed",top:"20px",right:"20px",background:"linear-gradient(135deg, #10B981, #059669)",color:"white",padding:"15px 20px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)",zIndex:1e3,maxWidth:"400px",fontSize:"14px",lineHeight:"1.4"},children:(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,u.jsx)(p.A7C,{style:{fontSize:"18px"}}),(0,u.jsx)("span",{children:xe})]})}),(0,u.jsxs)("div",{className:"projects-container projects-light",children:[(0,u.jsxs)("div",{className:"page-header enhanced",children:[(0,u.jsxs)("div",{className:"page-title-section",children:[(0,u.jsx)("h1",{className:"page-title",children:"Projects"}),(0,u.jsx)("p",{className:"page-subtitle",children:"System-wide project management"})]}),(0,u.jsxs)("div",{className:"page-actions",children:[(0,u.jsxs)("button",{className:"add-project-btn",onClick:function(){_(null),t(h),R(!0)},"aria-label":"Create Project",children:[(0,u.jsx)(p.OiG,{}),(0,u.jsx)("span",{children:"New Project"})]}),(0,u.jsxs)("button",{className:"export-btn",onClick:()=>Oe(!0),"aria-label":"Export Projects",children:[(0,u.jsx)(p.WCW,{}),(0,u.jsx)("span",{children:"Export"})]}),(0,u.jsxs)("div",{className:"search-container",children:[(0,u.jsx)(p.KSO,{className:"search-icon"}),(0,u.jsx)("input",{value:Ye,onChange:e=>Ge(e.target.value),placeholder:"Search by name, location, manager...",className:"search-input"})]}),(0,u.jsxs)("div",{className:"view-mode-container",children:[(0,u.jsx)("button",{"aria-label":"Grid view",className:"view-mode-btn ".concat("grid"===Ve?"active":""),onClick:()=>Qe("grid"),children:(0,u.jsx)(p.QJV,{})}),(0,u.jsx)("button",{"aria-label":"List view",className:"view-mode-btn ".concat("list"===Ve?"active":""),onClick:()=>Qe("list"),children:(0,u.jsx)(p.svy,{})})]}),(0,u.jsxs)("div",{className:"sort-container",children:[(0,u.jsxs)("select",{value:Ke,onChange:e=>Xe(e.target.value),className:"sort-select",children:[(0,u.jsx)("option",{value:"name",children:"Name"}),(0,u.jsx)("option",{value:"location",children:"Location"}),(0,u.jsx)("option",{value:"manager",children:"Manager"}),(0,u.jsx)("option",{value:"status",children:"Status"}),(0,u.jsx)("option",{value:"startDate",children:"Start Date"})]}),(0,u.jsx)("button",{"aria-label":"Toggle sort order",className:"sort-order-btn",onClick:()=>et((e=>"asc"===e?"desc":"asc")),children:"asc"===$e?(0,u.jsx)(p.Ucs,{}):(0,u.jsx)(p.Vr3,{})})]})]})]}),(0,u.jsxs)("div",{className:"filter-bar below-header",children:[(0,u.jsxs)("button",{className:"filter-chip ".concat("all"===He?"active":""),onClick:()=>Je("all"),children:["All ",(0,u.jsx)("span",{className:"badge",children:xt.total})]}),(0,u.jsxs)("button",{className:"filter-chip ".concat("ongoing"===He?"active":""),onClick:()=>Je("ongoing"),children:["Ongoing ",(0,u.jsx)("span",{className:"badge",children:xt.ongoing})]}),(0,u.jsxs)("button",{className:"filter-chip ".concat("completed"===He?"active":""),onClick:()=>Je("completed"),children:["Completed ",(0,u.jsx)("span",{className:"badge",children:xt.completed})]}),(0,u.jsxs)("button",{className:"filter-chip ".concat("pending"===He?"active":""),onClick:()=>Je("pending"),children:["Pending ",(0,u.jsx)("span",{className:"badge",children:xt.pending})]})]}),E&&(0,u.jsxs)("div",{className:"error-state",children:[(0,u.jsx)(p.w_X,{}),(0,u.jsx)("span",{children:E}),(0,u.jsx)("button",{onClick:()=>window.location.reload(),className:"retry-btn",children:"Try Again"})]}),!E&&T&&(0,u.jsx)(gt,{n:8}),!E&&!T&&(0,u.jsxs)("div",{className:"projects-display ".concat(Ve),children:[0===mt.length&&(0,u.jsxs)("div",{className:"empty-state full",children:[(0,u.jsx)(p.yd7,{size:42}),(0,u.jsx)("h3",{children:"No projects found"}),(0,u.jsx)("p",{children:Ye||"all"!==He?"Adjust search or filters.":"No projects available."})]}),mt.map((e=>{var a,n,s;const r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=e.toLowerCase();return"completed"===t?{color:"#10B981",Icon:p.A7C,label:"Completed"}:["ongoing","on going"].includes(t)?{color:"#3B82F6",Icon:p.w_X,label:"Ongoing"}:["pending","not started"].includes(t)?{color:"#F59E0B",Icon:p.w_X,label:"Pending"}:{color:"#6B7280",Icon:p.w_X,label:e||"Unknown"}}(e.status);return(0,u.jsxs)("div",{className:"project-card ".concat(Ve),role:"button",tabIndex:0,onKeyDown:t=>{"Enter"===t.key&&m("/it/projects/".concat(e._id))},children:[(0,u.jsxs)("div",{className:"project-image-wrapper",children:[(0,u.jsx)("img",{loading:"lazy",src:(null===(a=e.photos)||void 0===a?void 0:a[0])||"https://placehold.co/640x360?text=No+Photo",alt:e.projectName,className:"project-image"}),(0,u.jsxs)("div",{className:"status-badge",style:{backgroundColor:r.color},children:[(0,u.jsx)(r.Icon,{size:12}),(0,u.jsx)("span",{children:r.label})]}),(0,u.jsxs)("div",{className:"project-actions",children:[(0,u.jsx)("button",{className:"action-btn view-btn",onClick:t=>{t.stopPropagation(),m("/it/projects/".concat(e._id))},title:"View",children:(0,u.jsx)(p.Ny1,{})}),(0,u.jsx)("button",{className:"action-btn edit-btn",onClick:a=>{a.stopPropagation(),function(e){var a,n,s,r,i;_(e._id);const o={projectName:e.projectName||"",contractor:e.contractor||"",budget:null!==(a=e.budget)&&void 0!==a?a:"",location:null!==(n=e.location)&&void 0!==n&&n._id?String(e.location._id):"",startDate:e.startDate?new Date(e.startDate).toISOString().slice(0,10):"",endDate:e.endDate?new Date(e.endDate).toISOString().slice(0,10):"",status:e.status||"Ongoing",projectmanager:null!==(s=e.projectmanager)&&void 0!==s&&s._id?String(e.projectmanager._id):"",areamanager:null!==(r=e.areamanager)&&void 0!==r&&r._id?String(e.areamanager._id):"",area:null!==(i=e.area)&&void 0!==i&&i._id?String(e.area._id):"",pic:(e.pic||[]).map((e=>String(e._id||e))),staff:(e.staff||[]).map((e=>String(e._id||e))),hrsite:(e.hrsite||[]).map((e=>String(e._id||e))),manpower:(e.manpower||[]).map((e=>String(e._id||e)))};t(o);const l=e=>{for(const t in z){const a=(z[t]||[]).find((t=>String(t._id)===String(e)));if(a)return a}return{_id:e,name:U[e]||e}};be(o.pic.map(l)),Ne(o.staff.map(l)),Ie(o.hrsite.map(l)),Re((e.manpower||[]).map((e=>({_id:String(e._id||e),name:e.name||e._id||e,position:e.position||""}))));try{const t=(e.manpower||[]).map((e=>({_id:String(e._id||e),name:e.name||e._id||e,position:e.position||""})));X((e=>{const a=new Map(e.map((e=>[String(e._id),e])));return t.forEach((e=>{a.has(e._id)||a.set(e._id,e)})),Array.from(a.values())}))}catch(c){}R(!0)}(e)},title:"Edit",children:(0,u.jsx)(p.uO9,{})}),(0,u.jsx)("button",{className:"action-btn audit-btn",onClick:t=>{t.stopPropagation(),async function(e){Y(!0),Z(e);try{const{data:t}=await i.Ay.get("/audit-logs",{params:{projectId:e}});V(t||[])}catch(t){V([])}finally{Y(!1),H(!0)}}(e._id)},title:"Audit",children:"\ud83d\udd51"}),(0,u.jsx)("button",{className:"action-btn delete-btn",onClick:t=>{var a;t.stopPropagation(),fe({id:(a=e)._id,name:a.projectName})},title:"Delete",children:(0,u.jsx)(p.qbC,{})})]})]}),(0,u.jsxs)("div",{className:"project-content",children:[(0,u.jsx)("h3",{className:"project-name clamp",children:e.projectName||"Untitled"}),(0,u.jsxs)("div",{className:"project-location",children:[(0,u.jsx)(p.vq8,{}),(0,u.jsx)("span",{children:(null===(n=e.location)||void 0===n?void 0:n.name)||"No Location"})]}),(0,u.jsxs)("ul",{className:"meta-list",children:[(0,u.jsxs)("li",{children:[(0,u.jsx)(p.p7b,{}),(0,u.jsx)("span",{children:(null===(s=e.projectmanager)||void 0===s?void 0:s.name)||"Unassigned"})]}),(0,u.jsxs)("li",{children:[(0,u.jsx)(p.ymh,{}),(0,u.jsx)("span",{children:e.contractor||"No Contractor"})]}),(0,u.jsxs)("li",{children:[(0,u.jsx)(p.bfZ,{}),(0,u.jsx)("span",{children:e.startDate&&e.endDate?"".concat(new Date(e.startDate).toLocaleDateString()," - ").concat(new Date(e.endDate).toLocaleDateString()):e.startDate?new Date(e.startDate).toLocaleDateString():"No timeline"})]}),(0,u.jsxs)("li",{children:[(0,u.jsx)(p.YXz,{}),(0,u.jsx)("span",{children:Array.isArray(e.manpower)&&e.manpower.length>0?"".concat(e.manpower.length," manpower"):"No manpower"})]}),e.budget&&(0,u.jsxs)("li",{children:[(0,u.jsx)(p.MxO,{}),(0,u.jsx)("span",{children:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e.budget)})]})]})]})]},e._id)}))]}),mt.length>0&&!T&&(0,u.jsxs)("div",{className:"pagination-bar",children:[(0,u.jsxs)("div",{className:"pagination-left",children:[(0,u.jsxs)("span",{className:"pagination-info",children:["Showing ",(ht-1)*nt+1,"-",Math.min(ht*nt,pt)," of ",pt]}),(0,u.jsxs)("label",{className:"page-size-select-label",children:[(0,u.jsx)("span",{children:"Per page:"}),(0,u.jsx)("select",{value:nt,onChange:e=>{st(parseInt(e.target.value)||12),at(1)},className:"page-size-select",children:[6,12,18,24,36].map((e=>(0,u.jsx)("option",{value:e,children:e},e)))})]})]}),(0,u.jsxs)("div",{className:"pagination-pages",children:[(0,u.jsx)("button",{disabled:1===ht,onClick:()=>at((e=>Math.max(1,e-1))),className:"page-btn","aria-label":"Previous page",children:"\u2039"}),Array.from({length:ut}).map(((e,t)=>{const a=t+1;return 1===a||a===ut||Math.abs(a-ht)<=1?(0,u.jsx)("button",{className:"page-btn ".concat(a===ht?"active":""),onClick:()=>at(a),"aria-current":a===ht?"page":void 0,children:a},a):2===a&&ht>3?(0,u.jsx)("span",{className:"ellipsis",children:"\u2026"},"start-ellipsis"):a===ut-1&&ht<ut-2?(0,u.jsx)("span",{className:"ellipsis",children:"\u2026"},"end-ellipsis"):null})),(0,u.jsx)("button",{disabled:ht===ut,onClick:()=>at((e=>Math.min(ut,e+1))),className:"page-btn","aria-label":"Next page",children:"\u203a"})]})]})]})]}),k&&(0,u.jsx)("div",{className:"modal-overlay",onClick:e=>{e.target.classList.contains("modal-overlay")&&R(!1)},children:(0,u.jsxs)("div",{className:"modal-card large",style:{maxWidth:900},children:[(0,u.jsx)("h2",{style:{marginTop:0},children:P?"Edit Project":"Create Project"}),$.length>0&&(0,u.jsx)("div",{className:"alert error",style:{marginBottom:"0.5rem"},children:$.map(((e,t)=>(0,u.jsx)("div",{children:e},t)))}),(0,u.jsxs)("form",{onSubmit:async function(t){t.preventDefault(),L(!0);const a=function(e){const t=[];return e.projectName.trim()||t.push("Project name is required"),e.contractor.trim()||t.push("Contractor is required"),e.location||t.push("Location is required"),e.startDate||t.push("Start date is required"),e.endDate||t.push("End date is required"),e.startDate&&e.endDate&&new Date(e.startDate)>new Date(e.endDate)&&t.push("Start date must be before end date"),e.projectmanager||t.push("Project Manager is required"),e.areamanager||t.push("Area Manager is required"),e.pic&&0!==e.pic.length||t.push("At least one PIC is required"),e.staff&&0!==e.staff.length||t.push("At least one Staff member is required"),e.hrsite&&0!==e.hrsite.length||t.push("At least one HR-Site member is required"),e.manpower&&0!==e.manpower.length||t.push("At least one Manpower is required"),t}(e);if(ee(a),a.length)L(!1);else try{const t=(0,n.A)({},e);if(t.pic=[...e.pic],t.staff=[...e.staff],t.hrsite=[...e.hrsite],t.manpower=[...e.manpower],P)try{console.log("[IT Edit] Update payload",t)}catch(s){}let a;if(""===t.budget?delete t.budget:t.budget=Number(t.budget),["projectmanager","areamanager","area"].forEach((e=>{t[e]||delete t[e]})),!P&&(te.length||re.length||ne.length)){const e=new FormData;Object.entries(t).forEach((t=>{let[a,n]=t;Array.isArray(n)?n.forEach((t=>e.append(a,t))):e.append(a,n)})),re.forEach((t=>e.append("photos",t))),te.forEach((t=>e.append("documents",t))),ne.forEach((t=>e.append("budgetPdf",t)));a=(await i.Ay.post("/projects",e,{headers:{"Content-Type":"multipart/form-data"}})).data}else if(P)await i.Ay.patch("/projects/".concat(P),t);else{a=(await i.Ay.post("/projects",t)).data}if(!P&&a){try{const e=[];t.projectmanager&&e.push(t.projectmanager),t.areamanager&&e.push(t.areamanager),t.pic&&t.pic.length>0&&e.push(...t.pic),t.staff&&t.staff.length>0&&e.push(...t.staff),t.hrsite&&t.hrsite.length>0&&e.push(...t.hrsite);const a=[...new Set(e)];a.length>0?(await i.Ay.post("/chats",{name:t.projectName,users:a,isGroup:!0}),ge('Project "'.concat(t.projectName,'" created successfully! A group chat has been created with all assigned team members.'))):ge('Project "'.concat(t.projectName,'" created successfully!')),me(!0),setTimeout((()=>me(!1)),5e3)}catch(r){console.error("Failed to create group chat:",r),ge('Project "'.concat(t.projectName,'" created successfully! (Note: Group chat creation failed)')),me(!0),setTimeout((()=>me(!1)),5e3)}await i.Ay.post("/projects",{headers:{"Content-Type":"multipart/form-data"}});if(ge("Project updated successfully!"),re.length>0){const e=new FormData;Object.entries(t).forEach((t=>{let[a,n]=t;Array.isArray(n)?n.forEach((t=>e.append(a,t))):e.append(a,n)})),re.forEach((t=>e.append("photos",t))),await i.Ay.patch("/projects/".concat(P),e,{headers:{"Content-Type":"multipart/form-data"}})}else await i.Ay.patch("/projects/".concat(P),t);setTimeout((()=>me(!1)),3e3)}R(!1),await ot()}catch(o){alert("Save failed")}finally{L(!1)}},className:"grid-2col gap-md",style:{maxHeight:"70vh",overflow:"auto",paddingRight:8,gridTemplateColumns:P?"1fr 1fr":"1fr 1fr 1fr"},children:[(0,u.jsxs)("fieldset",{className:"section",style:{gridColumn:"1 / 2"},children:[(0,u.jsx)("legend",{children:"Core"}),(0,u.jsxs)("label",{children:["Project Name",(0,u.jsx)("input",{name:"projectName",value:e.projectName,onChange:lt,required:!0})]}),(0,u.jsxs)("label",{children:["Contractor",(0,u.jsx)("input",{name:"contractor",value:e.contractor,onChange:lt})]}),(0,u.jsxs)("label",{children:["Budget",(0,u.jsx)("input",{name:"budget",type:"text",inputMode:"decimal",min:"0",value:a,onChange:e=>{let a=e.target.value.replace(/,/g,"");a=a.replace(/[^\d.]/g,"");const s=a.split(".");let r=s[0].replace(/^0+(?!$)/,""),i=void 0!==s[1]?s[1].slice(0,2):void 0;const o=void 0!==i&&i.length>0?"".concat(r,".").concat(i):r;t((e=>(0,n.A)((0,n.A)({},e),{},{budget:o})))},placeholder:"0.00",autoComplete:"off"})]}),(0,u.jsxs)("label",{children:["Status",(0,u.jsxs)("select",{name:"status",value:e.status,onChange:lt,children:[(0,u.jsx)("option",{value:"Ongoing",children:"Ongoing"}),(0,u.jsx)("option",{value:"Completed",children:"Completed"})]})]}),(0,u.jsxs)("label",{children:["Location",(0,u.jsxs)("select",{name:"location",value:e.location,onChange:lt,required:!0,children:[(0,u.jsx)("option",{value:"",children:"-- select --"}),F.map((e=>(0,u.jsxs)("option",{value:e._id,children:[e.name," ",e.region?"(".concat(e.region,")"):""]},e._id)))]})]}),(0,u.jsxs)("label",{children:["Start Date",(0,u.jsx)("input",{name:"startDate",type:"date",value:e.startDate,onChange:lt,required:!0})]}),(0,u.jsxs)("label",{children:["End Date",(0,u.jsx)("input",{name:"endDate",type:"date",value:e.endDate,onChange:lt,required:!0})]})]}),(0,u.jsxs)("fieldset",{className:"section",style:{gridColumn:"2 / 3"},children:[(0,u.jsx)("legend",{children:"Assignments"}),(0,u.jsxs)("label",{children:["Project Manager",(0,u.jsxs)("select",{name:"projectmanager",value:e.projectmanager,onChange:lt,children:[(0,u.jsx)("option",{value:"",children:"-- none --"}),(it["Project Manager"]||[]).map((e=>(0,u.jsx)("option",{value:e._id,children:e.name},e._id)))]})]}),(0,u.jsxs)("label",{children:["Area Manager",(0,u.jsxs)("select",{name:"areamanager",value:e.areamanager,onChange:lt,children:[(0,u.jsx)("option",{value:"",children:"-- none --"}),(it["Area Manager"]||[]).map((e=>(0,u.jsx)("option",{value:e._id,children:e.name},e._id)))]})]}),(0,u.jsxs)("label",{children:["PIC(s)",(0,u.jsx)(x,{name:"pic",values:e.pic,options:it["Person in Charge"]||[],userLookup:U,onChange:e=>t((t=>(0,n.A)((0,n.A)({},t),{},{pic:e})))})]}),(0,u.jsxs)("label",{children:["Staff",(0,u.jsx)(x,{name:"staff",values:e.staff,options:it.Staff||[],userLookup:U,onChange:e=>t((t=>(0,n.A)((0,n.A)({},t),{},{staff:e})))})]}),(0,u.jsxs)("label",{children:["HR - Site",(0,u.jsx)(x,{name:"hrsite",values:e.hrsite,options:it["HR - Site"]||[],userLookup:U,onChange:e=>t((t=>(0,n.A)((0,n.A)({},t),{},{hrsite:e})))})]}),(0,u.jsxs)("div",{style:{marginBottom:12},children:[(0,u.jsx)("label",{htmlFor:"manpower-multibox",style:{display:"block",fontWeight:500,marginBottom:4},children:"Manpower"}),(0,u.jsxs)("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[(0,u.jsx)("input",{id:"csvUpload",type:"file",accept:".csv",style:{display:"none"},onChange:e=>{Le("");const a=e.target.files[0];a&&l().parse(a,{header:!0,skipEmptyLines:!0,complete:async e=>{const a=e.data,s=e.errors;if(s.length>0)return void Le("CSV Upload Error: ".concat(s[0].message));if(0===a.length)return void Le("No data found in CSV file.");const r=[],o=[],l=[],c=[];if(a.forEach(((e,t)=>{const n=e.Name||e.name||"",s=e.Position||e.position||"",i=e.Status||e.status||"",d=e.Project||e.project||"";if(!n||!s)return void o.push("Row ".concat(t+1,": Missing name or position"));if(a.slice(0,t).some(((e,t)=>{const a=(e.Name||e.name||"").trim().toLowerCase(),r=(e.Position||e.position||"").trim().toLowerCase();return a===n.trim().toLowerCase()&&r===s.trim().toLowerCase()})))return void c.push("Row ".concat(t+1,": Duplicate entry (").concat(n," - ").concat(s,")"));if(K.find((e=>e.name.trim().toLowerCase()===n.trim().toLowerCase()&&e.position.trim().toLowerCase()===s.trim().toLowerCase())))c.push("Row ".concat(t+1,": Already exists in system (").concat(n," - ").concat(s,")"));else{if(!P){if(d&&""!==d.trim())return void l.push("Row ".concat(t+1,": Project should be empty (").concat(n,")"));if(i&&"unassigned"!==i.trim().toLowerCase())return void l.push("Row ".concat(t+1,": Status should be 'unassigned' (").concat(n,")"))}r.push({name:n.trim(),position:s.trim(),status:P?i||"Active":"unassigned",project:"",isNew:!0})}})),o.length>0)Le("Invalid rows: ".concat(o.join(", ")));else if(c.length>0)Le("Duplicate entries: ".concat(c.join(", ")));else if(l.length>0)Le("Validation errors: ".concat(l.join(", ")));else if(r.length>0){Me(!0);try{const e=[];for(const t of r){const{data:a}=await i.Ay.post("/manpower",{name:t.name,position:t.position,status:t.status,assignedProject:null},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});e.push(a)}const a=e.map((e=>e._id));t((e=>(0,n.A)((0,n.A)({},e),{},{manpower:[...e.manpower,...a]}))),X((t=>[...t,...e])),Le("");const s=P?"added to project":"created and assigned to project";alert("Successfully imported ".concat(e.length," manpower entries. They have been ").concat(s,"."))}catch(d){console.error("Error importing manpower:",d),Le("Failed to import manpower. Please try again.")}finally{Me(!1)}}else Le("No valid manpower data found in CSV file.")},error:e=>{console.error("CSV Parsing Error:",e),Le("Error parsing CSV file. Please ensure it is a valid CSV and try again.")}})}}),(0,u.jsx)("button",{type:"button",onClick:()=>document.getElementById("csvUpload").click(),disabled:Fe,style:{padding:"4px 8px",fontSize:"12px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:Fe?"not-allowed":"pointer",opacity:Fe?.6:1},children:Fe?"Uploading...":"Import CSV"}),(0,u.jsx)("button",{type:"button",onClick:()=>{alert("CSV Format for ".concat(P?"Edit":"Create",' Project:\n\nRequired columns:\n- Name (required)\n- Position (required)\n\nOptional columns:\n- Status (defaults to "Active" for Edit, must be "unassigned" for Create)\n- Project (must be empty for Create mode)\n\nRules:\n\u2022 ').concat(P?"New manpower will be added to existing project roster":'All persons must have status "unassigned" and no project assignments',"\n\u2022 Duplicate names/positions are not allowed\n\u2022 New manpower will be created and assigned to this project\n\nExample:\nName,Position,Status,Project\nJohn Doe,Engineer,").concat(P?"Active":"unassigned",",\nJane Smith,Manager,").concat(P?"Active":"unassigned",",\nMike Johnson,Technician,").concat(P?"Active":"unassigned",","))},style:{padding:"4px 8px",fontSize:"12px",backgroundColor:"#17a2b8",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"?"})]}),qe&&(0,u.jsx)("div",{style:{color:"#dc2626",fontSize:"12px",marginBottom:"8px",padding:"4px 8px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"4px"},children:qe}),(0,u.jsx)("div",{id:"manpower-multibox",children:(0,u.jsx)(x,{name:"manpower",values:e.manpower,options:K,labelKey:"name",idKey:"_id",userLookup:U,onChange:e=>t((t=>(0,n.A)((0,n.A)({},t),{},{manpower:e})))})})]})]}),(0,u.jsxs)("fieldset",{className:"section",style:{gridColumn:"3 / 4",alignSelf:"start"},children:[(0,u.jsx)("legend",{children:"Initial Files (optional)"}),(0,u.jsxs)("div",{className:"flex-column gap-sm",children:[(0,u.jsxs)("label",{className:"uploader",style:{display:"flex",flexDirection:"column",gap:4},children:["Photos",(0,u.jsx)("input",{type:"file",multiple:!0,accept:"image/*",onChange:e=>ie(Array.from(e.target.files||[]))})]}),oe.length>0&&(0,u.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(70px,1fr))",gap:6,marginTop:6},children:oe.map((e=>(0,u.jsxs)("div",{style:{position:"relative",border:"1px solid #e5e7eb",borderRadius:6,overflow:"hidden",background:"#fafafa"},children:[(0,u.jsx)("img",{src:e.url,alt:e.name,style:{width:"100%",height:60,objectFit:"cover",display:"block"}}),(0,u.jsx)("button",{type:"button",title:"Remove",onClick:()=>ie((t=>t.filter((t=>t!==e.file)))),style:{position:"absolute",top:2,right:2,background:"rgba(0,0,0,0.55)",color:"#fff",border:"none",borderRadius:4,fontSize:10,padding:"2px 4px",cursor:"pointer"},children:"\xd7"})]},e.url)))}),(0,u.jsxs)("label",{className:"uploader",style:{display:"flex",flexDirection:"column",gap:4,marginTop:10},children:["Documents",(0,u.jsx)("input",{type:"file",multiple:!0,onChange:e=>ae(Array.from(e.target.files||[]))})]}),(0,u.jsxs)("label",{className:"uploader",style:{display:"flex",flexDirection:"column",gap:4,marginTop:10},children:["Budget PDF(s)",(0,u.jsx)("input",{type:"file",multiple:!0,accept:"application/pdf",onChange:e=>se(Array.from(e.target.files||[]))})]}),ce.length>0&&(0,u.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginTop:6},children:ce.map((e=>(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,border:"1px solid #e5e7eb",padding:"4px 6px",borderRadius:4,background:"#f8fafc",fontSize:11},children:[(0,u.jsx)("span",{style:{display:"inline-block",minWidth:28,textAlign:"center",background:"#3b82f6",color:"#fff",borderRadius:4,padding:"2px 4px"},children:e.ext||"DOC"}),(0,u.jsx)("span",{style:{maxWidth:120,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:e.name,children:e.name}),(0,u.jsx)("button",{type:"button",onClick:()=>ae((t=>t.filter((t=>t!==e.file)))),style:{background:"transparent",border:"none",color:"#dc2626",cursor:"pointer",fontSize:14,lineHeight:1},children:"\xd7"})]},e.name+Math.random())))}),ne.length>0&&(0,u.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginTop:6},children:ne.map((e=>(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,border:"1px solid #e5e7eb",padding:"4px 6px",borderRadius:4,background:"#fffbeb",fontSize:11},children:[(0,u.jsx)("span",{style:{display:"inline-block",minWidth:28,textAlign:"center",background:"#f59e0b",color:"#fff",borderRadius:4,padding:"2px 4px"},children:"PDF"}),(0,u.jsx)("span",{style:{maxWidth:140,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:e.name,children:e.name}),(0,u.jsx)("button",{type:"button",onClick:()=>se((t=>t.filter((t=>t!==e)))),style:{background:"transparent",border:"none",color:"#dc2626",cursor:"pointer",fontSize:14,lineHeight:1},children:"\xd7"})]},e.name+Math.random())))})]}),(0,u.jsxs)("small",{style:{display:"block",marginTop:6},children:[re.length," photo(s), ",te.length," document(s), ",ne.length," budget PDF(s) selected"]})]}),(0,u.jsxs)("div",{style:{gridColumn:"1 / -1",display:"flex",justifyContent:"flex-end",gap:"0.5rem",marginTop:"0.5rem"},children:[(0,u.jsx)("button",{type:"button",onClick:()=>R(!1),disabled:q,children:"Cancel"}),(0,u.jsx)("button",{type:"submit",disabled:q,children:q?"Saving...":"Save Project"})]})]})]})}),je&&(0,u.jsx)("div",{className:"modal-overlay",onClick:e=>{e.target.classList.contains("modal-overlay")&&ct()},children:(0,u.jsxs)("div",{className:"modal-card",style:{maxWidth:420,textAlign:"center"},children:[(0,u.jsx)("h2",{style:{marginTop:0},children:"Delete Project"}),(0,u.jsxs)("p",{style:{fontSize:14,lineHeight:1.4},children:["Are you sure you want to permanently delete ",(0,u.jsx)("strong",{children:je.name||"this project"}),"? This action cannot be undone."]}),(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"0.75rem",marginTop:"1rem"},children:[(0,u.jsx)("button",{onClick:ct,children:"No, Keep"}),(0,u.jsx)("button",{onClick:async function(){if(!je)return;const{id:e}=je;try{await i.Ay.delete("/projects/".concat(e)),A((t=>t.filter((t=>t._id!==e))))}catch(t){alert("Delete failed")}finally{fe(null)}},style:{background:"#dc2626",color:"#fff"},children:"Yes, Delete"})]})]})}),B&&(0,u.jsx)("div",{className:"modal-overlay",onClick:e=>{e.target.classList.contains("modal-overlay")&&H(!1)},children:(0,u.jsxs)("div",{className:"modal-card",style:{maxWidth:900},children:[(0,u.jsxs)("h2",{style:{marginTop:0},children:["Audit Trail ",G&&"for ".concat(G)]}),(0,u.jsx)("button",{style:{position:"absolute",top:8,right:8},onClick:()=>H(!1),children:"Close"}),Q&&(0,u.jsx)("p",{children:"Loading audit logs..."}),!Q&&(0,u.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:(0,u.jsxs)("table",{className:"pm-table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Time"}),(0,u.jsx)("th",{children:"Action"}),(0,u.jsx)("th",{children:"User"}),(0,u.jsx)("th",{children:"Role"}),(0,u.jsx)("th",{children:"Description"}),(0,u.jsx)("th",{children:"Changed Fields"})]})}),(0,u.jsxs)("tbody",{children:[J.map((e=>{var t,a,n;return(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:new Date(e.timestamp).toLocaleString()}),(0,u.jsx)("td",{children:e.action}),(0,u.jsx)("td",{children:(null===(t=e.performedBy)||void 0===t?void 0:t.name)||"\u2014"}),(0,u.jsx)("td",{children:e.performedByRole}),(0,u.jsx)("td",{style:{minWidth:180},children:e.description}),(0,u.jsxs)("td",{style:{minWidth:220},children:[0===((null===(a=e.meta)||void 0===a?void 0:a.changedFields)||[]).length&&"\u2014",((null===(n=e.meta)||void 0===n?void 0:n.changedFields)||[]).map(((e,t)=>(0,u.jsxs)("div",{style:{marginBottom:2},children:[(0,u.jsxs)("strong",{children:[e.field,":"]})," ",(0,u.jsx)("span",{style:{color:"#888"},children:JSON.stringify(e.before)})," \u2192 ",(0,u.jsx)("span",{children:JSON.stringify(e.after)})]},t)))]})]},e._id)})),0===J.length&&!Q&&(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:6,style:{textAlign:"center"},children:"No logs"})})]})]})})]})}),ze&&(0,u.jsx)("div",{className:"modal-overlay",onClick:e=>{e.target.classList.contains("modal-overlay")&&Oe(!1)},children:(0,u.jsxs)("div",{className:"modal-card",style:{maxWidth:600},children:[(0,u.jsx)("h2",{style:{marginTop:0},children:"Export Projects"}),(0,u.jsx)("button",{style:{position:"absolute",top:8,right:8},onClick:()=>Oe(!1),children:"Close"}),(0,u.jsxs)("div",{className:"export-filters",children:[(0,u.jsx)("h3",{children:"Filter Options"}),(0,u.jsxs)("div",{className:"filter-row",children:[(0,u.jsx)("label",{children:"Status Filter:"}),(0,u.jsxs)("select",{value:Ue.status,onChange:e=>We((t=>(0,n.A)((0,n.A)({},t),{},{status:e.target.value}))),children:[(0,u.jsx)("option",{value:"all",children:"All Projects"}),(0,u.jsx)("option",{value:"ongoing",children:"Ongoing Only"}),(0,u.jsx)("option",{value:"completed",children:"Completed Only"}),(0,u.jsx)("option",{value:"pending",children:"Pending Only"})]})]}),(0,u.jsxs)("div",{className:"filter-row",children:[(0,u.jsx)("label",{children:"Search:"}),(0,u.jsx)("input",{type:"text",placeholder:"Search by name, location, PM, or contractor...",value:Ue.search,onChange:e=>We((t=>(0,n.A)((0,n.A)({},t),{},{search:e.target.value})))})]}),(0,u.jsxs)("div",{className:"filter-row",children:[(0,u.jsx)("label",{children:"Date Range:"}),(0,u.jsxs)("div",{className:"date-inputs",children:[(0,u.jsx)("input",{type:"date",placeholder:"From Date",value:Ue.dateFrom,onChange:e=>We((t=>(0,n.A)((0,n.A)({},t),{},{dateFrom:e.target.value})))}),(0,u.jsx)("span",{children:"to"}),(0,u.jsx)("input",{type:"date",placeholder:"To Date",value:Ue.dateTo,onChange:e=>We((t=>(0,n.A)((0,n.A)({},t),{},{dateTo:e.target.value})))})]})]}),(0,u.jsxs)("div",{className:"filter-summary",children:[(0,u.jsx)("h4",{children:"Export Summary:"}),(0,u.jsxs)("p",{children:["Status: ","all"===Ue.status?"All Projects":Ue.status.charAt(0).toUpperCase()+Ue.status.slice(1)]}),Ue.search&&(0,u.jsxs)("p",{children:['Search: "',Ue.search,'"']}),Ue.dateFrom&&(0,u.jsxs)("p",{children:["From Date: ",Ue.dateFrom]}),Ue.dateTo&&(0,u.jsxs)("p",{children:["To Date: ",Ue.dateTo]}),(0,u.jsxs)("p",{children:["Matching Projects: ",Be.length]}),Be.length>0&&(0,u.jsxs)("div",{style:{maxHeight:120,overflowY:"auto",border:"1px solid #e5e7eb",borderRadius:4,padding:6,background:"#f9fafb",fontSize:12},children:[Be.slice(0,8).map((e=>(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:8},children:[(0,u.jsx)("span",{style:{flex:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.projectName}),(0,u.jsx)("span",{style:{opacity:.7},children:e.status})]},e._id))),Be.length>8&&(0,u.jsxs)("div",{style:{textAlign:"center",fontStyle:"italic",marginTop:4},children:["+ ",Be.length-8," more\u2026"]})]})]})]}),(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem",marginTop:"1rem"},children:[(0,u.jsx)("button",{onClick:()=>Oe(!1),children:"Cancel"}),(0,u.jsx)("button",{onClick:async()=>{const e=(new Date).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}),t={companyName:"Fadz Construction Inc.",companyLogo:"/images/Fadz-logo.png",exportedBy:y||"Unknown User",exportDate:e,filters:Ue,projects:Be.map((e=>{var t,a;return{name:e.projectName,area:(null===(t=e.location)||void 0===t?void 0:t.name)||"N/A",pm:(null===(a=e.projectmanager)||void 0===a?void 0:a.name)||"N/A",contractor:e.contractor||"N/A",timeline:"".concat(e.startDate?new Date(e.startDate).toLocaleDateString():"N/A"," - ").concat(e.endDate?new Date(e.endDate).toLocaleDateString():"N/A"),pics:Array.isArray(e.pic)?e.pic.map((e=>e.name)).join(", "):"N/A",budget:e.budget?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e.budget):"N/A"}}))};try{await(0,c.X)(t)}catch(a){console.error("PDF generation failed",a),alert("PDF generation failed. See console for details.")}Oe(!1)},disabled:0===Be.length,style:{background:Be.length?"#3b82f6":"#94a3b8",color:"white"},children:"Export to PDF"})]})]})})]})}function x(e){let{name:t,values:a,options:n,onChange:r,labelKey:i="name",idKey:o="_id",userLookup:l}=e;const[c,d]=s.useState(""),p=(n||[]).filter((e=>(e[i]||"").toLowerCase().includes(c.toLowerCase())));function h(e){r(a.includes(e)?a.filter((t=>t!==e)):[...a,e])}return(0,u.jsxs)("div",{className:"multibox",children:[(0,u.jsx)("input",{placeholder:"Filter...",value:c,onChange:e=>d(e.target.value)}),(0,u.jsxs)("div",{className:"box-list",children:[p.map((e=>(0,u.jsx)("div",{className:a.includes(e[o])?"box-item selected":"box-item",onClick:()=>h(e[o]),children:e[i]||e[o]},e[o]))),0===p.length&&(n||[]).length>0&&(0,u.jsx)("div",{className:"empty",children:"No matches"}),0===(n||[]).length&&(0,u.jsx)("div",{className:"empty",children:"Loading..."})]}),(0,u.jsx)("div",{className:"chips",children:a.map((e=>{const t=n.find((t=>t[o]===e));let a=t?t[i]:l?l[e]:null;return!a&&t&&t.position&&(a=t.position),(0,u.jsxs)("span",{className:"chip",onClick:()=>h(e),children:[a||e," \xd7"]},e)}))})]})}},7554:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var n=a(9379),s=a(5043),r=a(3216),i=a(411),o=a(2104),l=a(2063),c=a(7762),d=a(4857);async function p(e,t,a,n){try{const s="".concat("","/fonts/").concat(t),r=await fetch(s,{cache:"no-store"});if(!r.ok)return!1;const i=await r.arrayBuffer(),o=btoa(String.fromCharCode(...new Uint8Array(i)));return e.addFileToVFS(t,o),e.addFont(t,a,n),!0}catch(s){return!1}}function u(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal";try{return e.setFont(t,a),e.getTextWidth("test"),!0}catch(n){return!1}}function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;try{return new Date(e).toLocaleString()}catch(t){return String(e)}}async function m(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{companyName:a="FadzTrack",logoPath:n="".concat("","/images/Fadz-logo.png"),exporterName:s="Unknown",exporterRole:r="",filters:i={}}=t,o=new c.Ay({unit:"pt",format:"a4"}),l="NotoSans",m=await p(o,"NotoSans-Regular.ttf",l,"normal"),x=await p(o,"NotoSans-Bold.ttf",l,"bold"),g=m&&u(o,l,"normal"),j=x&&u(o,l,"bold"),f=g?l:"helvetica",v=j?"bold":"normal",b=40;let y=40;const S=await async function(e){return new Promise((t=>{if(!e)return t(null);try{const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{const e=document.createElement("canvas");e.width=a.naturalWidth,e.height=a.naturalHeight,e.getContext("2d").drawImage(a,0,0),t({dataUrl:e.toDataURL("image/png"),w:a.naturalWidth,h:a.naturalHeight})},a.onerror=()=>t(null),a.src=e}catch(a){t(null)}}))}(n);let w=b;if(null!==S&&void 0!==S&&S.dataUrl){const{w:e,h:t}=function(e,t,a,n){if(!e||!t)return{w:a,h:n};const s=Math.min(a/e,n/t);return{w:Math.round(e*s),h:Math.round(t*s)}}(S.w,S.h,180,60);o.addImage(S.dataUrl,"PNG",b,y-12,e,t,void 0,"FAST"),w=b+e+16}o.setFont(f,v),o.setFontSize(20),o.setTextColor(20),o.text(String(a),w,y+16),o.setFont(f,"normal"),o.setFontSize(12),o.setTextColor(90),o.text("Accounts Export",w,y+26),o.setDrawColor(220),o.setLineWidth(1),o.line(b,y+38,555,y+38),y+=54,o.setFont(f,v),o.setFontSize(12),o.setTextColor(20),o.text("Export Details",b,y),o.setFont(f,"normal"),o.setTextColor(60);const N=["Exported by: ".concat(s).concat(r?" (".concat(r,")"):""),"Date exported: ".concat(h(new Date))],C=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=[];return e.searchTerm&&t.push('Search: "'.concat(e.searchTerm,'"')),e.sortOption&&t.push("Sort: ".concat(e.sortOption)),t.join(" | ")}(i);C&&N.push("Filters: ".concat(C));let A=y+16;N.forEach((e=>{o.text(e,b,A),A+=16}));const T=A+6,I=e.map((e=>[String(e.name||""),String(e.position||""),String(e.phone||""),String(e.email||""),String(e.status||"")]));(0,d.Ay)(o,{startY:T,head:[["Name","Position","Phone","Email","Status"]],body:I,styles:{font:f,fontStyle:"normal",fontSize:11,cellPadding:6,halign:"left"},headStyles:{font:f,fontStyle:v,fillColor:[59,130,246],textColor:255},theme:"grid",margin:{left:b,right:b},didDrawPage:e=>{const t="Generated: ".concat(h(new Date));o.setFont(f,"normal"),o.setFontSize(9),o.setTextColor(120),o.text(t,b,818);const a=o.getCurrentPageInfo().pageNumber||1,n=o.getNumberOfPages(),s="Page ".concat(a," of ").concat(n),r=o.getTextWidth(s);o.text(s,555-r,818)}}),o.save(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Accounts-Export";const t=new Date,a=e=>String(e).padStart(2,"0"),n="".concat(t.getFullYear()).concat(a(t.getMonth()+1)).concat(a(t.getDate()),"_").concat(a(t.getHours())).concat(a(t.getMinutes()));return"".concat(e,"-").concat(n,".pdf")}())}a(2544);var x=a(3204),g=a(8818),j=a(7488),f=(a(2342),a(579));const v=()=>{const[e,t]=(0,s.useState)((()=>{const e=localStorage.getItem("user");return e?JSON.parse(e):null})),[a,c]=(0,s.useState)((()=>localStorage.getItem("token")||"")),[d,p]=(0,s.useState)((()=>null===e||void 0===e?void 0:e._id)),[u,h]=(0,s.useState)([]),v=(0,s.useRef)(null),[b,y]=(0,s.useState)(1),[S,w]=(0,s.useState)("Newest"),[N,C]=(0,s.useState)(""),[A,T]=(0,s.useState)(!1),[I,E]=(0,s.useState)({}),[D,k]=(0,s.useState)(null),[R,P]=(0,s.useState)(!1),[_,q]=(0,s.useState)(!1),[L,F]=(0,s.useState)(""),[M,z]=(0,s.useState)(null),[O,U]=(0,s.useState)(null),W=(0,r.Zp)(),[B,H]=(0,s.useState)({name:"",position:"",phone:"",email:""}),[J,V]=(0,s.useState)(!1),[Q,Y]=(0,s.useState)(null),[G,Z]=(0,s.useState)(""),[K,X]=(0,s.useState)(!0),[$,ee]=(0,s.useState)({processed:0,total:0,percent:0,id:null});(0,s.useEffect)((()=>{if(!v.current)return;const e=e=>{e.progressId&&e.progressId===$.id&&ee((t=>(0,n.A)((0,n.A)({},t),{},{processed:e.processed,total:e.total,percent:e.percent})))};return v.current.on("bulkRegisterProgress",e),()=>{v.current&&v.current.off("bulkRegisterProgress",e)}}),[$.id]);const[te,ae]=(0,s.useState)((null===e||void 0===e?void 0:e.name)||""),[ne,se]=(0,s.useState)((null===e||void 0===e?void 0:e.role)||"");(0,s.useEffect)((()=>{ae((null===e||void 0===e?void 0:e.name)||"ALECK"),se((null===e||void 0===e?void 0:e.role)||"")}),[e]);(0,s.useEffect)((()=>{(async()=>{try{const e=await i.Ay.get("/auth/Users"),t=e.data.map((e=>({id:e._id,name:e.name,position:e.role,phone:e.phone,email:e.email,accountStatus:e.accountStatus||("Active"===e.status?"Active":"Inactive"),presence:e.presenceStatus||"offline"})));h(t),!M&&t.length>0&&z(t[0])}catch(e){console.error("Error fetching accounts:",e)}})()}),[M]),(0,s.useEffect)((()=>{if(!v.current){try{const t=(0,o.io)(l.G,{path:l.c,transports:["websocket","polling"],auth:{userId:d||e&&e._id}});v.current=t,t.on("userStatusChanged",(e=>{let{userId:t,status:a}=e;const s="Active"===a?"Active":"Inactive";h((e=>e.map((e=>e.id===t?(0,n.A)((0,n.A)({},e),{},{accountStatus:s}):e)))),z((e=>e&&e.id===t?(0,n.A)((0,n.A)({},e),{},{accountStatus:s}):e))})),t.on("presenceSnapshot",(function(){const e=new Set(((arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])||[]).map(String));h((t=>t.map((t=>(0,n.A)((0,n.A)({},t),{},{presence:e.has(String(t.id))?"online":"offline"}))))),z((t=>t?(0,n.A)((0,n.A)({},t),{},{presence:e.has(String(t.id))?"online":"offline"}):t))})),t.on("userOnline",(e=>{const t=String(e);h((e=>e.map((e=>String(e.id)===t?(0,n.A)((0,n.A)({},e),{},{presence:"online"}):e)))),z((e=>e&&String(e.id)===t?(0,n.A)((0,n.A)({},e),{},{presence:"online"}):e))})),t.on("userOffline",(e=>{const t=String(e);h((e=>e.map((e=>String(e.id)===t?(0,n.A)((0,n.A)({},e),{},{presence:"offline"}):e)))),z((e=>e&&String(e.id)===t?(0,n.A)((0,n.A)({},e),{},{presence:"offline"}):e))})),t.on("disconnect",(()=>{}))}catch(t){console.error("Socket init failed (IT dashboard):",t)}return()=>{try{v.current&&v.current.disconnect()}catch(e){}v.current=null}}}),[]),(0,s.useEffect)((()=>{y(1)}),[N,S]);const re=e=>{const{name:t,value:a}=e.target;let s=a;"phone"===t&&(s=(a||"").replace(/\D/g,"").slice(0,11)),H((e=>(0,n.A)((0,n.A)({},e),{},{[t]:s}))),((e,t)=>{let a="";switch(e){case"name":t.trim()||(a="Name is required");break;case"position":t.trim()||(a="Position is required");break;case"phone":t?t.startsWith("09")?t.length<11?a="":/^09\d{9}$/.test(t)||(a="Phone must start with 09 and be 11 digits"):a="Phone must start with 09 and be 11 digits":a="";break;case"email":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||(a="Invalid email")}E((t=>(0,n.A)((0,n.A)({},t),{},{[e]:a})))})(t,s)},ie=async()=>{if((()=>{const e=["name","position","phone","email"],t=(0,n.A)({},I);let a=!0;for(const n of e){var s;const e=null!==(s=B[n])&&void 0!==s?s:"";let r="";"name"!==n||e.trim()||(r="Name is required"),"position"!==n||e.trim()||(r="Position is required"),"phone"!==n||/^09\d{9}$/.test(e)||(r="Phone must start with 09 and be 11 digits"),"email"!==n||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||(r="Invalid email"),t[n]=r,r&&(a=!1)}return E(t),a})())try{let e,t;R?(e=await i.Ay.put("/auth/users/".concat(D.id),{name:B.name,role:B.position,phone:B.phone,email:B.email}),t=e.data,h(u.map((e=>{var a,s,r,i,o,l,c,d,p,u;return e.id===D.id?(0,n.A)((0,n.A)({},e),{},{name:null!==(a=null===(s=t.user)||void 0===s?void 0:s.name)&&void 0!==a?a:B.name,position:null!==(r=null===(i=t.user)||void 0===i?void 0:i.role)&&void 0!==r?r:B.position,phone:null!==(o=null===(l=t.user)||void 0===l?void 0:l.phone)&&void 0!==o?o:B.phone,email:null!==(c=null===(d=t.user)||void 0===d?void 0:d.email)&&void 0!==c?c:B.email,accountStatus:(null===(p=t.user)||void 0===p?void 0:p.accountStatus)||("Active"===(null===(u=t.user)||void 0===u?void 0:u.status)?"Active":"Inactive")||e.accountStatus}):e}))),j.oR.success("Account updated successfully")):(e=await i.Ay.post("/auth/register",{name:B.name,role:B.position,phone:B.phone,email:B.email}),t=e.data,h([...u,{id:t.user._id,name:t.user.name,position:t.user.role,phone:t.user.phone,email:t.user.email,accountStatus:t.user.accountStatus||("Active"===t.user.status?"Active":"Inactive"),presence:t.user.presenceStatus||"offline"}]),j.oR.success("Account created & activation email sent")),H({name:"",position:"",phone:"",email:""}),T(!1),P(!1),k(null),F("")}catch(e){console.error("Error saving account:",e),j.oR.error("Failed to save account")}else j.oR.error("Please correct the errors before submitting")},oe=async()=>{if(B.email){F(""),q(!0);try{await i.Ay.post("/auth/reset-password-request",{email:B.email}),j.oR.success("Password reset link sent")}catch(e){console.error("Error resending reset link:",e),F("Failed to resend password reset link.")}finally{q(!1)}}else F("Email is required to resend reset link.")},le=N.toLowerCase(),ce=u.filter((e=>{var t,a,n,s;const r=String(null!==(t=e.phone)&&void 0!==t?t:"");return(null!==(a=e.name)&&void 0!==a?a:"").toLowerCase().includes(le)||(null!==(n=e.position)&&void 0!==n?n:"").toLowerCase().includes(le)||r.toLowerCase().includes(le)||(null!==(s=e.email)&&void 0!==s?s:"").toLowerCase().includes(le)})),de=10*b,pe=de-10,ue=[...ce].sort(((e,t)=>{switch(S){case"Newest":return t.id.localeCompare(e.id);case"Oldest":return e.id.localeCompare(t.id);case"A-Z":return e.name.localeCompare(t.name);case"Z-A":return t.name.localeCompare(e.name);case"Active":{const a="Active"===e.accountStatus;return a!==("Active"===t.accountStatus)?a?-1:1:e.name.localeCompare(t.name)}case"Inactive":{const a="Inactive"===e.accountStatus;return a!==("Inactive"===t.accountStatus)?a?-1:1:e.name.localeCompare(t.name)}default:return 0}})),he=ue.slice(pe,de),me=Math.ceil(ce.length/10),xe=0===ce.length?0:pe+1,ge=pe+he.length,je=e=>{e>0&&e<=me&&y(e)},[fe,ve]=(0,s.useState)(!1);return(0,f.jsxs)("div",{className:"fadztrack-app-IT",children:[(0,f.jsx)(g.A,{roleSegment:"it",onLogout:()=>{const e=localStorage.getItem("token");i.Ay.post("/auth/logout",{},{headers:{Authorization:"Bearer ".concat(e)}}).finally((()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),W("/")}))}}),(0,f.jsxs)("div",{className:"main-content-IT",children:[(0,f.jsx)("aside",{className:"sidebar-IT",children:(()=>{return A?(0,f.jsxs)("div",{className:"create-account-sidebar-IT",children:[(0,f.jsx)("h2",{children:R?"Update Account":"Create New Account"}),(0,f.jsxs)("div",{className:"form-group-IT",children:[(0,f.jsx)("label",{className:"form-label-IT",children:"Name"}),(0,f.jsx)("input",{type:"text",name:"name",placeholder:"Enter Name",value:B.name,onChange:re,className:"form-control-IT"}),I.name&&(0,f.jsx)("div",{className:"error-msg-IT",children:I.name})]}),(0,f.jsxs)("div",{className:"form-group-IT",children:[(0,f.jsx)("label",{className:"form-label-IT",children:"Position"}),(0,f.jsxs)("select",{name:"position",value:B.position,onChange:re,className:"form-control-IT",children:[(0,f.jsx)("option",{value:"",children:"Select Position"}),(0,f.jsx)("option",{value:"Project Manager",children:"Project Manager"}),(0,f.jsx)("option",{value:"Area Manager",children:"Area Manager"}),(0,f.jsx)("option",{value:"HR",children:"HR"}),(0,f.jsx)("option",{value:"Person in Charge",children:"Person in Charge"}),(0,f.jsx)("option",{value:"Staff",children:"Staff"}),(0,f.jsx)("option",{value:"HR - Site",children:"HR - Site"})]}),I.position&&(0,f.jsx)("div",{className:"error-msg-IT",children:I.position})]}),(0,f.jsxs)("div",{className:"form-group-IT",children:[(0,f.jsx)("label",{className:"form-label-IT",children:"Phone Number"}),(0,f.jsx)("input",{type:"tel",name:"phone",placeholder:"09xxxxxxxxx",value:B.phone,onChange:re,className:"form-control-IT",maxLength:"11"}),I.phone&&(0,f.jsx)("div",{className:"error-msg-IT",children:I.phone})]}),(0,f.jsxs)("div",{className:"form-group-IT",children:[(0,f.jsx)("label",{className:"form-label-IT",children:"Email"}),(0,f.jsx)("input",{type:"email",name:"email",placeholder:"Enter Email",value:B.email,onChange:re,className:"form-control-IT"}),I.email&&(0,f.jsx)("div",{className:"error-msg-IT",children:I.email})]}),(0,f.jsxs)("div",{className:"form-group-IT button-group-IT",children:[(0,f.jsx)("button",{className:"create-account-btn-IT",onClick:ie,children:R?"Update Account":"Create New Account"}),R&&(0,f.jsx)("button",{type:"button",className:"create-account-btn-IT",onClick:oe,disabled:_,children:_?"Resending...":"Resend Password Reset Link"}),(0,f.jsxs)("button",{className:"back-btn-IT",onClick:()=>{T(!1),P(!1),k(null),H({name:"",position:"",phone:"",email:""}),F("")},children:[(0,f.jsx)("span",{className:"back-arrow-IT",children:"\u2190"})," Back"]})]}),L&&(0,f.jsx)("p",{style:{color:"red",marginTop:"5px"},children:L})]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("h2",{children:"Dashboard"}),(0,f.jsxs)("div",{className:"bulk-upload-box-IT",children:[(0,f.jsx)("h3",{style:{marginTop:0},children:"Bulk Accounts Import"}),(0,f.jsxs)("p",{style:{fontSize:"12px",color:"#555",lineHeight:1.4},children:["Upload a CSV with columns: ",(0,f.jsx)("code",{children:"name,email,role,phone"}),". An activation email will be sent automatically to new accounts. Existing emails are skipped."]}),(0,f.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:"12px",marginBottom:4},children:[(0,f.jsx)("input",{type:"checkbox",checked:K,onChange:e=>X(e.target.checked)})," Dry run (no accounts created / emails sent)"]}),(0,f.jsx)("input",{type:"file",accept:".csv,text/csv",onChange:e=>{const t=e.target.files&&e.target.files[0];if(!t)return;Z(t.name);const a=new FormData;a.append("file",t);const n="prg_"+Date.now();a.append("progressId",n),a.append("dryRun",String(K)),ee({processed:0,total:0,percent:0,id:n}),V(!0),Y(null),i.Ay.post("/auth/bulk-register",a,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{if(Y(e.data),!e.data.dryRun)return i.Ay.get("/auth/Users").then((e=>{const t=e.data.map((e=>({id:e._id,name:e.name,position:e.role,phone:e.phone,email:e.email,accountStatus:e.accountStatus||("Active"===e.status?"Active":"Inactive"),presence:e.presenceStatus||"offline"})));h(t)}))})).catch((e=>{console.error("Bulk upload failed",e),j.oR.error("Bulk upload failed")})).finally((()=>V(!1)))},disabled:J}),J&&(0,f.jsxs)("div",{className:"bulk-progress-IT",children:[(0,f.jsx)("div",{className:"bulk-progress-bar-outer-IT",children:(0,f.jsx)("div",{className:"bulk-progress-bar-inner-IT",style:{width:"".concat($.percent,"%")}})}),(0,f.jsxs)("div",{className:"bulk-progress-label-IT",children:[$.percent,"% (",$.processed,"/",$.total||"?",")"]})]}),(0,f.jsxs)("div",{style:{marginTop:6,fontSize:"12px"},children:[J&&(0,f.jsx)("span",{children:"Uploading & processing\u2026"}),!J&&G&&!Q&&(0,f.jsxs)("span",{children:["Processing ",G,"\u2026"]}),Q&&(0,f.jsxs)("div",{className:"bulk-summary-IT",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("strong",{children:"Imported:"})," ",Q.summary.created]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("strong",{children:"Existing:"})," ",Q.summary.existing]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("strong",{children:"Failed:"})," ",Q.summary.failed]}),(0,f.jsx)("button",{className:"new-account-btn-IT",style:{marginTop:6},onClick:()=>Y(null),children:"Clear"}),(0,f.jsxs)("details",{style:{marginTop:4},children:[(0,f.jsx)("summary",{style:{cursor:"pointer"},children:"Details"}),(0,f.jsx)("div",{style:{maxHeight:150,overflowY:"auto",fontSize:"11px",marginTop:4},children:Q.results.map((e=>(0,f.jsxs)("div",{style:{padding:"2px 0",borderBottom:"1px solid #eee"},children:["Line ",e.line,": ",e.email||"(no email)"," \u2192 ",e.status,e.reason?" (".concat(e.reason,")"):""]},e.line)))})]}),(0,f.jsx)("p",{style:{marginTop:6},children:(0,f.jsx)("a",{href:"/sample_accounts_import.csv",download:!0,children:"Download sample CSV"})})]})]})]}),(0,f.jsx)("button",{className:"new-account-btn-IT",onClick:()=>{T(!0),P(!1),k(null),H({name:"",position:"",phone:"",email:""}),E({}),F("")},children:"Create New Account"}),(0,f.jsxs)("div",{className:"user-profile-large-IT",children:[(0,f.jsx)("div",{className:"profile-avatar-IT",children:((null===M||void 0===M||null===(e=M.name)||void 0===e?void 0:e[0])||"U").toUpperCase()}),(0,f.jsx)("h3",{children:(null===M||void 0===M?void 0:M.name)||"No User Selected"}),(0,f.jsx)("p",{className:"user-email-IT",children:(null===M||void 0===M?void 0:M.email)||"-"}),(0,f.jsx)("p",{className:"user-position-IT",children:(null===M||void 0===M?void 0:M.position)||"-"}),(0,f.jsx)("div",{className:"status-indicator-IT",children:(0,f.jsx)("span",{className:"status-IT ".concat(((null===M||void 0===M?void 0:M.accountStatus)||"active").toLowerCase(),"-IT"),children:(null===M||void 0===M?void 0:M.accountStatus)||"Active"})}),(0,f.jsx)("div",{className:"status-indicator-IT",style:{marginTop:8},children:(0,f.jsx)("span",{className:"status-IT ".concat((null===M||void 0===M?void 0:M.presence)||"offline","-IT"),children:((null===M||void 0===M?void 0:M.presence)||"offline").replace(/^./,(e=>e.toUpperCase()))})})]})]});var e})()}),(0,f.jsx)("main",{className:"dashboard-content-IT",children:(0,f.jsxs)("div",{className:"dashboard-card-IT",children:[(0,f.jsxs)("div",{className:"welcome-header-IT",children:[(0,f.jsxs)("h2",{children:["Hello, ",te]}),(0,f.jsxs)("p",{style:{fontSize:"14px",color:"#666"},children:["Currently logged in as ",(0,f.jsx)("strong",{children:ne})]}),(0,f.jsxs)("div",{className:"stats-container-IT",children:[(0,f.jsxs)("div",{className:"stat-card-IT",children:[(0,f.jsx)("div",{className:"stat-icon-IT users-IT",children:"\ud83d\udc65"}),(0,f.jsxs)("div",{className:"stat-info-IT",children:[(0,f.jsx)("div",{className:"stat-label-IT",children:"Total Accounts"}),(0,f.jsx)("div",{className:"stat-number-IT",children:u.length})]})]}),(0,f.jsxs)("div",{className:"stat-card-IT",children:[(0,f.jsx)("div",{className:"stat-icon-IT devices-IT",children:"\ud83d\udcbb"}),(0,f.jsxs)("div",{className:"stat-info-IT",children:[(0,f.jsx)("div",{className:"stat-label-IT",children:"Total Active"}),(0,f.jsx)("div",{className:"stat-number-IT",children:u.filter((e=>"Active"===e.accountStatus)).length})]})]})]})]}),(0,f.jsxs)("div",{className:"accounts-section-IT",children:[(0,f.jsxs)("div",{className:"accounts-header-IT",children:[(0,f.jsx)("h3",{children:"Accounts:"}),(0,f.jsxs)("div",{className:"accounts-tools-IT",children:[(0,f.jsx)("div",{className:"search-box-IT",children:(0,f.jsx)("input",{type:"text",placeholder:"Search",value:N,onChange:e=>C(e.target.value),className:"search-input-IT"})}),(0,f.jsxs)("div",{className:"sort-dropdown-IT",children:[(0,f.jsx)("span",{children:"Sort by: "}),(0,f.jsxs)("select",{value:S,onChange:e=>w(e.target.value),children:[(0,f.jsx)("option",{value:"Newest",children:"Newest"}),(0,f.jsx)("option",{value:"Oldest",children:"Oldest"}),(0,f.jsx)("option",{value:"A-Z",children:"A-Z"}),(0,f.jsx)("option",{value:"Z-A",children:"Z-A"}),(0,f.jsx)("option",{value:"Active",children:"Active"}),(0,f.jsx)("option",{value:"Inactive",children:"Inactive"})]})]}),(0,f.jsxs)("button",{className:"export-btn-IT",onClick:async()=>{try{ve(!0),await m(ue,{companyName:"FadzTrack",logoPath:"".concat("","/images/Fadz-logo.png"),exporterName:te||"Unknown",exporterRole:ne||"",filters:{searchTerm:N,sortOption:S}})}catch(e){console.error("Export failed",e),j.oR.error("Failed to export PDF")}finally{ve(!1)}},disabled:fe,title:"Export accounts to PDF",children:[(0,f.jsx)(x.kl1,{style:{marginRight:8}})," ",fe?"Exporting\u2026":"Export PDF"]})]})]}),(0,f.jsx)("div",{className:"accounts-table-IT",children:(0,f.jsxs)("table",{children:[(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{children:"Name"}),(0,f.jsx)("th",{children:"Position"}),(0,f.jsx)("th",{children:"Phone Number"}),(0,f.jsx)("th",{children:"Email"}),(0,f.jsx)("th",{children:"Presence"}),(0,f.jsx)("th",{children:"Account Status"}),(0,f.jsx)("th",{}),(0,f.jsx)("th",{})]})}),(0,f.jsx)("tbody",{children:he.map((e=>(0,f.jsxs)("tr",{onClick:()=>z(e),style:{cursor:"pointer"},children:[(0,f.jsx)("td",{children:e.name}),(0,f.jsx)("td",{children:e.position}),(0,f.jsx)("td",{children:e.phone}),(0,f.jsx)("td",{children:e.email}),(0,f.jsx)("td",{children:(0,f.jsx)("span",{className:"status-badge-IT ".concat(e.presence||"offline","-IT"),children:(e.presence||"offline").replace(/^./,(e=>e.toUpperCase()))})}),(0,f.jsx)("td",{children:(0,f.jsx)("span",{className:"status-badge-IT ".concat((e.accountStatus||"active").toLowerCase(),"-IT"),children:e.accountStatus||"Unknown"})}),(0,f.jsx)("td",{children:(0,f.jsx)("button",{className:"edit-button-IT",onClick:()=>{k(e),P(!0),T(!0),H({name:e.name,position:e.position,phone:e.phone,email:e.email}),F(""),E({}),z(e)},children:"\u270f\ufe0f"})}),(0,f.jsx)("td",{children:(0,f.jsx)("button",{className:"status-toggle-button-IT ".concat("Active"===e.accountStatus?"deactivate-IT":"activate-IT"),onClick:()=>(e=>{const t="Active"===e.accountStatus?"Inactive":"Active";U({account:e,newStatus:t})})(e),children:"Active"===e.accountStatus?"Disable":"Enable"})})]},e.id)))})]})}),(0,f.jsxs)("div",{className:"pagination-IT",children:[(0,f.jsxs)("span",{className:"pagination-info-IT",children:["Showing data ",xe," to ",ge," of ",ce.length," entries."]}),(0,f.jsxs)("div",{className:"pagination-controls-IT",children:[(0,f.jsx)("button",{className:"pagination-btn-IT prev-IT",onClick:()=>je(b-1),disabled:1===b,children:"<"}),Array.from({length:Math.min(5,me)},((e,t)=>{let a=t+1;return b>3&&me>5&&(a=b+t-2,a>me&&(a=me-4+t)),(0,f.jsx)("button",{className:"pagination-btn-IT ".concat(a===b?"active-IT":""),onClick:()=>je(a),children:a},t)})),(0,f.jsx)("button",{className:"pagination-btn-IT next-IT",onClick:()=>je(b+1),disabled:b===me,children:">"})]})]})]})]})})]}),O&&(0,f.jsx)("div",{className:"status-modal-overlay-IT",children:(0,f.jsxs)("div",{className:"status-modal-IT",children:[(0,f.jsx)("h3",{children:"Inactive"===O.newStatus?"Deactivate Account":"Activate Account"}),(0,f.jsx)("p",{children:"Inactive"===O.newStatus?"Are you sure you want to deactivate ".concat(O.account.name,"'s account? They will be prevented from logging in."):"Activate ".concat(O.account.name,"'s account? They will regain access.")}),(0,f.jsxs)("div",{className:"status-modal-actions-IT",children:[(0,f.jsx)("button",{className:"confirm-btn-IT",onClick:async()=>{if(!O)return;const{account:e,newStatus:t}=O;try{if((await i.Ay.put("/auth/users/".concat(e.id,"/status"),{accountStatus:t,status:t})).data){const a="Active"===t?"Active":"Inactive";h((t=>t.map((t=>t.id===e.id?(0,n.A)((0,n.A)({},t),{},{accountStatus:a}):t)))),z((t=>t&&t.id===e.id?(0,n.A)((0,n.A)({},t),{},{accountStatus:a}):t)),j.oR.success("Account ".concat("Inactive"===t?"disabled":"enabled"))}}catch(a){console.error("Failed to toggle account status:",a),j.oR.error("Failed to update status")}finally{U(null)}},children:"Yes"}),(0,f.jsx)("button",{className:"cancel-btn-IT",onClick:()=>U(null),children:"No"})]})]})})]})}}}]);
//# sourceMappingURL=it.a9f7ee6c.chunk.js.map
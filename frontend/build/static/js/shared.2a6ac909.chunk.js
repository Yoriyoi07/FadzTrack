"use strict";(self.webpackChunkfadz_web_frontend=self.webpackChunkfadz_web_frontend||[]).push([[804],{1499:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});var i=n(5043),a=n(7950),r=n(411),s=n(579);const o=e=>{var t;let{requestData:n,userId:o,userRole:d,onBack:l,onActionComplete:c}=e;const u="Project Manager"===d?"PM":"Area Manager"===d?"AM":d,p=null===n||void 0===n?void 0:n.status,g="Pending Project Manager"===p&&"PM"===u||"Pending Area Manager"===p&&"AM"===u,f=null===n||void 0===n||null===(t=n.approvals)||void 0===t?void 0:t.some((e=>{var t;return e.role===u&&String((null===(t=e.user)||void 0===t?void 0:t._id)||e.user)===String(o)})),m=g&&!f,[h,v]=(0,i.useState)(!1),[x,y]=(0,i.useState)(""),[b,j]=(0,i.useState)(!1),k=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];v(!1),e&&y("")},w=(0,i.useRef)(""),A=(0,i.useRef)(null);(0,i.useEffect)((()=>{w.current=x}),[x]),(0,i.useEffect)((()=>{h&&A.current&&requestAnimationFrame((()=>{const e=A.current;e.focus(),e.selectionStart=e.selectionEnd=e.value.length}))}),[h]),(0,i.useEffect)((()=>{if(h||b){const e=document.body.style.overflow;document.body.style.overflow="hidden";const t=e=>{"Escape"===e.key&&(h&&k(!0),b&&j(!1))};return window.addEventListener("keydown",t),()=>{document.body.style.overflow=e,window.removeEventListener("keydown",t)}}}),[h,b]);const S=e=>{let{children:t}=e;return(0,a.createPortal)(t,document.body)},[C,P]=(0,i.useState)(null),[M,R]=(0,i.useState)(!1);(0,i.useEffect)((()=>{if(!C)return;const e=setTimeout((()=>P(null)),5e3);return()=>clearTimeout(e)}),[C]);const q=!(null===n||void 0===n||!n.receivedDate),D=null!==n&&void 0!==n&&n.receivedDate?(e=>{if(!e)return"";const t=new Date(e);return t.toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"})+" "+t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})})(n.receivedDate):null,z=["Denied by Project Manager","Denied by Area Manager"].includes(null===n||void 0===n?void 0:n.status);let W=null;z&&(W=[...(null===n||void 0===n?void 0:n.approvals)||[]].reverse().find((e=>"denied"===e.decision)));let N="Approve";"Pending Project Manager"===p&&"PM"===u?N="Validate":"Pending Area Manager"===p&&"AM"===u&&(N="Approve");const I=(0,i.useMemo)((()=>m),[m]);let B="You are approving this request.";return"Pending Project Manager"===p&&"PM"===u?B="You are validating this request and sending it to the Area Manager.":"Pending Area Manager"===p&&"AM"===u&&(B="You are approving and completing this request."),(0,s.jsxs)(s.Fragment,{children:[z&&W&&(0,s.jsxs)("div",{style:{marginBottom:24},children:[(0,s.jsxs)("div",{style:{fontWeight:600,textAlign:"center",marginBottom:4},children:["Request Denied By: ",(e=>{if(!e)return"";let t="Project Manager"===e.role?"Project Manager":"Area Manager"===e.role?"Area Manager":e.role;return e.user&&"object"===typeof e.user&&e.user.name?"".concat(e.user.name," (").concat(t,")"):"".concat(t)})(W)]}),(0,s.jsxs)("div",{style:{background:"#faeaea",color:"#a12d2d",borderRadius:8,padding:"12px 16px",fontSize:15,maxWidth:800,margin:"0 auto",border:"1px solid #eedcdc",textAlign:"left"},children:[(0,s.jsx)("div",{style:{fontWeight:500,marginBottom:6},children:"Reason:"}),W.reason]})]}),C&&(0,s.jsx)("div",{style:{marginBottom:16,padding:"10px 14px",borderRadius:8,fontSize:13,background:"success"===C.type?"#ecfdf5":"#fef2f2",color:"success"===C.type?"#065f46":"#b91c1c",border:"1px solid ".concat("success"===C.type?"#a7f3d0":"#fecaca")},children:C.message}),q&&(0,s.jsxs)("div",{style:{margin:"40px 0 0",textAlign:"center",color:"#15a563",fontWeight:600},children:["This Request has been Closed and Items were Successfully Delivered On: ",D]}),(0,s.jsxs)("div",{className:"action-buttons unified",children:[(0,s.jsx)("button",{onClick:l,className:"back-btn",children:"Back"}),m&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>{m&&j(!0)},disabled:!I,className:"publish-button-picmatreq",style:{background:I?"#16a34a":"#9ca3af",minWidth:140,cursor:I?"pointer":"not-allowed"},children:N}),(0,s.jsx)("button",{onClick:()=>{v(!0),R(!1)},className:"cancel-btn",style:{marginLeft:"1rem",background:"#dc3545",color:"#fff",minWidth:120},children:"Deny"})]})]}),h&&(0,s.jsx)(S,{children:(0,s.jsx)("div",{role:"dialog","aria-modal":"true","aria-label":"Deny Request",style:{position:"fixed",inset:0,zIndex:2e3,background:"rgba(0,0,0,0.55)"},onClick:()=>!M&&k(!0),children:(0,s.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:"100%",maxWidth:840,padding:"0 24px"},children:(0,s.jsxs)("div",{style:{background:"#fff",width:"100%",borderRadius:14,padding:"30px 34px",boxShadow:"0 15px 40px -8px rgba(0,0,0,0.25)",animation:"fadeInScale .18s ease"},onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("h3",{style:{margin:"0 0 14px",fontSize:22},children:"Deny Request"}),(0,s.jsx)("p",{style:{margin:"0 0 18px",fontSize:14,color:"#475569"},children:"Please provide a reason for denial:"}),(0,s.jsx)("div",{style:{direction:"ltr"},children:(0,s.jsx)("textarea",{dir:"ltr",spellCheck:!0,value:x,onChange:e=>{const t=e.target.value,n=w.current;let i=t;if(t.length===n.length+1&&t.endsWith(n)){i=n+t.slice(0,t.length-n.length)}else if(t.length>n.length+1&&t.endsWith(n)){i=n+t.slice(0,t.length-n.length)}y(i),requestAnimationFrame((()=>{if(A.current){const e=A.current;e.selectionStart=e.selectionEnd=e.value.length}}))},rows:6,autoFocus:!0,disabled:M,style:{width:"100%",borderRadius:10,border:"1px solid #93c5fd",padding:"14px 16px",fontSize:14,background:M?"#f1f5f9":"#f8fafc",minHeight:170,resize:"vertical",direction:"ltr",textAlign:"left",whiteSpace:"pre-wrap",overflowWrap:"break-word",lineHeight:"1.45",fontFamily:"inherit",writingMode:"horizontal-tb",textIndent:0,caretColor:"#111827",unicodeBidi:"isolate",transform:"none"},autoComplete:"off",ref:A,placeholder:"Enter reason for denial"})}),(0,s.jsxs)("div",{style:{marginTop:20,display:"flex",justifyContent:"flex-end",gap:12},children:[(0,s.jsx)("button",{onClick:()=>k(!0),disabled:M,style:{padding:"11px 22px",background:"#e2e8f0",border:"none",borderRadius:9,fontWeight:500,cursor:M?"not-allowed":"pointer",opacity:M?.6:1},children:"Cancel"}),(0,s.jsx)("button",{onClick:async()=>{if(!x.trim())return void P({type:"error",message:"Reason is required."});const e=localStorage.getItem("token");if(e)try{R(!0),console.log("[DENY] submitting",{id:null===n||void 0===n?void 0:n._id,reason:x}),await r.Ay.post("/requests/".concat(n._id,"/approve"),{decision:"denied",reason:x},{headers:{Authorization:"Bearer ".concat(e)}}),P({type:"success",message:"Request denied."}),v(!1),y(""),c?c():l()}catch(a){var t,i;console.error(a),P({type:"error",message:(null===a||void 0===a||null===(t=a.response)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.message)||"Failed to deny request."})}finally{R(!1)}else P({type:"error",message:"Not authenticated."})},disabled:!x.trim()||M,style:{padding:"11px 24px",background:!x.trim()||M?"#fca5a5":"#dc2626",color:"#fff",border:"none",borderRadius:9,fontWeight:600,cursor:!x.trim()||M?"not-allowed":"pointer",opacity:M?.7:1},children:M?"Submitting...":"Submit"})]})]})})})}),b&&(0,s.jsx)(S,{children:(0,s.jsx)("div",{role:"dialog","aria-modal":"true","aria-label":"Approve Request",style:{position:"fixed",inset:0,zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.55)",padding:"24px"},onClick:()=>j(!1),children:(0,s.jsxs)("div",{style:{background:"#fff",borderRadius:14,padding:"30px 34px",width:"100%",maxWidth:640,boxShadow:"0 15px 40px -8px rgba(0,0,0,0.25)",animation:"fadeInScale .18s ease"},onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("h3",{style:{margin:"0 0 14px",fontSize:22,display:"flex",alignItems:"center",gap:10},children:[(0,s.jsx)("i",{className:"fas fa-check-circle",style:{color:"#16a34a"}})," Confirm ",N]}),(0,s.jsx)("p",{style:{margin:"0 0 18px",fontSize:14,color:"#475569"},children:B}),(0,s.jsxs)("div",{style:{marginTop:4,display:"flex",justifyContent:"flex-end",gap:12},children:[(0,s.jsx)("button",{onClick:()=>j(!1),style:{padding:"11px 22px",background:"#e2e8f0",border:"none",borderRadius:9,fontWeight:500,cursor:"pointer"},children:"Cancel"}),(0,s.jsx)("button",{onClick:()=>{j(!1),(async()=>{const e=localStorage.getItem("token"),t={decision:"approved"};try{await r.Ay.post("/requests/".concat(n._id,"/approve"),t,{headers:{Authorization:"Bearer ".concat(e)}}),P({type:"success",message:"Request approved."}),c?c():l()}catch(s){var i,a;P({type:"error",message:(null===s||void 0===s||null===(i=s.response)||void 0===i||null===(a=i.data)||void 0===a?void 0:a.message)||"Failed to approve request."})}})()},style:{padding:"11px 24px",background:"#16a34a",color:"#fff",border:"none",borderRadius:9,fontWeight:600,cursor:"pointer"},children:"Confirm"})]})]})})})]})}},4947:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});var i=n(5043),a=n(579);const r=[{label:"Placed",emoji:"\ud83d\udcdd",key:"placed"},{label:"Project Manager",emoji:"\ud83d\udc64",key:"project manager"},{label:"Area Manager",emoji:"\ud83c\udfe2",key:"area manager"},{label:"Received",emoji:"\u2705",key:"received"}];function s(e){if(!e)return"\u2014";try{const t=new Date(e);return t.toLocaleDateString()+", "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(t){return"\u2014"}}function o(e){let{request:t}=e;const n=function(e){if(!e)return r.map((()=>({status:"Pending",date:"\u2014",decision:"pending"})));const t=[];let n=!1;t.push({status:"Completed",date:s(e.createdAt),decision:"placed"});const i=(e.approvals||[]).find((e=>(e.role||"").toLowerCase().includes("project manager")));n?t.push({status:"\u2014",date:"\u2014",decision:"inactive"}):i?"approved"===i.decision?t.push({status:"Approved",date:s(i.timestamp),decision:"approved"}):"denied"===i.decision&&(n=!0,t.push({status:"Denied",date:s(i.timestamp),decision:"denied"})):t.push({status:"Pending",date:"\u2014",decision:"pending"});const a=(e.approvals||[]).find((e=>(e.role||"").toLowerCase().includes("area manager")));return n?t.push({status:"\u2014",date:"\u2014",decision:"inactive"}):a?"approved"===a.decision?t.push({status:"Approved",date:s(a.timestamp),decision:"approved"}):"denied"===a.decision&&(n=!0,t.push({status:"Denied",date:s(a.timestamp),decision:"denied"})):t.push({status:"Pending",date:"\u2014",decision:"pending"}),n?t.push({status:"\u2014",date:"\u2014",decision:"inactive"}):e.receivedByPIC?t.push({status:"Received",date:s(e.receivedDate),decision:"received"}):t.push({status:"Pending",date:"\u2014",decision:"pending"}),t}(t);return(0,a.jsx)("div",{className:"progress-tracker",children:r.map(((e,t)=>{const s=n[t];let o="step-circle";return"approved"===s.decision||"placed"===s.decision||"received"===s.decision?o+=" completed":"denied"===s.decision?o+=" denied":"inactive"===s.decision?o+=" inactive":"Pending"!==s.status||n.slice(t+1).some((e=>"Approved"===e.status))||(o+=" active"),(0,a.jsxs)(i.Fragment,{children:[(0,a.jsxs)("div",{className:"step-vertical",children:[(0,a.jsx)("div",{className:o,children:(0,a.jsx)("span",{style:{fontSize:18},children:e.emoji})}),(0,a.jsx)("div",{className:"step-label",children:e.label}),(0,a.jsx)("div",{className:"step-status step-status-".concat(s.decision),children:s.status}),(0,a.jsx)("div",{className:"step-date",children:s.date})]}),t<r.length-1&&(0,a.jsx)("div",{className:"step-line ".concat("approved"===s.decision||"placed"===s.decision||"received"===s.decision?"completed":"denied"===s.decision?"denied":"inactive"===s.decision?"inactive":"")})]},t)}))})}}}]);
//# sourceMappingURL=shared.2a6ac909.chunk.js.map
"use strict";(self.webpackChunkfadz_web_frontend=self.webpackChunkfadz_web_frontend||[]).push([[141],{1245:(e,t,s)=>{s.d(t,{A:()=>A});var n=s(9379),a=s(5043),i=s(8818),r=s(3216),o=s(5475),l=s(2104),c=s(4801),d=s(411),p=s(2063),u=s(6837),m=s(3204),h=(s(7508),s(579));function g(e){const t=(e||"").split("/").pop()||"",s=t.indexOf("_");if(-1!==s&&s<t.length-1)return t.slice(s+1);const n=t.match(/^project-\d{8,}-(.+)$/i);return n&&n[1]?n[1]:t}function f(e){var t;return{pdf:"PDF",doc:"DOC",docx:"DOCX",xls:"XLS",xlsx:"XLSX",ppt:"PPT",pptx:"PPTX",txt:"TXT",rtf:"RTF",csv:"CSV",jpg:"JPG",jpeg:"JPEG",png:"PNG",gif:"GIF",bmp:"BMP",svg:"SVG"}[null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase()]||"FILE"}async function x(e){try{const{data:t}=await d.Ay.get("/photo-signed-url?path=".concat(encodeURIComponent(e))),s=null===t||void 0===t?void 0:t.signedUrl;if(!s)throw 0;window.open(s,"_blank","noopener,noreferrer")}catch(t){alert("Failed to open attachment.")}}async function v(e,t){try{if(!e)throw new Error("Missing project id");const{data:s}=await d.Ay.get("/projects/".concat(encodeURIComponent(e),"/reports-signed-url"),{params:{path:t}}),n=null===s||void 0===s?void 0:s.signedUrl;if(!n)throw new Error("No signed url");window.open(n,"_blank","noopener,noreferrer")}catch(s){console.error("Failed to open report file",s),alert("Failed to open report file.")}}function j(e,t,s,a){const i={width:"100%",height:100,overflow:"hidden",borderRadius:8,position:"relative",display:"flex",alignItems:"center",justifyContent:"center",background:"#f1f5f9",boxShadow:"0 0 0 1px #e2e8f0 inset"};if(["JPG","JPEG","PNG","GIF","BMP","SVG"].includes(s))return a?(0,h.jsx)("div",{className:"file-thumbnail image-thumbnail",style:i,children:(0,h.jsx)("img",{src:a,alt:e,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}})}):(0,h.jsx)("div",{className:"file-thumbnail image-thumbnail",style:i,children:(0,h.jsx)("span",{style:{fontSize:34,lineHeight:1,color:"#94a3b8"},children:"\ud83d\uddbc\ufe0f"})});const r={PDF:["#ff6b6b","#ee5a52","\ud83d\udcc4"],DOC:["#4ecdc4","#44a08d","\ud83d\udcdd"],DOCX:["#4ecdc4","#44a08d","\ud83d\udcdd"],XLS:["#45b7d1","#96c93d","\ud83d\udcca"],XLSX:["#45b7d1","#96c93d","\ud83d\udcca"],PPT:["#f093fb","#f5576c","\ud83d\udcc8"],PPTX:["#f093fb","#f5576c","\ud83d\udcc8"],TXT:["#a8edea","#fed6e3","\ud83d\udcc4"],RTF:["#a8edea","#fed6e3","\ud83d\udcc4"],CSV:["#ffecd2","#fcb69f","\ud83d\udcca"],FILE:["#667eea","#764ba2","\ud83d\udcc1"]},o=r[s]||r.FILE;return(0,h.jsxs)("div",{className:"file-thumbnail document-thumbnail",style:(0,n.A)((0,n.A)({},i),{},{background:"linear-gradient(135deg,".concat(o[0],",").concat(o[1],")"),flexDirection:"column",color:"#fff"}),children:[(0,h.jsx)("span",{className:"thumbnail-icon",style:{fontSize:34,lineHeight:1},children:o[2]}),(0,h.jsx)("span",{className:"thumbnail-extension",style:{fontSize:11,marginTop:6,fontWeight:600,letterSpacing:.5},children:s})]})}function y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const s=(t||"").trim().toLowerCase().replace(/\s+/g,"");if(!s||!e)return e;const n=new RegExp("@".concat(s,"\\b"),"gi"),i=e.split(n);return 1===i.length?e:i.map(((e,s)=>0===s?e:(0,h.jsxs)(a.Fragment,{children:[(0,h.jsxs)("span",{style:{background:"#f6c343",color:"#3a2f00",padding:"2px 6px",borderRadius:4,fontWeight:"bold",fontSize:"0.9em"},children:["@",t]}),e]},s)))}function b(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=((arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")||"").trim().toLowerCase().replace(/\s+/g,"");return!(!t||!e)&&e.toLowerCase().replace(/\s+/g,"").includes("@".concat(t))}const N=new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}),w={container:{position:"relative",background:"#fffbe6",border:"1px solid #f6c343",boxShadow:"0 0 0 2px rgba(246,195,67,.25) inset",borderRadius:10},badge:{position:"absolute",top:6,right:6,fontSize:12,lineHeight:"16px",background:"#f6c343",color:"#3a2f00",borderRadius:999,padding:"2px 8px",fontWeight:700}},S={pic:{label:"Person in Charge",permissions:{image:!1,statusToggle:!1,uploadFiles:!0,deleteFiles:!0,postDiscuss:!0},base:"/pic"},pm:{label:"Project Manager",permissions:{image:!0,statusToggle:!0,uploadFiles:!0,deleteFiles:!0,postDiscuss:!0},base:"/pm"},am:{label:"Area Manager",permissions:{image:!0,statusToggle:!1,uploadFiles:!0,deleteFiles:!0,postDiscuss:!0},base:"/am"},ceo:{label:"CEO",permissions:{image:!1,statusToggle:!1,uploadFiles:!1,deleteFiles:!1,postDiscuss:!1},base:"/ceo"},hr:{label:"HR",permissions:{image:!1,statusToggle:!1,uploadFiles:!1,deleteFiles:!1,postDiscuss:!1},base:"/hr"},it:{label:"IT",permissions:{image:!1,statusToggle:!1,uploadFiles:!1,deleteFiles:!1,postDiscuss:!1},base:"/it"},staff:{label:"Staff",permissions:{image:!1,statusToggle:!1,uploadFiles:!1,deleteFiles:!1,postDiscuss:!0},base:"/staff"},hrsite:{label:"HR-Site",permissions:{image:!1,statusToggle:!1,uploadFiles:!1,deleteFiles:!1,postDiscuss:!0},base:"/hr-site"}};function A(e){var t,A,_,k,C,I,D,P;const{role:z="pm",navItems:T,permissionsOverride:R,navPathOverrides:F,useUnifiedHeader:M=!1}=e||{},B=!!M,{id:E}=(0,r.g)(),O=(0,r.Zp)(),L=(0,r.zy)(),W=localStorage.getItem("token"),U=S[z]||S.pm,G=(0,n.A)((0,n.A)({},U.permissions),R||{}),H=U.base,V={pic:"".concat(H,"/current-project").concat(E?"/".concat(E):""),pm:"".concat(H,"/viewprojects/").concat(E),am:"".concat(H,"/projects/").concat(E),ceo:"".concat(H,"/proj/").concat(E),hr:"".concat(H,"/project-records/").concat(E),it:"".concat(H,"/projects/").concat(E),staff:"".concat(H,"/current-project").concat(E?"/".concat(E):""),hrsite:"".concat(H,"/current-project").concat(E?"/".concat(E):"")},Y={pic:"".concat(H,"/progress-report/").concat(E),pm:"".concat(H,"/progress-report/").concat(E),am:"".concat(H,"/progress-report/").concat(E),ceo:"".concat(H,"/progress-report/").concat(E),hr:"".concat(H,"/progress-report/").concat(E),it:"".concat(H,"/progress-report/").concat(E),hrsite:"".concat(H,"/progress-report/").concat(E)},q={pic:"".concat(H,"/daily-logs-list"),pm:"".concat(H,"/daily-logs-list"),am:"".concat(H,"/daily-logs-list"),ceo:"".concat(H,"/daily-logs-list"),hr:"".concat(H,"/daily-logs-list"),it:"".concat(H,"/daily-logs-list"),hrsite:"".concat(H,"/daily-logs-list")},$=[{to:H,icon:(0,h.jsx)(m.$BV,{}),label:"Dashboard"},{to:"".concat(H,"/chat"),icon:(0,h.jsx)(m.uN,{}),label:"Chat"},{to:"".concat(H,"/request/:id"),icon:(0,h.jsx)(m.H5e,{}),label:"Material"},..."am"===z?[]:[{to:"".concat(H,"/manpower-list"),icon:(0,h.jsx)(m.YXz,{}),label:"Manpower"}],{to:V[z]||"".concat(H,"/viewprojects/").concat(E),icon:(0,h.jsx)(m.yd7,{}),label:"View Project",active:!0},{to:"".concat(H,"/budget/").concat(E),icon:(0,h.jsx)(m.MxO,{}),label:"Budget"},...B?[]:[{to:"".concat(H,"/daily-logs"),icon:(0,h.jsx)(m.kkc,{}),label:"Logs"},{to:Y[z]||"".concat(H,"/progress-report/").concat(E),icon:(0,h.jsx)(m.v$b,{}),label:"Reports"},{to:q[z]||"".concat(H,"/daily-logs-list"),icon:(0,h.jsx)(m.bfZ,{}),label:"Daily Logs"}]].map((e=>F&&F[e.label]?(0,n.A)((0,n.A)({},e),{},{to:F[e.label]}):e)),X=T||$,J=(0,a.useRef)(null);if(null===J.current)try{J.current=JSON.parse(localStorage.getItem("user"))}catch(Cs){J.current=null}const Z=J.current,K=(null===Z||void 0===Z?void 0:Z._id)||null,[Q]=(0,a.useState)((null===Z||void 0===Z?void 0:Z.name)||U.label.split(" ")[0]),[ee,te]=(0,a.useState)(!1),[se,ne]=(0,a.useState)(!1),[ae,ie]=(0,a.useState)(null),[re,oe]=(0,a.useState)("Details"),[le,ce]=(0,a.useState)(""),[de,pe]=(0,a.useState)(0),[ue,me]=(0,a.useState)(!0),[he,ge]=(0,a.useState)(null),[fe,xe]=(0,a.useState)([]),[ve,je]=(0,a.useState)(0),[ye,be]=(0,a.useState)(!1),[Ne,we]=(0,a.useState)(""),[Se,Ae]=(0,a.useState)({}),[_e,ke]=(0,a.useState)([]),[Ce,Ie]=(0,a.useState)(!1),[De,Pe]=(0,a.useState)(""),[ze,Te]=(0,a.useState)({}),[Re,Fe]=(0,a.useState)({}),[Me,Be]=(0,a.useState)(!1),[Ee,Oe]=(0,a.useState)([]),[Le,We]=(0,a.useState)(!1),[Ue,Ge]=(0,a.useState)(""),He=(0,a.useRef)(null),Ve=(0,a.useRef)(null),Ye=(0,a.useRef)(null),[qe,$e]=(0,a.useState)(!1),[Xe,Je]=(0,a.useState)(0),[Ze,Ke]=(0,a.useState)(""),[Qe,et]=(0,a.useState)(!1),[tt,st]=(0,a.useState)(0),[nt,at]=(0,a.useState)(""),[it,rt]=(0,a.useState)({open:!1,options:[],query:"",position:{top:0,left:0},activeInputId:null}),[ot,lt]=(0,a.useState)([]),[ct,dt]=(0,a.useState)({}),[pt,ut]=(0,a.useState)(""),[mt,ht]=(0,a.useState)([]),[gt,ft]=(0,a.useState)(!1),[xt,vt]=(0,a.useState)(0),[jt,yt]=(0,a.useState)(""),[bt,Nt]=(0,a.useState)([]),[wt,St]=(0,a.useState)(!1),[At,_t]=(0,a.useState)(""),[kt,Ct]=(0,a.useState)(null),[It,Dt]=(0,a.useState)(!1),[Pt,zt]=(0,a.useState)(!1),[Tt,Rt]=(0,a.useState)(!0),[Ft,Mt]=(0,a.useState)(null);(0,a.useEffect)((()=>{if(!Ft)return;const e=e=>{"Escape"===e.key&&Mt(null)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[Ft]);const[Bt,Et]=(0,a.useState)(!1),[Ot,Lt]=(0,a.useState)({}),[Wt,Ut]=(0,a.useState)(""),[Gt,Ht]=(0,a.useState)(!1),[Vt,Yt]=(0,a.useState)(!1),[qt,$t]=(0,a.useState)(null);(0,a.useEffect)((()=>{"Attendance"===re&&null!==ae&&void 0!==ae&&ae._id&&ds(ae._id)}),[re,null===ae||void 0===ae?void 0:ae._id,W]);const Xt=(0,a.useRef)(null),Jt=(0,a.useRef)(null);(0,a.useEffect)((()=>{const e=()=>ne((window.pageYOffset||document.documentElement.scrollTop)>50);return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[]),(0,a.useEffect)((()=>{let e=!1;return(async()=>{try{if(!E){if("staff"!==z&&"hrsite"!==z&&"pic"!==z||!K)ie(null);else try{const{data:t}=await d.Ay.get("/projects/assigned/allroles/".concat(K));if(e)return;const s=(Array.isArray(t)?t:[])[0];s?(ie(s),ce((null===s||void 0===s?void 0:s.status)||"")):ie(null)}catch(t){e||ie(null)}return}const{data:s}=await d.Ay.get("/projects/".concat(E));if(e)return;ie(s),ce((null===s||void 0===s?void 0:s.status)||"")}catch(s){e||ie(null)}finally{e||me(!1)}})(),()=>{e=!0}}),[E,z,K]),(0,a.useEffect)((()=>{if(null!==ae&&void 0!==ae&&ae.purchaseOrders){const e=Array.isArray(ae.purchaseOrders)?ae.purchaseOrders.slice():[];xe(e),je(e.reduce(((e,t)=>e+(Number(t.amount)||0)),0))}}),[null===ae||void 0===ae?void 0:ae.purchaseOrders]),(0,a.useEffect)((()=>{if(null===ae||void 0===ae||!ae._id||"Discussions"!==re&&"Reports"!==re)return;const e=new AbortController;return Ie(!0),d.Ay.get("/projects/".concat(ae._id,"/discussions"),{headers:{Authorization:"Bearer ".concat(W)},signal:e.signal}).then((e=>{const t=Array.isArray(e.data)?[...e.data].sort(((e,t)=>new Date(e.timestamp||0)-new Date(t.timestamp||0))):[];ke(t)})).catch((()=>ke([]))).finally((()=>Ie(!1))),()=>e.abort()}),[null===ae||void 0===ae?void 0:ae._id,re,W]),(0,a.useEffect)((()=>{_e.length&&Te((e=>{const t=(0,n.A)({},e);let s=!1;return _e.forEach((e=>{(Array.isArray(e.replies)?e.replies.length:0)>=3&&"undefined"===typeof t[e._id]&&(t[e._id]=!0,s=!0)})),s?t:e}))}),[_e]);const Zt=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null===ae||void 0===ae?void 0:ae._id;if(e)try{const{data:t}=await d.Ay.get("/projects/".concat(e,"/reports"),{headers:{Authorization:"Bearer ".concat(W)}}),s=(null===t||void 0===t?void 0:t.reports)||[];if(ht(s),!s.length)return void console.info("[ProjectView] No reports for project",e,"role",z);const n=[...s].sort(((e,t)=>new Date(t.uploadedAt||0)-new Date(e.uploadedAt||0))),a=new Map;for(const e of n){const t=e.uploadedBy||e.uploadedByName||e._id;a.has(t)||a.set(t,e)}const i=[...a.values()];let r=i.map((e=>{var t,s;const n=(null===e||void 0===e?void 0:e.ai)||{},a=Number(n.pic_contribution_percent_raw),i=Number(n.pic_contribution_percent);if(isFinite(a)&&a>=0)return a;if(isFinite(i)&&i>=0)return i;const r=(null===(t=n.completed_tasks)||void 0===t?void 0:t.length)||0,o=r+((null===(s=n.summary_of_work_done)||void 0===s?void 0:s.length)||0);return o>0?r/o*100:0})).filter((e=>isFinite(e)&&e>=0));if(r.length){const e=(Array.isArray(null===ae||void 0===ae?void 0:ae.pic)?ae.pic:[]).length||i.length,t=r.reduce(((e,t)=>e+t),0),s=e>0?t/e:0,n=Number(Math.min(100,Math.max(0,s)).toFixed(1));console.debug("[ProjectView] Progress calculation",{totalAssigned:e,reportedPICs:i.length,sumContrib:Number(t.toFixed(2)),headcountAvgRaw:s,headcountClamped:n}),pe(n);const a=i.map((e=>{const t=e.ai||{},s=Number(t.pic_contribution_percent_raw),n=Number(t.pic_contribution_percent),a=isFinite(s)&&s>=0?s:isFinite(n)&&n>=0?n:0;return{picId:e.uploadedBy||e._id,picName:e.uploadedByName||"Unknown",contribution:Math.round(a),hasReport:!0,lastReportDate:e.uploadedAt||null,fallbackUsed:!!t.meta_fallback_used,duplicate:!!t.meta_duplicate_previous}}));ge({averageContribution:n,picContributions:a,totalPics:e,reportingPics:i.length,pendingPics:Math.max(e-i.length,0)})}else{const e=Array.isArray(null===ae||void 0===ae?void 0:ae.pic)?ae.pic:[];e.length&&(pe(0),ge({averageContribution:0,picContributions:[],totalPics:e.length,reportingPics:0,pendingPics:e.length}))}}catch(t){console.error("[ProjectView] fetchReports failed",t),ht([])}},Kt=a.useMemo((()=>{if(!ae)return!1;const e=Array.isArray(ae.documents)?ae.documents.length:0,t=Array.isArray(mt)?mt.length:0;return e>0&&t>0}),[ae,mt]),Qt=a.useMemo((()=>{if(!he||!he.picContributions)return!1;const e=(Array.isArray(null===ae||void 0===ae?void 0:ae.pic)?ae.pic:[]).length||he.totalPics||0;if(0===e)return!1;const t=he.picContributions;return!(t.length<e)&&t.every((e=>e&&e.hasReport&&Number(e.contribution)>=100))}),[he,null===ae||void 0===ae?void 0:ae.pic]),es=async function(){if(null!==ae&&void 0!==ae&&ae._id){Et(!0);try{var e;const t=(null===(e=(await d.Ay.patch("/projects/".concat(ae._id,"/toggle-status"))).data)||void 0===e?void 0:e.status)||le;if(ce(t),Dt(!1),"Completed"===t&&"pm"===z)try{localStorage.setItem("activeProjectInvalidated","1"),window.dispatchEvent(new Event("storage"))}catch(n){}}catch(a){var t,s;let e="Failed to update project status.";"PRECONDITION_FAILED"===(null===a||void 0===a||null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)&&(e=a.response.data.message),alert(e)}finally{Et(!1)}}};(0,a.useEffect)((()=>{null!==ae&&void 0!==ae&&ae._id&&Zt(ae._id)}),[null===ae||void 0===ae?void 0:ae._id]),(0,a.useEffect)((()=>{"Reports"===re&&null!==ae&&void 0!==ae&&ae._id&&0===mt.length&&Zt(ae._id)}),[re,null===ae||void 0===ae?void 0:ae._id]),(0,a.useEffect)((()=>{if(null===ae||void 0===ae||!ae._id)return;const e=setInterval((()=>Zt(ae._id)),12e4);return()=>clearInterval(e)}),[null===ae||void 0===ae?void 0:ae._id]),(0,a.useEffect)((()=>{"Discussions"===re&&requestAnimationFrame((()=>{Ve.current?Ve.current.scrollIntoView():He.current&&(He.current.scrollTop=He.current.scrollHeight)}))}),[_e,re]),(0,a.useEffect)((()=>{if(null===ae||void 0===ae||!ae._id)return;let e=!1;return(async()=>{try{const t=[];if(ae.documents&&t.push(...ae.documents),_e&&_e.forEach((e=>{var s;e.attachments&&t.push(...e.attachments),null===(s=e.replies)||void 0===s||s.forEach((e=>e.attachments&&t.push(...e.attachments)))})),t.length){const s=await async function(e){const t=e.filter((e=>{const t="string"===typeof e?g(e):e.name||g(e.path);return["JPG","JPEG","PNG","GIF","BMP","SVG"].includes(f(t))})),s={};for(const a of t){const e="string"===typeof a?a:a.path;try{const{data:t}=await d.Ay.get("/photo-signed-url?path=".concat(encodeURIComponent(e)));null!==t&&void 0!==t&&t.signedUrl&&(s[e]=t.signedUrl)}catch(n){}}return s}(t);e||dt((e=>(0,n.A)((0,n.A)({},e),s)))}}catch(t){}})(),()=>{e=!0}}),[null===ae||void 0===ae?void 0:ae.documents,_e]),(0,a.useEffect)((()=>{if(null===ae||void 0===ae||!ae._id)return;let e=!1;return(async()=>{try{const t=await d.Ay.get("/projects/".concat(ae._id,"/users"));e||lt(t.data||[])}catch(t){e||lt([])}})(),()=>{e=!0}}),[null===ae||void 0===ae?void 0:ae._id]),(0,a.useEffect)((()=>{const e=e=>{e.target.closest(".user-profile")||te(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[]),(0,a.useEffect)((()=>{if("Discussions"!==re&&"Reports"!==re||null===ae||void 0===ae||!ae._id){if(Xt.current){try{Xt.current.emit("leaveProject",Jt.current)}catch(i){}try{Xt.current.disconnect()}catch(r){}Xt.current=null,Jt.current=null}return}if(Xt.current){if(Jt.current===ae._id)return;try{Xt.current.emit("leaveProject",Jt.current)}catch(o){}Jt.current=null}const e=(0,l.io)(p.G,{path:p.c,transports:["websocket"],auth:{userId:K}});Xt.current=e,Jt.current=ae._id,e.emit("joinProject",ae._id);const t=e=>{if(String(e.projectId)===String(ae._id)&&e.message){const t=String(e.message._id);ke((s=>s.some((e=>String(e._id)===t))?s:[...s,e.message].sort(((e,t)=>new Date(e.timestamp)-new Date(t.timestamp)))))}},s=e=>{String(e.projectId)===String(ae._id)&&e.msgId&&e.reply&&ke((t=>t.map((t=>{if(String(t._id)!==e.msgId)return t;return t.replies.some((t=>String(t._id)===String(e.reply._id)))?t:(0,n.A)((0,n.A)({},t),{},{replies:[...t.replies,e.reply]})}))))},a=e=>{try{window.dispatchEvent(new CustomEvent("projectReportsUpdated",{detail:{projectId:null===e||void 0===e?void 0:e.projectId}}))}catch(t){}String(e.projectId)===String(ae._id)&&Zt(ae._id)};return e.on("project:newDiscussion",t),e.on("project:newReply",s),e.on("project:reportsUpdated",a),()=>{try{e.off("project:newDiscussion",t),e.off("project:newReply",s),e.off("project:reportsUpdated",a),e.emit("leaveProject",Jt.current),e.disconnect()}catch(n){}Xt.current=null,Jt.current=null}}),[null===ae||void 0===ae?void 0:ae._id,re,K]);const ts=async()=>{if(G.postDiscuss&&(De.trim()||0!==Ee.length)&&!Me&&null!==ae&&void 0!==ae&&ae._id)try{Be(!0);const e=new FormData;De.trim()&&e.append("text",De.trim()),Ue&&e.append("label",Ue),Ee.forEach((t=>e.append("files",t)));const t=(await d.Ay.post("/projects/".concat(ae._id,"/discussions"),e,{headers:{Authorization:"Bearer ".concat(W)}})).data;ke((e=>e.some((e=>String(e._id)===String(t._id)))?e:[...e,t].sort(((e,t)=>new Date(e.timestamp)-new Date(t.timestamp))))),Pe(""),Oe([]),Ge("")}catch(e){}finally{Be(!1)}},ss=async e=>{if(!G.postDiscuss)return;const t=(Re[e]||"").trim();if(t&&!Me&&null!==ae&&void 0!==ae&&ae._id){Be(!0);try{const s=new FormData;s.append("text",t);const a=(await d.Ay.post("/projects/".concat(ae._id,"/discussions/").concat(e,"/reply"),s,{headers:{Authorization:"Bearer ".concat(W)}})).data;ke((t=>t.map((t=>String(t._id)!==e||t.replies.some((e=>String(e._id)===String(a._id)))?t:(0,n.A)((0,n.A)({},t),{},{replies:[...t.replies,a]}))))),Fe((t=>(0,n.A)((0,n.A)({},t),{},{[e]:""})))}catch(s){}finally{Be(!1)}}},ns=e=>{G.postDiscuss&&null!==e&&void 0!==e&&e.length&&Oe((t=>[...t,...Array.from(e)]))},as="pic"===z||"pm"===z,is=e=>{if("pm"===z)return!0;if("pic"===z){var t;const s=(null===e||void 0===e||null===(t=e.uploadedBy)||void 0===t?void 0:t._id)||(null===e||void 0===e?void 0:e.uploadedBy);return s&&String(s)===String(K)}return!1},rs=!(!L.state||!L.state.justCreated),[os,ls]=(0,a.useState)(rs);(0,a.useEffect)((()=>{if(rs){const e=setTimeout((()=>ls(!1)),6e3);return()=>clearTimeout(e)}}),[rs]);const cs=e=>{var t,s,n;if(null!==e&&void 0!==e&&e.uploadedByName&&"string"===typeof e.uploadedByName&&e.uploadedByName.trim())return e.uploadedByName.trim();if(null!==e&&void 0!==e&&e.uploaderName)return e.uploaderName;if(null!==e&&void 0!==e&&e.generatedByName)return e.generatedByName;const a=e=>{if(!e||"object"!==typeof e)return null;for(const t of["name","fullName","displayName","username"])if("string"===typeof e[t]&&e[t].trim())return e[t].trim();return"string"===typeof e.email&&e.email?e.email.split("@")[0]:null},i=a(null===e||void 0===e?void 0:e.uploadedBy)||a(null===e||void 0===e?void 0:e.uploader)||a(null===e||void 0===e?void 0:e.user);if(i)return i;const r=(null===e||void 0===e?void 0:e.generatedBy)||(null===e||void 0===e||null===(t=e.uploadedBy)||void 0===t?void 0:t._id)||(null===e||void 0===e||null===(s=e.uploader)||void 0===s?void 0:s._id)||(null===e||void 0===e||null===(n=e.user)||void 0===n?void 0:n._id)||(null===e||void 0===e?void 0:e.uploadedById)||(null===e||void 0===e?void 0:e.uploaderId)||(null===e||void 0===e?void 0:e.userId)||(null===e||void 0===e?void 0:e.uploadedBy)||(null===e||void 0===e?void 0:e.uploader);if(r){const e=ot.find((e=>String(e._id)===String(r)||String(e.id)===String(r)));if(null!==e&&void 0!==e&&e.name)return e.name;if(null!==e&&void 0!==e&&e.fullName)return e.fullName;if(null!==e&&void 0!==e&&e.displayName)return e.displayName;if(Z&&String(Z._id)===String(r)&&Z.name)return Z.name;const t=String(r).slice(-6);return t?"User \u2022\u2022\u2022".concat(t):"Unknown"}return"Unknown"},ds=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null===ae||void 0===ae?void 0:ae._id;if(e)try{const{data:t}=await d.Ay.get("/projects/".concat(e,"/attendance"),{headers:{Authorization:"Bearer ".concat(W)}}),s=(null===t||void 0===t?void 0:t.reports)||[];Nt(s);const n=s[s.length-1];Ct((null===n||void 0===n?void 0:n.ai)||(null===n||void 0===n?void 0:n.ai_summary)||(null===n||void 0===n?void 0:n.summary)||null)}catch(t){Nt([]),Ct(null)}},ps="pm-view-root staff-view-root ".concat("staff"===z?"is-staff":""," ").concat("ceo"===z?"ceo-view-root":""),us=function(e){if(!e)return"N/A";const t=void 0!==e.contractor&&null!==e.contractor?e.contractor:e.contractorName;if(!t)return"N/A";if("string"===typeof t)return t.trim()||"N/A";if(Array.isArray(t)){const e=t.map((e=>"string"===typeof e?e:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.company)||(null===e||void 0===e?void 0:e.companyName)||(null===e||void 0===e?void 0:e.title)||(null===e||void 0===e?void 0:e.fullName)||"")).map((e=>(e||"").trim())).filter(Boolean);if(e.length)return e.join(", ")}if("object"===typeof t)for(const s of["name","company","companyName","title","fullName"])if("string"===typeof t[s]&&t[s].trim())return t[s].trim();return"N/A"}(ae),ms="Sub Contractor"===(null===ae||void 0===ae?void 0:ae.contractorType)?"Sub Contractor":"Contractor",hs=(null===ae||void 0===ae?void 0:ae.budgetDocument)||null,gs=a.useMemo((()=>null!==ae&&void 0!==ae&&ae.documents?hs?ae.documents.filter((e=>!!e&&("string"===typeof e?e!==hs.path:e.path!==hs.path))):ae.documents:[]),[null===ae||void 0===ae?void 0:ae.documents,hs]);if(ue)return(0,h.jsx)("div",{className:"dashboard-container ".concat(ps),children:(0,h.jsx)("div",{className:"professional-loading-screen",children:(0,h.jsxs)("div",{className:"loading-content",children:[(0,h.jsx)("div",{className:"loading-logo",children:(0,h.jsx)("img",{src:s(8370),alt:"FadzTrack Logo",className:"loading-logo-img"})}),(0,h.jsx)("div",{className:"loading-spinner-container",children:(0,h.jsx)("div",{className:"loading-spinner"})}),(0,h.jsxs)("div",{className:"loading-text",children:[(0,h.jsx)("h2",{className:"loading-title",children:"Loading Project Details"}),(0,h.jsx)("p",{className:"loading-subtitle",children:"Fetching project information..."})]}),(0,h.jsx)("div",{className:"loading-progress",children:(0,h.jsx)("div",{className:"progress-bar",children:(0,h.jsx)("div",{className:"progress-fill"})})})]})})});const fs=!ae;if(fs&&!["staff","hrsite"].includes(z))return(0,h.jsx)("div",{className:"dashboard-container ".concat(ps),children:(0,h.jsx)("div",{className:"professional-loading-screen",children:(0,h.jsxs)("div",{className:"loading-content",children:[(0,h.jsx)("div",{className:"loading-logo",children:(0,h.jsx)("img",{src:s(8370),alt:"FadzTrack Logo",className:"loading-logo-img"})}),(0,h.jsxs)("div",{className:"loading-text",children:[(0,h.jsx)("h2",{className:"loading-title",style:{color:"#ef4444"},children:"Project Not Found"}),(0,h.jsx)("p",{className:"loading-subtitle",children:"Project missing or access denied."})]}),(0,h.jsx)("div",{style:{marginTop:"2rem"},children:(0,h.jsx)("button",{onClick:()=>O(H),style:{background:"linear-gradient(135deg,#3b82f6,#1d4ed8)",color:"#fff",border:"none",padding:"12px 24px",borderRadius:8,fontSize:"1rem",fontWeight:600,cursor:"pointer"},children:"Return to Dashboard"})})]})})});const xs=null!==ae&&void 0!==ae&&ae.startDate?new Date(ae.startDate).toLocaleDateString():"N/A",vs=null!==ae&&void 0!==ae&&ae.endDate?new Date(ae.endDate).toLocaleDateString():"N/A";let js="N/A";if(null!==ae&&void 0!==ae&&ae.location){const e=ae.location;"string"===typeof e?js=e:e.name?js=e.name+(e.region?" (".concat(e.region,")"):""):e.title&&(js=e.title)}const ys=Array.isArray(null===ae||void 0===ae?void 0:ae.manpower)&&ae.manpower.length>0?ae.manpower.map((e=>[null===e||void 0===e?void 0:e.name,null===e||void 0===e?void 0:e.position].filter(Boolean).join(" (")+(null!==e&&void 0!==e&&e.position?")":""))).join(", "):"No Manpower Assigned",bs=Number((null===ae||void 0===ae?void 0:ae.budget)||0),Ns=Math.max(bs-Number(ve||0),0),ws=e=>Array.isArray(e)&&e.length?e.map((e=>{if(e&&"object"===typeof e&&e.name)return e.name;const t="string"===typeof e?e:(null===e||void 0===e?void 0:e._id)||"",s=ot.find((e=>String(e._id)===String(t)));return(null===s||void 0===s?void 0:s.name)||null})).filter(Boolean):[],Ss=ws(null===ae||void 0===ae?void 0:ae.hrsite),As=ws(null===ae||void 0===ae?void 0:ae.staff),_s={Important:{bg:"linear-gradient(90deg,#dc2626,#f87171)",fg:"#fff"},Announcement:{bg:"linear-gradient(90deg,#6366f1,#8b5cf6)",fg:"#fff"},Update:{bg:"linear-gradient(90deg,#0d9488,#14b8a6)",fg:"#fff"},Reminder:{bg:"linear-gradient(90deg,#eab308,#f59e0b)",fg:"#3a2f00"},Urgent:{bg:"linear-gradient(90deg,#b91c1c,#ef4444)",fg:"#fff"}};function ks(e){if(!e)return null;const t=_s[e]||{bg:"#334155",fg:"#fff"};return(0,h.jsx)("span",{className:"discussion-label-badge",style:{background:t.bg,color:t.fg,padding:"2px 8px",borderRadius:8,fontSize:11,marginLeft:8,fontWeight:600,letterSpacing:.5,display:"inline-flex",alignItems:"center",gap:4},children:e})}return(0,h.jsxs)("div",{className:"dashboard-container ".concat(ps),children:[B&&!(null!==(t=document.body.dataset)&&void 0!==t&&t.appHeaderMounted)&&(0,h.jsx)(i.A,{roleSegment:z}),!B&&(0,h.jsxs)("header",{className:"dashboard-header ".concat(se?"collapsed":""),children:[(0,h.jsxs)("div",{className:"header-top",children:[(0,h.jsxs)("div",{className:"logo-section",children:[(0,h.jsx)("img",{src:s(8370),alt:"FadzTrack Logo",className:"header-logo"}),(0,h.jsx)("h1",{className:"header-brand",children:"FadzTrack"})]}),(0,h.jsxs)("div",{className:"user-profile",onClick:()=>te((e=>!e)),children:[(0,h.jsx)("div",{className:"profile-avatar",children:Q?Q.charAt(0).toUpperCase():"U"}),(0,h.jsxs)("div",{className:"profile-info",children:[(0,h.jsx)("span",{className:"profile-name",children:Q}),(0,h.jsx)("span",{className:"profile-role",children:U.label})]}),ee&&(0,h.jsx)("div",{className:"profile-menu",children:(0,h.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),O(H)},children:"Logout"})})]})]}),(0,h.jsxs)("div",{className:"header-bottom",children:[(0,h.jsx)("nav",{className:"header-nav",children:X.map((e=>(0,h.jsxs)(o.N_,{to:e.to,className:"nav-item ".concat(e.active?"active":""),children:[e.icon,(0,h.jsx)("span",{className:se?"hidden":"",children:e.label})]},e.to)))}),(0,h.jsx)(c.A,{})]})]}),Ft&&(0,h.jsxs)("div",{onClick:()=>Mt(null),style:{position:"fixed",inset:0,background:"rgba(15,23,42,.85)",zIndex:1e3,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20},children:[(0,h.jsxs)("div",{style:{maxWidth:"90%",maxHeight:"80%",position:"relative"},children:[(0,h.jsx)("img",{src:Ft.src,alt:Ft.name,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",borderRadius:12,boxShadow:"0 10px 28px -4px rgba(0,0,0,.6)"}}),(0,h.jsx)("div",{style:{marginTop:12,textAlign:"center",color:"#f1f5f9",fontSize:14},children:Ft.name}),(0,h.jsx)("button",{onClick:e=>{e.stopPropagation(),Mt(null)},style:{position:"absolute",top:8,right:8,background:"rgba(0,0,0,.55)",color:"#fff",border:"none",borderRadius:8,padding:"6px 10px",cursor:"pointer"},children:"Close"})]}),(0,h.jsx)("div",{style:{marginTop:16,color:"#94a3b8",fontSize:12},children:"Click anywhere or press ESC to close"})]}),(0,h.jsxs)("main",{className:"dashboard-main",children:[os&&(0,h.jsxs)("div",{role:"status","aria-live":"polite",className:"project-flash-banner",style:{background:"linear-gradient(90deg,#15803d,#16a34a)",color:"#fff",padding:"12px 20px",borderRadius:"10px",fontSize:"0.95rem",fontWeight:500,display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px",boxShadow:"0 4px 12px -2px rgba(16,185,129,0.35)",margin:"0 24px 18px"},children:[(0,h.jsxs)("span",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,h.jsx)("span",{style:{fontSize:"1.2rem"},children:"\u2705"}),(0,h.jsxs)("span",{children:["Project ",(0,h.jsx)("strong",{children:L.state&&L.state.projectName||ae&&ae.projectName})," created. Team notified."]})]}),(0,h.jsx)("button",{onClick:()=>ls(!1),style:{background:"rgba(255,255,255,0.15)",border:"none",color:"#fff",padding:"4px 10px",borderRadius:6,cursor:"pointer",fontSize:"0.75rem",letterSpacing:".5px"},children:"DISMISS"})]}),(0,h.jsxs)("div",{className:"project-view-container",children:[(0,h.jsxs)("div",{className:"project-header",children:[(0,h.jsxs)("div",{className:"project-image-section",children:[(0,h.jsx)("img",{src:(null===ae||void 0===ae||null===(A=ae.photos)||void 0===A?void 0:A[0])||"https://placehold.co/1200x400?text=No+Active+Project",alt:(null===ae||void 0===ae?void 0:ae.projectName)||"No Active Project",className:"project-hero-image"}),G.image&&(0,h.jsxs)("div",{className:"image-upload-overlay",children:[(0,h.jsx)("input",{type:"file",id:"project-image-upload",accept:"image/*",style:{display:"none"},onChange:async e=>{const t=e.target.files[0];if(t)if(t.type.startsWith("image/"))if(t.size>5242880)alert("Image must be <5MB");else try{et(!0),st(0),at("");const e=new FormData;e.append("photo",t);const s=await d.Ay.post("/projects/".concat(ae._id,"/photo"),e,{onUploadProgress:e=>st(Math.round(100*e.loaded/e.total))});ie((e=>(0,n.A)((0,n.A)({},e),{},{photos:[s.data.photoUrl,...(e.photos||[]).slice(1)]})))}catch(s){at("Upload failed")}finally{et(!1),st(0),e.target.value=""}else alert("Select an image")}}),(0,h.jsxs)("label",{htmlFor:"project-image-upload",className:"change-image-btn",children:[(0,h.jsx)(m.p5B,{}),(0,h.jsx)("span",{children:"Change Image"})]}),Qe&&(0,h.jsxs)("div",{className:"image-upload-progress",children:[(0,h.jsx)("div",{className:"progress-bar",children:(0,h.jsx)("div",{className:"progress-fill",style:{width:"".concat(tt,"%")}})}),(0,h.jsxs)("p",{className:"progress-text",children:["Uploading... ",tt,"%"]})]}),nt&&(0,h.jsx)("div",{className:"image-upload-error",children:(0,h.jsx)("p",{children:nt})})]}),G.statusToggle&&(0,h.jsxs)(h.Fragment,{children:["Completed"===le?(0,h.jsx)("button",{onClick:()=>es(),disabled:Bt,className:"status-toggle-btn completed",children:Bt?"Updating...":"Mark as Ongoing"}):(0,h.jsx)("button",{onClick:()=>Dt(!0),disabled:Bt||!Kt,className:"status-toggle-btn ".concat(Qt?"success fast-complete-btn":"ongoing"),title:Qt?"All PIC reports at 100% - click to confirm completion":"Click to confirm project completion",style:Qt?{background:"#16a34a",borderColor:"#15803d"}:void 0,children:Bt?"Updating...":Qt?"Mark as Completed (All 100%)":"Mark as Completed"}),It&&"Completed"!==le&&(0,h.jsx)("div",{className:"modal-overlay",children:(0,h.jsxs)("div",{className:"modal small",children:[(0,h.jsx)("h3",{children:"Confirm Project Completion"}),Kt&&(0,h.jsxs)("div",{style:{marginBottom:"1rem"},children:[de<80&&(0,h.jsxs)("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"12px",marginBottom:"12px"},children:[(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[(0,h.jsx)("span",{style:{fontSize:"20px"},children:"\u26a0\ufe0f"}),(0,h.jsx)("strong",{style:{color:"#dc2626"},children:"High Risk Warning"})]}),(0,h.jsxs)("p",{style:{color:"#dc2626",margin:0,fontSize:"14px"},children:["Project progress is only ",(0,h.jsxs)("strong",{children:[de,"%"]}),". Completing now may result in incomplete deliverables and unsatisfied stakeholders."]})]}),de>=80&&de<90&&(0,h.jsxs)("div",{style:{backgroundColor:"#fffbeb",border:"1px solid #fed7aa",borderRadius:"8px",padding:"12px",marginBottom:"12px"},children:[(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[(0,h.jsx)("span",{style:{fontSize:"20px"},children:"\u26a0\ufe0f"}),(0,h.jsx)("strong",{style:{color:"#ea580c"},children:"Moderate Warning"})]}),(0,h.jsxs)("p",{style:{color:"#ea580c",margin:0,fontSize:"14px"},children:["Project progress is ",(0,h.jsxs)("strong",{children:[de,"%"]}),". Consider completing remaining tasks before marking as complete."]})]}),de>=90&&de<100&&(0,h.jsxs)("div",{style:{backgroundColor:"#f0f9ff",border:"1px solid #93c5fd",borderRadius:"8px",padding:"12px",marginBottom:"12px"},children:[(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[(0,h.jsx)("span",{style:{fontSize:"20px"},children:"\u2139\ufe0f"}),(0,h.jsx)("strong",{style:{color:"#2563eb"},children:"Minor Notice"})]}),(0,h.jsxs)("p",{style:{color:"#2563eb",margin:0,fontSize:"14px"},children:["Project progress is ",(0,h.jsxs)("strong",{children:[de,"%"]}),". Almost complete - ensure all final deliverables are ready."]})]}),de>=100&&(0,h.jsxs)("div",{style:{backgroundColor:"#f0fdf4",border:"1px solid #86efac",borderRadius:"8px",padding:"12px",marginBottom:"12px"},children:[(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[(0,h.jsx)("span",{style:{fontSize:"20px"},children:"\u2705"}),(0,h.jsx)("strong",{style:{color:"#16a34a"},children:"Ready for Completion"})]}),(0,h.jsxs)("p",{style:{color:"#16a34a",margin:0,fontSize:"14px"},children:["Project progress is ",(0,h.jsxs)("strong",{children:[de,"%"]}),". All tasks appear to be completed."]})]})]}),!Kt&&(0,h.jsxs)("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"12px",marginBottom:"12px"},children:[(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[(0,h.jsx)("span",{style:{fontSize:"20px"},children:"\ud83d\udeab"}),(0,h.jsx)("strong",{style:{color:"#dc2626"},children:"Preconditions Not Met"})]}),(0,h.jsx)("p",{style:{color:"#dc2626",margin:0,fontSize:"14px"},children:"At least one file and one report are required to complete this project."})]}),(0,h.jsxs)("p",{style:{marginBottom:"1rem",fontSize:"14px",lineHeight:"1.5"},children:["Mark this project as ",(0,h.jsx)("strong",{children:"Completed"}),"? All members (PM, PIC, Staff, HR-Site) will become available for new assignments."]}),(0,h.jsxs)("div",{className:"modal-actions",style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[(0,h.jsx)("button",{className:"btn",onClick:()=>Dt(!1),children:"Cancel"}),(0,h.jsx)("button",{className:"btn primary",disabled:Bt||!Kt,onClick:()=>es(!0),style:{backgroundColor:de<80?"#dc2626":de<90?"#ea580c":de<100?"#2563eb":"#16a34a"},children:Bt?"Completing...":"Yes, Complete Project"})]})]})})]})]}),(0,h.jsxs)("div",{className:"project-title-section",children:[(0,h.jsx)("h1",{className:"project-title",children:fs?"No Active Project Assigned":ae.projectName}),(0,h.jsx)("div",{className:"project-status-badge",children:!fs&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("span",{className:"status-indicator ".concat("Completed"===le?"completed":"ongoing"),children:"Completed"===le?(0,h.jsx)(m.A7C,{}):(0,h.jsx)(m.w_X,{})}),(0,h.jsx)("span",{className:"status-text",children:le||(null===ae||void 0===ae?void 0:ae.status)||"N/A"})]})})]})]}),(0,h.jsxs)("div",{className:"project-tabs",children:[(0,h.jsxs)("button",{className:"project-tab ".concat("Details"===re?"active":""),onClick:()=>oe("Details"),children:[(0,h.jsx)(m.$NR,{}),(0,h.jsx)("span",{children:"Project Details"})]}),["pic","pm","am","ceo"].includes(z)&&(0,h.jsxs)("button",{className:"project-tab ".concat("Budget"===re?"active":""),onClick:()=>oe("Budget"),children:[(0,h.jsx)(m.MxO,{}),(0,h.jsx)("span",{children:"Budget"})]}),(0,h.jsxs)("button",{className:"project-tab ".concat("Discussions"===re?"active":""),onClick:()=>oe("Discussions"),children:[(0,h.jsx)(m.Nhu,{}),(0,h.jsx)("span",{children:"Discussions"})]}),(0,h.jsxs)("button",{className:"project-tab ".concat("Files"===re?"active":""),onClick:()=>oe("Files"),children:[(0,h.jsx)(m.FrV,{}),(0,h.jsx)("span",{children:"Files"})]}),(0,h.jsxs)("button",{className:"project-tab ".concat("Reports"===re?"active":""),onClick:()=>oe("Reports"),children:[(0,h.jsx)(m.FrV,{}),(0,h.jsx)("span",{children:"Reports"})]}),["it","am","pm","ceo","hr","hrsite"].includes(z)&&(0,h.jsxs)("button",{className:"project-tab ".concat("Attendance"===re?"active":""),onClick:()=>oe("Attendance"),children:[(0,h.jsx)(m.FrV,{}),(0,h.jsx)("span",{children:"Attendance"})]})]}),fs&&(0,h.jsxs)("div",{style:{padding:"24px 28px",background:"#fff1f2",border:"1px solid #fecdd3",borderRadius:16,margin:"24px 24px 0"},children:[(0,h.jsx)("h2",{style:{marginTop:0,marginBottom:8,color:"#be123c"},children:"No Project Assigned"}),(0,h.jsx)("p",{style:{margin:0,color:"#9f1239",fontSize:14,lineHeight:1.5},children:"You currently have no active project. You can still access other areas using the navigation above (Chat, Dashboard, etc.). Once a project is assigned to you it will appear here automatically."})]}),(0,h.jsxs)("div",{className:"tab-content",children:["Details"===re&&(0,h.jsxs)("div",{className:"project-details-content",children:[(0,h.jsx)("div",{className:"action-buttons",children:(0,h.jsxs)("button",{onClick:()=>{const e=JSON.parse(localStorage.getItem("user")||"{}"),t=(new Date).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0});(0,u.K)(ae,{contextTitle:"Project Details \u2014 ".concat(U.label),exportedBy:(null===e||void 0===e?void 0:e.name)||"Unknown User",exportDate:t})},className:"export-btn",children:[(0,h.jsx)(m.WCW,{}),(0,h.jsx)("span",{children:"Export Project Details"})]})}),(0,h.jsxs)("div",{className:"overview-grid",children:[(0,h.jsxs)("div",{className:"overview-card budget-card",children:[(0,h.jsx)("div",{className:"card-icon",children:(0,h.jsx)(m.MxO,{})}),(0,h.jsx)("h3",{className:"card-title",children:"Budget"}),(0,h.jsx)("div",{className:"budget-amount",children:N.format(bs||0)}),ve>0&&(0,h.jsxs)("div",{className:"remaining-budget",style:{marginTop:6,fontSize:12},children:["Remaining: ",N.format(Ns)," (POs: ",N.format(ve),")"]})]}),(0,h.jsxs)("div",{className:"overview-card timeline-card",children:[(0,h.jsx)("div",{className:"card-icon",children:(0,h.jsx)(m.bfZ,{})}),(0,h.jsx)("h3",{className:"card-title",children:"Timeline"}),(0,h.jsxs)("div",{className:"timeline-dates",children:[(0,h.jsxs)("div",{className:"date-item",children:[(0,h.jsx)("span",{className:"date-label",children:"Start:"}),(0,h.jsx)("span",{className:"date-value",children:xs})]}),(0,h.jsxs)("div",{className:"date-item",children:[(0,h.jsx)("span",{className:"date-label",children:"End:"}),(0,h.jsx)("span",{className:"date-value",children:vs})]})]})]}),(0,h.jsxs)("div",{className:"overview-card location-card",children:[(0,h.jsx)("div",{className:"card-icon",children:(0,h.jsx)(m.vq8,{})}),(0,h.jsx)("h3",{className:"card-title",children:"Location"}),(0,h.jsx)("div",{className:"location-value",children:js})]}),(0,h.jsxs)("div",{className:"overview-card contractor-card",children:[(0,h.jsx)("div",{className:"card-icon",children:(0,h.jsx)(m.ymh,{})}),(0,h.jsx)("h3",{className:"card-title",children:ms}),(0,h.jsx)("div",{className:"contractor-value",children:us})]})]}),(0,h.jsxs)("div",{className:"progress-section",children:[(0,h.jsxs)("h2",{className:"section-title",style:{display:"flex",alignItems:"center",gap:10},children:["Project Progress"," ",de>=100&&(0,h.jsx)("span",{style:{background:"linear-gradient(90deg,#16a34a,#4ade80)",color:"#fff",padding:"4px 10px",fontSize:12,borderRadius:20},children:"COMPLETED"})]}),(0,h.jsxs)("div",{className:"progress-grid",style:{display:"grid",gap:18,gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))"},children:[(0,h.jsxs)("div",{className:"progress-card overall-progress",style:{background:"#0f172a",color:"#f1f5f9",borderRadius:18,padding:20,position:"relative"},children:[(0,h.jsx)("div",{style:{position:"absolute",inset:0,background:"radial-gradient(circle at 30% 20%, rgba(59,130,246,.25), transparent 70%)"}}),(0,h.jsxs)("div",{style:{position:"relative",display:"flex",flexDirection:"column",gap:10},children:[(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,h.jsx)("h3",{style:{margin:0,fontSize:16,fontWeight:600},children:"Overall Progress"}),(0,h.jsx)(m.v$b,{style:{opacity:.7}})]}),(0,h.jsxs)("div",{style:{fontSize:38,fontWeight:700,background:"linear-gradient(90deg,#3b82f6,#06b6d4)",WebkitBackgroundClip:"text",color:"transparent"},children:[he?Math.round(he.averageContribution):Math.round(de),"%"]}),(0,h.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:6,width:"100%",alignSelf:"stretch"},children:[(0,h.jsx)("div",{style:{height:14,background:"#1e293b",borderRadius:10,position:"relative",width:"100%",minWidth:"100%"},"aria-label":"Overall progress ".concat(he?Math.round(he.averageContribution):Math.round(de),"%"),role:"progressbar","aria-valuenow":he?Math.round(he.averageContribution):Math.round(de),"aria-valuemin":0,"aria-valuemax":100,children:(0,h.jsx)("div",{style:{position:"absolute",inset:0,background:"linear-gradient(90deg,#3b82f6,#6366f1,#8b5cf6)",width:"".concat(he?Math.round(he.averageContribution):Math.round(de),"%"),borderRadius:10,transition:"width .5s ease"}})}),he&&(0,h.jsxs)("div",{style:{marginTop:4,display:"flex",flexDirection:"column",gap:8,width:"100%"},children:[(0,h.jsx)("small",{style:{opacity:.8},children:"Average across all PICs (missing reports = 0%)"}),(0,h.jsx)("div",{style:{display:"flex",gap:6,width:"100%"},children:Array.from({length:he.totalPics}).map(((e,t)=>(0,h.jsx)("div",{style:{flex:1,height:6,background:t<he.reportingPics?"linear-gradient(90deg,#10b981,#4ade80)":"#334155",borderRadius:4}},t)))}),(0,h.jsxs)("div",{style:{fontSize:12,opacity:.7},children:[he.reportingPics,"/",he.totalPics," submitted"]})]})]})," "]})," "]})," ",(he||(null===ae||void 0===ae?void 0:ae.pic)&&ae.pic.length>0)&&(0,h.jsxs)("div",{className:"progress-card pic-contributions",style:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:18,padding:20,display:"flex",flexDirection:"column",gap:16,minWidth:0},children:[(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,h.jsxs)("h3",{style:{margin:0,fontSize:16,fontWeight:600,color:"#0f172a",display:"flex",alignItems:"center",gap:8},children:["PiC Contributions",he&&(0,h.jsxs)("span",{style:{background:"#0f172a",color:"#fff",fontSize:11,padding:"4px 10px",borderRadius:20,letterSpacing:.5,fontWeight:600},children:["Avg ",Math.round(he.averageContribution),"%"]})]}),(0,h.jsx)(m.YXz,{style:{color:"#475569"}})]}),he&&he.totalPics>8&&(0,h.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,h.jsx)("input",{type:"text",placeholder:"Search PIC name...",value:Wt,onChange:e=>Ut(e.target.value),style:{flex:"1 1 200px",minWidth:140,background:"#f1f5f9",border:"1px solid #e2e8f0",borderRadius:8,padding:"8px 10px",fontSize:12}}),(0,h.jsx)("button",{type:"button",onClick:()=>Ht((e=>!e)),style:{background:"#0f172a",color:"#fff",border:"none",padding:"8px 14px",borderRadius:8,fontSize:12,fontWeight:600,cursor:"pointer"},children:Gt?"Show Less":"Show All"})]}),!he&&(0,h.jsx)("div",{style:{fontSize:12,background:"#f1f5f9",padding:"8px 10px",borderRadius:8,color:"#475569"},children:"No contribution data yet."}),he&&(()=>{const e=Array.isArray(null===ae||void 0===ae?void 0:ae.pic)?ae.pic:[],t=new Map;he.picContributions.forEach((e=>t.set(String(e.picId),e)));const s=e.map((e=>{const s=String((null===e||void 0===e?void 0:e._id)||e.id||e);return t.get(s)||{picId:s,picName:(null===e||void 0===e?void 0:e.name)||"Unresolved",contribution:0,hasReport:!1}}));he.picContributions.forEach((e=>{s.some((t=>String(t.picId)===String(e.picId)))||s.push(e)}));const n=Wt.trim().toLowerCase(),a=n?s.filter((e=>(e.picName||"").toLowerCase().includes(n))):s;a.sort(((e,t)=>{if(e.hasReport!==t.hasReport)return e.hasReport?-1:1;const s=(Number(t.contribution)||0)-(Number(e.contribution)||0);return 0!==s?s:(e.picName||"").localeCompare(t.picName||"")}));const i=Gt?a.length:12,r=a.slice(0,i);return(0,h.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10,minWidth:0},children:[(0,h.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(180px,1fr))",gap:10},children:r.map(((e,t)=>{const s=Math.round(e.contribution||0);return(0,h.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:6,background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:12,padding:"10px 12px",minWidth:0},children:[(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0},children:[(0,h.jsx)("div",{style:{width:34,height:34,borderRadius:10,background:"#0f172a",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:600,flexShrink:0},children:(e.picName||"?").charAt(0).toUpperCase()}),(0,h.jsxs)("div",{style:{display:"flex",flexDirection:"column",minWidth:0},children:[(0,h.jsx)("span",{style:{fontSize:12,fontWeight:600,color:"#0f172a",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},title:e.picName,children:e.picName}),(0,h.jsx)("span",{style:{fontSize:10,color:e.hasReport?"#10b981":"#64748b",fontWeight:500},children:e.hasReport?"Reported":"No report"})]}),(0,h.jsxs)("div",{style:{marginLeft:"auto",fontSize:12,fontWeight:700,color:"#0f172a"},children:[s,"%"]})]}),(0,h.jsx)("div",{style:{height:6,background:"#e2e8f0",borderRadius:4,overflow:"hidden",position:"relative"},children:(0,h.jsx)("div",{style:{position:"absolute",inset:0,width:"".concat(Math.min(100,Math.max(0,s)),"%"),background:s>=100?"linear-gradient(90deg,#16a34a,#4ade80)":"linear-gradient(90deg,#3b82f6,#6366f1)",transition:"width .5s",borderRadius:4}})})]},t)}))}),a.length>r.length&&(0,h.jsxs)("button",{type:"button",onClick:()=>Ht(!0),style:{background:"#fff",border:"1px solid #e2e8f0",padding:"8px 12px",borderRadius:8,fontSize:12,fontWeight:600,cursor:"pointer",alignSelf:"center"},children:["Show ",a.length-r.length," more"]}),Gt&&a.length>12&&(0,h.jsx)("button",{type:"button",onClick:()=>Ht(!1),style:{background:"#fff",border:"1px solid #e2e8f0",padding:"6px 10px",borderRadius:8,fontSize:11,fontWeight:600,cursor:"pointer",alignSelf:"center"},children:"Collapse"}),(0,h.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:"#475569",marginTop:4},children:[(0,h.jsx)("span",{style:{fontWeight:600},children:"Reported"}),(0,h.jsxs)("span",{style:{fontWeight:600},children:[he.reportingPics,"/",he.totalPics]})]})]})})()]})]}),he&&he.picContributions.length>0&&(0,h.jsxs)("div",{className:"individual-contributions",style:{marginTop:24},children:[(0,h.jsx)("h3",{className:"subsection-title",style:{fontSize:16,fontWeight:600,margin:"0 0 12px"},children:"Individual PiC Contributions"}),(0,h.jsx)("div",{className:"pic-list",style:{display:"grid",gap:10,gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))"},children:he.picContributions.map(((e,t)=>(0,h.jsxs)("div",{className:"pic-item ".concat(e.hasReport?"":"no-report"),style:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:14,padding:14},children:[(0,h.jsx)("div",{style:{fontWeight:600},children:e.picName}),e.lastReportDate&&(0,h.jsxs)("span",{style:{fontSize:11,color:"#64748b"},children:["Last: ",new Date(e.lastReportDate).toLocaleDateString()]}),(0,h.jsx)("div",{style:{marginTop:8},children:e.hasReport?(0,h.jsxs)("span",{style:{display:"inline-block",background:"linear-gradient(90deg,#3b82f6,#6366f1)",color:"#fff",fontSize:13,padding:"4px 10px",borderRadius:8,fontWeight:600},children:[e.contribution,"%"]}):(0,h.jsx)("span",{style:{display:"inline-block",background:"#f1f5f9",color:"#475569",fontSize:12,padding:"4px 10px",borderRadius:8},children:"No report"})})]},t)))})]})]}),(0,h.jsxs)("div",{className:"team-section",children:[(0,h.jsx)("h2",{className:"section-title",children:"Project Team"}),(0,h.jsxs)("div",{className:"team-grid",children:[(0,h.jsxs)("div",{className:"team-member",children:[(0,h.jsx)("div",{className:"member-avatar",children:(0,h.jsx)(m.p7b,{})}),(0,h.jsxs)("div",{className:"member-info",children:[(0,h.jsx)("h4",{className:"member-role",children:"Project Manager"}),(0,h.jsx)("p",{className:"member-name",children:(null===ae||void 0===ae||null===(_=ae.projectmanager)||void 0===_?void 0:_.name)||"N/A"})]})]}),(0,h.jsxs)("div",{className:"team-member",children:[(0,h.jsx)("div",{className:"member-avatar",children:(0,h.jsx)(m.YXz,{})}),(0,h.jsxs)("div",{className:"member-info",children:[(0,h.jsx)("h4",{className:"member-role",children:"Person in Charge"}),(0,h.jsx)("p",{className:"member-name",children:Array.isArray(null===ae||void 0===ae?void 0:ae.pic)&&ae.pic.length?ae.pic.map((e=>null===e||void 0===e?void 0:e.name)).filter(Boolean).join(", "):"N/A"})]})]}),(0,h.jsxs)("div",{className:"team-member",children:[(0,h.jsx)("div",{className:"member-avatar",children:(0,h.jsx)(m.YXz,{})}),(0,h.jsxs)("div",{className:"member-info",children:[(0,h.jsx)("h4",{className:"member-role",children:"HR Site"}),(0,h.jsx)("p",{className:"member-name",children:Ss.length?Ss.join(", "):Array.isArray(null===ae||void 0===ae?void 0:ae.hrsite)&&ae.hrsite.length?"".concat(ae.hrsite.length," assigned"):"hrsite"===z?Q||"You":"N/A"})]})]}),(0,h.jsxs)("div",{className:"team-member",children:[(0,h.jsx)("div",{className:"member-avatar",children:(0,h.jsx)(m.YXz,{})}),(0,h.jsxs)("div",{className:"member-info",children:[(0,h.jsx)("h4",{className:"member-role",children:"Staff"}),(0,h.jsx)("p",{className:"member-name",children:As.length?As.join(", "):Array.isArray(null===ae||void 0===ae?void 0:ae.staff)&&ae.staff.length?"".concat(ae.staff.length," assigned"):"staff"===z?Q||"You":"N/A"})]})]})]})]}),(0,h.jsxs)("div",{className:"manpower-section",children:[(0,h.jsx)("h2",{className:"section-title",children:"Assigned Manpower"}),(0,h.jsx)("div",{className:"manpower-content",children:(0,h.jsx)("p",{className:"manpower-text",children:ys})})]}),fe.length>0&&(0,h.jsxs)("div",{className:"purchase-orders-section",children:[(0,h.jsx)("h2",{className:"section-title",children:"Purchase Orders"}),(0,h.jsx)("div",{className:"po-list",children:fe.map((e=>(0,h.jsxs)("div",{className:"po-item",children:[(0,h.jsxs)("span",{className:"po-number",children:["PO#: ",e.purchaseOrder]}),(0,h.jsx)("span",{className:"po-amount",children:N.format(Number(e.totalValue))})]},e._id)))})]})]}),"Budget"===re&&["pic","pm","am","ceo"].includes(z)&&(0,h.jsxs)("div",{className:"budget-tab",style:{textAlign:"left"},children:[(0,h.jsxs)("h2",{style:{margin:"0 0 16px",display:"flex",alignItems:"center",gap:10},children:[(0,h.jsx)(m.MxO,{})," Project Budget"]}),(0,h.jsxs)("div",{style:{display:"grid",gap:20,gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))"},children:[(0,h.jsxs)("div",{style:{background:"#ffffff",border:"1px solid #e2e8f0",borderRadius:16,padding:20,position:"relative"},children:[(0,h.jsx)("h3",{style:{marginTop:0,marginBottom:6,fontSize:16},children:"Total Budget"}),(0,h.jsx)("div",{style:{fontSize:30,fontWeight:700,color:"#0f172a"},children:N.format(bs||0)}),ve>0&&(0,h.jsxs)("div",{style:{marginTop:8,fontSize:13,color:"#475569"},children:["Remaining: ",(0,h.jsx)("b",{children:N.format(Math.max(bs-Number(ve||0),0))}),(0,h.jsxs)("span",{style:{color:"#64748b"},children:[" (POs: ",N.format(ve),")"]})]}),(null===ae||void 0===ae?void 0:ae.parsedBudgetTotals)&&Number((null===ae||void 0===ae||null===(k=ae.parsedBudgetTotals)||void 0===k?void 0:k.totalAll)||0)>0&&(0,h.jsx)("div",{style:{marginTop:18,paddingTop:14,borderTop:"1px solid #e2e8f0"},children:(()=>{const e=Number(ae.parsedBudgetTotals.totalAll||0),t=Number(bs||0)+e,s=Array.isArray(ae.parsedBudgetTotals.sections)?ae.parsedBudgetTotals.sections:[],n=Array.isArray(ae.parsedBudgetTotals.greenItems)?ae.parsedBudgetTotals.greenItems:[],a=[...s.map((e=>({code:e.letter?e.letter+".":"",title:e.title||"",amount:e.amount}))),...n.map((e=>({code:e.code||"",title:e.title||"",amount:e.amount})))];return(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,fontSize:13},children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("span",{style:{color:"#64748b"},children:"Original:"})," ",(0,h.jsx)("b",{children:N.format(t)})]}),(0,h.jsxs)("div",{style:{textAlign:"right"},children:[(0,h.jsx)("span",{style:{color:"#64748b"},children:"Total Deduction:"})," ",(0,h.jsxs)("b",{style:{color:"#b91c1c"},children:["-",N.format(e)]})]})]}),(0,h.jsxs)("div",{style:{marginTop:16},children:[(0,h.jsxs)("button",{type:"button",onClick:()=>Rt((e=>!e)),style:{width:"100%",background:"#f1f5f9",border:"1px solid #e2e8f0",borderRadius:8,padding:"10px 14px",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",fontSize:13,fontWeight:600,color:"#334155"},children:[(0,h.jsx)("span",{children:"Budget Breakdown"}),(0,h.jsxs)("span",{style:{display:"flex",alignItems:"center",gap:10},children:[(0,h.jsx)("span",{style:{fontSize:11,color:"#64748b",fontWeight:500},children:N.format(e)}),(0,h.jsx)("span",{style:{transition:"transform .25s",transform:Tt?"rotate(90deg)":"rotate(0deg)"},children:"\u25b8"})]})]}),Tt&&(0,h.jsx)("div",{style:{marginTop:8,maxHeight:260,overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:8},children:(0,h.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{style:{background:"#f8fafc"},children:[(0,h.jsx)("th",{style:{textAlign:"left",padding:"8px 10px",borderBottom:"1px solid #e2e8f0"},children:"Item"}),(0,h.jsx)("th",{style:{textAlign:"right",padding:"8px 10px",borderBottom:"1px solid #e2e8f0"},children:"Amount"})]})}),(0,h.jsx)("tbody",{children:a.map(((e,t)=>(0,h.jsxs)("tr",{children:[(0,h.jsx)("td",{style:{padding:"6px 10px",borderBottom:"1px solid #eef2f7"},children:e.title}),(0,h.jsx)("td",{style:{padding:"6px 10px",borderBottom:"1px solid #eef2f7",textAlign:"right"},children:N.format(Number(e.amount||0))})]},t)))}),(0,h.jsx)("tfoot",{children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("td",{style:{padding:"8px 10px",textAlign:"right",fontWeight:700},children:"Total"}),(0,h.jsx)("td",{style:{padding:"8px 10px",textAlign:"right",fontWeight:700},children:N.format(e)})]})})]})})]})]})})()})]}),hs&&(0,h.jsxs)("div",{style:{background:"#ffffff",border:"1px solid #e2e8f0",borderRadius:16,padding:20,display:"flex",flexDirection:"column",gap:10,position:"relative"},children:[(0,h.jsxs)("h3",{style:{margin:"0 0 4px",fontSize:16,display:"flex",alignItems:"center",gap:8},children:["Budget PDF",(null===ae||void 0===ae?void 0:ae.parsedBudgetTotals)&&!1===ae.parsedBudgetTotals.autoDeductEligible&&(0,h.jsx)("span",{title:"Parsed but not auto-deducted (low confidence)",style:{background:"#f59e0b",color:"#3a2f00",fontSize:11,padding:"3px 8px",borderRadius:20,fontWeight:700,letterSpacing:.5},children:"NOT DEDUCTED"})]}),(0,h.jsx)("div",{style:{fontSize:13,color:"#475569",fontWeight:600},children:hs.name||(null===(C=hs.path)||void 0===C?void 0:C.split("/").pop())}),(0,h.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,h.jsx)("button",{type:"button",onClick:()=>x(hs.path),style:{background:"#0b5fff",color:"#fff",border:"none",padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,cursor:"pointer"},children:"Open"}),(0,h.jsx)("button",{type:"button",onClick:()=>x(hs.path),style:{background:"#0f172a",color:"#fff",border:"none",padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600,cursor:"pointer"},children:"Download"})]}),(hs.uploadedByName||hs.uploadedAt)&&(0,h.jsxs)("div",{style:{fontSize:11,color:"#64748b"},children:[hs.uploadedByName&&(0,h.jsxs)("span",{children:["Uploaded by ",(0,h.jsx)("b",{children:hs.uploadedByName})]}),hs.uploadedAt&&(0,h.jsxs)("span",{style:{marginLeft:6},children:["on ",new Date(hs.uploadedAt).toLocaleDateString()]})]}),(null===ae||void 0===ae||null===(I=ae.parsedBudgetTotals)||void 0===I?void 0:I.confidenceSummary)&&(0,h.jsx)("div",{style:{marginTop:4,fontSize:12,color:"#64748b"},children:ae.parsedBudgetTotals.confidenceSummary}),(()=>{if(null===ae||void 0===ae||!ae.parsedBudgetTotals)return null;const e=Number(ae.parsedBudgetTotals.totalAll||0),t=Number(bs||0)+e||0;if(!t)return null;const s=t-Number(bs||0),n=Math.min(100,Math.max(0,s/t*100));return(0,h.jsxs)("div",{style:{marginTop:10},children:[(0,h.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:"#475569",marginBottom:4},children:[(0,h.jsxs)("span",{children:["Spent: ",N.format(s)]}),(0,h.jsxs)("span",{children:[n.toFixed(1),"%"]})]}),(0,h.jsx)("div",{style:{height:8,background:"#e2e8f0",borderRadius:6,overflow:"hidden",position:"relative"},children:(0,h.jsx)("div",{style:{width:"".concat(n,"%"),height:"100%",background:"linear-gradient(90deg,#0b5fff,#38bdf8)"}})})]})})()]}),(0,h.jsxs)("div",{style:{background:"#ffffff",border:"1px solid #e2e8f0",borderRadius:16,padding:20,display:"flex",flexDirection:"column",gap:16},children:[(0,h.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,h.jsx)("h3",{style:{margin:0,fontSize:16},children:"Purchase Orders"}),"am"===z&&(0,h.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),null===ae||void 0===ae||!ae._id)return;const t=e.currentTarget,s=Array.from(t.poFiles.files||[]);if(s.length){we(""),be(!0);try{const e=new FormData;s.forEach((t=>e.append("poFiles",t)));const{data:a}=await d.Ay.post("/projects/".concat(ae._id,"/purchase-orders/files"),e);null!==a&&void 0!==a&&a.purchaseOrders&&(xe(a.purchaseOrders),je(a.purchaseOrders.reduce(((e,t)=>e+(Number(t.amount)||0)),0))),"undefined"!==typeof(null===a||void 0===a?void 0:a.budget)&&ie((e=>(0,n.A)((0,n.A)({},e),{},{budget:a.budget,purchaseOrders:a.purchaseOrders}))),t.reset()}catch(r){var a,i;we((null===r||void 0===r||null===(a=r.response)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.message)||"Upload failed")}finally{be(!1)}}else we("Select at least one file")},style:{display:"flex",gap:8,alignItems:"center"},children:[(0,h.jsx)("input",{name:"poFiles",type:"file",multiple:!0,accept:"application/pdf,image/*",style:{fontSize:12}}),(0,h.jsx)("button",{disabled:ye,style:{background:"#0f172a",color:"#fff",border:"none",padding:"8px 12px",borderRadius:8,fontSize:13,fontWeight:600,cursor:ye?"not-allowed":"pointer",opacity:ye?.6:1},children:ye?"Uploading...":"Upload Document/s"})]})]}),Ne&&(0,h.jsx)("div",{style:{color:"#b91c1c",fontSize:12},children:Ne}),0===fe.length?(0,h.jsx)("div",{style:{fontSize:13,color:"#64748b"},children:"No purchase orders yet."}):(0,h.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8,maxHeight:260,overflowY:"auto"},children:[fe.map(((e,t)=>{var s;return(0,h.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:6,padding:"8px 10px",border:"1px solid #e2e8f0",borderRadius:8,fontSize:13,background:"#f8fafc"},children:(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,h.jsx)("button",{onClick:()=>e.path&&x(e.path),style:{background:"transparent",border:"none",color:"#2563eb",cursor:e.path?"pointer":"not-allowed",textAlign:"left",flex:1,fontSize:13,padding:0},title:e.path?"View PO file":"No file path",disabled:!e.path,children:e.name||(null===(s=e.path)||void 0===s?void 0:s.split("/").pop())||"PO File"}),e.amount?(0,h.jsx)("span",{style:{fontWeight:600,whiteSpace:"nowrap"},children:N.format(Number(e.amount)||0)}):"am"===z?(0,h.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),null===ae||void 0===ae||!ae._id)return;const s=(e=>{if(!e)return 0;const t=parseFloat(e.replace(/,/g,""));return isFinite(t)?t:0})(Se[e._id]||"");if(!s)return void alert("Enter valid amount");if(s>Number(ae.budget||0))alert("Amount exceeds remaining budget");else try{const{data:t}=await d.Ay.patch("/projects/".concat(ae._id,"/purchase-orders/").concat(e._id,"/amount"),{amount:s});null!==t&&void 0!==t&&t.purchaseOrders&&(xe(t.purchaseOrders),je(t.purchaseOrders.reduce(((e,t)=>e+(Number(t.amount)||0)),0))),"undefined"!==typeof(null===t||void 0===t?void 0:t.budget)&&ie((e=>(0,n.A)((0,n.A)({},e),{},{budget:t.budget,purchaseOrders:t.purchaseOrders}))),Ae((t=>(0,n.A)((0,n.A)({},t),{},{[e._id]:""})))}catch(r){var a,i;alert((null===r||void 0===r||null===(a=r.response)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.message)||"Set amount failed")}},style:{display:"flex",alignItems:"center",gap:6},children:[(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",background:"#fff",border:"1px solid #cbd5e1",borderRadius:6,padding:"2px 6px"},children:[(0,h.jsx)("span",{style:{fontSize:12,color:"#64748b",marginRight:4},children:"\u20b1"}),(0,h.jsx)("input",{name:"amount",type:"text",inputMode:"decimal",value:Se[e._id]||"",onChange:t=>{const s=(e=>{if(!e)return"";const t=e.replace(/[^0-9.]/g,"");if(!t)return"";const s=t.split("."),n=s[0].replace(/^0+(\d)/,"$1").replace(/\B(?=(\d{3})+(?!\d))/g,","),a=s[1]?s[1].slice(0,2):"";return a?"".concat(n,".").concat(a):n})(t.target.value);Ae((t=>(0,n.A)((0,n.A)({},t),{},{[e._id]:s})))},placeholder:"0.00",style:{width:90,padding:"2px 0",border:"none",outline:"none",fontSize:12,background:"transparent"}})]}),(0,h.jsx)("button",{style:{background:"#0f172a",color:"#fff",border:"none",padding:"6px 10px",borderRadius:6,fontSize:12,fontWeight:600,cursor:"pointer"},children:"Set"})]}):(0,h.jsx)("span",{style:{color:"#64748b",fontStyle:"italic"},children:"Pending total"}),"am"===z&&(0,h.jsx)("button",{onClick:async()=>{if(window.confirm("Delete this PO?"))try{const{data:t}=await d.Ay.delete("/projects/".concat(ae._id,"/purchase-orders/").concat(e._id));null!==t&&void 0!==t&&t.purchaseOrders&&(xe(t.purchaseOrders),je(t.purchaseOrders.reduce(((e,t)=>e+(Number(t.amount)||0)),0))),"undefined"!==typeof(null===t||void 0===t?void 0:t.budget)&&ie((e=>(0,n.A)((0,n.A)({},e),{},{budget:t.budget,purchaseOrders:t.purchaseOrders})))}catch(a){var t,s;alert((null===a||void 0===a||null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Delete failed")}},style:{background:"#fee2e2",color:"#b91c1c",border:"1px solid #fca5a5",padding:"6px 10px",borderRadius:6,fontSize:12,cursor:"pointer"},children:"Delete"})]})},e._id||t)})),(0,h.jsxs)("div",{style:{marginTop:4,textAlign:"right",fontSize:13},children:[(0,h.jsx)("b",{children:"Total Deducted:"})," ",N.format(ve)]})]})]})]})]}),"Discussions"===re&&(0,h.jsxs)("div",{className:"discussions-container",style:{minHeight:"120vh",maxHeight:"calc(200vh - 300px)",display:"flex",flexDirection:"column"},children:[(0,h.jsx)("div",{className:"messages-list",ref:He,style:{flex:"1 1 auto",overflowY:"auto",paddingBottom:16},children:Ce?(0,h.jsxs)("div",{className:"loading-messages",children:[(0,h.jsx)("div",{className:"loading-spinner"}),(0,h.jsx)("span",{children:"Loading discussions..."})]}):0===_e.length?(0,h.jsxs)("div",{className:"empty-discussions",children:[(0,h.jsx)(m.Nhu,{}),(0,h.jsx)("h3",{children:"No discussions yet"}),(0,h.jsx)("p",{children:"Start a conversation about this project."})]}):_e.map((e=>{var t,s;const a=b(e.text,Q);return(0,h.jsxs)("div",{className:"message-item",style:(0,n.A)({},a?w.container:{}),children:[a&&(0,h.jsx)("div",{style:w.badge,children:"MENTIONED"}),(0,h.jsxs)("div",{className:"message-header",children:[(0,h.jsx)("div",{className:"message-avatar",children:(null===(t=e.userName)||void 0===t||null===(s=t.charAt(0))||void 0===s?void 0:s.toUpperCase())||"?"}),(0,h.jsxs)("div",{className:"message-info",children:[(0,h.jsx)("span",{className:"message-author",children:e.userName||"Unknown"}),(0,h.jsx)("span",{className:"message-time",children:e.timestamp?new Date(e.timestamp).toLocaleString():""})]}),ks(e.label)]}),(0,h.jsxs)("div",{className:"message-content",children:[e.text&&(0,h.jsx)("p",{className:"message-text",children:y(e.text,Q)}),Array.isArray(e.attachments)&&e.attachments.length>0&&(0,h.jsx)("div",{className:"message-attachments",children:(0,h.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:16},children:e.attachments.map(((e,t)=>{const s=e.name||g(e.path),n=f(s),a=["JPG","JPEG","PNG","GIF","BMP","SVG"].includes(n);return(0,h.jsxs)("div",{className:"attachment-item",style:{width:160,background:"#ffffff",border:"1px solid #e2e8f0",borderRadius:12,padding:8,boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,h.jsx)("div",{className:"attachment-thumbnail",style:{cursor:a?"zoom-in":"pointer"},onClick:t=>{t.preventDefault(),a?Mt({src:ct[e.path]||e.path,name:s}):x(e.path)},children:j(s,e.path,n,ct[e.path])}),(0,h.jsxs)("div",{className:"attachment-info",style:{marginTop:8,minHeight:42,width:"100%",textAlign:"center",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,h.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),x(e.path)},className:"attachment-name",title:s,style:{display:"-webkit-box",fontSize:12,overflow:"hidden",textOverflow:"ellipsis",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"1.2em",wordBreak:"break-word",overflowWrap:"anywhere",width:"100%"},children:s}),(0,h.jsx)("span",{className:"attachment-type",style:{fontSize:10,background:"#f1f5f9",padding:"2px 6px",borderRadius:6,display:"inline-block",marginTop:4,alignSelf:"center"},children:n})]})]},t)}))})})]}),Array.isArray(e.replies)&&e.replies.length>0&&(0,h.jsxs)("div",{className:"replies-container",children:[(()=>{const t=e.replies.length;return(ze[e._id]&&t>=3?e.replies.slice(0,2):e.replies).map((e=>{var t,s;const n=b(e.text,Q);return(0,h.jsxs)("div",{className:"reply-item",style:n?w.container:{},children:[n&&(0,h.jsx)("div",{style:w.badge,children:"MENTIONED"}),(0,h.jsxs)("div",{className:"reply-header",children:[(0,h.jsx)("div",{className:"reply-avatar",children:(null===(t=e.userName)||void 0===t||null===(s=t.charAt(0))||void 0===s?void 0:s.toUpperCase())||"?"}),(0,h.jsxs)("div",{className:"reply-info",children:[(0,h.jsx)("span",{className:"reply-author",children:e.userName||"Unknown"}),(0,h.jsx)("span",{className:"reply-time",children:e.timestamp?new Date(e.timestamp).toLocaleString():""})]})]}),(0,h.jsxs)("div",{className:"reply-content",children:[e.text&&(0,h.jsx)("p",{className:"reply-text",children:y(e.text,Q)}),Array.isArray(e.attachments)&&e.attachments.length>0&&(0,h.jsx)("div",{className:"reply-attachments",children:(0,h.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:16},children:e.attachments.map(((e,t)=>{const s=e.name||g(e.path),n=f(s),a=["JPG","JPEG","PNG","GIF","BMP","SVG"].includes(n);return(0,h.jsxs)("div",{className:"attachment-item",style:{width:160,background:"#ffffff",border:"1px solid #e2e8f0",borderRadius:12,padding:8,boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,h.jsx)("div",{className:"attachment-thumbnail",style:{cursor:a?"zoom-in":"pointer"},onClick:t=>{t.preventDefault(),a?Mt({src:ct[e.path]||e.path,name:s}):x(e.path)},children:j(s,e.path,n,ct[e.path])}),(0,h.jsxs)("div",{className:"attachment-info",style:{marginTop:8,minHeight:42,width:"100%",textAlign:"center",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,h.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),x(e.path)},className:"attachment-name",title:s,style:{display:"-webkit-box",fontSize:12,overflow:"hidden",textOverflow:"ellipsis",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"1.2em",wordBreak:"break-word",overflowWrap:"anywhere",width:"100%"},children:s}),(0,h.jsx)("span",{className:"attachment-type",style:{fontSize:10,background:"#f1f5f9",padding:"2px 6px",borderRadius:6,display:"inline-block",marginTop:4,alignSelf:"center"},children:n})]})]},t)}))})})]})]},e._id)}))})(),e.replies.length>=3&&(0,h.jsx)("button",{onClick:()=>Te((t=>(0,n.A)((0,n.A)({},t),{},{[e._id]:!t[e._id]}))),className:"replies-toggle-btn",style:{marginTop:8,background:"transparent",border:"none",color:"#2563eb",cursor:"pointer",fontSize:13,fontWeight:600,padding:0},children:ze[e._id]?"Show all ".concat(e.replies.length," replies"):"Hide replies"})]}),G.postDiscuss&&(0,h.jsxs)("div",{className:"reply-composer",style:{marginTop:12,padding:12,borderTop:"1px solid #e2e8f0",display:"flex",gap:8,alignItems:"flex-start"},children:[(0,h.jsx)("textarea",{value:Re[e._id]||"",onChange:t=>Fe((s=>(0,n.A)((0,n.A)({},s),{},{[e._id]:t.target.value}))),onKeyDown:t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),ss(e._id))},placeholder:"Write a reply...",style:{flex:1,minHeight:60,resize:"vertical",fontFamily:"inherit",fontSize:14,padding:8,border:"1px solid #cbd5e1",borderRadius:8}}),(0,h.jsx)("button",{onClick:()=>ss(e._id),disabled:Me||!(Re[e._id]||"").trim(),style:{background:"linear-gradient(90deg,#3b82f6,#6366f1)",color:"#fff",border:"none",padding:"10px 16px",borderRadius:8,fontSize:14,fontWeight:600,cursor:Me||!(Re[e._id]||"").trim()?"not-allowed":"pointer",opacity:Me||!(Re[e._id]||"").trim()?.6:1,alignSelf:"stretch"},children:Me?"Posting...":"Reply"})]})]},e._id)}))}),(0,h.jsx)("div",{ref:Ve}),G.postDiscuss&&(0,h.jsxs)("div",{className:"message-composer",children:[(0,h.jsxs)("div",{className:"composer-area ".concat(Le?"drag-over":""),onDragOver:e=>{e.preventDefault(),We(!0)},onDragLeave:e=>{e.preventDefault(),We(!1)},onDrop:e=>{var t,s;e.preventDefault(),We(!1),null!==(t=e.dataTransfer)&&void 0!==t&&null!==(s=t.files)&&void 0!==s&&s.length&&ns(e.dataTransfer.files)},children:[(0,h.jsx)("div",{className:"label-selector",children:(0,h.jsxs)("select",{value:Ue,onChange:e=>Ge(e.target.value),className:"label-dropdown",children:[(0,h.jsx)("option",{value:"",children:"No Label"}),(0,h.jsx)("option",{value:"Important",children:"Important"}),(0,h.jsx)("option",{value:"Announcement",children:"Announcement"}),(0,h.jsx)("option",{value:"Update",children:"Update"}),(0,h.jsx)("option",{value:"Reminder",children:"Reminder"}),(0,h.jsx)("option",{value:"Urgent",children:"Urgent"})]})}),(0,h.jsx)("textarea",{ref:Ye,id:"main-composer-textarea",value:De,onChange:e=>{const t=e.target.value;Pe(t);const s=e.target.selectionStart,n=t.slice(0,s),a=/(^|\s)@(\w*)$/.exec(n);if(a){const t=a[2].toLowerCase(),s=ot.concat([{_id:"_all_",name:"all"},{_id:"_everyone_",name:"everyone"}]).filter((e=>(e.name||"").toLowerCase().includes(t)));rt({open:!0,options:s,query:t,position:{top:0,left:0},activeInputId:e.target.id})}else rt({open:!1,options:[],query:"",position:{top:0,left:0},activeInputId:null})},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Me||!De.trim()&&!Ee.length||ts())},placeholder:"Type your message here...",className:"composer-textarea"}),it.open&&it.activeInputId===(null===(D=Ye.current)||void 0===D?void 0:D.id)&&(0,h.jsx)("div",{className:"mention-dropdown",children:it.options.map((e=>(0,h.jsx)("div",{className:"mention-option",onClick:()=>(e=>{if(!Ye.current)return;const t=De,s=Ye.current.selectionStart,n=t.slice(0,s),a=/(^|\s)@(\w*)$/.exec(n);if(!a)return;const i=t.slice(0,a.index+a[1].length),r=t.slice(s),o="@".concat(e.name," ");Pe(i+o+r),rt({open:!1,options:[],query:"",position:{top:0,left:0},activeInputId:null}),setTimeout((()=>{Ye.current&&(Ye.current.focus(),Ye.current.selectionStart=Ye.current.selectionEnd=(i+o).length)}),0)})(e),children:e.name},e._id)))})]}),(0,h.jsxs)("div",{className:"composer-actions",children:[(0,h.jsxs)("div",{className:"composer-left",children:[(0,h.jsxs)("label",{htmlFor:"composer-attachments",className:"attachment-button",children:[(0,h.jsx)(m.FrV,{}),(0,h.jsx)("span",{children:"Attach Files"})]}),(0,h.jsx)("input",{id:"composer-attachments",type:"file",multiple:!0,accept:".pdf,.ppt,.pptx,.doc,.docx,.xls,.xlsx,.txt,.rtf,.csv,image/*",style:{display:"none"},onChange:e=>{ns(e.target.files),e.target.value=""}}),Ee.map(((e,t)=>(0,h.jsxs)("div",{className:"file-preview",children:[(0,h.jsxs)("span",{children:["\ud83d\udcce ",e.name]}),(0,h.jsx)("button",{onClick:()=>Oe((e=>e.filter(((e,s)=>s!==t)))),className:"remove-file-btn",children:"\xd7"})]},t)))]}),(0,h.jsx)("div",{className:"composer-right",children:(0,h.jsx)("button",{onClick:ts,disabled:Me||!De.trim()&&0===Ee.length,className:"send-button",children:Me?"Sending...":"Send Message"})})]})]})]}),"Files"===re&&(0,h.jsxs)("div",{className:"files-container",children:[(0,h.jsxs)("div",{className:"files-header",children:[(0,h.jsxs)("div",{className:"files-title-section",children:[(0,h.jsx)("h2",{className:"files-title",children:"Project Files"}),(0,h.jsx)("p",{className:"files-subtitle",children:gs&&gs.length?"Showing ".concat(Math.min(gs.filter((e=>{if(!pt)return!0;return("string"===typeof e?g(e):e.name||g(e.path)).toLowerCase().includes(pt.toLowerCase())})).length,5)," of ").concat(gs.length," files"):"Manage and organize project documents"})]}),(0,h.jsxs)("div",{className:"files-actions",children:[(0,h.jsx)("div",{className:"search-container",children:(0,h.jsx)("input",{type:"text",placeholder:"Search files...",value:pt,onChange:e=>ut(e.target.value),className:"file-search-input"})}),G.uploadFiles&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("label",{htmlFor:"file-upload",className:"upload-btn",children:[(0,h.jsx)(m.FrV,{}),(0,h.jsx)("span",{children:"Upload Files"})]}),(0,h.jsx)("input",{id:"file-upload",type:"file",multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.rtf,.csv,image/*",style:{display:"none"},onChange:e=>{var t;null!==(t=e.target.files)&&void 0!==t&&t.length&&(async e=>{if(G.uploadFiles&&null!==e&&void 0!==e&&e.length&&null!==ae&&void 0!==ae&&ae._id){$e(!0),Je(0),Ke("");try{var t;const s=new FormData;e.forEach((e=>s.append("files",e)));const a=setInterval((()=>Je((e=>e>=90?(clearInterval(a),90):e+10))),200),i=await d.Ay.post("/projects/".concat(ae._id,"/documents"),s,{headers:{Authorization:"Bearer ".concat(W),"Content-Type":"multipart/form-data"}});clearInterval(a),Je(100),null!==(t=i.data)&&void 0!==t&&t.documents&&ie((e=>(0,n.A)((0,n.A)({},e),{},{documents:i.data.documents}))),setTimeout((()=>{$e(!1),Je(0)}),800)}catch(s){Ke("Upload failed"),$e(!1),Je(0)}}})(Array.from(e.target.files)),e.target.value=""}})]})]})]}),qe&&(0,h.jsxs)("div",{className:"upload-progress",children:[(0,h.jsx)("div",{className:"progress-bar",children:(0,h.jsx)("div",{className:"progress-fill",style:{width:"".concat(Xe,"%")}})}),(0,h.jsxs)("span",{className:"progress-text",children:["Uploading... ",Xe,"%"]})]}),(0,h.jsx)("div",{className:"files-table-container",children:gs&&gs.length?(0,h.jsxs)("table",{className:"files-table",children:[(0,h.jsx)("thead",{className:"table-header",children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{className:"header-cell file-name",children:"File Name"}),(0,h.jsx)("th",{className:"header-cell file-type",children:"Type"}),(0,h.jsx)("th",{className:"header-cell file-size",children:"Size"}),(0,h.jsx)("th",{className:"header-cell file-uploader",children:"Uploaded By"}),(0,h.jsx)("th",{className:"header-cell file-date",children:"Date"}),(0,h.jsx)("th",{className:"header-cell file-actions",children:"Actions"})]})}),(0,h.jsx)("tbody",{className:"table-body",children:gs.filter((e=>{if(!pt)return!0;return("string"===typeof e?g(e):e.name||g(e.path)).toLowerCase().includes(pt.toLowerCase())})).slice(0,5).map(((e,t)=>{const s="string"===typeof e?g(e):e.name||g(e.path),n="string"===typeof e?e:e.path,a=f(s),i="string"===typeof e?"Unknown":e.uploadedByName||"Unknown",r="string"===typeof e?null:e.uploadedAt;return(0,h.jsxs)("tr",{className:"table-row",children:[(0,h.jsx)("td",{className:"table-cell file-name",children:(0,h.jsxs)("div",{className:"file-info",children:[(0,h.jsx)("div",{className:"file-thumbnail-container",style:{width:160,height:110},children:j(s,0,a,ct[n])}),(0,h.jsx)("span",{className:"file-name-text",title:s,children:s})]})}),(0,h.jsx)("td",{className:"table-cell file-type",children:(0,h.jsx)("span",{className:"file-type-badge",children:a})}),(0,h.jsx)("td",{className:"table-cell file-size",children:"N/A"}),(0,h.jsx)("td",{className:"table-cell file-uploader",children:i}),(0,h.jsx)("td",{className:"table-cell file-date",children:r?new Date(r).toLocaleDateString():"N/A"}),(0,h.jsx)("td",{className:"table-cell file-actions",children:(0,h.jsxs)("div",{className:"action-buttons",children:[(0,h.jsx)("button",{onClick:()=>x(n),className:"action-btn download-btn",title:"Download",children:(0,h.jsx)(m.WCW,{})}),G.deleteFiles&&(0,h.jsx)("button",{onClick:()=>((e,t)=>{G.deleteFiles&&null!==ae&&void 0!==ae&&ae._id&&($t({doc:e,index:t}),Yt(!0))})(e,t),className:"action-btn delete-btn",title:"Delete",children:(0,h.jsx)(m.qbC,{})})]})})]},t)}))})]}):(0,h.jsxs)("div",{className:"empty-files",children:[(0,h.jsx)(m.FrV,{}),(0,h.jsx)("h3",{children:"No files uploaded yet"}),(0,h.jsx)("p",{children:"Upload project documents to get started"})]})})]}),"Reports"===re&&(0,h.jsxs)("div",{className:"project-reports",style:{textAlign:"left"},children:[(0,h.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[(0,h.jsx)("h3",{style:{marginBottom:18},children:"Project Reports"}),as&&(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,h.jsx)("label",{htmlFor:"pptx-report-uploader",style:{cursor:gt?"not-allowed":"pointer",padding:"8px 14px",borderRadius:8,background:gt?"#e2e8f0":"#ffffff",border:"1px solid #cbd5e1",fontWeight:600,fontSize:13,display:"inline-flex",alignItems:"center",gap:6},children:gt?"Uploading\u2026":"Upload Report (.pptx)"}),(0,h.jsx)("input",{id:"pptx-report-uploader",type:"file",accept:".ppt,.pptx",style:{display:"none"},disabled:gt,onChange:e=>{var t;const s=null===(t=e.target.files)||void 0===t?void 0:t[0];e.target.value="",s&&(async t=>{if(t&&null!==ae&&void 0!==ae&&ae._id)if(/\.pptx?$/i.test(t.name))try{ft(!0),yt(""),vt(0);const e=new FormData;e.append("report",t);const s=setInterval((()=>vt((e=>e>=85?85:e+7))),180),{data:n}=await d.Ay.post("/projects/".concat(ae._id,"/reports"),e,{headers:{Authorization:"Bearer ".concat(W)}});clearInterval(s),vt(100),null!==n&&void 0!==n&&n.report&&ht((e=>[n.report,...e])),Zt(ae._id),setTimeout((()=>{ft(!1),vt(0)}),600)}catch(e){var s,n;ft(!1),vt(0),yt((null===e||void 0===e||null===(s=e.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||"Report upload failed")}else alert("Please select a .pptx file")})(s)}}),gt&&(0,h.jsxs)("div",{style:{minWidth:140},children:[(0,h.jsx)("div",{style:{height:6,background:"#e2e8f0",borderRadius:4,overflow:"hidden",marginBottom:4},children:(0,h.jsx)("div",{style:{width:xt+"%",height:"100%",background:"linear-gradient(90deg,#3b82f6,#6366f1)",transition:"width .25s"}})}),(0,h.jsxs)("span",{style:{fontSize:11,color:"#475569"},children:[xt,"%"]})]})]})]}),jt&&(0,h.jsx)("div",{style:{color:"#b91c1c",fontSize:12,marginBottom:10},children:jt}),0===mt.length?(0,h.jsx)("div",{style:{color:"#888",fontSize:16},children:"No reports yet."}):(0,h.jsx)("div",{style:{overflowX:"auto"},children:(0,h.jsxs)("table",{className:"files-table",style:{width:"100%",borderCollapse:"collapse"},children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid #eee",background:"#fafafa"},children:"Name"}),(0,h.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid #eee",background:"#fafafa"},children:"Uploaded By"}),(0,h.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid #eee",background:"#fafafa"},children:"Uploaded At"}),(0,h.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid #eee",background:"#fafafa"},children:"Status"}),(0,h.jsx)("th",{style:{textAlign:"left",padding:"10px 12px",borderBottom:"1px solid #eee",background:"#fafafa",width:380},children:"Action"})]})}),(0,h.jsx)("tbody",{children:mt.map((e=>{var t,s,i,r;const o=null!==e&&void 0!==e&&e.uploadedAt?new Date(e.uploadedAt).toLocaleString():"\u2014";return(0,h.jsxs)(a.Fragment,{children:[(0,h.jsxs)("tr",{children:[(0,h.jsx)("td",{style:{padding:"10px 12px",borderTop:"1px solid #f1f1f1"},children:(0,h.jsxs)("span",{style:{display:"inline-flex",alignItems:"center"},children:[(0,h.jsx)(m.FrV,{style:{marginRight:6}}),(null===e||void 0===e?void 0:e.name)||"Report.pptx"]})}),(0,h.jsx)("td",{style:{padding:"10px 12px",borderTop:"1px solid #f1f1f1"},children:(null===e||void 0===e?void 0:e.uploadedByName)||"Unknown"}),(0,h.jsx)("td",{style:{padding:"10px 12px",borderTop:"1px solid #f1f1f1"},children:o}),(0,h.jsx)("td",{style:{padding:"10px 12px",borderTop:"1px solid #f1f1f1",textTransform:"capitalize"},children:(null===e||void 0===e?void 0:e.status)||"pending"}),(0,h.jsxs)("td",{style:{padding:"10px 12px",borderTop:"1px solid #f1f1f1"},children:[null!==e&&void 0!==e&&e.path?(0,h.jsx)("button",{onClick:()=>v(ae._id,e.path),style:{marginRight:10,border:"1px solid #cbd5e1",background:"#000000ff",padding:"6px 12px",borderRadius:8,cursor:"pointer",fontSize:13,fontWeight:600},children:"View PPT"}):(0,h.jsx)("span",{style:{color:"#94a3b8",marginRight:10,fontSize:12},children:"No PPT"}),null!==e&&void 0!==e&&e.pdfPath?(0,h.jsx)("button",{onClick:()=>v(ae._id,e.pdfPath),style:{marginRight:10,border:"1px solid #cbd5e1",background:"linear-gradient(90deg,#3b82f6,#6366f1)",padding:"6px 12px",borderRadius:8,cursor:"pointer",fontSize:13,fontWeight:600,color:"#fff"},children:"Download AI PDF"}):(0,h.jsx)("span",{style:{color:"#94a3b8",marginRight:10,fontSize:12},children:"No PDF"}),(0,h.jsx)("button",{onClick:()=>Lt((t=>(0,n.A)((0,n.A)({},t),{},{[e._id]:!(null!==t&&void 0!==t&&t[e._id])}))),style:{marginRight:10,border:"1px solid #cbd5e1",background:"#ffffff",padding:"6px 12px",borderRadius:8,cursor:null!==e&&void 0!==e&&e.ai?"pointer":"not-allowed",fontSize:13,fontWeight:600,color:null!==e&&void 0!==e&&e.ai?"#0f172a":"#94a3b8"},disabled:!(null!==e&&void 0!==e&&e.ai),title:null!==e&&void 0!==e&&e.ai?"Show AI summary":"No AI summary available",children:null!==Ot&&void 0!==Ot&&Ot[e._id]?"Hide Summary":"Show Summary"}),is(e)&&(0,h.jsx)("button",{onClick:()=>{var t;return(async(e,t)=>{if(null===ae||void 0===ae||!ae._id||!e)return;if("pm"===z||"pic"===z&&t&&String(t)===String(K)){if(window.confirm("Delete this report (PPT + AI outputs)?"))try{const{data:t}=await d.Ay.delete("/projects/".concat(ae._id,"/reports/").concat(e),{headers:{Authorization:"Bearer ".concat(W)}});null!==t&&void 0!==t&&t.reports?ht(t.reports):ht((t=>t.filter((t=>String(t._id)!==String(e)))))}catch(a){var s,n;alert((null===a||void 0===a||null===(s=a.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||"Failed to delete report")}}else alert("You can only delete your own reports.")})(e._id,(null===(t=e.uploadedBy)||void 0===t?void 0:t._id)||e.uploadedBy)},style:{border:"1px solid #dc2626",background:"#fee2e2",padding:"6px 12px",borderRadius:8,cursor:"pointer",fontSize:13,fontWeight:600,color:"#b91c1c"},children:"Delete"})]})]}),(null===Ot||void 0===Ot?void 0:Ot[e._id])&&(null===e||void 0===e?void 0:e.ai)&&(0,h.jsx)("tr",{children:(0,h.jsx)("td",{colSpan:5,style:{background:"#f8fafc",borderTop:"1px solid #eef2f7"},children:(0,h.jsxs)("div",{style:{padding:16},children:[(0,h.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,h.jsx)("h4",{style:{margin:0},children:"AI Summary"}),(0,h.jsx)("span",{style:{fontStyle:"italic",color:"#64748b",fontSize:12},children:"AI-generated summary"})]}),(0,h.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(280px,1fr))",gap:16,marginTop:12},children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("b",{children:"Summary of Work Done"}),(0,h.jsx)("ul",{style:{marginTop:6},children:(e.ai.summary_of_work_done||[]).map(((e,t)=>(0,h.jsx)("li",{children:e},t)))})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("b",{children:"Completed Tasks"}),(0,h.jsx)("ul",{style:{marginTop:6},children:(e.ai.completed_tasks||[]).map(((e,t)=>(0,h.jsx)("li",{children:e},t)))})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("b",{children:"Critical Path (3)"}),(0,h.jsx)("div",{style:{marginTop:6},children:(e.ai.critical_path_analysis||[]).slice(0,3).map(((e,t)=>{var s,n;return(0,h.jsxs)("div",{style:{marginBottom:8},children:[(0,h.jsx)("b",{children:"".concat(t+1,". ").concat((null===e||void 0===e?void 0:e.path_type)||"Path "+(t+1))}),(0,h.jsxs)("ul",{style:{marginTop:4,marginBottom:4},children:[(null===e||void 0===e?void 0:e.risk)&&(0,h.jsxs)("li",{children:[(0,h.jsx)("b",{children:"Risk:"})," ",e.risk]}),(null===e||void 0===e||null===(s=e.blockers)||void 0===s?void 0:s.length)>0&&(0,h.jsxs)("li",{children:[(0,h.jsx)("b",{children:"Blockers:"})," ",e.blockers.join("; ")]}),(null===e||void 0===e||null===(n=e.next)||void 0===n?void 0:n.length)>0&&(0,h.jsxs)("li",{children:[(0,h.jsx)("b",{children:"Next:"})," ",e.next.join("; ")]})]})]},t)}))})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("b",{children:"Task Priorities"}),(0,h.jsx)("div",{style:{marginTop:6},children:Array.isArray(e.ai.task_priorities)&&e.ai.task_priorities.length>0?(0,h.jsx)("ol",{style:{margin:0,paddingLeft:18},children:e.ai.task_priorities.slice(0,5).map(((e,t)=>{const s=(e.priority||"").toString(),n=/high/i.test(s)?"#dc2626":/medium|med/i.test(s)?"#ea580c":/low/i.test(s)?"#0d9488":"#334155";return(0,h.jsxs)("li",{style:{marginBottom:8},children:[(0,h.jsxs)("div",{style:{fontWeight:600,display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"},children:[(0,h.jsx)("span",{style:{background:n,color:"#fff",fontSize:11,padding:"2px 6px",borderRadius:12},children:s||"Priority"}),(0,h.jsx)("span",{children:e.task||e.title||"Untitled Task"})]}),(e.impact||e.justification)&&(0,h.jsxs)("ul",{style:{margin:"4px 0 0",paddingLeft:16},children:[e.impact&&(0,h.jsxs)("li",{children:[(0,h.jsx)("b",{children:"Impact:"})," ",e.impact]}),e.justification&&(0,h.jsxs)("li",{children:[(0,h.jsx)("b",{children:"Reason:"})," ",e.justification]})]})]},t)}))}):(0,h.jsx)("p",{style:{margin:0,color:"#64748b"},children:"No prioritized tasks."})})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("b",{children:"PiC Performance"}),(0,h.jsx)("p",{style:{marginTop:6},children:(null===(t=e.ai.pic_performance_evaluation)||void 0===t?void 0:t.text)||"Performance summary unavailable."}),"number"===typeof(null===(s=e.ai.pic_performance_evaluation)||void 0===s?void 0:s.score)&&(0,h.jsxs)("p",{children:["Score: ",e.ai.pic_performance_evaluation.score,"/100"]}),(0,h.jsxs)("p",{children:["PiC Contribution: ",(()=>{const t=e.ai||{},s=Number(t.pic_contribution_percent_raw),n=Number(t.pic_contribution_percent),a=isFinite(s)&&s>=0?s:isFinite(n)&&n>=0?n:0;return Math.round(a)})(),"%",(null===(i=e.ai)||void 0===i?void 0:i.meta_fallback_used)&&(0,h.jsx)("span",{style:{marginLeft:6,fontSize:11,color:"#f97316"},title:"AI model fallback heuristic used",children:"(fallback)"}),(null===(r=e.ai)||void 0===r?void 0:r.meta_duplicate_previous)&&(0,h.jsx)("span",{style:{marginLeft:6,fontSize:11,color:"#64748b"},title:"Same PPT content as prior upload",children:"(duplicate)"})]}),"number"===typeof e.ai.confidence&&(0,h.jsxs)("p",{children:["Model Confidence: ",(100*e.ai.confidence).toFixed(0),"%"]})]})]})]})})})]},e._id)}))})]})})]}),"Attendance"===re&&["it","am","pm","ceo","hr","hrsite"].includes(z)&&(0,h.jsxs)("div",{className:"attendance-tab",style:{textAlign:"left"},children:[(0,h.jsx)("h3",{style:{margin:"0 0 16px"},children:"Attendance Reports"}),(0,h.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"center",marginBottom:16},children:[(0,h.jsxs)("label",{style:{background:"#0f172a",color:"#fff",padding:"8px 14px",borderRadius:8,fontSize:14,cursor:wt?"not-allowed":"pointer",opacity:wt?.6:1},children:[wt?"Uploading...":"Upload Schedule (.xlsx)",(0,h.jsx)("input",{type:"file",accept:".xls,.xlsx",style:{display:"none"},disabled:wt,onChange:async e=>{var t;const s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s&&null!==ae&&void 0!==ae&&ae._id){_t(""),St(!0);try{const e=new FormData;e.append("schedule",s),await d.Ay.post("/projects/".concat(ae._id,"/attendance/upload"),e,{headers:{Authorization:"Bearer ".concat(W)}}),await ds(ae._id)}catch(n){_t("Upload failed")}finally{St(!1),e.target.value=""}}}})]}),(0,h.jsx)("button",{onClick:()=>ds(ae._id),style:{background:"#334155",color:"#fff",border:"none",padding:"8px 14px",borderRadius:8,cursor:"pointer"},children:"Refresh"}),At&&(0,h.jsx)("span",{style:{color:"#b91c1c",fontWeight:600},children:At})]}),0===bt.length?(0,h.jsx)("div",{style:{color:"#666"},children:"No attendance reports yet."}):(0,h.jsxs)("table",{className:"files-table",style:{width:"100%",borderCollapse:"collapse"},children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{style:{textAlign:"left",padding:"8px"},children:"Original File"}),(0,h.jsx)("th",{style:{textAlign:"left",padding:"8px"},children:"Uploaded By"}),(0,h.jsx)("th",{style:{textAlign:"left",padding:"8px"},children:"Generated At"}),(0,h.jsx)("th",{style:{textAlign:"left",padding:"8px"},children:"Actions"})]})}),(0,h.jsx)("tbody",{children:bt.slice().reverse().map(((e,t)=>(0,h.jsxs)("tr",{style:{borderTop:"1px solid #eee"},children:[(0,h.jsx)("td",{style:{padding:"8px"},children:e.originalName}),(0,h.jsx)("td",{style:{padding:"8px"},children:cs(e)}),(0,h.jsx)("td",{style:{padding:"8px"},children:e.generatedAt?new Date(e.generatedAt).toLocaleString():"N/A"}),(0,h.jsxs)("td",{style:{padding:"8px",display:"flex",gap:8},children:[(0,h.jsx)("button",{onClick:async()=>{try{const{data:t}=await d.Ay.get("/projects/".concat(ae._id,"/attendance-signed-url"),{params:{path:e.inputPath},headers:{Authorization:"Bearer ".concat(W)}});null!==t&&void 0!==t&&t.signedUrl&&window.open(t.signedUrl,"_blank")}catch(t){}},className:"btn small",children:"View Excel"}),(0,h.jsx)("button",{onClick:async()=>{try{const{data:t}=await d.Ay.get("/projects/".concat(ae._id,"/attendance-signed-url"),{params:{path:e.outputPath},headers:{Authorization:"Bearer ".concat(W)}});null!==t&&void 0!==t&&t.signedUrl&&window.open(t.signedUrl,"_blank")}catch(t){}},className:"btn small primary",children:"Download AI Attendace Report"}),(0,h.jsx)("button",{onClick:async()=>{if(window.confirm("Delete this attendance report?"))try{await d.Ay.delete("/projects/".concat(ae._id,"/attendance/").concat(e._id),{headers:{Authorization:"Bearer ".concat(W)}}),await ds(ae._id)}catch(t){alert("Delete failed")}},className:"btn small danger",style:{background:"#fee2e2",color:"#b91c1c"},children:"Delete"})]})]},t)))})]}),kt&&(0,h.jsxs)("div",{style:{marginTop:24,background:"#f8fafc",padding:16,border:"1px solid #e2e8f0",borderRadius:12},children:[(0,h.jsx)("h4",{style:{marginTop:0},children:"AI Attendance Summary"}),kt.insights&&kt.insights.length>0&&(0,h.jsx)("ul",{style:{marginTop:8},children:kt.insights.map(((e,t)=>(0,h.jsx)("li",{children:e},t)))}),kt.top_absent&&kt.top_absent.length>0&&(0,h.jsxs)("div",{style:{marginTop:12},children:[(0,h.jsx)("b",{children:"Most Absent:"}),(0,h.jsx)("ol",{style:{marginTop:6},children:kt.top_absent.map(((e,t)=>(0,h.jsxs)("li",{children:[e.name,": ",e.absent]},t)))})]}),kt.average_attendance&&(0,h.jsxs)("p",{style:{marginTop:12},children:[(0,h.jsx)("b",{children:"Average Attendance:"})," ",kt.average_attendance,"%"]})]})]})]})]})]}),Vt&&qt&&(0,h.jsx)("div",{className:"modal-overlay",children:(0,h.jsxs)("div",{className:"modal small",children:[(0,h.jsx)("h3",{children:"Confirm File Deletion"}),(0,h.jsxs)("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"12px",marginBottom:"16px"},children:[(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[(0,h.jsx)("span",{style:{fontSize:"20px"},children:"\u26a0\ufe0f"}),(0,h.jsx)("strong",{style:{color:"#dc2626"},children:"File Deletion Warning"})]}),(0,h.jsx)("p",{style:{color:"#dc2626",margin:0,fontSize:"14px"},children:"This will permanently delete the file from the project. This action cannot be undone."})]}),(0,h.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,h.jsx)("p",{style:{marginBottom:"8px",fontWeight:"600"},children:"File Details:"}),(0,h.jsxs)("div",{style:{backgroundColor:"#f9fafb",padding:"12px",borderRadius:"6px",fontSize:"14px"},children:[(0,h.jsxs)("p",{style:{margin:"0 0 4px 0"},children:[(0,h.jsx)("strong",{children:"File Name:"})," ","string"===typeof qt.doc?qt.doc.split("/").pop():qt.doc.originalName||(null===(P=qt.doc.path)||void 0===P?void 0:P.split("/").pop())||"Unknown"]}),(0,h.jsxs)("p",{style:{margin:"0 0 4px 0"},children:[(0,h.jsx)("strong",{children:"Project:"})," ",(null===ae||void 0===ae?void 0:ae.projectName)||"Unknown"]}),(0,h.jsxs)("p",{style:{margin:"0"},children:[(0,h.jsx)("strong",{children:"File Path:"})," ","string"===typeof qt.doc?qt.doc:qt.doc.path||"Unknown"]})]})]}),(0,h.jsxs)("p",{style:{marginBottom:"16px",fontSize:"14px",lineHeight:"1.5"},children:["Are you sure you want to ",(0,h.jsx)("strong",{children:"permanently delete"})," this file from the project?"]}),(0,h.jsxs)("div",{className:"modal-actions",style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[(0,h.jsx)("button",{className:"btn",onClick:()=>{Yt(!1),$t(null)},children:"Cancel"}),(0,h.jsx)("button",{className:"btn primary",onClick:async()=>{if(qt&&null!==ae&&void 0!==ae&&ae._id)try{const e="string"===typeof qt.doc?qt.doc:qt.doc.path;await d.Ay.delete("/projects/".concat(ae._id,"/documents"),{headers:{Authorization:"Bearer ".concat(W)},data:{path:e}}),ie((e=>(0,n.A)((0,n.A)({},e),{},{documents:e.documents.filter(((e,t)=>t!==qt.index))}))),Yt(!1),$t(null)}catch(e){alert("Failed to delete file")}},style:{backgroundColor:"#dc2626"},children:"Yes, Delete File"})]})]})})]})}},4801:(e,t,s)=>{s.d(t,{A:()=>l});var n=s(5043),a=s(3216),i=s(5114),r=s(3204),o=s(579);const l=()=>{const{notifications:e,unread:t,markAllRead:s,markAsRead:l}=(0,i.E)(),c=(0,a.Zp)(),[d,p]=(0,n.useState)(!1),u=(0,n.useRef)();let m=localStorage.getItem("userId");if(!m)try{const e=JSON.parse(localStorage.getItem("user")||"null");e&&(e._id||e.id)&&(m=String(e._id||e.id))}catch(j){m=null}(0,n.useEffect)((()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&p(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]);const h=(e,t)=>{switch(e){case"success":return(0,o.jsx)(r.A7C,{className:"notif-icon success"});case"warning":return(0,o.jsx)(r.BS8,{className:"notif-icon warning"});case"error":return(0,o.jsx)(r._Hm,{className:"notif-icon error"});default:return(0,o.jsx)(r.__w,{className:"notif-icon info"})}},g=(()=>{try{var e;return(null===(e=JSON.parse(localStorage.getItem("user")||"null"))||void 0===e?void 0:e.role)||""}catch(t){return""}})(),f=e=>{let t;"unread"===e.status&&l&&l(e._id),t||(t=e.actionUrl||(e=>{var t,s;const n=(null===(t=e.requestId)||void 0===t?void 0:t._id)||e.requestId,a=(null===(s=e.projectId)||void 0===s?void 0:s._id)||e.projectId,i=(g||"").toLowerCase(),r=i.includes("person in charge")||"pic"===i,o=i.includes("project manager")||"pm"===i,l=i.includes("area manager")||"am"===i,c="ceo"===i,d="it"===i,p="hr"===i&&!i.includes("site"),u=i.includes("hr - site"),m="staff"===i;if(["material_request_created","pending_approval","approved","denied","nudge"].includes(e.type)&&n){if(r)return"/pic/material-request/".concat(n);if(o)return"/pm/material-request/".concat(n);if(l)return"/am/material-request/".concat(n);if(c)return"/ceo/material-request/".concat(n);if(d)return"/it/material-request/".concat(n)}if(["discussion","reply","mention","task","system","general","manpower","project_created"].includes(e.type)&&a){if(r)return"/pic/".concat(a);if(o)return"/pm/viewprojects/".concat(a);if(l)return"/am/projects/".concat(a);if(c)return"/ceo/proj/".concat(a);if(d)return"/it/projects";if(p)return"/hr/project-records/".concat(a);if(u)return"/hr-site/current-project";if(m)return"/staff/current-project"}return r?"/pic":o?"/pm":l?"/am":c?"/ceo/dash":d?"/it":p?"/hr/dash":u?"/hr-site":m?"/staff":"/"})(e)),t&&(t.startsWith("http")?window.location.href=t:c(t))},x=e.filter((e=>!["chat","chat_message","message"].includes(String(e.type||"").toLowerCase()))),v=x.filter((e=>"unread"===e.status)).length;return(0,o.jsxs)("div",{className:"notif-bell-container",ref:u,children:[(0,o.jsxs)("div",{className:"notif-bell-icon",onClick:()=>{p((e=>!e)),v>0&&x.filter((e=>"unread"===e.status)).forEach((e=>l&&l(e._id)))},children:[(0,o.jsx)(r.jNV,{size:22,color:"white"}),v>0&&(0,o.jsx)("span",{className:"notif-badge",children:v})]}),d&&(0,o.jsxs)("div",{className:"notif-popup",children:[(0,o.jsxs)("div",{className:"notif-popup-header",children:[(0,o.jsx)("span",{children:"Notifications"}),e.length>0&&(0,o.jsx)("button",{className:"notif-markread-btn",onClick:s,children:"Mark all as read"})]}),(0,o.jsx)("div",{className:"notif-popup-list",children:0===x.length?(0,o.jsx)("div",{className:"notif-empty",children:"No notifications"}):x.slice(0,12).map(((e,t)=>{var s;return(0,o.jsxs)("div",{className:"notif-item rich".concat("unread"===e.status?" unread":""),onClick:()=>f(e),role:"button",tabIndex:0,onKeyPress:t=>{"Enter"===t.key&&f(e)},children:[(0,o.jsx)("div",{className:"notif-left",children:h(e.severity,e.icon)}),(0,o.jsxs)("div",{className:"notif-body",children:[(0,o.jsxs)("div",{className:"notif-title-row",children:[(0,o.jsx)("span",{className:"notif-title sev-".concat(e.severity||"info"),children:e.title||"Notification"}),"unread"===e.status&&(0,o.jsx)("span",{className:"badge-dot"})]}),(0,o.jsx)("div",{className:"notif-message",children:e.message}),(0,o.jsxs)("div",{className:"notif-meta-line",children:[(0,o.jsx)("span",{className:"notif-date",children:new Date(e.createdAt).toLocaleString()}),(null===(s=e.projectId)||void 0===s?void 0:s.projectName)&&(0,o.jsx)("span",{className:"notif-project",children:e.projectId.projectName})]})]})]},(e&&e._id?String(e._id):"notif-".concat(t))+"-".concat(t))}))})]})]})}},5500:(e,t,s)=>{e.exports=s.p+"static/media/attach.7db0cd41fa458423a7d7.png"},6837:(e,t,s)=>{s.d(t,{K:()=>h,X:()=>g});var n=s(7762),a=s(4857);const i=new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}),r=e=>{if(!e)return"N/A";const t=new Date(e);return Number.isNaN(t.getTime())?"N/A":t.toLocaleDateString()},o=function(){return((arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")||"Project").replace(/[\/\\?%*:|"<>]/g,"_")},l=e=>{var t,s;return null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.name?"".concat(e.location.name).concat(null!==(s=e.location)&&void 0!==s&&s.region?" (".concat(e.location.region,")"):""):"N/A"};function c(e){const t=null===e||void 0===e?void 0:e.contractor;if(!t)return"N/A";if("string"===typeof t)return t.trim()||"N/A";if(Array.isArray(t)){const e=t.map((e=>"string"===typeof e?e:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.company)||(null===e||void 0===e?void 0:e.companyName)||"")).map((e=>"string"===typeof e?e.trim():"")).filter(Boolean);return e.length?e.join(", "):"N/A"}if("object"===typeof t)for(const s of[t.name,t.company,t.companyName,t.title,t.fullName])if("string"===typeof s&&s.trim())return s.trim();return"string"===typeof(null===e||void 0===e?void 0:e.contractorName)&&e.contractorName.trim()?e.contractorName.trim():"N/A"}function d(e){return new Promise((t=>{if(!e)return t(null);try{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>{const e=document.createElement("canvas");e.width=s.naturalWidth,e.height=s.naturalHeight,e.getContext("2d").drawImage(s,0,0),t({dataUrl:e.toDataURL("image/png"),w:s.naturalWidth,h:s.naturalHeight})},s.onerror=()=>t(null),s.src=e}catch(s){t(null)}}))}function p(e,t,s,n){if(!e||!t)return{w:s,h:n};const a=Math.min(s/e,n/t);return{w:Math.round(e*a),h:Math.round(t*a)}}async function u(e,t,s,n){try{const a="".concat("","/fonts/").concat(t),i=await fetch(a,{cache:"no-store"});if(!i.ok)return!1;const r=await i.arrayBuffer(),o=btoa(String.fromCharCode(...new Uint8Array(r)));return e.addFileToVFS(t,o),e.addFont(t,s,n),!0}catch(a){return!1}}function m(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal";try{return e.setFont(t,s),e.getTextWidth("test"),!0}catch(n){return!1}}async function h(e){var t,s;let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{contextTitle:g="Project Details",includeHrSite:f=!0,includeStaff:x=!0,includePIC:v=!0,includeAM:j=!0,includePM:y=!0,includeBudget:b=!0,includeManpower:N=!0,preferPesoSign:w=!1,exportedBy:S="Unknown User",exportDate:A=(new Date).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})}=h,_=new n.Ay({unit:"pt",format:"a4"}),k="NotoSans",C=await u(_,"NotoSans-Regular.ttf",k,"normal"),I=await u(_,"NotoSans-Bold.ttf",k,"bold"),D=C&&m(_,k,"normal"),P=D?k:"helvetica",z=I&&m(_,k,"bold")?"bold":"normal",T=function(e,t){return s=>{const n=i.format(Number(s||0));return e&&t?n.replace("PHP","\u20b1").replace(/\s+/g," "):n.replace("\u20b1","PHP")}}(w,D),R=40;let F=36;const M="".concat("","/images/Fadz-logo.png"),B=await d(M);let E=R;if(null!==B&&void 0!==B&&B.dataUrl){const e=60,t=B.w&&B.h?B.w/B.h:1,s=Math.min(200,Math.max(100,e*t));_.addImage(B.dataUrl,"PNG",R,F-12,s,e,void 0,"FAST"),E=R+s+16}_.setFont(P,z),_.setFontSize(20),_.setTextColor(20),_.text("Fadz Construction Inc.",E,F+16),_.setFont(P,"normal"),_.setFontSize(12),_.setTextColor(90),_.text(String(g||""),E,F+28),_.setDrawColor(220),_.setLineWidth(1),_.line(R,F+42,555,F+42),F+=56,_.setFont(P,"normal"),_.setFontSize(10),_.setTextColor(100,116,139),_.text("Exported by: ".concat(S),R,F),_.text("Export Date & Time: ".concat(A),R,F+12),_.setDrawColor(200,200,200),_.setLineWidth(.5),_.line(R,F+20,555,F+20),F+=30,_.setTextColor(20),_.setFont(P,z),_.setFontSize(16),_.text(String((null===e||void 0===e?void 0:e.projectName)||"Untitled Project"),R,F);let O=F;const L=await d(null===e||void 0===e||null===(t=e.photos)||void 0===t?void 0:t[0]);if(null!==L&&void 0!==L&&L.dataUrl){const e=120,t=72,{w:s,h:n}=p(L.w,L.h,e,t),a=555-s,i=F-22+Math.round((t-n)/2);_.addImage(L.dataUrl,"PNG",a,i,s,n,void 0,"FAST"),O=Math.max(O,i+n)}const W=Math.max(F+8,O+16),U=[["Location",l(e)],["Project Manager",(null===e||void 0===e||null===(s=e.projectmanager)||void 0===s?void 0:s.name)||"N/A"],["Contractor",c(e)],["Start Date",r(null===e||void 0===e?void 0:e.startDate)],["End Date",r(null===e||void 0===e?void 0:e.endDate)],["Status",(null===e||void 0===e?void 0:e.status)||"N/A"]];b&&U.splice(1,0,["Budget",T(null===e||void 0===e?void 0:e.budget)]),(0,a.Ay)(_,{startY:W,head:[["Field","Value"]],body:U,styles:{font:P,fontStyle:"normal",fontSize:11,cellPadding:8,halign:"left"},headStyles:{font:P,fontStyle:z,fillColor:[25,118,210],textColor:255},columnStyles:{0:{cellWidth:150}},theme:"grid",margin:{left:R,right:R}});const G=[];if(y&&null!==e&&void 0!==e&&e.projectmanager&&G.push(["Project Manager",e.projectmanager.name||""]),j&&null!==e&&void 0!==e&&e.areamanager&&G.push(["Area Manager",e.areamanager.name||""]),v&&Array.isArray(null===e||void 0===e?void 0:e.pic)&&e.pic.forEach((e=>G.push(["Person in Charge",(null===e||void 0===e?void 0:e.name)||""]))),f&&Array.isArray(null===e||void 0===e?void 0:e.hrsite)&&e.hrsite.forEach((e=>G.push(["HR - Site",(null===e||void 0===e?void 0:e.name)||""]))),x&&Array.isArray(null===e||void 0===e?void 0:e.staff)&&e.staff.forEach((e=>G.push(["Staff",(null===e||void 0===e?void 0:e.name)||""]))),G.length&&(0,a.Ay)(_,{startY:_.lastAutoTable.finalY+18,head:[["Role","Name"]],body:G,styles:{font:P,fontStyle:"normal",fontSize:11,cellPadding:8,halign:"left"},headStyles:{font:P,fontStyle:z,fillColor:[76,175,80],textColor:255},theme:"grid",margin:{left:R,right:R}}),N&&Array.isArray(null===e||void 0===e?void 0:e.manpower)&&e.manpower.length){var H;const t=e.manpower.map((e=>[(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.fullName)||"Unnamed",(null===e||void 0===e?void 0:e.position)||(null===e||void 0===e?void 0:e.role)||""]));(0,a.Ay)(_,{startY:((null===(H=_.lastAutoTable)||void 0===H?void 0:H.finalY)||W)+18,head:[["Manpower Name","Position"]],body:t,styles:{font:P,fontStyle:"normal",fontSize:11,cellPadding:8,halign:"left"},headStyles:{font:P,fontStyle:z,fillColor:[33,150,243],textColor:255},theme:"grid",margin:{left:R,right:R}})}const V=_.getNumberOfPages();_.setFont(P,"normal"),_.setFontSize(9),_.setTextColor(120);for(let n=1;n<=V;n++){_.setPage(n);const e=818;_.text("Fadz Construction Inc. - Project Details",R,e);const t="Page ".concat(n," of ").concat(V),s=_.getTextWidth(t);_.text(t,555-s,e),_.setFontSize(8),_.setTextColor(100);const a="Generated on ".concat(A," by ").concat(S),i=_.getTextWidth(a);_.text(a,555-i,e-12)}_.save("Project-".concat(o(null===e||void 0===e?void 0:e.projectName),".pdf"))}const g=async e=>{const{companyName:t,companyLogo:s,exportedBy:i,exportDate:r,filters:o,projects:l}=e,c=new n.Ay("landscape","mm","a4");c.setFont("helvetica");let u=20,m=0,h=0;if(s)try{const e=await d(s);if(null!==e&&void 0!==e&&e.dataUrl){const t=35,s=100,{w:n,h:a}=p(e.w,e.h,s,t);m=n,h=a,c.addImage(e.dataUrl,"PNG",u,15,m,h,void 0,"FAST"),u+=m+15}}catch(j){console.warn("Failed to load company logo:",j)}c.setFontSize(26),c.setTextColor(30,41,59),c.text(t||"Projects",u,33),c.setFontSize(12),c.setTextColor(100,116,139),c.text("Exported by: ".concat(i||"Unknown"),20,40),c.text("Export Date & Time: ".concat(r),20,47);const g=o.status&&"all"!==o.status||o.search||o.dateFrom||o.dateTo;if(g){c.setFontSize(14),c.setTextColor(30,41,59),c.text("Export Filters Applied:",20,60),c.setFontSize(10),c.setTextColor(100,116,139);let e=70;if(o.status&&"all"!==o.status&&(c.text("\u2022 Status: ".concat(o.status.charAt(0).toUpperCase()+o.status.slice(1)),20,e),e+=7),o.search&&(c.text('\u2022 Search: "'.concat(o.search,'"'),20,e),e+=7),o.dateFrom||o.dateTo){const t=[];o.dateFrom&&t.push("From: ".concat(o.dateFrom)),o.dateTo&&t.push("To: ".concat(o.dateTo)),c.text("\u2022 Date Range: ".concat(t.join(" - ")),20,e),e+=7}c.setDrawColor(200,200,200),c.setLineWidth(.5),c.line(20,e+2,280,e+2),e+=10}const f=g?95:60;c.setFontSize(12),c.setTextColor(30,41,59),c.text("Total Projects: ".concat((null===l||void 0===l?void 0:l.length)||0),20,f);const x=(l&&l.length?l:[]).map((e=>[e.name||"\u2014",e.area||"\u2014",e.pm||"\u2014",e.contractor||"\u2014",e.timeline||"\u2014",e.pics||"\u2014",e.budget||"\u2014"]));if(l&&l.length)try{(0,a.Ay)(c,{head:[["Project Name","Area","Project Manager","Contractor","Timeline","PICs","Budget"]],body:x,startY:f+15,margin:{top:20},styles:{fontSize:9,cellPadding:3,lineColor:[226,232,240],lineWidth:.1},headStyles:{fillColor:[30,41,59],textColor:[255,255,255],fontStyle:"bold"},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{0:{cellWidth:40},1:{cellWidth:30},2:{cellWidth:35},3:{cellWidth:35},4:{cellWidth:35},5:{cellWidth:40},6:{cellWidth:25}},didDrawPage:function(){c.setFontSize(10),c.setTextColor(100,116,139),c.text("Page ".concat(c.internal.getCurrentPageInfo().pageNumber),c.internal.pageSize.width-30,c.internal.pageSize.height-10)}})}catch(y){console.error("autoTable error",y),c.setFontSize(12),c.setTextColor(200,30,30),c.text("Failed to render table (autoTable error).",20,100)}else c.setFontSize(14),c.setTextColor(150),c.text("No projects match the selected filters.",20,f+15);const v=c.internal.getNumberOfPages();for(let n=1;n<=v;n++)c.setPage(n),c.setFontSize(8),c.setTextColor(100,116,139),c.text("".concat(t," - Project Export"),20,c.internal.pageSize.height-10),c.text("Generated on ".concat(r," by ").concat(i),c.internal.pageSize.width-80,c.internal.pageSize.height-10);c.save("projects_export_".concat(String(r).replace(/\//g,"-"),".pdf"))}},7508:()=>{},8153:(e,t,s)=>{s.r(t),s.d(t,{default:()=>m});var n=s(9379),a=s(5043),i=s(8818),r=s(3216),o=s(3204),l=s(2104),c=s(1877),d=s(411),p=s(2063),u=s(579);o.$BV,o.uN,o.H5e,o.YXz,o.yd7,o.kkc,o.v$b,o.uN,o.H5e,o.YXz,o.yd7,o.kkc,o.v$b,o.bfZ,o.$BV,o.uN,o.kkc,o.Ny1,o.yd7,o.$BV,o.uN,o.H5e,o.YXz,o.kkc,o.$BV,o.uN,o.YXz,o.yd7,o.H5e,o.kkc,o.v$b,o.$BV,o.uN,o.YXz,o.yk7,o.yd7,o.bfZ,o.yd7,o.uN,o.yd7,o.yd7,o.uN,o.yd7,o.kkc;const m=e=>{var t;let{baseSegment:m="am"}=e;const h=(0,r.Zp)(),{chatId:g}=(0,r.g)(),f=localStorage.getItem("token"),x=JSON.parse(localStorage.getItem("user")||"{}"),v=null===x||void 0===x?void 0:x._id,j=(null===x||void 0===x?void 0:x.name)||"Z",y=(null===x||void 0===x||x.role,(0,a.useMemo)((()=>({Authorization:"Bearer ".concat(f)})),[f])),b=(0,a.useRef)(null),N=(0,a.useRef)(null),w=(0,a.useRef)(null),S=(0,a.useRef)(0),[A,_]=(0,a.useState)([]),[k,C]=(0,a.useState)(""),[I,D]=(0,a.useState)([]),[P,z]=(0,a.useState)(null),[T,R]=(0,a.useState)([]),[F,M]=(0,a.useState)(""),[B,E]=(0,a.useState)({}),[O,L]=(0,a.useState)([]),[W,U]=(0,a.useState)(!1),[G,H]=(0,a.useState)(!1),[V,Y]=(0,a.useState)(!1),[q,$]=(0,a.useState)("media"),[X,J]=(0,a.useState)(!1),[Z,K]=(0,a.useState)(null),[Q,ee]=(0,a.useState)(!1),[te,se]=(0,a.useState)(!1),[ne,ae]=(0,a.useState)(""),[ie,re]=(0,a.useState)([]),[oe,le]=(0,a.useState)(0),[ce,de]=(0,a.useState)(null),[pe,ue]=(0,a.useState)(!1),[me,he]=(0,a.useState)(null),[ge,fe]=(0,a.useState)([]),[xe,ve]=(0,a.useState)([]),[je,ye]=(0,a.useState)(""),[be,Ne]=(0,a.useState)({open:!1,msgId:null,x:0,y:0}),[we,Se]=(0,a.useState)(!1),[Ae,_e]=(0,a.useState)(""),[ke,Ce]=(0,a.useState)([]),[Ie,De]=(0,a.useState)([]),[Pe,ze]=(0,a.useState)(""),[Te,Re]=(0,a.useState)(null),[Fe,Me]=(0,a.useState)([]),[Be,Ee]=(0,a.useState)(!1),[Oe,Le]=(0,a.useState)(""),[We,Ue]=(0,a.useState)(!1),[Ge,He]=(0,a.useState)([]),[Ve,Ye]=(0,a.useState)([]),[qe,$e]=(0,a.useState)(""),[Xe,Je]=(0,a.useState)(!1),[Ze,Ke]=(0,a.useState)(!1),[Qe,et]=(0,a.useState)(0),[tt,st]=(0,a.useState)(null),[nt,at]=(0,a.useState)(null),[it,rt]=(0,a.useState)(new Set),[ot,lt]=(0,a.useState)(new Set),[ct,dt]=(0,a.useState)({});function pt(e){return(null===e||void 0===e?void 0:e.name)||"".concat((null===e||void 0===e?void 0:e.firstname)||""," ").concat((null===e||void 0===e?void 0:e.lastname)||"").trim()||(null===e||void 0===e?void 0:e.email)||""}(0,a.useEffect)((()=>{try{const e=JSON.parse(localStorage.getItem("chatLastRead")||"{}");e&&"object"===typeof e&&dt(e)}catch(e){}}),[]);const ut=(0,a.useMemo)((()=>T.flatMap((e=>e.attachments||[])).filter((e=>e&&e.mime&&e.mime.startsWith("image/")&&e.url))),[T]),mt=(0,a.useMemo)((()=>{if(!qe.trim())return Ge;const e=qe.trim().toLowerCase();return Ge.filter((t=>pt(t).toLowerCase().includes(e)))}),[Ge,qe]),ht=(0,a.useMemo)((()=>{const e=new Map;return ut.forEach(((t,s)=>{null!==t&&void 0!==t&&t.url&&e.set(t.url,s)})),e}),[ut]),gt=e=>{et(e),Ke(!0)},ft=()=>Ke(!1),xt=e=>{et((t=>ut.length?(t+e+ut.length)%ut.length:0))};(0,a.useEffect)((()=>{if(!Ze)return;const e=e=>{"Escape"===e.key&&ft(),"ArrowRight"===e.key&&xt(1),"ArrowLeft"===e.key&&xt(-1)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[Ze,ut.length]),(0,a.useEffect)((()=>{"pm"!==m&&"pic"!==m||(async()=>{try{if("pm"===m){const{data:e}=await d.Ay.get("/projects?limit=1",{headers:y});if(Array.isArray(e)&&e.length){const t=e[0];st(t._id||t.id||null)}}else if("pic"===m&&v){const{data:e}=await d.Ay.get("/projects/by-user-status?userId=".concat(v,"&role=pic&status=Ongoing"),{headers:y});if(Array.isArray(e)&&e.length){const t=e[0];at(t._id||t.id||null)}}}catch(e){}})()}),[m,y,v]);const vt=e=>{const t=e=>{const t=null===e||void 0===e?void 0:e.lastMessage;if(null!==e&&void 0!==e&&e.isGroup){if(!t)return!0;"string"===typeof t.content&&t.content.trim().length,Array.isArray(t.attachments)&&t.attachments.length,t.sender;return!0}if(!t)return!1;const s="string"===typeof t.content&&t.content.trim().length>0,n=Array.isArray(t.attachments)&&t.attachments.length>0,a=!!t.sender;return s||n||a},s=e=>{var t,s,n,a;if(null!==e&&void 0!==e&&null!==(t=e.lastMessage)&&void 0!==t&&t.tsNum)return e.lastMessage.tsNum;if((null===e||void 0===e||!e.lastMessage)&&null!==e&&void 0!==e&&e.isGroup){const t=e.createdAt||e.updatedAt;if(t){const e="number"===typeof t?t:Date.parse(t);return isNaN(e)?0:e}}let i=(null===e||void 0===e||null===(s=e.lastMessage)||void 0===s?void 0:s.timestamp)||(null===e||void 0===e||null===(n=e.lastMessage)||void 0===n?void 0:n.createdAt)||(null===e||void 0===e||null===(a=e.lastMessage)||void 0===a?void 0:a.updatedAt)||(null===e||void 0===e?void 0:e.updatedAt)||(null===e||void 0===e?void 0:e.createdAt);if(!i&&null!==e&&void 0!==e&&e._id&&/^[a-f0-9]{24}$/.test(e._id)&&(i=1e3*parseInt(e._id.substring(0,8),16)),!i)return 0;if("number"===typeof i)return i;const r=Date.parse(i);return isNaN(r)?0:r};let n=[...e||[]].map(((e,t)=>({c:e,idx:t}))).sort(((e,n)=>{var a,i,r,o;const l=t(e.c),c=t(n.c);if(l&&!c)return-1;if(!l&&c)return 1;if(!l&&!c)return e.idx-n.idx;const d=s(n.c)-s(e.c);if(0!==d)return d;const p=(null===(a=e.c)||void 0===a||null===(i=a.lastMessage)||void 0===i?void 0:i.seq)||0,u=(null===(r=n.c)||void 0===r||null===(o=r.lastMessage)||void 0===o?void 0:o.seq)||0;return u!==p?u-p:e.c.isGroup&&!n.c.isGroup?-1:!e.c.isGroup&&n.c.isGroup?1:0})).map((e=>e.c));if(Te){const e=n.findIndex((e=>e._id===Te));if(e>-1){n[e].lastMessage,Re(null)}else Re(null)}return n};(0,a.useEffect)((()=>{if(!Te)return;const e=A.find((e=>e._id===Te));e&&e.lastMessage&&Re(null)}),[A,Te]),(0,a.useEffect)((()=>{ee(!!P)}),[P]),(0,a.useEffect)((()=>{f&&v||h("/")}),[h,f,v]),(0,a.useEffect)((()=>{const e=e=>{e.target.closest(".user-profile")||J(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[]),(0,a.useEffect)((()=>{const e=e=>{e.target.closest(".msg-action-trigger")||e.target.closest(".msg-action-popover")||Ne((e=>e.open?(0,n.A)((0,n.A)({},e),{},{open:!1}):e))},t=e=>{"Escape"===e.key&&Ne((e=>e.open?(0,n.A)((0,n.A)({},e),{},{open:!1}):e))};return document.addEventListener("click",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("click",e),document.removeEventListener("keydown",t)}}),[]);const jt=e=>{if(!e)return"";const t=new Date(e),s=new Date,n=t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&t.getDate()===s.getDate(),a=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});if(n)return a;const i=t.toLocaleDateString([],{month:"short",day:"numeric"}),r=t.getFullYear()!==s.getFullYear()?" "+t.getFullYear():"";return"".concat(i).concat(r," ").concat(a)},yt=a.useMemo((()=>{const e=new Set;return(T||[]).filter((t=>{const s=String(t&&t._id);return!!s&&(!e.has(s)&&(e.add(s),!0))}))}),[T]),bt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!ne.trim())return e;try{const t=new RegExp("(".concat(function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(ne.trim()),")"),"gi");return e.replace(t,'<mark class="msg-hit">$1</mark>')}catch(t){return e}};(0,a.useEffect)((()=>{if(!ne.trim())return re([]),void le(0);const e=ne.trim().toLowerCase(),t=yt.map(((e,t)=>({i:t,content:(e.content||"").toLowerCase()}))).filter((t=>t.content.includes(e))).map((e=>e.i));re(t),le(0),t.length&&setTimeout((()=>{const e=document.querySelector('[data-msg-index="'.concat(t[0],'"]'));e&&e.scrollIntoView({behavior:"smooth",block:"center"})}),50)}),[ne,yt]);const Nt=e=>{ie.length&&le((t=>{const s=(t+e+ie.length)%ie.length,n=ie[s];return setTimeout((()=>{const e=document.querySelector('[data-msg-index="'.concat(n,'"]'));e&&e.scrollIntoView({behavior:"smooth",block:"center"})}),30),s}))};(0,a.useEffect)((()=>{if(!v)return;b.current&&(b.current.disconnect(),b.current=null),b.current=(0,l.io)(p.G,{path:p.c,withCredentials:!0,transports:["websocket","polling"],auth:{userId:v}}),b.current.on("connect_error",(e=>{console.warn("[socket] connect_error",p.G,null===e||void 0===e?void 0:e.message)})),b.current.on("error",(e=>{console.warn("[socket] error",e)})),b.current.on("reconnect_attempt",(e=>{try{b.current.io.opts.transports=["websocket","polling"]}catch(t){}1===e&&console.info("[socket] reconnect attempt")})),b.current.on("reconnect_failed",(()=>{console.error("[socket] reconnect failed")}));const e=e=>{const{text:t,attachments:s}=(e=>{var t,s,n;let a=(null!==(t=null!==(s=null!==(n=e.content)&&void 0!==n?n:e.message)&&void 0!==s?s:e.fileUrl)&&void 0!==t?t:"")||"";const i=Array.isArray(e.attachments)?e.attachments:[];if(i.length){const e=i.map((e=>e&&e.url)).filter(Boolean);e.includes(a)&&(a=""),/^https?:\/\//.test(a)&&e.some((e=>a.startsWith(e.split("?")[0])))&&(a=""),/^Sending \d+ attachment\(s\)\u2026$/.test(a)&&(a="")}return{text:a,attachments:i}})(e);console.log("Debug: onReceive message",e);const a="number"===typeof e.timestamp?e.timestamp:e.timestamp?Date.parse(e.timestamp):Date.now();_((i=>{let r=!1;const o=i.map((i=>{if(i._id!==e.conversation)return i;r=!0;let o=t;if(!o&&s.length){const e=s.every((e=>((null===e||void 0===e?void 0:e.mimetype)||"").startsWith("image/"))),t=s.length;o=e?1===t?"\ufffd Photo":"\ud83d\uddbc ".concat(t," Photos"):1===t?"\ufffd\ud83d\udcce Attachment":"\ud83d\udcce ".concat(t," Files")}return(0,n.A)((0,n.A)({},i),{},{lastMessage:{content:o,timestamp:e.timestamp||a,tsNum:a,seq:++S.current,attachments:s,sender:e.sender}})}));return r?vt(o):i})),N.current===e.conversation&&(R((n=>[...n.filter((t=>!String(t._id).startsWith("tmp-")||(!t.isOwn||e.sender!==v&&(t.content!==(e.content||"")&&!(/^Sending \d+ attachment\(s\)\u2026$/.test(t.content)&&s.length>0))))),{_id:e._id,content:t,timestamp:e.timestamp,isOwn:e.sender===v,reactions:[],seen:[],attachments:s,replyTo:e.replyTo||null,forwardOf:e.forwardOf||null,senderId:e.sender||e.senderId||null}])),e.sender!==v&&(b.current&&b.current.connected?b.current.emit("messageSeen",{messageId:e._id,userId:v}):b.current&&b.current.once&&b.current.once("connect",(()=>b.current.emit("messageSeen",{messageId:e._id,userId:v})))))},t=e=>{let{messageId:t,userId:s,timestamp:a}=e;R((e=>e.map((e=>e._id===t?(0,n.A)((0,n.A)({},e),{},{seen:[...e.seen||[],{userId:s,timestamp:a}]}):e))))},s=e=>{let{chatId:t,lastMessage:s}=e;const a=("number"===typeof(null===s||void 0===s?void 0:s.timestamp)?s.timestamp:Date.parse(null===s||void 0===s?void 0:s.timestamp))||Date.now();_((e=>vt(e.map((e=>{var i;if(e._id!==t)return e;const r=(null===(i=e.lastMessage)||void 0===i?void 0:i.seen)||[],o=null!==s&&void 0!==s&&s.seen?s.seen:r;return(0,n.A)((0,n.A)({},e),{},{lastMessage:(0,n.A)((0,n.A)({},s),{},{seen:o,tsNum:a,seq:++S.current})})})))))},a=e=>{let{chatId:t,users:s,name:a}=e;_((e=>e.map((e=>e._id===t?(0,n.A)((0,n.A)({},e),{},{users:s||e.users,name:a||e.name}):e)))),z((e=>e&&e._id===t?(0,n.A)((0,n.A)({},e),{},{users:s||e.users,name:a||e.name}):e))},i=e=>{var t,s,a;if(!e||!e._id)return;if(!(e.users||[]).some((e=>e._id===v)))return;const i=(null===(t=e.lastMessage)||void 0===t?void 0:t.timestamp)||(null===(s=e.lastMessage)||void 0===s?void 0:s.createdAt)||(null===(a=e.lastMessage)||void 0===a?void 0:a.updatedAt);let r="number"===typeof i?i:i?Date.parse(i):0;if((e=e.lastMessage?(0,n.A)((0,n.A)({},e),{},{lastMessage:(0,n.A)((0,n.A)({},e.lastMessage),{},{tsNum:r,seq:++S.current})}):e).lastMessage||e.isGroup){if(!e.lastMessage&&e.isGroup){let t=e.createdAt||e.updatedAt;!t&&/^[a-f0-9]{24}$/.test(e._id)&&(t=new Date(1e3*parseInt(e._id.substring(0,8),16)).toISOString());let s=0;t&&(s="number"===typeof t?t:Date.parse(t)||0),e=(0,n.A)((0,n.A)({},e),{},{lastMessage:{content:"",timestamp:t,tsNum:s,seq:++S.current,sender:null,attachments:[],seen:[]}})}_((t=>vt([e,...t.filter((t=>t._id!==e._id))])))}},r=e=>{let{messageId:t,reactions:s}=e;R((e=>e.map((e=>e._id===t?(0,n.A)((0,n.A)({},e),{},{reactions:s}):e))))};b.current.on("receiveMessage",e),b.current.on("messageSeen",t),b.current.on("chatUpdated",s),b.current.on("messageReaction",r),b.current.on("chatMembersUpdated",a),b.current.on("chatCreated",i),b.current.on("presenceSnapshot",(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];try{lt(new Set(e.map(String)))}catch(t){}})),b.current.on("userOnline",(e=>{e&&lt((t=>{const s=new Set(t);return s.add(String(e)),s}))})),b.current.on("userOffline",(e=>{e&&lt((t=>{const s=new Set(t);return s.delete(String(e)),s}))})),b.current.on("chatReadReceipt",(e=>{let{chatId:t,timestamp:s}=e;t&&s&&dt((e=>(0,n.A)((0,n.A)({},e),{},{[t]:s})))}));try{b.current.emit("getPresence")}catch(o){}return()=>{b.current.off("receiveMessage",e),b.current.off("messageSeen",t),b.current.off("chatUpdated",s),b.current.off("messageReaction",r),b.current.off("chatMembersUpdated",a),b.current.off("chatCreated",i),b.current.off("presenceSnapshot"),b.current.off("userOnline"),b.current.off("userOffline"),b.current.off("chatReadReceipt"),b.current.disconnect()}}),[v]),(0,a.useEffect)((()=>{N.current=(null===P||void 0===P?void 0:P._id)||null}),[null===P||void 0===P?void 0:P._id]),(0,a.useEffect)((()=>{w.current&&w.current.scrollIntoView({behavior:"smooth"})}),[T,P]);const wt=()=>{w.current&&w.current.scrollIntoView({behavior:"smooth"})};(0,a.useEffect)((()=>{const e=document.querySelector(".modern-chat-main");if(!e)return;const t=()=>{const{scrollTop:t,scrollHeight:s,clientHeight:n}=e;se(s-t-n>=20)};return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}),[P]);const St=async()=>{try{const{data:e}=await d.Ay.get("/chats",{headers:y}),t=(e||[]).map((e=>{if(null!==e&&void 0!==e&&e.lastMessage){const t=e.lastMessage,s=t.timestamp||t.createdAt||t.updatedAt;let a="number"===typeof s?s:s?Date.parse(s):0;a||(a=0);let i=t.content||"";if((!i||/^https?:\/\//.test(i))&&Array.isArray(t.attachments)&&t.attachments.length){const e=t.attachments.every((e=>((null===e||void 0===e?void 0:e.mimetype)||"").startsWith("image/"))),s=t.attachments.length;i=e?1===s?"\ud83d\uddbc Photo":"\ud83d\uddbc ".concat(s," Photos"):1===s?"\ud83d\udcce Attachment":"\ud83d\udcce ".concat(s," Files")}return(0,n.A)((0,n.A)({},e),{},{lastMessage:(0,n.A)((0,n.A)({},t),{},{content:i,tsNum:a,attachments:t.attachments||[]})})}if(null!==e&&void 0!==e&&e.isGroup){let t=e.createdAt||e.updatedAt;!t&&/^[a-f0-9]{24}$/.test(e._id||"")&&(t=new Date(1e3*parseInt(e._id.substring(0,8),16)).toISOString());let s=0;return t&&(s="number"===typeof t?t:Date.parse(t)||0),s||(s=Date.now()),(0,n.A)((0,n.A)({},e),{},{lastMessage:{content:"",timestamp:t||(new Date).toISOString(),tsNum:s,seq:++S.current,sender:null,attachments:[],seen:[]}})}return e})).filter((e=>{if(e.isGroup)return!0;const t=e.lastMessage;if(!t)return!1;const s="string"===typeof t.content&&t.content.trim().length>0,n=Array.isArray(t.attachments)&&t.attachments.length>0,a=!!t.sender;return s||n||a}));_(vt(t))}catch(e){_([])}};(0,a.useEffect)((()=>{f&&St()}),[f,y]),(0,a.useEffect)((()=>{if(!g||0===A.length)return;const e=A.find((e=>e._id===g));e&&z(e)}),[g,A]),(0,a.useEffect)((()=>{if(!P)return;const e=P._id;b.current.emit("joinChat",e),R([]);let t=!1;return(async()=>{try{U(!0);const{data:s}=await d.Ay.get("/messages/".concat(e),{headers:y});if(t)return;if(!P||P._id!==e)return;const n=(s||[]).map((e=>{var t,s,n;return{_id:e._id,content:(null!==(t=null!==(s=null!==(n=e.message)&&void 0!==n?n:e.content)&&void 0!==s?s:e.fileUrl)&&void 0!==t?t:"")||"",timestamp:e.createdAt,isOwn:e.senderId===v,reactions:e.reactions||[],seen:e.seen||[],attachments:e.attachments||[],replyTo:e.replyTo||null,forwardOf:e.forwardOf||null,senderId:e.senderId||e.sender&&e.sender._id||null}}));R((()=>n)),n.filter((e=>!e.isOwn)).forEach((e=>{b.current&&b.current.connected?b.current.emit("messageSeen",{messageId:e._id,userId:v}):b.current&&b.current.once&&b.current.once("connect",(()=>b.current.emit("messageSeen",{messageId:e._id,userId:v})))}))}finally{t||(U(!1),setTimeout((()=>wt()),100))}})(),()=>{t=!0,b.current.emit("leaveChat",e)}}),[null===P||void 0===P?void 0:P._id,v,y]),(0,a.useEffect)((()=>{const e=setTimeout((async()=>{const e=k.trim().toLowerCase();if(!e)return D([]);try{const{data:t}=await d.Ay.get("/users",{headers:y}),s=Array.isArray(t)?t:[],a=A.filter((t=>t.isGroup?(t.name||"").toLowerCase().includes(e):pt(t.users.find((e=>e._id!==v))).toLowerCase().includes(e))),i=new RegExp(e,"i"),r=s.filter((e=>i.test(e.name||"")||i.test(e.email||""))),o=[...a];r.forEach((e=>{A.some((t=>!t.isGroup&&t.users.some((t=>t._id===e._id))))||o.push((0,n.A)((0,n.A)({},e),{},{type:"user"}))})),D(o)}catch(t){D([])}}),300);return()=>clearTimeout(e)}),[k,A,v,y]),(0,a.useEffect)((()=>{we&&(async()=>{try{const{data:e}=await d.Ay.get("/users?limit=100",{headers:y});Ce(e||[]),De(e||[])}catch(e){Ce([]),De([])}})()}),[we,y]),(0,a.useEffect)((()=>{We&&null!==P&&void 0!==P&&P.isGroup&&Ct()}),[We,P]),(0,a.useEffect)((()=>{pe&&(async()=>{try{const{data:e}=await d.Ay.get("/users?limit=500",{headers:y});ve(Array.isArray(e)?e:[])}catch(e){ve([])}ye("")})()}),[pe,y]);const At=(0,a.useMemo)((()=>{const e=[...A.filter((e=>e._id!==(null===P||void 0===P?void 0:P._id))).map((e=>({key:"chat-".concat(e._id),type:"chat",id:e._id,name:e.isGroup?e.name:pt(e.users.find((e=>e._id!==v))),isGroup:e.isGroup}))),...xe.filter((e=>e._id!==v)).filter((e=>!A.some((t=>!t.isGroup&&t.users.some((t=>t._id===e._id))&&t.users.some((e=>e._id===v)))))).map((e=>({key:"user-".concat(e._id),type:"user",id:e._id,name:pt(e),isGroup:!1})))],t=je.trim().toLowerCase();return t?e.filter((e=>(e.name||"").toLowerCase().includes(t))):e}),[A,xe,je,P,v]),_t=async()=>{const e=(F||"").trim();if(!e&&0===O.length)return;if(!P)return;const t=O;M(""),L([]),E((e=>{if(null===P||void 0===P||!P._id)return e;const t=(0,n.A)({},e);return delete t[P._id],t}));const s="tmp-".concat(Date.now(),"-").concat(Math.random());R((n=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const s=new Map;(e||[]).forEach((e=>{e&&e._id&&s.set(String(e._id),e)})),(t||[]).forEach((e=>{e&&e._id&&s.set(String(e._id),e)}));const n=Array.from(s.values());return n.sort(((e,t)=>(e.timestamp||0)-(t.timestamp||0))),n}(n,[{_id:s,content:e||(t.length?"Sending ".concat(t.length," attachment(s)\u2026"):""),timestamp:Date.now(),isOwn:!0,reactions:[],seen:[],attachments:[],replyTo:ce?ce._id:null}])));const a=Date.now();_((s=>vt(s.map((s=>s._id===P._id?(0,n.A)((0,n.A)({},s),{},{lastMessage:{content:e||(t.length?"\ud83d\udcce Attachment":""),timestamp:a,tsNum:a,seq:++S.current,sender:v,seen:[]}}):s)))));try{const s=new FormData;s.append("conversation",P._id),e&&s.append("content",e),ce&&s.append("replyTo",ce._id),t.forEach((e=>s.append("files",e))),await d.Ay.post("/messages",s,{headers:(0,n.A)((0,n.A)({},y),{},{"Content-Type":"multipart/form-data"})});try{const{data:e}=await d.Ay.get("/messages/".concat(P._id),{headers:y}),t=(e||[]).map((e=>({_id:e._id,content:e.message||"",timestamp:e.createdAt,isOwn:e.senderId===v,reactions:e.reactions||[],seen:e.seen||[],attachments:e.attachments||[],replyTo:e.replyTo||null,forwardOf:e.forwardOf||null,senderId:e.senderId||e.sender&&e.sender._id||null})));R((()=>t)),de(null)}catch(i){}}catch(r){console.error("Failed to send:",r),R((e=>e.filter((e=>e._id!==s)))),L((e=>[...t,...e])),M(e)}},kt=async(e,t)=>{const s=e.reactions.find((e=>(e=>{var t;return"string"===typeof e.userId?e.userId:null===(t=e.userId)||void 0===t?void 0:t._id})(e)===v));s&&s.emoji===t?await d.Ay.delete("/messages/".concat(e._id,"/reactions"),{data:{userId:v,emoji:t},headers:y}):(s&&await d.Ay.delete("/messages/".concat(e._id,"/reactions"),{data:{userId:v,emoji:s.emoji},headers:y}),await d.Ay.post("/messages/".concat(e._id,"/reactions"),{userId:v,emoji:t},{headers:y}))},Ct=async()=>{try{const{data:e}=await d.Ay.get("/users?limit=100",{headers:y}),t=P.users.map((e=>e._id));He((e||[]).filter((e=>!t.includes(e._id)))),Ye([])}catch(e){console.error(e)}},It=async e=>{if(null!==P&&void 0!==P&&P.isGroup&&e!==v&&!It._busy){It._busy=!0;try{let s=!1;try{const{data:t}=await d.Ay.post("/chats/".concat(P._id,"/remove-member"),{memberId:e},{headers:y});null!==t&&void 0!==t&&t.chat?(z(t.chat),s=!0):s=!0}catch(i){var t;if(403!==(null===i||void 0===i||null===(t=i.response)||void 0===t?void 0:t.status))throw i;try{const t=P.users.filter((t=>t._id!==e)).map((e=>e._id));await d.Ay.put("/chats/".concat(P._id),{users:t},{headers:y}),s=!0}catch(r){throw r}}s&&(z((t=>t?(0,n.A)((0,n.A)({},t),{},{users:t.users.filter((t=>t._id!==e))}):t)),await St())}catch(o){var s,a;if(403===(null===o||void 0===o||null===(s=o.response)||void 0===s?void 0:s.status))alert((null===(a=o.response.data)||void 0===a?void 0:a.error)||"You are not allowed to remove members from this group.");console.error("Remove member failed:",o)}finally{It._busy=!1}}},Dt=(k.trim(),(0,a.useMemo)((()=>null!==P&&void 0!==P&&P.isGroup?(P.users||[]).reduce(((e,t)=>null!==t&&void 0!==t&&t._id?(e.map.has(t._id)||(e.map.set(t._id,!0),e.list.push(t)),e):e),{map:new Map,list:[]}).list:[]),[P]));return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"area-chat-wrapper",children:[we&&(0,u.jsx)("div",{className:"modal-overlay",children:(0,u.jsxs)("div",{className:"modal",children:[(0,u.jsx)("h3",{children:"Create Group Chat"}),(0,u.jsx)("label",{children:"Group Name"}),(0,u.jsx)("input",{className:"modal-input",placeholder:"Enter a group name",value:Ae,onChange:e=>_e(e.target.value)}),(0,u.jsx)("label",{children:"Search users"}),(0,u.jsx)("input",{className:"modal-input",placeholder:"Search for users",value:Pe,onChange:e=>{const t=e.target.value.toLowerCase();ze(t),De(ke.filter((e=>pt(e).toLowerCase().includes(t))))}}),(0,u.jsx)("div",{className:"user-list",children:Ie.map(((e,t)=>(0,u.jsxs)("label",{className:"user-item",children:[(0,u.jsx)("input",{type:"checkbox",checked:Fe.includes(e._id),onChange:()=>{return t=e._id,Me((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]));var t}}),pt(e)]},"".concat(e._id,"-").concat(t))))}),(0,u.jsxs)("div",{className:"modal-buttons",children:[(0,u.jsx)("button",{className:"btn-create",onClick:async()=>{const e=[v,...Fe],{data:t}=await d.Ay.post("/chats",{name:Ae,users:e,isGroup:!0},{headers:y});let s=t;if(s&&!s.lastMessage){let e=s.createdAt||s.updatedAt;!e&&/^[a-f0-9]{24}$/.test(s._id||"")&&(e=new Date(1e3*parseInt(s._id.substring(0,8),16)).toISOString());let t=0;e&&(t="number"===typeof e?e:Date.parse(e)||0),t||(t=Date.now()),s=(0,n.A)((0,n.A)({},s),{},{lastMessage:{content:"",timestamp:e||(new Date).toISOString(),tsNum:t,seq:++S.current,sender:null,attachments:[],seen:[]}})}_((e=>vt([s,...e.filter((e=>e._id!==s._id))]))),Se(!1),_e(""),ze(""),Me([]),z(s),h("/".concat(m,"/chat/").concat(s._id)),St()},disabled:!Ae||!Fe.length,children:"Create"}),(0,u.jsx)("button",{className:"btn-cancel",onClick:()=>Se(!1),children:"Cancel"})]})]})}),pe&&(0,u.jsx)("div",{className:"modal-overlay",children:(0,u.jsxs)("div",{className:"modal",style:{maxWidth:420},children:[(0,u.jsx)("h3",{children:"Forward Message"}),(0,u.jsx)("div",{style:{fontSize:12,marginBottom:8,opacity:.7},children:"Select chats or users"}),(0,u.jsx)("input",{style:{width:"100%",marginBottom:8,padding:"6px 8px",border:"1px solid #d1d5db",borderRadius:6,fontSize:13},placeholder:"Search users...",value:je,onChange:e=>ye(e.target.value)}),(0,u.jsxs)("div",{className:"user-list",style:{maxHeight:260,overflowY:"auto",display:"flex",flexDirection:"column",gap:4},children:[At.map((e=>{const t=ge.some((t=>t.type===e.type&&t.id===e.id));return(0,u.jsxs)("label",{className:"user-item",style:{display:"flex",alignItems:"center",gap:6},children:[(0,u.jsx)("input",{type:"checkbox",checked:t,onChange:()=>{return t={type:e.type,id:e.id},void fe((e=>e.some((e=>e.type===t.type&&e.id===t.id))?e.filter((e=>!(e.type===t.type&&e.id===t.id))):[...e,t]));var t}}),(0,u.jsxs)("span",{style:{fontSize:12},children:[e.isGroup&&"\ud83d\udc65 ",e.name,"user"===e.type&&!e.isGroup&&" \ud83d\udc64"]})]},e.key)})),0===At.length&&(0,u.jsx)("div",{style:{fontSize:12,opacity:.5},children:"No results"})]}),(0,u.jsxs)("div",{className:"modal-buttons",children:[(0,u.jsxs)("button",{className:"btn-create",disabled:!ge.length,onClick:()=>{if(!me)return;(async()=>{try{const a=new Set;for(const s of ge)if("chat"!==s.type){if("user"===s.type){var e;let n=A.find((e=>!e.isGroup&&e.users.some((e=>e._id===s.id))&&e.users.some((e=>e._id===v))));if(!n)try{const{data:e}=await d.Ay.post("/chats",{users:[v,s.id]},{headers:y});n=e}catch(t){}null!==(e=n)&&void 0!==e&&e._id&&a.add(n._id)}}else a.add(s.id);for(const e of Array.from(a)){const t=Array.isArray(me.attachments)?me.attachments:[];if(t.length){const a=new FormData;a.append("conversation",e),me.content&&a.append("content",me.content),a.append("forwardOf",me._id);for(const e of t)if(null!==e&&void 0!==e&&e.url)try{const t=await fetch(e.url),s=await t.blob(),n=e.name||e.url.split("?")[0].split("/").pop()||"attachment",i=new File([s],n,{type:s.type||e.mime||"application/octet-stream"});a.append("files",i)}catch(s){}await d.Ay.post("/messages",a,{headers:(0,n.A)((0,n.A)({},y),{},{"Content-Type":"multipart/form-data"})})}else await d.Ay.post("/messages",{conversation:e,content:me.content,forwardOf:me._id},{headers:y})}ue(!1),he(null),fe([]),Array.from(a).includes(null===P||void 0===P?void 0:P._id)||St()}catch(a){alert("Forward failed")}})()},children:["Forward (",ge.length,")"]}),(0,u.jsx)("button",{className:"btn-cancel",onClick:()=>{ue(!1),he(null),fe([])},children:"Cancel"})]})]})}),be.open&&(0,u.jsxs)("div",{className:"msg-action-popover",style:{position:"fixed",top:be.y-10,left:be.x,transform:"translate(-50%, -100%)",background:"#18191a",color:"#e4e6eb",padding:"6px 0",borderRadius:12,minWidth:140,boxShadow:"0 8px 24px rgba(0,0,0,.4)",zIndex:2e3,fontSize:13},children:[(0,u.jsx)("div",{style:{position:"absolute",bottom:-6,left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid #18191a"}}),(()=>{const e=T.find((e=>e._id===be.msgId));if(!e)return null;const t=()=>Ne((e=>(0,n.A)((0,n.A)({},e),{},{open:!1})));return(0,u.jsxs)(u.Fragment,{children:[e.isOwn&&(0,u.jsx)("button",{className:"popover-item",onClick:()=>{t(),window.confirm("Unsend this message?")&&d.Ay.delete("/messages/".concat(e._id),{headers:y}).then((()=>R((t=>t.filter((t=>t._id!==e._id))))))},children:"Unsend"}),(0,u.jsx)("button",{className:"popover-item",onClick:()=>{t(),he(e),fe([]),ue(!0)},children:"Forward"})]})})()]}),(0,u.jsx)(i.A,{roleSegment:"hr"===m?"hr":m,overrideNav:"hr"===m?[{to:"/hr/dash",label:"Dashboard",icon:(0,u.jsx)(o.$BV,{}),match:"/hr/dash"},{to:"/hr/chat",label:"Chat",icon:(0,u.jsx)(o.uN,{}),match:"/hr/chat"},{to:"/hr/mlist",label:"Manpower",icon:(0,u.jsx)(o.YXz,{}),match:"/hr/mlist"},{to:"/hr/movement",label:"Movement",icon:(0,u.jsx)(o.yk7,{}),match:"/hr/movement"},{to:"/hr/project-records",label:"Projects",icon:(0,u.jsx)(o.yd7,{}),match:"/hr/project-records"},{to:"/hr/attendance",label:"Attendance",icon:(0,u.jsx)(o.bfZ,{}),match:"/hr/attendance"}]:void 0}),(0,u.jsxs)("div",{className:"area-chat-content",children:[(0,u.jsxs)("div",{className:"modern-sidebar",children:[(0,u.jsxs)("div",{className:"modern-sidebar-header",children:[(0,u.jsxs)("div",{className:"header-top",children:[(0,u.jsx)("h2",{children:"Chats"}),(0,u.jsx)("button",{className:"group-chat-btn modern-new-group-btn",onClick:()=>Se(!0),children:"+ New Group"})]}),(0,u.jsx)("input",{className:"modern-search-input",placeholder:"Search chats or users",value:k,onChange:e=>C(e.target.value)})]}),(0,u.jsx)("div",{className:"modern-chat-list",children:0===(k.trim()?I:A).length?(0,u.jsx)("div",{className:"modern-no-chats",children:"No chats found."}):(k.trim()?I:A).map((e=>{var t,s,a,i,r;const l="user"===e.type,c=e.isGroup,p=c?null:(null===(t=e.users)||void 0===t?void 0:t.find((e=>e._id!==v)))||{},g=l?pt(e):c?e.name:pt(p);let f="";if(null!==(s=e.lastMessage)&&void 0!==s&&s.content)f=e.lastMessage.content;else if(Array.isArray(e.messages)&&e.messages.length){const t=[...e.messages].reverse().find((e=>!e.system&&e.content));f=(null===t||void 0===t?void 0:t.content)||""}const x=(null===(a=e.lastMessage)||void 0===a?void 0:a.attachments)||(Array.isArray(e.messages)?null===(i=[...e.messages].reverse().find((e=>Array.isArray(e.attachments)&&e.attachments.length)))||void 0===i?void 0:i.attachments:[]);if((!f||/^https?:\/\//.test(f))&&x&&x.length){if(x.every((e=>((null===e||void 0===e?void 0:e.mimetype)||"").startsWith("image/")))){const e=x.length;f=1===e?"\ud83d\uddbc Photo":"\ud83d\uddbc ".concat(e," Photos")}else{const e=x.length,t=1===e?"File":"Files";f=1===e?"\ud83d\udcce Attachment":"\ud83d\udcce ".concat(e," ").concat(t)}}f||(f="(no messages yet)");let j="";if(e.lastMessage&&"(no messages yet)"!==f){const t=e.lastMessage.sender,s="string"===typeof t?t:t&&t._id;if(s)if(String(s)===String(v))j="You: ";else{const t=(e.users||[]).find((e=>e._id===s));if(t){const e=pt(t)||"";j=(e.split(" ")[0]||e)+": "}}}f=j+f,f=f.length>60?f.slice(0,57)+"\u2026":f;const N=null!==(r=e.lastMessage)&&void 0!==r&&r.timestamp?jt(e.lastMessage.timestamp):"",w=e.lastMessage,S=Array.isArray(null===w||void 0===w?void 0:w.seen)?w.seen:[];let A=!1;if(w&&w.sender!==v){const t=S.map((e=>String(e.userId||e._id||e))).includes(String(v)),s=("number"===typeof w.timestamp?w.timestamp:w.timestamp?Date.parse(w.timestamp):w.tsNum)||0,n=ct[e._id]||0;A=!(n&&s<=n)&&(!t||s>n)}const k=!w,I=!c&&p&&ot.has(String(p._id));return(0,u.jsxs)("div",{className:"modern-chat-item ".concat((null===P||void 0===P?void 0:P._id)===e._id?"active":""," ").concat(A?"unread":""," ").concat(k?"new-chat":""),onClick:()=>(async e=>{var t;P&&P._id&&E((e=>F||O&&0!==O.length?(0,n.A)((0,n.A)({},e),{},{[P._id]:F}):e));let s=e;if("user"===e.type){const{data:t}=await d.Ay.post("/chats",{users:[v,e._id]},{headers:y});s=t,await St()}z(s),M(B[s._id]||""),C(""),D([]),L([]),h("/".concat(m,"/chat/").concat(s._id));const a=(null===(t=s)||void 0===t?void 0:t.lastMessage)&&(Date.parse(s.lastMessage.timestamp)||s.lastMessage.tsNum||Date.now())||Date.now();dt((e=>(0,n.A)((0,n.A)({},e),{},{[s._id]:a})));try{const e=JSON.parse(localStorage.getItem("chatLastRead")||"{}");e[s._id]=a,localStorage.setItem("chatLastRead",JSON.stringify(e))}catch(i){}_((e=>e.map((e=>e._id===s._id&&e.lastMessage&&!(e.lastMessage.seen||[]).map(String).includes(String(v))?(0,n.A)((0,n.A)({},e),{},{lastMessage:(0,n.A)((0,n.A)({},e.lastMessage),{},{seen:[...e.lastMessage.seen||[],v]})}):e)))),z((e=>e&&e._id===s._id&&e.lastMessage?(e.lastMessage.seen||[]).map(String).includes(String(v))?e:(0,n.A)((0,n.A)({},e),{},{lastMessage:(0,n.A)((0,n.A)({},e.lastMessage),{},{seen:[...e.lastMessage.seen||[],v]})}):e));try{b.current&&b.current.emit("markChatRead",{chatId:s._id,timestamp:a})}catch(r){}try{window.dispatchEvent(new CustomEvent("chatUnreadChanged",{detail:{chatId:s._id,action:"read"}}))}catch(o){}})(e),style:A?{background:"#eff6ff"}:void 0,children:[(0,u.jsxs)("div",{className:"modern-chat-avatar",style:{position:"relative"},children:[c?(0,u.jsx)(o.YXz,{}):g.charAt(0).toUpperCase(),!c&&(0,u.jsx)("span",{className:"presence-dot",style:{position:"absolute",bottom:-2,right:-2,width:10,height:10,borderRadius:"50%",background:I?"#10b981":"#9ca3af",border:"2px solid #fff",boxSizing:"content-box"},title:I?"Online":"Offline"})]}),(0,u.jsxs)("div",{className:"modern-chat-info",children:[(0,u.jsxs)("div",{className:"modern-chat-name",style:A?{fontWeight:600}:void 0,children:[g,k&&(0,u.jsx)("span",{style:{marginLeft:6,fontSize:10,background:"#2563eb",color:"#fff",padding:"2px 6px",borderRadius:12},children:"NEW"})]}),(0,u.jsx)("div",{className:"modern-chat-preview",style:A?{fontWeight:500,color:"#1e3a8a"}:void 0,children:f})]}),N&&(0,u.jsx)("div",{className:"modern-chat-time",style:A?{fontWeight:600}:void 0,children:N}),A&&(0,u.jsx)("div",{style:{width:8,height:8,borderRadius:"50%",background:"#2563eb",marginLeft:8}})]},e._id)}))})]}),(0,u.jsx)("div",{className:"modern-chat-section",children:(0,u.jsxs)("div",{className:"modern-chat-wrapper",children:[(0,u.jsx)("div",{className:"modern-chat-main",children:P?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"modern-chat-header",children:[(0,u.jsxs)("div",{className:"modern-chat-header-left",children:[(0,u.jsx)("div",{className:"modern-chat-header-avatar",children:P.isGroup?(0,u.jsx)(o.YXz,{}):pt(P.users.find((e=>e._id!==v))).charAt(0).toUpperCase()}),(0,u.jsxs)("div",{className:"modern-chat-header-info",children:[(0,u.jsx)("h3",{children:P.isGroup?P.name:pt(P.users.find((e=>e._id!==v)))}),(0,u.jsxs)("div",{className:"message-search-inline",style:{display:"flex",gap:4,alignItems:"center",marginTop:4},children:[(0,u.jsxs)("div",{style:{position:"relative",display:"flex",alignItems:"center",background:"#f1f3f6",borderRadius:16,padding:"2px 6px"},children:[(0,u.jsx)(o.KSO,{style:{fontSize:12,opacity:.6}}),(0,u.jsx)("input",{style:{border:"none",outline:"none",background:"transparent",fontSize:12,padding:"2px 4px",width:140},placeholder:"Search in chat",value:ne,onChange:e=>ae(e.target.value)}),ne&&(0,u.jsx)(o.QCr,{style:{cursor:"pointer",fontSize:12,opacity:.6},onClick:()=>ae("")})]}),ne&&(0,u.jsxs)("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[(0,u.jsx)("button",{disabled:!ie.length,onClick:()=>Nt(-1),className:"mini-nav-btn",title:"Previous",children:(0,u.jsx)(o.uCC,{})}),(0,u.jsx)("button",{disabled:!ie.length,onClick:()=>Nt(1),className:"mini-nav-btn",title:"Next",children:(0,u.jsx)(o.$TP,{})}),(0,u.jsxs)("span",{style:{fontSize:11,opacity:.7},children:[ie.length?oe+1:0,"/",ie.length]})]})]})]})]}),(0,u.jsx)("button",{className:"modern-info-btn",onClick:()=>Y((e=>!e)),children:"i"})]}),(0,u.jsxs)("div",{className:"modern-chat-messages",children:[W?(0,u.jsx)("div",{className:"messages-loading",children:"Loading messages\u2026"}):yt.filter((e=>{const t="string"===typeof e.content&&e.content.trim().length>0,s=Array.isArray(e.attachments)&&e.attachments.length>0;return t||s})).map(((e,t)=>{var s,n,a,i,r;let l=!1,c="";if(P.isGroup&&!e.isOwn){var d;const s=yt[t-1],n=s?s.senderId||(s.isOwn?v:s.senderId):null,a=e.senderId||(e.isOwn?v:e.senderId);if(l=!s||n!==a,e.senderId){const t=(P.users||[]).find((t=>t._id===e.senderId));t&&(c=pt(t))}if(!c&&e.forwardOf&&null!==(d=e.forwardOf)&&void 0!==d&&d.senderId){const t=(P.users||[]).find((t=>t._id===e.forwardOf.senderId));t&&(c=pt(t))}}const p=(e=>{if(!P)return null;const t=e.senderId||(e.isOwn?v:e.senderId);return t&&(P.users||[]).find((e=>e._id===t))||null})(e);!c&&p&&(c=pt(p));const m=function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").trim().split(/\s+/).filter(Boolean).slice(0,2);return e.length?e.map((e=>e.charAt(0).toUpperCase())).join(""):"U"}(c||(e.isOwn?j:"User")),h=yt[t-1],g=yt[t+1],f=(h&&(h.senderId||(h.isOwn||h.senderId),e.senderId||(e.isOwn||e.senderId)),g&&(g.senderId||(g.isOwn?v:g.senderId))===(e.senderId||(e.isOwn?v:e.senderId))),x=p&&ot instanceof Set&&ot.has(p._id),y=e.reactions.reduce(((e,t)=>(e[t.emoji]=(e[t.emoji]||0)+1,e)),{}),b=e.isOwn&&t===T.length-1,N=(b&&(null===(s=e.seen)||void 0===s||s.length),null!==(w=e.seen)&&void 0!==w&&w.length?w.map((e=>{var t;return pt(null===(t=A.find((t=>t.users.some((t=>t._id===e.userId)))))||void 0===t?void 0:t.users.find((t=>t._id===e.userId)))})).filter(Boolean):[]);var w;const S=(null===(n=e.seen)||void 0===n?void 0:n.length)>0&&(()=>{if(!P.isGroup)return b;return!T.slice(t+1).some((t=>{var s;if(null===(s=t.seen)||void 0===s||!s.length)return!1;const n=t.seen.map((e=>e.userId));return e.seen.map((e=>e.userId)).every((e=>n.includes(e)))}))})(),_=(e.content||"").replace(/<[^>]+>/g,""),k=/\s/.test(_),C=_.length>120&&!k;return(0,u.jsxs)("div",{"data-msg-index":t,className:"modern-message-wrapper ".concat(e.isOwn?"own":"other"," ").concat(ie.includes(t)?"search-hit":""),children:[(0,u.jsxs)("div",{className:"msg-bubble-outer",children:[f?(0,u.jsx)("div",{className:"msg-collapsed-spacer"}):(0,u.jsx)("div",{className:"msg-avatar-wrapper".concat(x?" presence-online":""),children:(0,u.jsx)("div",{className:"msg-avatar".concat(x?" presence-online":""),"aria-label":c,children:m})}),(0,u.jsxs)("div",{className:"msg-bubble-stack",children:[l&&c&&P.isGroup&&(0,u.jsx)("div",{className:"group-sender-outside ".concat(e.isOwn?"own":"other"),children:c}),(0,u.jsxs)("div",{className:"modern-message ".concat(e.isOwn?"own":"other"),style:{maxWidth:C?"min(64ch, 88%)":"min(88ch, 92%)",width:"fit-content",wordBreak:C?"break-all":"break-word",overflowWrap:"anywhere"},children:[(0,u.jsxs)("div",{className:"modern-message-content",children:[e.forwardOf&&(0,u.jsx)("div",{className:"forward-label",style:{fontSize:10,opacity:.6,marginBottom:2},children:"Forwarded"}),e.replyTo&&(0,u.jsx)("div",{className:"reply-ref",onClick:()=>{const t=document.querySelector("[data-reply-id='".concat(e.replyTo,"']"))||document.querySelector("[data-msg-index='".concat(yt.findIndex((t=>t._id===e.replyTo)),"']"));t&&t.scrollIntoView({behavior:"smooth",block:"center"})},style:{cursor:"pointer",background:"rgba(0,0,0,0.05)",borderLeft:"3px solid #4a68d4",padding:"4px 6px",borderRadius:4,fontSize:11,marginBottom:4},children:null===(a=(null===(i=yt.find((t=>t._id===e.replyTo)))||void 0===i?void 0:i.content)||"[Original message]")||void 0===a?void 0:a.slice(0,120)}),e.content&&(0,u.jsx)("div",{className:"msg-text",dangerouslySetInnerHTML:{__html:bt(e.content)}}),Array.isArray(e.attachments)&&e.attachments.length>0&&(0,u.jsx)("div",{className:"msg-attachments",children:e.attachments.map(((e,t)=>{const s=e.mime||"",n=s.startsWith("image/"),a=s.startsWith("video/"),i=s.startsWith("audio/"),r=e.url;if(n){if(r){const s=ht.get(r);return(0,u.jsx)("button",{type:"button",className:"att-link img",onClick:()=>{"number"===typeof s&&gt(s)},style:{border:"none",background:"transparent",padding:0,cursor:"pointer"},children:(0,u.jsx)("img",{src:r,alt:e.name,className:"att-image"})},t)}return(0,u.jsxs)("div",{className:"att-placeholder",children:["Image (loading)",e.name?": ".concat(e.name):""]},t)}return a?r?(0,u.jsx)("div",{className:"att-video",children:(0,u.jsx)("video",{src:r,controls:!0})},t):(0,u.jsxs)("div",{className:"att-placeholder",children:["Video (loading)",e.name?": ".concat(e.name):""]},t):i?r?(0,u.jsx)("div",{className:"att-audio",children:(0,u.jsx)("audio",{src:r,controls:!0})},t):(0,u.jsxs)("div",{className:"att-placeholder",children:["Audio (loading)",e.name?": ".concat(e.name):""]},t):(0,u.jsxs)("a",{href:r||"#",download:!0,target:"_blank",rel:"noopener noreferrer",className:"att-doc",children:["\ud83d\udcce ",(0,u.jsx)("span",{style:{overflow:"hidden",textOverflow:"ellipsis"},children:e.name||"File"})]},t)}))})]}),(0,u.jsx)("div",{className:"modern-message-time-row",children:(0,u.jsx)("span",{className:"msg-ts",children:jt(e.timestamp)})}),(P.isGroup?(null===(r=e.seen)||void 0===r?void 0:r.length)>0:S)&&(0,u.jsxs)("div",{className:"message-seen-info below-ts",children:[P.isGroup?(()=>{const t=N.slice(0,2),s=N.length-t.length;return(0,u.jsxs)("button",{type:"button",className:"seen-indicator group-seen ".concat(e.isOwn?"own":"other"," seen-inline"),onClick:()=>K(Z===e._id?null:e._id),title:N.length?"Seen by ".concat(N.join(", ")):"No viewers yet",children:[(0,u.jsx)("span",{className:"eye-icon","aria-hidden":"true",children:"\ud83d\udc41\ufe0f"}),0===N.length&&(0,u.jsx)("span",{children:"Unseen"}),N.length>0&&(0,u.jsxs)("span",{className:"seen-names-text",children:[t.join(", "),s>0&&" +".concat(s)]})]})})():(0,u.jsxs)("span",{className:"seen-indicator dm-seen seen-inline",children:[(0,u.jsx)("span",{className:"eye-icon","aria-hidden":"true",children:"\ud83d\udc41\ufe0f"})," Seen"]}),P.isGroup&&Z===e._id&&(0,u.jsx)("div",{className:"seen-details-tooltip",children:(0,u.jsxs)("div",{className:"seen-users-list scrollable",children:[N.map(((e,t)=>(0,u.jsx)("div",{className:"seen-user",children:(0,u.jsx)("span",{className:"seen-user-name",children:e})},t))),!N.length&&(0,u.jsx)("div",{className:"seen-user",style:{opacity:.6},children:"No viewers yet"})]})})]}),(0,u.jsx)("div",{className:"reactions-bar",children:Object.entries(y).map((t=>{let[s,n]=t;const a=e.reactions.some((e=>{var t;return("string"===typeof e.userId?e.userId:null===(t=e.userId)||void 0===t?void 0:t._id)===v&&e.emoji===s}));return(0,u.jsxs)("button",{className:"reaction-pill ".concat(a?"reacted":""),onClick:()=>kt(e,s),title:"".concat(s," ").concat(n>1?"(".concat(n,")"):""),children:[(0,u.jsx)("span",{className:"reaction-emoji",children:s}),n>1&&(0,u.jsx)("span",{className:"reaction-count",children:n})]},s)}))})]})]})]}),(0,u.jsxs)("div",{className:"msg-floating-layer ".concat(e.isOwn?"own":"other"),children:[(0,u.jsx)("div",{className:"msg-reaction-palette",children:["\ud83d\udc4d","\u2764\ufe0f","\ud83d\ude02","\ud83d\ude2e","\ud83d\ude22","\ud83d\udc4e"].map((t=>(0,u.jsx)("button",{className:"react-quick",onClick:()=>kt(e,t),title:t,children:t},t)))}),(0,u.jsxs)("div",{className:"msg-float-actions",children:[(0,u.jsx)("button",{className:"float-act-btn",title:"Reply",onClick:()=>de(e),children:(0,u.jsx)(o.w1Z,{})}),(0,u.jsx)("button",{className:"float-act-btn msg-action-trigger",title:"More",onClick:t=>{t.stopPropagation();const s=t.currentTarget.getBoundingClientRect();Ne({open:!0,msgId:e._id,x:s.left+s.width/2,y:s.top})},children:(0,u.jsx)(o.HFM,{})})]})]})]},"".concat(String(e._id),"-").concat(t))})),(0,u.jsx)("div",{ref:w})]}),te&&(0,u.jsx)("button",{className:"scroll-to-bottom-btn",onClick:wt,title:"Scroll to latest messages",children:"\u2193"}),(0,u.jsxs)("div",{className:"modern-message-input-container",children:[ce&&(0,u.jsxs)("div",{className:"reply-banner",children:["Replying to: ",(0,u.jsx)("strong",{children:(ce.content||"").slice(0,80)||"[attachment]"}),(0,u.jsx)("button",{className:"reply-cancel",onClick:()=>de(null),children:"\xd7"})]}),(0,u.jsxs)("div",{className:"modern-input-wrapper",children:[(0,u.jsxs)("label",{className:"modern-attach-btn",children:[(0,u.jsx)("img",{src:s(5500),className:"attach-icon",alt:"attach"}),(0,u.jsx)("input",{type:"file",hidden:!0,multiple:!0,accept:"image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.csv",onChange:e=>{const t=Array.from(e.target.files||[]);t.length&&L((e=>[...e,...t])),e.target.value=""}})]}),O.length>0&&(0,u.jsx)("div",{className:"pending-previews",children:O.map(((e,t)=>{const s=e.type.startsWith("image/"),n=e.type.startsWith("video/"),a=e.type.startsWith("audio/");return(0,u.jsxs)("div",{className:"pending-item",children:[s&&(0,u.jsx)("img",{src:URL.createObjectURL(e),alt:e.name,className:"pending-thumb"}),n&&(0,u.jsx)("video",{src:URL.createObjectURL(e),className:"pending-thumb",muted:!0}),a&&(0,u.jsxs)("span",{className:"pending-chip",children:["\ud83c\udfb5 ",e.name]}),!s&&!n&&!a&&(0,u.jsxs)("span",{className:"pending-chip",children:["\ud83d\udcce ",e.name]}),(0,u.jsx)("button",{className:"remove-pending",onClick:()=>L((e=>e.filter(((e,s)=>s!==t)))),children:"\xd7"})]},"".concat(e.name,"-").concat(t))}))}),(0,u.jsx)("input",{className:"modern-chat-input",placeholder:"Type your message here",value:F,onChange:e=>{const t=e.target.value;M(t),P&&P._id&&E((e=>(0,n.A)((0,n.A)({},e),{},{[P._id]:t})))},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),_t())},onPaste:async e=>{try{var t;const n=(null===(t=e.clipboardData)||void 0===t?void 0:t.items)||[],a=[];for(const e of n)if("file"===e.kind&&e.type.startsWith("image/")){const t=e.getAsFile();t&&a.push(t)}if(!a.length){const t=e.clipboardData.getData("text/plain");if(t&&/^https?:\/\//i.test(t)&&/(\.png|\.jpe?g|\.gif|\.webp|\.bmp|\.svg)(\?|#|$)/i.test(t))try{const e=await fetch(t,{mode:"cors"}),s=await e.blob();if(s&&s.type.startsWith("image/")){const e="pasted-"+Date.now()+("image/png"===s.type?".png":".img"),t=new File([s],e,{type:s.type});a.push(t)}}catch(s){}}a.length&&(e.preventDefault(),L((e=>[...e,...a])))}catch(n){}}}),(0,u.jsx)("button",{className:"modern-emoji-btn",onClick:()=>H((e=>!e)),children:"\ud83d\ude0a"}),G&&(0,u.jsx)("div",{className:"modern-emoji-picker",children:(0,u.jsx)(c.Ay,{emojiStyle:"native",onEmojiClick:e=>M((t=>(t||"")+((null===e||void 0===e?void 0:e.emoji)||""))),height:360,width:300})}),(0,u.jsx)("button",{className:"modern-send-btn",onClick:_t,disabled:!F.trim()&&0===O.length,children:(0,u.jsx)(o.Cer,{})})]})]})]}):(0,u.jsx)("div",{className:"modern-no-chat-selected",children:"Select a chat to start messaging"})}),V&&P&&(0,u.jsxs)("div",{className:"modern-contact-info",children:[(0,u.jsxs)("div",{className:"messenger-header",children:[(0,u.jsx)("button",{className:"close-details-btn",onClick:()=>Y(!1),children:"\xd7"}),(0,u.jsx)("h3",{children:"Chat Details"})]}),(0,u.jsxs)("div",{className:"messenger-content",children:[(0,u.jsxs)("div",{className:"profile-section",children:[(0,u.jsx)("div",{className:"profile-avatar-large",children:P.isGroup?(0,u.jsx)(o.YXz,{}):pt(P.users.find((e=>e._id!==v))).charAt(0).toUpperCase()}),(0,u.jsxs)("div",{className:"profile-info-large",children:[Be?(0,u.jsxs)("div",{className:"edit-name-container",children:[(0,u.jsx)("input",{type:"text",value:Oe,onChange:e=>Le(e.target.value),className:"edit-name-input",autoFocus:!0}),(0,u.jsxs)("div",{className:"edit-name-actions",children:[(0,u.jsx)("button",{className:"save-name-btn",onClick:async()=>{if(Oe.trim()&&Oe!==P.name)try{await d.Ay.put("/chats/".concat(P._id),{name:Oe.trim()},{headers:y}),z((e=>(0,n.A)((0,n.A)({},e),{},{name:Oe.trim()}))),await St(),Ee(!1)}catch(e){console.error(e)}else Ee(!1)},children:"Save"}),(0,u.jsx)("button",{className:"cancel-name-btn",onClick:()=>{Ee(!1),Le("")},children:"Cancel"})]})]}):(0,u.jsxs)("div",{className:"name-container",children:[(0,u.jsx)("h4",{children:P.isGroup?P.name:pt(P.users.find((e=>e._id!==v)))}),P.isGroup&&(0,u.jsx)("div",{className:"edit-name-wrapper",children:(0,u.jsx)("button",{className:"edit-name-btn",onClick:()=>{Le(P.name),Ee(!0)},children:(0,u.jsx)("span",{children:"Edit"})})})]}),(0,u.jsx)("p",{className:"chat-type",children:P.isGroup?"Group Chat":"Direct Message"})]})]}),(0,u.jsx)("div",{className:"actions-section",children:P.isGroup&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("button",{className:"action-btn add-members-btn",onClick:()=>Ue(!0),children:(0,u.jsx)(o.NPy,{})}),(0,u.jsx)("button",{className:"action-btn leave-btn",onClick:async()=>{if(null===P||void 0===P||!P.isGroup)return;if(window.confirm("Leave this group chat?"))try{await d.Ay.post("/chats/".concat(P._id,"/leave"),{},{headers:y}),_((e=>e.filter((e=>e._id!==P._id)))),z(null),h("/".concat(m,"/chat"))}catch(s){var e,t;alert((null===s||void 0===s||null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Failed to leave group")}},children:(0,u.jsx)(o.axc,{})})]})}),(0,u.jsxs)("div",{className:"details-section",children:[(0,u.jsx)("h5",{children:"Details"}),P.isGroup?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"detail-item",children:[(0,u.jsx)("span",{className:"detail-label",children:"Group Name"}),(0,u.jsx)("span",{className:"detail-value",children:P.name})]}),(0,u.jsxs)("div",{className:"detail-item",children:[(0,u.jsx)("span",{className:"detail-label",children:"Members"}),(0,u.jsxs)("span",{className:"detail-value",children:[Dt.length," people"]})]})]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"detail-item",children:[(0,u.jsx)("span",{className:"detail-label",children:"Name"}),(0,u.jsx)("span",{className:"detail-value",children:pt(P.users.find((e=>e._id!==v)))})]}),(0,u.jsxs)("div",{className:"detail-item",children:[(0,u.jsx)("span",{className:"detail-label",children:"Email"}),(0,u.jsx)("span",{className:"detail-value",children:null===(t=P.users.find((e=>e._id!==v)))||void 0===t?void 0:t.email})]})]}),(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsxs)("div",{className:"info-tab-buttons",children:[(0,u.jsx)("button",{className:"media"===q?"active":"",onClick:()=>$("media"),children:"Media"}),(0,u.jsx)("button",{className:"files"===q?"active":"",onClick:()=>$("files"),children:"Files"})]}),"media"===q&&(0,u.jsxs)("div",{className:"info-media-grid",style:{maxHeight:200,overflowY:"auto",display:"flex",flexWrap:"wrap",gap:6,paddingTop:6},children:[ut.map(((e,t)=>(0,u.jsx)("div",{className:"info-media-item",style:{width:60,height:60,overflow:"hidden",borderRadius:4,cursor:"pointer",background:"#f8f9fa",border:"1px solid #e5e7eb"},onClick:()=>gt(t),children:(0,u.jsx)("img",{src:e.url,alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover"}})},t))),0===ut.length&&(0,u.jsx)("div",{style:{fontSize:12,opacity:.6},children:"No images"})]}),"files"===q&&(0,u.jsxs)("div",{className:"info-files-list",style:{maxHeight:200,overflowY:"auto",display:"flex",flexDirection:"column",gap:4,paddingTop:6},children:[T.flatMap((e=>e.attachments||[])).filter((e=>!(e.mime&&e.mime.startsWith("image/")))).map(((e,t)=>(0,u.jsxs)("a",{href:e.url,download:!0,style:{textDecoration:"none",color:"#0b5fff",fontSize:12,background:"#f8f9fa",padding:"4px 6px",borderRadius:6,border:"1px solid #e5e7eb"},children:["\ud83d\udcce ",e.name]},t))),0===T.flatMap((e=>e.attachments||[])).filter((e=>!(e.mime&&e.mime.startsWith("image/")))).length&&(0,u.jsx)("div",{style:{fontSize:12,opacity:.6},children:"No files"})]})]})]}),P.isGroup&&(0,u.jsxs)("div",{className:"members-section",children:[(0,u.jsxs)("button",{type:"button",className:"members-header-toggle",onClick:()=>Je((e=>!e)),style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",background:"transparent",border:"none",padding:"6px 0",cursor:"pointer",fontSize:14,fontWeight:600,color:"#222",borderBottom:"1px solid rgba(0,0,0,0.08)",marginTop:12},children:[(0,u.jsxs)("span",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,u.jsx)("span",{style:{letterSpacing:".5px"},children:"Members"}),(0,u.jsx)("span",{style:{fontSize:11,background:"#e5e7eb",padding:"2px 6px",borderRadius:12,color:"#111"},children:Dt.length})]}),(0,u.jsx)("span",{style:{fontSize:12,opacity:.7},children:Xe?"\u25b2":"\u25bc"})]}),Xe&&(0,u.jsx)("div",{className:"members-list",children:Dt.map(((e,t)=>{var s,n,a,i;const r=P.creator&&(P.creator===e._id||(null===(s=P.creator)||void 0===s?void 0:s._id)===e._id);return(0,u.jsxs)("div",{className:"member-item",children:[(0,u.jsx)("div",{className:"member-avatar",children:pt(e).charAt(0).toUpperCase()}),(0,u.jsxs)("div",{className:"member-info",children:[(0,u.jsx)("span",{className:"member-name",children:pt(e)}),e._id===v&&(0,u.jsx)("span",{className:"member-badge",children:"You"}),r&&(0,u.jsx)("span",{className:"member-badge admin",children:"Admin"})]}),e._id!==v&&(P.creator===v||(null===(n=P.creator)||void 0===n?void 0:n._id)===v||(null===(a=P.users)||void 0===a||null===(i=a[0])||void 0===i?void 0:i._id)===v)&&(0,u.jsx)("button",{className:"remove-member-btn",onClick:()=>It(e._id),title:"Remove member",children:"\xd7"})]},"".concat(e._id,"-").concat(t))}))})]})]}),We&&(0,u.jsxs)("div",{className:"add-members-modal",children:[(0,u.jsxs)("div",{className:"modal-header add-members-header",style:{display:"flex",flexDirection:"column",gap:8},children:[(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,u.jsx)("h4",{style:{flex:1,margin:0},children:"Add Members"}),(0,u.jsx)("button",{className:"close-modal-btn",onClick:()=>Ue(!1),"aria-label":"Close",children:"\xd7"})]}),(0,u.jsx)("div",{className:"search-row",style:{width:"100%"},children:(0,u.jsx)("input",{type:"text",placeholder:"Search users...",className:"search-input",value:qe,onChange:e=>$e(e.target.value),style:{width:"100%"}})})]}),(0,u.jsxs)("div",{className:"modal-content",children:[(0,u.jsxs)("div",{className:"users-list",children:[mt.map(((e,t)=>(0,u.jsxs)("label",{className:"user-checkbox-item",children:[(0,u.jsx)("input",{type:"checkbox",checked:Ve.includes(e._id),onChange:()=>{Ye((t=>t.includes(e._id)?t.filter((t=>t!==e._id)):[...t,e._id]))}}),(0,u.jsx)("div",{className:"user-avatar",children:pt(e).charAt(0).toUpperCase()}),(0,u.jsx)("span",{className:"user-name",children:pt(e)})]},"".concat(e._id,"-").concat(t)))),0===mt.length&&(0,u.jsx)("div",{style:{fontSize:12,opacity:.6,padding:"4px 2px"},children:"No users found."})]}),(0,u.jsx)("div",{className:"modal-actions",children:(0,u.jsxs)("button",{className:"add-members-submit-btn",onClick:async()=>{if(Ve.length)try{const a=[...P.users.map((e=>e._id)),...Ve];try{await d.Ay.put("/chats/".concat(P._id),{users:a},{headers:y})}catch(s){var e,t;if(403===(null===s||void 0===s||null===(e=s.response)||void 0===e?void 0:e.status))return void alert((null===(t=s.response.data)||void 0===t?void 0:t.error)||"You are not allowed to add members.");throw s}z((e=>e?(0,n.A)((0,n.A)({},e),{},{users:Array.from(new Set([...e.users.map((e=>e._id?e._id:e)),...Ve])).map((t=>e.users.find((e=>e._id===t))||{_id:t,name:""}))}):e)),await St(),Ue(!1),Ye([])}catch(a){console.error("Add members failed:",a)}},disabled:0===Ve.length,children:["Add ",Ve.length," member",1!==Ve.length?"s":""]})})]})]})]})]})})]})]}),Ze&&ut[Qe]&&(0,u.jsxs)("div",{className:"media-viewer-overlay",onClick:ft,style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.85)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[(0,u.jsx)("div",{style:{position:"absolute",top:12,right:20,display:"flex",gap:12},children:(0,u.jsx)("button",{onClick:e=>{e.stopPropagation(),ft()},style:{background:"rgba(255,255,255,0.15)",color:"#fff",border:"none",fontSize:24,width:44,height:44,borderRadius:"50%",cursor:"pointer"},children:"\xd7"})}),(0,u.jsx)("button",{onClick:e=>{e.stopPropagation(),xt(-1)},style:{position:"absolute",left:10,background:"rgba(255,255,255,0.15)",color:"#fff",border:"none",fontSize:32,width:48,height:72,borderRadius:6,cursor:"pointer"},children:"\u2039"}),(0,u.jsx)("img",{src:ut[Qe].url,alt:ut[Qe].name||"Image",onClick:e=>e.stopPropagation(),style:{maxWidth:"90%",maxHeight:"85%",objectFit:"contain",boxShadow:"0 0 12px rgba(0,0,0,0.6)",borderRadius:8}}),(0,u.jsx)("button",{onClick:e=>{e.stopPropagation(),xt(1)},style:{position:"absolute",right:10,background:"rgba(255,255,255,0.15)",color:"#fff",border:"none",fontSize:32,width:48,height:72,borderRadius:6,cursor:"pointer"},children:"\u203a"}),(0,u.jsxs)("div",{style:{marginTop:12,color:"#eee",fontSize:13},onClick:e=>e.stopPropagation(),children:[Qe+1," / ",ut.length," ",ut[Qe].name?"\u2014 "+ut[Qe].name:""]})]})]})}},8370:(e,t,s)=>{e.exports=s.p+"static/media/FadzLogo1.7cb95760a42ff4cc7b15.png"},8818:(e,t,s)=>{s.d(t,{A:()=>m});var n=s(5043),a=s(3216),i=s(5475),r=s(4801),o=s(3204),l=s(411),c=s(2063),d=s(2104),p=s(579);const u={pic:e=>{const t=e.activeProject;return[{to:"/pic",label:"Dashboard",icon:(0,p.jsx)(o.$BV,{}),match:"/pic"},{to:"/pic/chat",label:"Chat",icon:(0,p.jsx)(o.uN,{}),match:"/pic/chat"},{to:"/pic/requests",label:"Requests",icon:(0,p.jsx)(o.kkc,{}),match:"/pic/requests"},t&&{to:"/pic/".concat(t._id),label:"View Project",icon:(0,p.jsx)(o.Ny1,{}),match:"/pic/"+(null===t||void 0===t?void 0:t._id)},{to:"/pic/projects",label:"My Projects",icon:(0,p.jsx)(o.yd7,{}),match:"/pic/projects"}].filter(Boolean)},pm:e=>{const t=e.activeProject;return[{to:"/pm",label:"Dashboard",icon:(0,p.jsx)(o.$BV,{}),match:"/pm"},{to:"/pm/chat",label:"Chat",icon:(0,p.jsx)(o.uN,{}),match:"/pm/chat"},t&&{to:"/pm/request/"+t._id,label:"Material",icon:(0,p.jsx)(o.H5e,{}),match:"/pm/request"},{to:"/pm/manpower-list",label:"Manpower",icon:(0,p.jsx)(o.YXz,{}),match:"/pm/manpower-list"},t&&{to:"/pm/viewprojects/".concat(t._id),label:"View Project",icon:(0,p.jsx)(o.Ny1,{}),match:"/pm/viewprojects/"+t._id},{to:"/pm/projects",label:"Projects",icon:(0,p.jsx)(o.yd7,{}),match:"/pm/projects"}].filter(Boolean)},am:e=>[{to:"/am",label:"Dashboard",icon:(0,p.jsx)(o.$BV,{}),match:"/am"},{to:"/am/chat",label:"Chat",icon:(0,p.jsx)(o.uN,{}),match:"/am/chat"},{to:"/am/matreq",label:"Material",icon:(0,p.jsx)(o.H5e,{}),match:"/am/matreq"},{to:"/am/viewproj",label:"Projects",icon:(0,p.jsx)(o.yd7,{}),match:"/am/viewproj"}],ceo:()=>[{to:"/ceo/dash",label:"Dashboard",icon:(0,p.jsx)(o.$BV,{}),match:"/ceo/dash"},{to:"/ceo/chat",label:"Chat",icon:(0,p.jsx)(o.uN,{}),match:"/ceo/chat"},{to:"/ceo/manpower-requests",label:"Manpower",icon:(0,p.jsx)(o.YXz,{}),match:"/ceo/manpower-requests"},{to:"/ceo/proj",label:"Projects",icon:(0,p.jsx)(o.yd7,{}),match:"/ceo/proj"},{to:"/ceo/material-list",label:"Materials",icon:(0,p.jsx)(o.H5e,{}),match:"/ceo/material-list"},{to:"/ceo/audit-logs",label:"Audit Logs",icon:(0,p.jsx)(o.kkc,{}),match:"/ceo/audit-logs"}],it:()=>[{to:"/it",label:"Dashboard",icon:(0,p.jsx)(o.$BV,{}),match:"/it"},{to:"/it/chat",label:"Chat",icon:(0,p.jsx)(o.uN,{}),match:"/it/chat"},{to:"/it/material-list",label:"Materials",icon:(0,p.jsx)(o.H5e,{}),match:"/it/material-list"},{to:"/it/manpower-list",label:"Manpower",icon:(0,p.jsx)(o.YXz,{}),match:"/it/manpower-list"},{to:"/it/auditlogs",label:"Audit Logs",icon:(0,p.jsx)(o.kkc,{}),match:"/it/auditlogs"},{to:"/it/projects",label:"Projects",icon:(0,p.jsx)(o.yd7,{}),match:"/it/projects"}],staff:()=>[{to:"/staff",label:"Project",icon:(0,p.jsx)(o.Ny1,{}),match:"/staff"},{to:"/staff/chat",label:"Chat",icon:(0,p.jsx)(o.uN,{}),match:"/staff/chat"},{to:"/staff/all-projects",label:"My Projects",icon:(0,p.jsx)(o.yd7,{}),match:"/staff/all-projects"}],hrsite:()=>[{to:"/hr-site/current-project",label:"Project",icon:(0,p.jsx)(o.Ny1,{}),match:"/hr-site/current-project"},{to:"/hr-site/chat",label:"Chat",icon:(0,p.jsx)(o.uN,{}),match:"/hr-site/chat"},{to:"/hr-site/all-projects",label:"My Projects",icon:(0,p.jsx)(o.yd7,{}),match:"/hr-site/all-projects"}],hr:()=>[{to:"/hr/dash",label:"Dashboard",icon:(0,p.jsx)(o.$BV,{}),match:"/hr/dash"},{to:"/hr/chat",label:"Chat",icon:(0,p.jsx)(o.uN,{}),match:"/hr/chat"},{to:"/hr/mlist",label:"Manpower",icon:(0,p.jsx)(o.YXz,{}),match:"/hr/mlist"},{to:"/hr/movement",label:"Movement",icon:(0,p.jsx)(o.yk7,{}),match:"/hr/movement"},{to:"/hr/project-records",label:"Projects",icon:(0,p.jsx)(o.yd7,{}),match:"/hr/project-records"},{to:"/hr/attendance",label:"Attendance",icon:(0,p.jsx)(o.bfZ,{}),match:"/hr/attendance"}]},m=e=>{var t;let{roleSegment:o="pic",extraRight:m,extraLeft:h,overrideNav:g,showBelow:f=!1,below:x,onLogout:v}=e;const j=(0,a.zy)(),y=(0,a.Zp)(),b=localStorage.getItem("user"),N=b?JSON.parse(b):null,w=(null===N||void 0===N?void 0:N.name)||"User",S=((null===N||void 0===N?void 0:N.role)||(null===N||void 0===N?void 0:N.userType)||(null===N||void 0===N?void 0:N.position)||(null===N||void 0===N?void 0:N.designation)||o).toString(),[A,_]=(0,n.useState)(!1),[k,C]=(0,n.useState)(null),[I,D]=(0,n.useState)(0),[P,z]=(0,n.useState)(null);(0,n.useEffect)((()=>{localStorage.getItem("token");let e;try{e=(0,d.io)(c.G,{path:c.c,transports:["websocket","polling"],auth:{userId:null===N||void 0===N?void 0:N._id}}),z(e)}catch(s){}const t=e=>{e&&e.chatId&&T()};return e&&e.on("chatUpdated",t),()=>{e&&(e.off("chatUpdated",t),e.disconnect())}}),[null===N||void 0===N?void 0:N._id]);const T=async()=>{try{const{data:e}=await l.Ay.get("/chats"),t=null===N||void 0===N?void 0:N._id,s=(e||[]).filter((e=>{if(!e.lastMessage)return!1;if(String(e.lastMessage.sender)===String(t))return!1;return!(e.lastMessage.seen||[]).map(String).includes(String(t))})).length;D(s)}catch(e){D(0)}};(0,n.useEffect)((()=>{T()}),[]);const R=(0,n.useRef)("undefined"!==typeof document?document.title:"FadzTrack"),[F,M]=(0,n.useState)(!0);(0,n.useEffect)((()=>{const e=()=>M(!0),t=()=>M(!1);return window.addEventListener("focus",e),window.addEventListener("blur",t),()=>{window.removeEventListener("focus",e),window.removeEventListener("blur",t)}}),[]),(0,n.useEffect)((()=>{try{const e=R.current||"FadzTrack";if(!F&&I>0){const t=I>99?"99+":String(I);document.title="(".concat(t,") ").concat(e)}else document.title=e}catch(e){}}),[I,F]),(0,n.useEffect)((()=>{const e=e=>{var t;"read"===(null===e||void 0===e||null===(t=e.detail)||void 0===t?void 0:t.action)&&T()};return window.addEventListener("chatUnreadChanged",e),()=>window.removeEventListener("chatUnreadChanged",e)}),[]),(0,n.useEffect)((()=>{let e=!1;if(null!==N&&void 0!==N&&N._id)return"pic"===o?l.Ay.get("/projects/by-user-status?userId=".concat(N._id,"&role=pic&status=Ongoing")).then((t=>{let{data:s}=t;e||C((null===s||void 0===s?void 0:s[0])||null)})).catch((()=>!e&&C(null))):"pm"===o&&l.Ay.get("/projects/by-user-status?userId=".concat(N._id,"&role=projectmanager&status=Ongoing")).then((t=>{let{data:s}=t;e||C((null===s||void 0===s?void 0:s[0])||null)})).catch((()=>!e&&C(null))),()=>{e=!0}}),[o,null===N||void 0===N?void 0:N._id]),(0,n.useEffect)((()=>{function e(e){try{if(e&&e.key&&"activeProjectInvalidated"!==e.key)return;"1"===localStorage.getItem("activeProjectInvalidated")&&("pm"===o?l.Ay.get("/projects/by-user-status?userId=".concat(N._id,"&role=projectmanager&status=Ongoing")).then((e=>{let{data:t}=e;C((null===t||void 0===t?void 0:t[0])||null),localStorage.removeItem("activeProjectInvalidated")})):"pic"===o&&l.Ay.get("/projects/by-user-status?userId=".concat(N._id,"&role=pic&status=Ongoing")).then((e=>{let{data:t}=e;C((null===t||void 0===t?void 0:t[0])||null),localStorage.removeItem("activeProjectInvalidated")})))}catch(t){}}window.addEventListener("storage",e);const t=setInterval((()=>e({key:"activeProjectInvalidated"})),6e4);return()=>{window.removeEventListener("storage",e),clearInterval(t)}}),[o,null===N||void 0===N?void 0:N._id]),(0,n.useEffect)((()=>{const e=e=>{e.target.closest(".profile-menu-container")||_(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[]);const B={activeProject:k},E=u[o]?o:o.replace(/-/g,"");let O=g||(u[E]?u[E](B):[]);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("header",{className:"pic-header pp-navbar",children:[(0,p.jsxs)("div",{className:"pp-left",children:[h,(0,p.jsx)("img",{src:s(8370),alt:"FadzTrack",className:"pp-logo"}),(0,p.jsx)("span",{className:"pp-brand",children:"FadzTrack"}),(0,p.jsx)("nav",{className:"pp-nav",children:O.map((e=>{const t=["/pic","/pm","/am","/ceo","/it","/staff","/hr-site"].includes(e.match),s=j.pathname.replace(/\/$/,""),n=e.match.replace(/\/$/,""),a=/^\/pic\/projects\/[^/]+\/request(\/|$)?/.test(s);let r=s===n||!t&&s.startsWith(n+"/");a&&(/\/pic\/requests$/.test(n)&&"Requests"===e.label&&(r=!0),/\/pic\/projects$/.test(n)&&"My Projects"===e.label&&(r=!1));const o=/\/chat$/.test(e.to);return(0,p.jsxs)(i.N_,{to:e.to,className:"pp-link".concat(r?" active":""),children:[e.icon,(0,p.jsx)("span",{children:e.label}),o&&I>0&&(0,p.jsx)("span",{className:"chat-unread-badge",children:I>99?"99+":I})]},e.to)}))})]}),(0,p.jsxs)("div",{className:"pp-right",children:[(0,p.jsx)(r.A,{}),m,(0,p.jsxs)("div",{className:"pp-user profile-menu-container",onClick:()=>_((e=>!e)),children:[(0,p.jsx)("div",{className:"pp-avatar",children:(null===(t=w[0])||void 0===t?void 0:t.toUpperCase())||"U"}),(0,p.jsxs)("div",{className:"pp-user-text",children:[(0,p.jsx)("span",{className:"pp-username",children:w}),(0,p.jsx)("span",{className:"pp-role",children:S})]}),A&&(0,p.jsx)("div",{className:"pp-dropdown",children:(0,p.jsx)("button",{onClick:()=>{v?v():(localStorage.removeItem("token"),localStorage.removeItem("user"),window.dispatchEvent(new Event("storage")),y("/"))},children:"Logout"})})]})]})]}),f&&x&&(0,p.jsx)("div",{className:"pic-header-below",children:x})]})}}}]);
//# sourceMappingURL=141.094a986b.chunk.js.map
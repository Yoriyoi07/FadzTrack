{"version":3,"file":"static/js/141.094a986b.chunk.js","mappings":"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","sources":["components/project/ProjectView.js","components/NotificationBell.js","utils/projectPdf.js","components/chats/AreaChat.js","components/layout/AppHeader.js"],"sourcesContent":["// Reusable ProjectView component with role-based permissions (pm, am, ceo, hr)\r\n// Extracted and refactored from original PM-specific implementation.\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport AppHeader from '../layout/AppHeader';\r\nimport { Link, useNavigate, useParams, useLocation } from 'react-router-dom';\r\nimport { io } from 'socket.io-client';\r\nimport NotificationBell from '../NotificationBell';\r\nimport api from '../../api/axiosInstance';\r\nimport { SOCKET_URL as SOCKET_ORIGIN, SOCKET_PATH } from '../../utils/socketConfig';\r\nimport { exportProjectDetails } from '../../utils/projectPdf';\r\nimport {\r\n  FaRegCommentDots, FaRegFileAlt, FaRegListAlt, FaDownload, FaCalendarAlt, FaMapMarkerAlt,\r\n  FaUsers, FaUserTie, FaBuilding, FaMoneyBillWave, FaCheckCircle, FaClock, FaTrash, FaCamera\r\n} from 'react-icons/fa';\r\nimport { FaTachometerAlt, FaComments, FaBoxes, FaUsers as FaUsersNav, FaProjectDiagram, FaClipboardList, FaChartBar, FaCalendarAlt as FaCalendarAltNav } from 'react-icons/fa';\r\nimport \"../style/pm_style/Pm_Dash.css\";\r\nimport \"../style/pm_style/Pm_ViewProjects.css\";\r\nimport \"../style/pm_style/Pm_ViewProjects_Wide.css\";\r\n// Staff style sheet (safe to load globally; selectors are namespaced under .staff-view-root)\r\nimport \"../style/staff_style/Staff_ViewProject.css\";\r\n\r\n// Centralized socket origin/path from utils/socketConfig\r\n\r\nfunction extractOriginalNameFromPath(path) {\r\n  const base = (path || '').split('/').pop() || '';\r\n  const underscore = base.indexOf('_');\r\n  if (underscore !== -1 && underscore < base.length - 1) return base.slice(underscore + 1);\r\n  const m = base.match(/^project-\\d{8,}-(.+)$/i);\r\n  if (m && m[1]) return m[1];\r\n  return base;\r\n}\r\nfunction getFileType(fileName) {\r\n  const ext = fileName.split('.').pop()?.toLowerCase();\r\n  const map = { pdf:'PDF', doc:'DOC', docx:'DOCX', xls:'XLS', xlsx:'XLSX', ppt:'PPT', pptx:'PPTX', txt:'TXT', rtf:'RTF', csv:'CSV', jpg:'JPG', jpeg:'JPEG', png:'PNG', gif:'GIF', bmp:'BMP', svg:'SVG' };\r\n  return map[ext] || 'FILE';\r\n}\r\nfunction getFileSize() { return 'N/A'; }\r\nasync function openSignedPath(path) { try { const { data } = await api.get(`/photo-signed-url?path=${encodeURIComponent(path)}`); const url=data?.signedUrl; if(!url) throw 0; window.open(url,'_blank','noopener,noreferrer'); } catch { alert('Failed to open attachment.'); } }\r\nasync function openReportSignedPath(projectId, path) {\r\n  try {\r\n    if(!projectId) throw new Error('Missing project id');\r\n    const { data } = await api.get(`/projects/${encodeURIComponent(projectId)}/reports-signed-url`, { params: { path } });\r\n    const url = data?.signedUrl; if(!url) throw new Error('No signed url');\r\n    window.open(url,'_blank','noopener,noreferrer');\r\n  } catch (e) { console.error('Failed to open report file', e); alert('Failed to open report file.'); }\r\n}\r\nasync function fetchSignedUrlsForImages(files){ const imgs=files.filter(f=>{ const name= typeof f==='string'? extractOriginalNameFromPath(f) : f.name || extractOriginalNameFromPath(f.path); return ['JPG','JPEG','PNG','GIF','BMP','SVG'].includes(getFileType(name));}); const out={}; for(const f of imgs){ const p= typeof f==='string'? f : f.path; try { const {data}=await api.get(`/photo-signed-url?path=${encodeURIComponent(p)}`); if(data?.signedUrl) out[p]=data.signedUrl; } catch{} } return out; }\r\nfunction generateFileThumbnail(fileName,filePath,fileType,signedUrl){\r\n  const SIZE_H = 100; // height only; width fills parent tile\r\n  const baseTileStyle={width:'100%',height:SIZE_H,overflow:'hidden',borderRadius:8,position:'relative',display:'flex',alignItems:'center',justifyContent:'center',background:'#f1f5f9',boxShadow:'0 0 0 1px #e2e8f0 inset'};\r\n  const isImg=['JPG','JPEG','PNG','GIF','BMP','SVG'].includes(fileType);\r\n  if(isImg){\r\n    if(!signedUrl){\r\n      return <div className=\"file-thumbnail image-thumbnail\" style={baseTileStyle}><span style={{fontSize:34,lineHeight:1,color:'#94a3b8'}}></span></div>;\r\n    }\r\n    return <div className=\"file-thumbnail image-thumbnail\" style={baseTileStyle}><img src={signedUrl} alt={fileName} style={{width:'100%',height:'100%',objectFit:'cover',display:'block'}} /></div>;\r\n  }\r\n  const map={ PDF:['#ff6b6b','#ee5a52',''], DOC:['#4ecdc4','#44a08d',''], DOCX:['#4ecdc4','#44a08d',''], XLS:['#45b7d1','#96c93d',''], XLSX:['#45b7d1','#96c93d',''], PPT:['#f093fb','#f5576c',''], PPTX:['#f093fb','#f5576c',''], TXT:['#a8edea','#fed6e3',''], RTF:['#a8edea','#fed6e3',''], CSV:['#ffecd2','#fcb69f',''], FILE:['#667eea','#764ba2',''] };\r\n  const s=map[fileType]||map.FILE;\r\n  return <div className=\"file-thumbnail document-thumbnail\" style={{...baseTileStyle,background:`linear-gradient(135deg,${s[0]},${s[1]})`,flexDirection:'column',color:'#fff'}}><span className=\"thumbnail-icon\" style={{fontSize:34,lineHeight:1}}>{s[2]}</span><span className=\"thumbnail-extension\" style={{fontSize:11,marginTop:6,fontWeight:600,letterSpacing:.5}}>{fileType}</span></div>;\r\n}\r\nfunction renderMessageText(text='',me=''){ const slug=(me||'').trim().toLowerCase().replace(/\\s+/g,''); if(!slug||!text) return text; const re=new RegExp(`@${slug}\\\\b`,'gi'); const parts=text.split(re); if(parts.length===1) return text; return parts.map((p,i)=> i===0? p : <React.Fragment key={i}><span style={{background:'#f6c343',color:'#3a2f00',padding:'2px 6px',borderRadius:4,fontWeight:'bold',fontSize:'0.9em'}}>@{me}</span>{p}</React.Fragment>); }\r\nfunction isMentioned(text='',me=''){ const slug=(me||'').trim().toLowerCase().replace(/\\s+/g,''); if(!slug||!text) return false; return text.toLowerCase().replace(/\\s+/g,'').includes(`@${slug}`); }\r\nfunction readContractor(p){\r\n  if(!p) return 'N/A';\r\n  const cRaw = p.contractor !== undefined && p.contractor !== null ? p.contractor : p.contractorName;\r\n  if(!cRaw) return 'N/A';\r\n  if(typeof cRaw === 'string') return cRaw.trim() || 'N/A';\r\n  if(Array.isArray(cRaw)){\r\n    const names = cRaw.map(x=> typeof x==='string'? x : (x?.name||x?.company||x?.companyName||x?.title||x?.fullName||''))\r\n      .map(s=> (s||'').trim()).filter(Boolean);\r\n    if(names.length) return names.join(', ');\r\n  }\r\n  if(typeof cRaw === 'object'){\r\n    for(const k of ['name','company','companyName','title','fullName']){\r\n      if(typeof cRaw[k] === 'string' && cRaw[k].trim()) return cRaw[k].trim();\r\n    }\r\n  }\r\n  return 'N/A';\r\n}\r\nconst peso = new Intl.NumberFormat('en-PH',{ style:'currency', currency:'PHP' });\r\nconst mentionRowStyles={ container:{position:'relative',background:'#fffbe6',border:'1px solid #f6c343',boxShadow:'0 0 0 2px rgba(246,195,67,.25) inset',borderRadius:10}, badge:{position:'absolute',top:6,right:6,fontSize:12,lineHeight:'16px',background:'#f6c343',color:'#3a2f00',borderRadius:999,padding:'2px 8px',fontWeight:700}};\r\nconst roleConfigs={\r\n  pic:{ label:'Person in Charge', permissions:{ image:false,statusToggle:false,uploadFiles:true,deleteFiles:true,postDiscuss:true }, base:'/pic'},\r\n  pm:{ label:'Project Manager', permissions:{ image:true,statusToggle:true,uploadFiles:true,deleteFiles:true,postDiscuss:true }, base:'/pm'},\r\n  am:{ label:'Area Manager', permissions:{ image:true,statusToggle:false,uploadFiles:true,deleteFiles:true,postDiscuss:true }, base:'/am'},\r\n  ceo:{ label:'CEO', permissions:{ image:false,statusToggle:false,uploadFiles:false,deleteFiles:false,postDiscuss:false }, base:'/ceo'},\r\n  hr:{ label:'HR', permissions:{ image:false,statusToggle:false,uploadFiles:false,deleteFiles:false,postDiscuss:false }, base:'/hr'},\r\n  it:{ label:'IT', permissions:{ image:false,statusToggle:false,uploadFiles:false,deleteFiles:false,postDiscuss:false }, base:'/it'},\r\n  staff:{ label:'Staff', permissions:{ image:false,statusToggle:false,uploadFiles:false,deleteFiles:false,postDiscuss:true }, base:'/staff'},\r\n  hrsite:{ label:'HR-Site', permissions:{ image:false,statusToggle:false,uploadFiles:false,deleteFiles:false,postDiscuss:true }, base:'/hr-site'}\r\n};\r\n\r\nexport default function ProjectView(props) {\r\n  const { role='pm', navItems, permissionsOverride, navPathOverrides, useUnifiedHeader: useUnifiedHeaderProp=false } = props || {};\r\n  // Use unified header only when explicitly requested by parent\r\n  const useUnifiedHeader = !!useUnifiedHeaderProp;\r\n  const { id } = useParams();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const token = localStorage.getItem('token');\r\n  const roleCfg = roleConfigs[role] || roleConfigs.pm;\r\n  const perms = { ...roleCfg.permissions, ...(permissionsOverride||{}) };\r\n  const basePath = roleCfg.base;\r\n  // Role-specific route differences (legacy structure mapping)\r\n  const viewProjectPathMap = {\r\n  pic: `${basePath}/current-project${id?`/${id}`:''}`,\r\n    pm: `${basePath}/viewprojects/${id}`,\r\n    am: `${basePath}/projects/${id}`,\r\n    ceo: `${basePath}/proj/${id}`,\r\n    hr: `${basePath}/project-records/${id}`,\r\n    it: `${basePath}/projects/${id}`,\r\n  staff: `${basePath}/current-project${id?`/${id}`:''}`,\r\n  hrsite: `${basePath}/current-project${id?`/${id}`:''}`\r\n  };\r\n  const progressReportPathMap = {\r\n  pic: `${basePath}/progress-report/${id}`,\r\n    pm: `${basePath}/progress-report/${id}`,\r\n    am: `${basePath}/progress-report/${id}`,\r\n    ceo: `${basePath}/progress-report/${id}`,\r\n    hr: `${basePath}/progress-report/${id}`,\r\n  it: `${basePath}/progress-report/${id}`,\r\n  hrsite: `${basePath}/progress-report/${id}`\r\n  };\r\n  const dailyLogsPathMap = {\r\n  pic: `${basePath}/daily-logs-list`,\r\n    pm: `${basePath}/daily-logs-list`,\r\n    am: `${basePath}/daily-logs-list`,\r\n    ceo: `${basePath}/daily-logs-list`,\r\n    hr: `${basePath}/daily-logs-list`,\r\n  it: `${basePath}/daily-logs-list`,\r\n  hrsite: `${basePath}/daily-logs-list`\r\n  };\r\n  const defaultNav = [\r\n    { to: basePath, icon:<FaTachometerAlt/>, label:'Dashboard' },\r\n    { to: `${basePath}/chat`, icon:<FaComments/>, label:'Chat' },\r\n    { to: `${basePath}/request/:id`, icon:<FaBoxes/>, label:'Material' },\r\n    // Exclude Manpower tab for Area Manager per request\r\n    ...(role === 'am' ? [] : [{ to: `${basePath}/manpower-list`, icon:<FaUsersNav/>, label:'Manpower' }]),\r\n  { to: viewProjectPathMap[role] || `${basePath}/viewprojects/${id}`, icon:<FaProjectDiagram/>, label:'View Project', active:true },\r\n  { to: `${basePath}/budget/${id}`, icon:<FaMoneyBillWave/>, label:'Budget' },\r\n    // Legacy nav items (Logs / Reports / Daily Logs) intentionally omitted for PM when using unified header\r\n    ...(!useUnifiedHeader ? [\r\n      { to: `${basePath}/daily-logs`, icon:<FaClipboardList/>, label:'Logs' },\r\n      { to: progressReportPathMap[role] || `${basePath}/progress-report/${id}`, icon:<FaChartBar/>, label:'Reports' },\r\n      { to: dailyLogsPathMap[role] || `${basePath}/daily-logs-list`, icon:<FaCalendarAltNav/>, label:'Daily Logs' }\r\n    ] : [])\r\n  ].map(item => navPathOverrides && navPathOverrides[item.label] ? { ...item, to: navPathOverrides[item.label] } : item);\r\n  const nav = navItems || defaultNav;\r\n  const userRef = useRef(null); if(userRef.current===null){ try { userRef.current = JSON.parse(localStorage.getItem('user')); } catch { userRef.current=null; } }\r\n  const user = userRef.current; const userId = user?._id || null; const [userName] = useState(user?.name || roleCfg.label.split(' ')[0]);\r\n  const [profileMenuOpen,setProfileMenuOpen]=useState(false);\r\n  const [isHeaderCollapsed,setIsHeaderCollapsed]=useState(false);\r\n  const [project,setProject]=useState(null); const [activeTab,setActiveTab]=useState('Details'); const [status,setStatus]=useState('');\r\n  const [progress,setProgress]=useState(0); const [loading,setLoading]=useState(true); const [picContributions,setPicContributions]=useState(null);\r\n  const [purchaseOrders,setPurchaseOrders]=useState([]); const [totalPO,setTotalPO]=useState(0);\r\n  const [poUploading,setPoUploading]=useState(false); const [poError,setPoError]=useState('');\r\n  const [poAmountInputs, setPoAmountInputs] = useState({}); // per-PO temp input text with formatting\r\n  const formatNumberWithCommas = (numStr)=>{\r\n    if(!numStr) return '';\r\n    const cleaned = numStr.replace(/[^0-9.]/g,'');\r\n    if(!cleaned) return '';\r\n    // Split integer / decimal\r\n    const parts = cleaned.split('.');\r\n    const intPart = parts[0].replace(/^0+(\\d)/,'$1');\r\n    const withCommas = intPart.replace(/\\B(?=(\\d{3})+(?!\\d))/g,',');\r\n    const dec = parts[1] ? parts[1].slice(0,2) : '';\r\n    return dec ? `${withCommas}.${dec}` : withCommas;\r\n  };\r\n  const parseFormattedNumber = (v)=>{ if(!v) return 0; const n=parseFloat(v.replace(/,/g,'')); return isFinite(n)? n:0; };\r\n  const [messages,setMessages]=useState([]); const [loadingMsgs,setLoadingMsgs]=useState(false); const [newMessage,setNewMessage]=useState('');\r\n  // Per-message reply collapse map: { [messageId]: boolean }\r\n  const [collapsedReplies, setCollapsedReplies] = useState({});\r\n  const [replyInputs,setReplyInputs]=useState({}); const [posting,setPosting]=useState(false); const [composerFiles,setComposerFiles]=useState([]); const [isDragOver,setIsDragOver]=useState(false); const [selectedLabel,setSelectedLabel]=useState('');\r\n  const listScrollRef=useRef(null); const listBottomRef=useRef(null); const textareaRef=useRef(null);\r\n  const [uploading,setUploading]=useState(false); const [uploadProgress,setUploadProgress]=useState(0); const [uploadError,setUploadError]=useState('');\r\n  const [imageUploading,setImageUploading]=useState(false); const [imageUploadProgress,setImageUploadProgress]=useState(0); const [imageUploadError,setImageUploadError]=useState('');\r\n  const [mentionDropdown,setMentionDropdown]=useState({open:false,options:[],query:'',position:{top:0,left:0},activeInputId:null});\r\n  const [projectUsers,setProjectUsers]=useState([]); const [fileSignedUrls,setFileSignedUrls]=useState({}); const [fileSearchTerm,setFileSearchTerm]=useState('');\r\n  const [reports,setReports]=useState([]);\r\n  // Reports upload (PPTX) for PM & PIC\r\n  const [reportUploading,setReportUploading]=useState(false);\r\n  const [reportUploadProgress,setReportUploadProgress]=useState(0);\r\n  const [reportUploadError,setReportUploadError]=useState('');\r\n  const [attendanceReports,setAttendanceReports]=useState([]);\r\n  const [attUploading,setAttUploading]=useState(false);\r\n  const [attError,setAttError]=useState('');\r\n  const [attendanceAI,setAttendanceAI]=useState(null);\r\n  const [showCompleteConfirm,setShowCompleteConfirm]=useState(false);\r\n  // UI toggle for estimated material cost (green items)\r\n  const [showEstimatedMaterial,setShowEstimatedMaterial]=useState(false);\r\n  const [showSectionBreakdown,setShowSectionBreakdown]=useState(true);\r\n  const [imagePreview,setImagePreview]=useState(null); // {src,name}\r\n\r\n  // Close image preview with ESC\r\n  useEffect(()=>{\r\n    if(!imagePreview) return;\r\n    const onKey = (e)=>{ if(e.key === 'Escape') setImagePreview(null); };\r\n    window.addEventListener('keydown', onKey);\r\n    return ()=> window.removeEventListener('keydown', onKey);\r\n  },[imagePreview]);\r\n  const [statusUpdating,setStatusUpdating]=useState(false);\r\n  // Per-report AI dropdown expanded state: { [reportId]: boolean }\r\n  const [openAiRows, setOpenAiRows] = useState({});\r\n  // Scalable PiC card UI helpers\r\n  const [picSearch,setPicSearch]=useState('');\r\n  const [showAllPics,setShowAllPics]=useState(false);\r\n  \r\n  // File deletion confirmation modal state\r\n  const [showFileDeleteConfirm, setShowFileDeleteConfirm] = useState(false);\r\n  const [fileToDelete, setFileToDelete] = useState(null);\r\n  // Load attendance reports when Attendance tab selected\r\nuseEffect(() => {\r\n  if (activeTab !== 'Attendance' || !project?._id) return;\r\n  loadAttendance(project._id);\r\n}, [activeTab, project?._id, token]);\r\n\r\n  // Realtime socket refs\r\n  const socketRef = useRef(null);\r\n  const joinedProjectRef = useRef(null);\r\n  useEffect(()=>{ const onScroll=()=> setIsHeaderCollapsed((window.pageYOffset||document.documentElement.scrollTop)>50); window.addEventListener('scroll',onScroll); return ()=> window.removeEventListener('scroll',onScroll); },[]);\r\n  useEffect(()=>{\r\n    let cancelled=false;\r\n    (async()=>{\r\n      try {\r\n        if(!id){\r\n          // Fallback for staff/hrsite/pic roles without explicit project id: pick first assigned project\r\n            if((role==='staff' || role==='hrsite' || role==='pic') && userId){\r\n              try {\r\n                const { data } = await api.get(`/projects/assigned/allroles/${userId}`);\r\n                if(cancelled) return;\r\n                const list = Array.isArray(data)? data : [];\r\n                const first = list[0];\r\n                if(first){ setProject(first); setStatus(first?.status||''); }\r\n                else { setProject(null); }\r\n              } catch { if(!cancelled) setProject(null); }\r\n            } else {\r\n              setProject(null);\r\n            }\r\n            return;\r\n        }\r\n        const {data}=await api.get(`/projects/${id}`);\r\n        if(cancelled) return;\r\n        setProject(data); setStatus(data?.status||'');\r\n      } catch { if(!cancelled) setProject(null); } finally { if(!cancelled) setLoading(false);} })();\r\n    return ()=> {cancelled=true;};\r\n  },[id,role,userId]);\r\n  // Populate purchaseOrders from project model (new schema) if present\r\n  useEffect(()=>{ if(project?.purchaseOrders){ const list = Array.isArray(project.purchaseOrders)? project.purchaseOrders.slice():[]; setPurchaseOrders(list); setTotalPO(list.reduce((s,p)=> s + (Number(p.amount)||0),0)); } },[project?.purchaseOrders]);\r\n  useEffect(()=>{ if(!project?._id || (activeTab!=='Discussions' && activeTab!=='Reports')) return; const controller=new AbortController(); setLoadingMsgs(true); api.get(`/projects/${project._id}/discussions`,{ headers:{Authorization:`Bearer ${token}`}, signal:controller.signal }).then(res=>{ const list=Array.isArray(res.data)?[...res.data].sort((a,b)=> new Date(a.timestamp||0)-new Date(b.timestamp||0)):[]; setMessages(list); }).catch(()=> setMessages([])).finally(()=> setLoadingMsgs(false)); return ()=> controller.abort(); },[project?._id,activeTab,token]);\r\n  // Initialize collapsed state for messages with 3+ replies (only once per message)\r\n  useEffect(()=>{ if(!messages.length) return; setCollapsedReplies(prev=>{ const next={...prev}; let changed=false; messages.forEach(m=>{ const rc=Array.isArray(m.replies)?m.replies.length:0; if(rc>=3 && typeof next[m._id]==='undefined'){ next[m._id]=true; changed=true; } }); return changed?next:prev; }); },[messages]);\r\n  const fetchReports=async(pid=project?._id)=>{ if(!pid) return; try { const {data}=await api.get(`/projects/${pid}/reports`,{ headers:{Authorization:`Bearer ${token}`}}); const list=data?.reports||[]; setReports(list); if(!list.length){ console.info('[ProjectView] No reports for project', pid, 'role', role); return; } const sorted=[...list].sort((a,b)=> new Date(b.uploadedAt||0)-new Date(a.uploadedAt||0)); const byUser=new Map(); for(const rep of sorted){ const key=rep.uploadedBy||rep.uploadedByName||rep._id; if(!byUser.has(key)) byUser.set(key,rep);} const distinct=[...byUser.values()]; // Prefer raw contribution field if present\r\n    let vals=distinct.map(r=> { const ai=r?.ai||{}; const raw=Number(ai.pic_contribution_percent_raw); const legacy=Number(ai.pic_contribution_percent); if(isFinite(raw) && raw>=0) return raw; if(isFinite(legacy) && legacy>=0) return legacy; const done=ai.completed_tasks?.length||0; const total=done + (ai.summary_of_work_done?.length||0); return total>0?(done/total)*100:0; }).filter(v=> isFinite(v)&&v>=0);\r\n    if(vals.length){\r\n      const assignedPics = Array.isArray(project?.pic)? project.pic : [];\r\n      const totalAssigned = assignedPics.length || distinct.length;\r\n      const sumContrib = vals.reduce((s,v)=> s+v,0);\r\n      const headcountAvgRaw = totalAssigned>0 ? (sumContrib / totalAssigned) : 0;\r\n      const headcountClamped = Number(Math.min(100,Math.max(0,headcountAvgRaw)).toFixed(1));\r\n      console.debug('[ProjectView] Progress calculation', { totalAssigned, reportedPICs: distinct.length, sumContrib: Number(sumContrib.toFixed(2)), headcountAvgRaw, headcountClamped });\r\n      setProgress(headcountClamped);\r\n      const perPic = distinct.map(r=> {\r\n        const ai=r.ai||{}; const raw=Number(ai.pic_contribution_percent_raw); const legacy=Number(ai.pic_contribution_percent);\r\n        const chosen = isFinite(raw)&&raw>=0? raw : (isFinite(legacy)&&legacy>=0? legacy : 0);\r\n        return ({ picId:r.uploadedBy||r._id, picName:r.uploadedByName||'Unknown', contribution:Math.round(chosen), hasReport:true, lastReportDate:r.uploadedAt||null, fallbackUsed: !!ai.meta_fallback_used, duplicate: !!ai.meta_duplicate_previous });\r\n      });\r\n      setPicContributions({\r\n        averageContribution: headcountClamped,\r\n        picContributions: perPic,\r\n        totalPics: totalAssigned,\r\n        reportingPics: distinct.length,\r\n        pendingPics: Math.max(totalAssigned - distinct.length,0)\r\n      });\r\n    } else {\r\n      // still set picContributions if there are assigned pics but zero reports (so UI shows 0% with correct denominator)\r\n      const assignedPics = Array.isArray(project?.pic)? project.pic : [];\r\n      if(assignedPics.length){\r\n        setProgress(0);\r\n        setPicContributions({ averageContribution:0, picContributions:[], totalPics:assignedPics.length, reportingPics:0, pendingPics:assignedPics.length });\r\n      }\r\n    }\r\n  } catch (e){ console.error('[ProjectView] fetchReports failed', e); setReports([]);} };\r\n  const completionPreconditionsMet = React.useMemo(()=>{\r\n    if(!project) return false;\r\n    const docCount = Array.isArray(project.documents)? project.documents.length : 0;\r\n    const reportCount = Array.isArray(reports)? reports.length : 0;\r\n    return docCount>0 && reportCount>0;\r\n  },[project,reports]);\r\n\r\n  // True when every assigned PIC has a latest report and each is at 100% contribution\r\n  const allPics100 = React.useMemo(()=> {\r\n    if(!picContributions || !picContributions.picContributions) return false;\r\n    const assignedPics = Array.isArray(project?.pic)? project.pic : [];\r\n    const requiredCount = assignedPics.length || picContributions.totalPics || 0;\r\n    if(requiredCount === 0) return false;\r\n    const list = picContributions.picContributions;\r\n    // Must have at least one entry per assigned PIC (or per detected reporter if no assignment list)\r\n    if(list.length < requiredCount) return false;\r\n    return list.every(p => p && p.hasReport && Number(p.contribution) >= 100);\r\n  },[picContributions, project?.pic]);\r\n\r\n  const handleToggleStatus = async(forceComplete=false)=> {\r\n    if(!project?._id) return;\r\n    // If completing, ensure progress is 100 (already checked in UI) and confirmation accepted\r\n    setStatusUpdating(true);\r\n    try {\r\n      const res = await api.patch(`/projects/${project._id}/toggle-status`);\r\n      const newStatus = res.data?.status || status;\r\n      setStatus(newStatus);\r\n      setShowCompleteConfirm(false);\r\n      // Optional: clear activeProject in header if completed so PM header updates after refresh\r\n      if(newStatus==='Completed' && role==='pm') {\r\n        // Mark flag so AppHeader refetches\r\n        try { localStorage.setItem('activeProjectInvalidated','1'); window.dispatchEvent(new Event('storage')); } catch {}\r\n      }\r\n    } catch(e){\r\n      let msg='Failed to update project status.';\r\n      if(e?.response?.data?.error==='PRECONDITION_FAILED') msg=e.response.data.message;\r\n      alert(msg);\r\n    } finally { setStatusUpdating(false); }\r\n  };\r\n  useEffect(()=>{ if(!project?._id) return; fetchReports(project._id); },[project?._id]);\r\n  useEffect(()=>{ if(activeTab==='Reports' && project?._id && reports.length===0) fetchReports(project._id); },[activeTab,project?._id]);\r\n  useEffect(()=>{ if(!project?._id) return; const int=setInterval(()=> fetchReports(project._id),120000); return ()=> clearInterval(int); },[project?._id]);\r\n  useEffect(()=>{ if(activeTab!=='Discussions') return; requestAnimationFrame(()=>{ if(listBottomRef.current) listBottomRef.current.scrollIntoView(); else if(listScrollRef.current) listScrollRef.current.scrollTop=listScrollRef.current.scrollHeight; }); },[messages,activeTab]);\r\n  useEffect(()=>{ if(!project?._id) return; let cancelled=false; (async()=>{ try { const all=[]; if(project.documents) all.push(...project.documents); if(messages) messages.forEach(m=>{ if(m.attachments) all.push(...m.attachments); m.replies?.forEach(r=> r.attachments && all.push(...r.attachments)); }); if(all.length){ const signed=await fetchSignedUrlsForImages(all); if(!cancelled) setFileSignedUrls(p=> ({...p,...signed})); } } catch{} })(); return ()=> {cancelled=true;}; },[project?.documents,messages]);\r\n  // Fetch project users once project id is available (used for Discussions + resolving HR/Staff names)\r\n  useEffect(()=>{ if(!project?._id) return; let cancelled=false; (async()=>{ try { const res=await api.get(`/projects/${project._id}/users`); if(!cancelled) setProjectUsers(res.data||[]); } catch { if(!cancelled) setProjectUsers([]);} })(); return ()=> {cancelled=true;}; },[project?._id]);\r\n  useEffect(()=>{ const close=e=>{ if(!e.target.closest('.user-profile')) setProfileMenuOpen(false); }; document.addEventListener('click',close); return ()=> document.removeEventListener('click',close); },[]);\r\n  // Live discussions socket (all roles) - single effect with dedup\r\n  useEffect(()=>{\r\n    if((activeTab !== 'Discussions' && activeTab !== 'Reports') || !project?._id){\r\n      if(socketRef.current){\r\n        try { socketRef.current.emit('leaveProject', joinedProjectRef.current); } catch {}\r\n        try { socketRef.current.disconnect(); } catch {}\r\n        socketRef.current=null; joinedProjectRef.current=null;\r\n      }\r\n      return;\r\n    }\r\n    if(socketRef.current){\r\n      if(joinedProjectRef.current === project._id) return; // already connected to correct project\r\n      try { socketRef.current.emit('leaveProject', joinedProjectRef.current); } catch {}\r\n      joinedProjectRef.current=null;\r\n    }\r\n    const socket=io(SOCKET_ORIGIN,{ path:SOCKET_PATH, transports:['websocket'], auth:{ userId } });\r\n    socketRef.current=socket; joinedProjectRef.current=project._id;\r\n    socket.emit('joinProject', project._id);\r\n    const hNew=data=>{ if(String(data.projectId)===String(project._id)&&data.message){ const mid=String(data.message._id); setMessages(prev=> prev.some(m=> String(m._id)===mid) ? prev : [...prev,data.message].sort((a,b)=> new Date(a.timestamp)-new Date(b.timestamp))); } };\r\n    const hReply=data=>{ if(String(data.projectId)===String(project._id)&&data.msgId&&data.reply){ setMessages(prev=> prev.map(m=> { if(String(m._id)!==data.msgId) return m; const has = m.replies.some(r=> String(r._id)===String(data.reply._id)); return has? m : { ...m, replies:[...m.replies,data.reply] }; })); } };\r\n    const hReports=d=>{ \r\n      try { \r\n        // Broadcast a window-level event so other dashboards (CEO/Area/PM/PIC) can refresh without own sockets\r\n        window.dispatchEvent(new CustomEvent('projectReportsUpdated',{ detail:{ projectId: d?.projectId } }));\r\n      } catch {}\r\n      if(String(d.projectId)===String(project._id)) fetchReports(project._id); \r\n    };\r\n    socket.on('project:newDiscussion',hNew); socket.on('project:newReply',hReply); socket.on('project:reportsUpdated',hReports);\r\n    return ()=>{ try{socket.off('project:newDiscussion',hNew);socket.off('project:newReply',hReply);socket.off('project:reportsUpdated',hReports);socket.emit('leaveProject',joinedProjectRef.current);socket.disconnect();}catch{} socketRef.current=null; joinedProjectRef.current=null; };\r\n  },[project?._id,activeTab,userId]);\r\n  const handlePostMessage=async()=>{ if(!perms.postDiscuss) return; if((!newMessage.trim() && composerFiles.length===0) || posting || !project?._id) return; try { setPosting(true); const fd=new FormData(); if(newMessage.trim()) fd.append('text',newMessage.trim()); if(selectedLabel) fd.append('label',selectedLabel); composerFiles.forEach(f=> fd.append('files',f)); const res=await api.post(`/projects/${project._id}/discussions`,fd,{ headers:{Authorization:`Bearer ${token}`}}); const msg=res.data; setMessages(prev=> prev.some(m=> String(m._id)===String(msg._id)) ? prev : [...prev,msg].sort((a,b)=> new Date(a.timestamp)-new Date(b.timestamp))); setNewMessage(''); setComposerFiles([]); setSelectedLabel(''); } catch {} finally { setPosting(false);} };\r\n  const handlePostReply=async(msgId)=>{ if(!perms.postDiscuss) return; const txt=(replyInputs[msgId]||'').trim(); if(!txt||posting||!project?._id) return; setPosting(true); try { const fd=new FormData(); fd.append('text',txt); const res=await api.post(`/projects/${project._id}/discussions/${msgId}/reply`,fd,{ headers:{Authorization:`Bearer ${token}`}}); const reply=res.data; setMessages(prev=> prev.map(m=> { if(String(m._id)!==msgId) return m; if(m.replies.some(r=> String(r._id)===String(reply._id))) return m; return { ...m, replies:[...m.replies,reply] }; })); setReplyInputs(p=> ({...p,[msgId]:''})); } catch {} finally { setPosting(false);} };\r\n  const handleKeyDownComposer=e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); if(!posting && (newMessage.trim()||composerFiles.length)) handlePostMessage(); } };\r\n  const acceptTypes=\".pdf,.ppt,.pptx,.doc,.docx,.xls,.xlsx,.txt,.rtf,.csv,image/*\";\r\n  const addComposerFiles=f=>{ if(!perms.postDiscuss) return; if(!f?.length) return; setComposerFiles(p=> [...p,...Array.from(f)]); };\r\n  const handleTextareaInput=e=>{ const v=e.target.value; setNewMessage(v); const caret=e.target.selectionStart; const up=v.slice(0,caret); const m=/(^|\\s)@(\\w*)$/.exec(up); if(m){ const q=m[2].toLowerCase(); const opts=projectUsers.concat([{_id:'_all_',name:'all'},{_id:'_everyone_',name:'everyone'}]).filter(u=> (u.name||'').toLowerCase().includes(q)); setMentionDropdown({open:true,options:opts,query:q,position:{top:0,left:0},activeInputId:e.target.id}); } else setMentionDropdown({open:false,options:[],query:'',position:{top:0,left:0},activeInputId:null}); };\r\n  const handleMentionSelect=u=>{ if(!textareaRef.current) return; const val=newMessage; const caret=textareaRef.current.selectionStart; const up=val.slice(0,caret); const m=/(^|\\s)@(\\w*)$/.exec(up); if(!m) return; const before=val.slice(0,m.index+m[1].length); const after=val.slice(caret); const mention=`@${u.name} `; const nv=before+mention+after; setNewMessage(nv); setMentionDropdown({open:false,options:[],query:'',position:{top:0,left:0},activeInputId:null}); setTimeout(()=>{ if(textareaRef.current){ textareaRef.current.focus(); textareaRef.current.selectionStart=textareaRef.current.selectionEnd=(before+mention).length; }},0); };\r\n  const handleLogout=()=>{ localStorage.removeItem('token'); localStorage.removeItem('user'); navigate(basePath); };\r\n  const handleFileUpload=async(files)=>{ if(!perms.uploadFiles) return; if(!files?.length||!project?._id) return; setUploading(true); setUploadProgress(0); setUploadError(''); try { const fd=new FormData(); files.forEach(f=> fd.append('files',f)); const it=setInterval(()=> setUploadProgress(p=> p>=90? (clearInterval(it),90):p+10),200); const res=await api.post(`/projects/${project._id}/documents`,fd,{ headers:{Authorization:`Bearer ${token}`,'Content-Type':'multipart/form-data'} }); clearInterval(it); setUploadProgress(100); if(res.data?.documents) setProject(pr=> ({...pr,documents:res.data.documents})); setTimeout(()=>{ setUploading(false); setUploadProgress(0); },800); } catch { setUploadError('Upload failed'); setUploading(false); setUploadProgress(0);} };\r\n  const handleDeleteFile=(doc,i)=>{ \r\n    if(!perms.deleteFiles) return; \r\n    if(!project?._id) return; \r\n    setFileToDelete({doc, index: i});\r\n    setShowFileDeleteConfirm(true);\r\n  };\r\n  \r\n  const confirmDeleteFile=async()=>{ \r\n    if(!fileToDelete || !project?._id) return; \r\n    try { \r\n      const path= typeof fileToDelete.doc==='string'? fileToDelete.doc : fileToDelete.doc.path; \r\n      await api.delete(`/projects/${project._id}/documents`,{ headers:{Authorization:`Bearer ${token}`}, data:{ path }}); \r\n      setProject(pr=> ({...pr,documents: pr.documents.filter((_,idx)=> idx!==fileToDelete.index)})); \r\n      setShowFileDeleteConfirm(false);\r\n      setFileToDelete(null);\r\n    } catch { \r\n      alert('Failed to delete file'); \r\n    } \r\n  };\r\n  const canUploadReport = role==='pic' || role==='pm';\r\n  const handleReportUpload = async(file)=>{\r\n    if(!file || !project?._id) return;\r\n    if(!/\\.pptx?$/i.test(file.name)) { alert('Please select a .pptx file'); return; }\r\n    try {\r\n      setReportUploading(true); setReportUploadError(''); setReportUploadProgress(0);\r\n      const fd=new FormData(); fd.append('report', file);\r\n      // fake progress (since axios onUploadProgress with FormData & fetch may vary)\r\n      const tick = setInterval(()=> setReportUploadProgress(p=> p>=85?85:p+7),180);\r\n      const { data } = await api.post(`/projects/${project._id}/reports`, fd, { headers:{ Authorization:`Bearer ${token}` } });\r\n      clearInterval(tick); setReportUploadProgress(100);\r\n      // Prepend new report for immediate feedback\r\n      if(data?.report){ setReports(prev=> [data.report, ...prev]); }\r\n      // refresh to ensure AI / pdfPath etc.\r\n      fetchReports(project._id);\r\n      setTimeout(()=> { setReportUploading(false); setReportUploadProgress(0); },600);\r\n    } catch(e){\r\n      setReportUploading(false);\r\n      setReportUploadProgress(0);\r\n      setReportUploadError(e?.response?.data?.message || 'Report upload failed');\r\n    }\r\n  };\r\n  // Delete permissions:\r\n  // - PM can delete any report\r\n  // - PIC can delete only reports they uploaded\r\n  const canDeleteReport = (report)=>{\r\n    if (role==='pm') return true;\r\n    if (role==='pic') {\r\n      const ownerId = report?.uploadedBy?._id || report?.uploadedBy;\r\n      return ownerId && String(ownerId)===String(userId);\r\n    }\r\n    return false;\r\n  };\r\n  const handleDeleteReport = async(reportId, uploadedBy)=>{\r\n    if(!project?._id || !reportId) return;\r\n    const allowed = (role==='pm') || (role==='pic' && uploadedBy && String(uploadedBy)===String(userId));\r\n    if(!allowed) { alert('You can only delete your own reports.'); return; }\r\n    if(!window.confirm('Delete this report (PPT + AI outputs)?')) return;\r\n    try {\r\n      const { data } = await api.delete(`/projects/${project._id}/reports/${reportId}`, { headers:{ Authorization:`Bearer ${token}` } });\r\n      if(data?.reports) setReports(data.reports); else setReports(prev=> prev.filter(r=> String(r._id)!==String(reportId)));\r\n    } catch(e){\r\n      alert(e?.response?.data?.message || 'Failed to delete report');\r\n    }\r\n  };\r\n  // Flash banner (must be declared before any early returns to satisfy hooks rules)\r\n  const justCreated = !!(location.state && location.state.justCreated);\r\n  const [showFlash, setShowFlash] = useState(justCreated);\r\n  useEffect(()=>{ if(justCreated){ const t=setTimeout(()=> setShowFlash(false),6000); return ()=> clearTimeout(t);} },[justCreated]);\r\n\r\n// Resolve attendance uploader name from known fields or fall back to projectUsers\r\n// Robust uploader name resolver for attendance rows\r\nconst resolveAttendanceUploaderName = (r) => {\r\n  // Direct string fields the backend might send\r\n  if (r?.uploadedByName && typeof r.uploadedByName === 'string' && r.uploadedByName.trim()) return r.uploadedByName.trim();\r\n  if (r?.uploaderName) return r.uploaderName;\r\n  if (r?.generatedByName) return r.generatedByName;\r\n\r\n  // If backend sent nested user objects\r\n  const readName = (obj) => {\r\n    if (!obj || typeof obj !== 'object') return null;\r\n    for (const k of ['name','fullName','displayName','username']) {\r\n      if (typeof obj[k] === 'string' && obj[k].trim()) return obj[k].trim();\r\n    }\r\n    if (typeof obj.email === 'string' && obj.email) return obj.email.split('@')[0];\r\n    return null;\r\n  };\r\n  const nestedName = readName(r?.uploadedBy) || readName(r?.uploader) || readName(r?.user);\r\n  if (nestedName) return nestedName;\r\n\r\n  // Try to match by ID against projectUsers we fetched earlier\r\n  const candidateId =\r\n    r?.generatedBy ||\r\n    r?.uploadedBy?._id ||\r\n    r?.uploader?._id ||\r\n    r?.user?._id ||\r\n    r?.uploadedById ||\r\n    r?.uploaderId ||\r\n    r?.userId ||\r\n    r?.uploadedBy ||\r\n    r?.uploader;\r\n\r\n  if (candidateId) {\r\n    const match = projectUsers.find(\r\n      u => String(u._id) === String(candidateId) || String(u.id) === String(candidateId)\r\n    );\r\n  if (match?.name) return match.name;\r\n  if (match?.fullName) return match.fullName;\r\n  if (match?.displayName) return match.displayName;\r\n\r\n    // If it was you\r\n    if (user && String(user._id) === String(candidateId) && user.name) return user.name;\r\n\r\n    // Last-resort: readable fallback from the ID\r\n    const tail = String(candidateId).slice(-6);\r\n    return tail ? `User ${tail}` : 'Unknown';\r\n  }\r\n\r\n  return 'Unknown';\r\n};\r\n\r\n\r\n  // ---- Attendance helpers ----\r\nconst loadAttendance = async (pid = project?._id) => {\r\n  if (!pid) return;\r\n  try {\r\n    const { data } = await api.get(`/projects/${pid}/attendance`, {\r\n      headers: { Authorization: `Bearer ${token}` }\r\n    });\r\n    const reps = data?.reports || [];\r\n    setAttendanceReports(reps);\r\n    const latest = reps[reps.length - 1];\r\n    // accept various backend keys just in case\r\n    setAttendanceAI(latest?.ai || latest?.ai_summary || latest?.summary || null);\r\n  } catch {\r\n    setAttendanceReports([]);\r\n    setAttendanceAI(null);\r\n  }\r\n};\r\n\r\n\r\n\r\n  // Always include staff-view-root so unified overview card styles apply for every role\r\n  const rootRoleClass = `pm-view-root staff-view-root ${role==='staff'?'is-staff':''} ${role==='ceo'?'ceo-view-root':''}`;\r\n  // Move derived values & hooks BEFORE any early returns to satisfy hooks rules\r\n  const contractor = readContractor(project);\r\n  const contractorType = project?.contractorType === 'Sub Contractor' ? 'Sub Contractor' : 'Contractor';\r\n  const budgetDocument = project?.budgetDocument || null;\r\n  const documentsExcludingBudget = React.useMemo(()=>{\r\n    if(!project?.documents) return [];\r\n    if(!budgetDocument) return project.documents;\r\n    // Filter out any doc with same path as budgetDocument\r\n    return project.documents.filter(d => {\r\n      if(!d) return false;\r\n      if(typeof d === 'string') return d !== budgetDocument.path;\r\n      return d.path !== budgetDocument.path;\r\n    });\r\n  }, [project?.documents, budgetDocument]);\r\n  if(loading) return <div className={`dashboard-container ${rootRoleClass}`}><div className=\"professional-loading-screen\"><div className=\"loading-content\"><div className=\"loading-logo\"><img src={require('../../assets/images/FadzLogo1.png')} alt=\"FadzTrack Logo\" className=\"loading-logo-img\" /></div><div className=\"loading-spinner-container\"><div className=\"loading-spinner\"/></div><div className=\"loading-text\"><h2 className=\"loading-title\">Loading Project Details</h2><p className=\"loading-subtitle\">Fetching project information...</p></div><div className=\"loading-progress\"><div className=\"progress-bar\"><div className=\"progress-fill\"/></div></div></div></div></div>;\r\n  // When project is missing:\r\n  //  - For staff & hrsite we still show full layout (header, tabs, etc.) with an empty state panel\r\n  //  - For other roles retain the original blocking screen with a dashboard return\r\n  const projectMissing = !project;\r\n  if(projectMissing && !['staff','hrsite'].includes(role)) {\r\n    return <div className={`dashboard-container ${rootRoleClass}`}><div className=\"professional-loading-screen\"><div className=\"loading-content\"><div className=\"loading-logo\"><img src={require('../../assets/images/FadzLogo1.png')} alt=\"FadzTrack Logo\" className=\"loading-logo-img\" /></div><div className=\"loading-text\"><h2 className=\"loading-title\" style={{color:'#ef4444'}}>Project Not Found</h2><p className=\"loading-subtitle\">Project missing or access denied.</p></div><div style={{marginTop:'2rem'}}><button onClick={()=> navigate(basePath)} style={{background:'linear-gradient(135deg,#3b82f6,#1d4ed8)',color:'#fff',border:'none',padding:'12px 24px',borderRadius:8,fontSize:'1rem',fontWeight:600,cursor:'pointer'}}>Return to Dashboard</button></div></div></div></div>;\r\n  }\r\n  const start = project?.startDate ? new Date(project.startDate).toLocaleDateString() : 'N/A';\r\n  const end = project?.endDate ? new Date(project.endDate).toLocaleDateString() : 'N/A';\r\n  let locationLabel = 'N/A';\r\n  if(project?.location){\r\n    const loc = project.location;\r\n    if(typeof loc === 'string') locationLabel = loc;\r\n    else if(loc.name) locationLabel = loc.name + (loc.region?` (${loc.region})`: '');\r\n    else if(loc.title) locationLabel = loc.title;\r\n  }\r\n  const manpowerText = Array.isArray(project?.manpower)&&project.manpower.length>0 ? project.manpower.map(mp=> [mp?.name,mp?.position].filter(Boolean).join(' (') + (mp?.position?')':'')).join(', ') : 'No Manpower Assigned';\r\n  const budgetNum = Number(project?.budget||0); const remaining = Math.max(budgetNum - Number(totalPO||0),0);\r\n  // Resolve HR Site / Staff names even if backend didn't populate (ids only)\r\n  const resolveUserNames = (arr)=> {\r\n    if(!Array.isArray(arr) || !arr.length) return [];\r\n    return arr.map(u=>{\r\n      if(u && typeof u === 'object' && u.name) return u.name;\r\n      const id = typeof u === 'string' ? u : (u?._id||'');\r\n      const match = projectUsers.find(pu=> String(pu._id)===String(id));\r\n      return match?.name || null;\r\n    }).filter(Boolean);\r\n  };\r\n  const hrSiteNames = resolveUserNames(project?.hrsite);\r\n  const staffNames = resolveUserNames(project?.staff);\r\n  // Rewritten JSX with proper nesting & explicit wrappers to avoid unclosed tag errors\r\n// Discussion label style map\r\nconst labelColorMap = {\r\n  Important: { bg: 'linear-gradient(90deg,#dc2626,#f87171)', fg: '#fff' },\r\n  Announcement: { bg: 'linear-gradient(90deg,#6366f1,#8b5cf6)', fg: '#fff' },\r\n  Update: { bg: 'linear-gradient(90deg,#0d9488,#14b8a6)', fg: '#fff' },\r\n  Reminder: { bg: 'linear-gradient(90deg,#eab308,#f59e0b)', fg: '#3a2f00' },\r\n  Urgent: { bg: 'linear-gradient(90deg,#b91c1c,#ef4444)', fg: '#fff' }\r\n};\r\nfunction renderLabelBadge(label){ if(!label) return null; const s=labelColorMap[label]||{bg:'#334155',fg:'#fff'}; return <span className=\"discussion-label-badge\" style={{background:s.bg,color:s.fg,padding:'2px 8px',borderRadius:8,fontSize:11,marginLeft:8,fontWeight:600,letterSpacing:.5,display:'inline-flex',alignItems:'center',gap:4}}>{label}</span>; }\r\n  return (\r\n  <div className={`dashboard-container ${rootRoleClass}`}>\r\n  {useUnifiedHeader && !document.body.dataset?.appHeaderMounted && <AppHeader roleSegment={role} />}\r\n  {!useUnifiedHeader && (\r\n  <header className={`dashboard-header ${isHeaderCollapsed ? 'collapsed' : ''}`}>\r\n        <div className=\"header-top\">\r\n          <div className=\"logo-section\">\r\n            <img src={require('../../assets/images/FadzLogo1.png')} alt=\"FadzTrack Logo\" className=\"header-logo\" />\r\n            <h1 className=\"header-brand\">FadzTrack</h1>\r\n          </div>\r\n          <div className=\"user-profile\" onClick={() => setProfileMenuOpen(o => !o)}>\r\n            <div className=\"profile-avatar\">{userName ? userName.charAt(0).toUpperCase() : 'U'}</div>\r\n            <div className=\"profile-info\">\r\n              <span className=\"profile-name\">{userName}</span>\r\n              <span className=\"profile-role\">{roleCfg.label}</span>\r\n            </div>\r\n            {profileMenuOpen && (\r\n              <div className=\"profile-menu\">\r\n                <button onClick={handleLogout}>Logout</button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n        <div className=\"header-bottom\">\r\n          <nav className=\"header-nav\">\r\n            {nav.map(n => (\r\n              <Link key={n.to} to={n.to} className={`nav-item ${n.active ? 'active' : ''}`}>\r\n                {n.icon}\r\n                <span className={isHeaderCollapsed ? 'hidden' : ''}>{n.label}</span>\r\n              </Link>\r\n            ))}\r\n          </nav>\r\n          <NotificationBell />\r\n        </div>\r\n  </header>) }\r\n\r\n    {imagePreview && (\r\n      <div\r\n        onClick={()=> setImagePreview(null)}\r\n        style={{\r\n          position:'fixed',inset:0,background:'rgba(15,23,42,.85)',zIndex:1000,\r\n          display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',padding:20\r\n        }}\r\n      >\r\n        <div style={{maxWidth:'90%',maxHeight:'80%',position:'relative'}}>\r\n          <img src={imagePreview.src} alt={imagePreview.name} style={{maxWidth:'100%',maxHeight:'100%',objectFit:'contain',borderRadius:12,boxShadow:'0 10px 28px -4px rgba(0,0,0,.6)'}} />\r\n          <div style={{marginTop:12,textAlign:'center',color:'#f1f5f9',fontSize:14}}>{imagePreview.name}</div>\r\n          <button onClick={(e)=>{e.stopPropagation(); setImagePreview(null);}} style={{position:'absolute',top:8,right:8,background:'rgba(0,0,0,.55)',color:'#fff',border:'none',borderRadius:8,padding:'6px 10px',cursor:'pointer'}}>Close</button>\r\n        </div>\r\n        <div style={{marginTop:16,color:'#94a3b8',fontSize:12}}>Click anywhere or press ESC to close</div>\r\n      </div>\r\n    )}\r\n      <main className=\"dashboard-main\">\r\n        {showFlash && (\r\n          <div role=\"status\" aria-live=\"polite\" className=\"project-flash-banner\" style={{\r\n            background: 'linear-gradient(90deg,#15803d,#16a34a)',\r\n            color: '#fff',\r\n            padding: '12px 20px',\r\n            borderRadius: '10px',\r\n            fontSize: '0.95rem',\r\n            fontWeight: 500,\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n            gap: '16px',\r\n            boxShadow: '0 4px 12px -2px rgba(16,185,129,0.35)',\r\n            margin: '0 24px 18px'\r\n          }}>\r\n            <span style={{display:'flex',alignItems:'center',gap:8}}>\r\n              <span style={{fontSize:'1.2rem'}}></span>\r\n              <span>Project <strong>{(location.state && location.state.projectName) || (project && project.projectName)}</strong> created. Team notified.</span>\r\n            </span>\r\n            <button onClick={()=> setShowFlash(false)} style={{\r\n              background:'rgba(255,255,255,0.15)',\r\n              border:'none',\r\n              color:'#fff',\r\n              padding:'4px 10px',\r\n              borderRadius:6,\r\n              cursor:'pointer',\r\n              fontSize:'0.75rem',\r\n              letterSpacing:'.5px'\r\n            }}>DISMISS</button>\r\n          </div>\r\n        )}\r\n        <div className=\"project-view-container\">\r\n          {/* Project Header */}\r\n          <div className=\"project-header\">\r\n            <div className=\"project-image-section\">\r\n              <img\r\n                src={(project?.photos?.[0]) || 'https://placehold.co/1200x400?text=No+Active+Project'}\r\n                alt={project?.projectName || 'No Active Project'}\r\n                className=\"project-hero-image\"\r\n              />\r\n              {perms.image && (\r\n                <div className=\"image-upload-overlay\">\r\n                  <input\r\n                    type=\"file\"\r\n                    id=\"project-image-upload\"\r\n                    accept=\"image/*\"\r\n                    style={{ display: 'none' }}\r\n                    onChange={async e => {\r\n                      const f = e.target.files[0];\r\n                      if (!f) return;\r\n                      if (!f.type.startsWith('image/')) {\r\n                        alert('Select an image');\r\n                        return;\r\n                      }\r\n                      if (f.size > 5 * 1024 * 1024) {\r\n                        alert('Image must be <5MB');\r\n                        return;\r\n                      }\r\n                      try {\r\n                        setImageUploading(true);\r\n                        setImageUploadProgress(0);\r\n                        setImageUploadError('');\r\n                        const fd = new FormData();\r\n                        fd.append('photo', f);\r\n                        const res = await api.post(`/projects/${project._id}/photo`, fd, {\r\n                          onUploadProgress: pe =>\r\n                            setImageUploadProgress(Math.round((pe.loaded * 100) / pe.total))\r\n                        });\r\n                        setProject(p => ({ ...p, photos: [res.data.photoUrl, ...(p.photos || []).slice(1)] }));\r\n                      } catch {\r\n                        setImageUploadError('Upload failed');\r\n                      } finally {\r\n                        setImageUploading(false);\r\n                        setImageUploadProgress(0);\r\n                        e.target.value = '';\r\n                      }\r\n                    }}\r\n                  />\r\n                  <label htmlFor=\"project-image-upload\" className=\"change-image-btn\">\r\n                    <FaCamera />\r\n                    <span>Change Image</span>\r\n                  </label>\r\n                  {imageUploading && (\r\n                    <div className=\"image-upload-progress\">\r\n                      <div className=\"progress-bar\">\r\n                        <div className=\"progress-fill\" style={{ width: `${imageUploadProgress}%` }} />\r\n                      </div>\r\n                      <p className=\"progress-text\">Uploading... {imageUploadProgress}%</p>\r\n                    </div>\r\n                  )}\r\n                  {imageUploadError && (\r\n                    <div className=\"image-upload-error\">\r\n                      <p>{imageUploadError}</p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n              {perms.statusToggle && (\r\n                <>\r\n                  {/* Single unified completion button:\r\n                      - If project already completed -> allow reopening\r\n                      - If not completed and allPics100 -> show green Finalize\r\n                      - Else show standard Complete Project (with modal confirm)\r\n                  */}\r\n                  {status==='Completed' ? (\r\n                    <button\r\n                      onClick={()=> handleToggleStatus()}\r\n                      disabled={statusUpdating}\r\n                      className=\"status-toggle-btn completed\"\r\n                    >\r\n                      {statusUpdating ? 'Updating...' : 'Mark as Ongoing'}\r\n                    </button>\r\n                  ) : (\r\n                    // Always require confirmation modal regardless of allPics100\r\n                    <button\r\n                      onClick={()=> setShowCompleteConfirm(true)}\r\n                      disabled={statusUpdating || !completionPreconditionsMet}\r\n                      className={`status-toggle-btn ${allPics100? 'success fast-complete-btn' : 'ongoing'}`}\r\n                      title={allPics100? 'All PIC reports at 100% - click to confirm completion' : 'Click to confirm project completion'}\r\n                      style={allPics100? {background:'#16a34a', borderColor:'#15803d'}:undefined}\r\n                    >\r\n                      {statusUpdating ? 'Updating...' : (allPics100? 'Mark as Completed (All 100%)' : 'Mark as Completed')}\r\n                    </button>\r\n                  )}\r\n                  {showCompleteConfirm && status!=='Completed' && (\r\n                    <div className=\"modal-overlay\">\r\n                      <div className=\"modal small\">\r\n                        <h3>Confirm Project Completion</h3>\r\n                        \r\n                        {/* Progress Warning Section */}\r\n                        {completionPreconditionsMet && (\r\n                          <div style={{marginBottom: '1rem'}}>\r\n                            {progress < 80 && (\r\n                              <div style={{\r\n                                backgroundColor: '#fef2f2',\r\n                                border: '1px solid #fecaca',\r\n                                borderRadius: '8px',\r\n                                padding: '12px',\r\n                                marginBottom: '12px'\r\n                              }}>\r\n                                <div style={{display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '8px'}}>\r\n                                  <span style={{fontSize: '20px'}}></span>\r\n                                  <strong style={{color: '#dc2626'}}>High Risk Warning</strong>\r\n                                </div>\r\n                                <p style={{color: '#dc2626', margin: 0, fontSize: '14px'}}>\r\n                                  Project progress is only <strong>{progress}%</strong>. Completing now may result in incomplete deliverables and unsatisfied stakeholders.\r\n                                </p>\r\n                              </div>\r\n                            )}\r\n                            \r\n                            {progress >= 80 && progress < 90 && (\r\n                              <div style={{\r\n                                backgroundColor: '#fffbeb',\r\n                                border: '1px solid #fed7aa',\r\n                                borderRadius: '8px',\r\n                                padding: '12px',\r\n                                marginBottom: '12px'\r\n                              }}>\r\n                                <div style={{display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '8px'}}>\r\n                                  <span style={{fontSize: '20px'}}></span>\r\n                                  <strong style={{color: '#ea580c'}}>Moderate Warning</strong>\r\n                                </div>\r\n                                <p style={{color: '#ea580c', margin: 0, fontSize: '14px'}}>\r\n                                  Project progress is <strong>{progress}%</strong>. Consider completing remaining tasks before marking as complete.\r\n                                </p>\r\n                              </div>\r\n                            )}\r\n                            \r\n                            {progress >= 90 && progress < 100 && (\r\n                              <div style={{\r\n                                backgroundColor: '#f0f9ff',\r\n                                border: '1px solid #93c5fd',\r\n                                borderRadius: '8px',\r\n                                padding: '12px',\r\n                                marginBottom: '12px'\r\n                              }}>\r\n                                <div style={{display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '8px'}}>\r\n                                  <span style={{fontSize: '20px'}}></span>\r\n                                  <strong style={{color: '#2563eb'}}>Minor Notice</strong>\r\n                                </div>\r\n                                <p style={{color: '#2563eb', margin: 0, fontSize: '14px'}}>\r\n                                  Project progress is <strong>{progress}%</strong>. Almost complete - ensure all final deliverables are ready.\r\n                                </p>\r\n                              </div>\r\n                            )}\r\n                            \r\n                            {progress >= 100 && (\r\n                              <div style={{\r\n                                backgroundColor: '#f0fdf4',\r\n                                border: '1px solid #86efac',\r\n                                borderRadius: '8px',\r\n                                padding: '12px',\r\n                                marginBottom: '12px'\r\n                              }}>\r\n                                <div style={{display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '8px'}}>\r\n                                  <span style={{fontSize: '20px'}}></span>\r\n                                  <strong style={{color: '#16a34a'}}>Ready for Completion</strong>\r\n                                </div>\r\n                                <p style={{color: '#16a34a', margin: 0, fontSize: '14px'}}>\r\n                                  Project progress is <strong>{progress}%</strong>. All tasks appear to be completed.\r\n                                </p>\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        )}\r\n\r\n                        {/* Preconditions Warning */}\r\n                        {!completionPreconditionsMet && (\r\n                          <div style={{\r\n                            backgroundColor: '#fef2f2',\r\n                            border: '1px solid #fecaca',\r\n                            borderRadius: '8px',\r\n                            padding: '12px',\r\n                            marginBottom: '12px'\r\n                          }}>\r\n                            <div style={{display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '8px'}}>\r\n                              <span style={{fontSize: '20px'}}></span>\r\n                              <strong style={{color: '#dc2626'}}>Preconditions Not Met</strong>\r\n                            </div>\r\n                            <p style={{color: '#dc2626', margin: 0, fontSize: '14px'}}>\r\n                              At least one file and one report are required to complete this project.\r\n                            </p>\r\n                          </div>\r\n                        )}\r\n\r\n                        {/* Main Confirmation Message */}\r\n                        <p style={{marginBottom: '1rem', fontSize: '14px', lineHeight: '1.5'}}>\r\n                          Mark this project as <strong>Completed</strong>? All members (PM, PIC, Staff, HR-Site) will become available for new assignments.\r\n                        </p>\r\n\r\n                        <div className=\"modal-actions\" style={{display:'flex',gap:'0.5rem',justifyContent:'flex-end'}}>\r\n                          <button className=\"btn\" onClick={()=> setShowCompleteConfirm(false)}>Cancel</button>\r\n                          <button \r\n                            className=\"btn primary\" \r\n                            disabled={statusUpdating || !completionPreconditionsMet} \r\n                            onClick={()=> handleToggleStatus(true)}\r\n                            style={{\r\n                              backgroundColor: progress < 80 ? '#dc2626' : progress < 90 ? '#ea580c' : progress < 100 ? '#2563eb' : '#16a34a'\r\n                            }}\r\n                          >\r\n                            {statusUpdating ? 'Completing...' : 'Yes, Complete Project'}\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </>\r\n              )}\r\n            </div>\r\n            <div className=\"project-title-section\">\r\n              <h1 className=\"project-title\">{projectMissing ? 'No Active Project Assigned' : project.projectName}</h1>\r\n              <div className=\"project-status-badge\">\r\n                {!projectMissing && (\r\n                  <>\r\n                    <span className={`status-indicator ${status === 'Completed' ? 'completed' : 'ongoing'}`}>\r\n                      {status === 'Completed' ? <FaCheckCircle /> : <FaClock />}\r\n                    </span>\r\n                    <span className=\"status-text\">{status || project?.status || 'N/A'}</span>\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          {/* Tabs */}\r\n          <div className=\"project-tabs\">\r\n            <button className={`project-tab ${activeTab === 'Details' ? 'active' : ''}`} onClick={() => setActiveTab('Details')}>\r\n              <FaRegListAlt />\r\n              <span>Project Details</span>\r\n            </button>\r\n            {/* Budget tab  only for PIC, PM, AM, CEO */}\r\n            {['pic','pm','am','ceo'].includes(role) && (\r\n              <button className={`project-tab ${activeTab === 'Budget' ? 'active' : ''}`} onClick={() => setActiveTab('Budget')}>\r\n                <FaMoneyBillWave />\r\n                <span>Budget</span>\r\n              </button>\r\n            )}\r\n            <button className={`project-tab ${activeTab === 'Discussions' ? 'active' : ''}`} onClick={() => setActiveTab('Discussions')}>\r\n              <FaRegCommentDots />\r\n              <span>Discussions</span>\r\n            </button>\r\n            <button className={`project-tab ${activeTab === 'Files' ? 'active' : ''}`} onClick={() => setActiveTab('Files')}>\r\n              <FaRegFileAlt />\r\n              <span>Files</span>\r\n            </button>\r\n            <button className={`project-tab ${activeTab === 'Reports' ? 'active' : ''}`} onClick={() => setActiveTab('Reports')}>\r\n              <FaRegFileAlt />\r\n              <span>Reports</span>\r\n            </button>\r\n            {['it','am','pm','ceo','hr','hrsite'].includes(role) && (\r\n              <button className={`project-tab ${activeTab === 'Attendance' ? 'active' : ''}`} onClick={() => setActiveTab('Attendance')}>\r\n                <FaRegFileAlt />\r\n                <span>Attendance</span>\r\n              </button>\r\n            )}\r\n          </div>\r\n          {projectMissing && (\r\n            <div style={{padding:'24px 28px',background:'#fff1f2',border:'1px solid #fecdd3',borderRadius:16,margin:'24px 24px 0'}}>\r\n              <h2 style={{marginTop:0,marginBottom:8,color:'#be123c'}}>No Project Assigned</h2>\r\n              <p style={{margin:0,color:'#9f1239',fontSize:14,lineHeight:1.5}}>You currently have no active project. You can still access other areas using the navigation above (Chat, Dashboard, etc.). Once a project is assigned to you it will appear here automatically.</p>\r\n            </div>\r\n          )}\r\n          <div className=\"tab-content\">\r\n            {/* DETAILS TAB */}\r\n            {activeTab === 'Details' && (\r\n              <div className=\"project-details-content\">\r\n                <div className=\"action-buttons\">\r\n                  <button\r\n                    onClick={() => {\r\n                      const user = JSON.parse(localStorage.getItem('user') || '{}');\r\n                      const exportDateTime = new Date().toLocaleString('en-US', {\r\n                        year: 'numeric',\r\n                        month: '2-digit',\r\n                        day: '2-digit',\r\n                        hour: '2-digit',\r\n                        minute: '2-digit',\r\n                        second: '2-digit',\r\n                        hour12: true\r\n                      });\r\n                      exportProjectDetails(project, { \r\n                        contextTitle: `Project Details  ${roleCfg.label}`,\r\n                        exportedBy: user?.name || 'Unknown User',\r\n                        exportDate: exportDateTime\r\n                      });\r\n                    }}\r\n                    className=\"export-btn\"\r\n                  >\r\n                    <FaDownload />\r\n                    <span>Export Project Details</span>\r\n                  </button>\r\n                </div>\r\n                <div className=\"overview-grid\">\r\n                  <div className=\"overview-card budget-card\">\r\n                    <div className=\"card-icon\"><FaMoneyBillWave /></div>\r\n                    <h3 className=\"card-title\">Budget</h3>\r\n                    <div className=\"budget-amount\">{peso.format(budgetNum || 0)}</div>\r\n                    {totalPO>0 && (\r\n                      <div className=\"remaining-budget\" style={{marginTop:6,fontSize:12}}>\r\n                        Remaining: {peso.format(remaining)} (POs: {peso.format(totalPO)})\r\n                      </div>\r\n                    )}\r\n                    {/* Breakdown removed per request */}\r\n                  </div>\r\n                  <div className=\"overview-card timeline-card\">\r\n                    <div className=\"card-icon\"><FaCalendarAlt /></div>\r\n                    <h3 className=\"card-title\">Timeline</h3>\r\n                    <div className=\"timeline-dates\">\r\n                      <div className=\"date-item\"><span className=\"date-label\">Start:</span><span className=\"date-value\">{start}</span></div>\r\n                      <div className=\"date-item\"><span className=\"date-label\">End:</span><span className=\"date-value\">{end}</span></div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"overview-card location-card\">\r\n                    <div className=\"card-icon\"><FaMapMarkerAlt /></div>\r\n                    <h3 className=\"card-title\">Location</h3>\r\n                    <div className=\"location-value\">{locationLabel}</div>\r\n                  </div>\r\n                  <div className=\"overview-card contractor-card\">\r\n                    <div className=\"card-icon\"><FaBuilding /></div>\r\n                    <h3 className=\"card-title\">{contractorType}</h3>\r\n                    <div className=\"contractor-value\">{contractor}</div>\r\n                  </div>\r\n                </div>\r\n                {/* Progress Section */}\r\n                <div className=\"progress-section\">\r\n                  <h2 className=\"section-title\" style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\r\n                    Project Progress{' '}\r\n                    {progress >= 100 && (\r\n                      <span\r\n                        style={{\r\n                          background: 'linear-gradient(90deg,#16a34a,#4ade80)',\r\n                          color: '#fff',\r\n                          padding: '4px 10px',\r\n                          fontSize: 12,\r\n                          borderRadius: 20\r\n                        }}\r\n                      >\r\n                        COMPLETED\r\n                      </span>\r\n                    )}\r\n                  </h2>\r\n                  <div\r\n                    className=\"progress-grid\"\r\n                    style={{ display: 'grid', gap: 18, gridTemplateColumns: 'repeat(auto-fit,minmax(260px,1fr))' }}\r\n                  >\r\n                    <div\r\n                      className=\"progress-card overall-progress\"\r\n                      style={{ background: '#0f172a', color: '#f1f5f9', borderRadius: 18, padding: 20, position: 'relative' }}\r\n                    >\r\n                      <div\r\n                        style={{\r\n                          position: 'absolute',\r\n                          inset: 0,\r\n                          background: 'radial-gradient(circle at 30% 20%, rgba(59,130,246,.25), transparent 70%)'\r\n                        }}\r\n                      />\r\n                      <div style={{ position: 'relative', display: 'flex', flexDirection: 'column', gap: 10 }}>\r\n                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n                          <h3 style={{ margin: 0, fontSize: 16, fontWeight: 600 }}>Overall Progress</h3>\r\n                          <FaChartBar style={{ opacity: 0.7 }} />\r\n                        </div>\r\n                        <div style={{ fontSize: 38, fontWeight: 700, background: 'linear-gradient(90deg,#3b82f6,#06b6d4)', WebkitBackgroundClip: 'text', color: 'transparent' }}>\r\n                          {picContributions ? Math.round(picContributions.averageContribution) : Math.round(progress)}%\r\n                        </div>\r\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: 6, width: '100%', alignSelf:'stretch' }}>\r\n                          <div\r\n                            style={{ height: 14, background: '#1e293b', borderRadius: 10, position: 'relative', width: '100%', minWidth:'100%' }}\r\n                            aria-label={`Overall progress ${picContributions ? Math.round(picContributions.averageContribution) : Math.round(progress)}%`}\r\n                            role=\"progressbar\"\r\n                            aria-valuenow={picContributions ? Math.round(picContributions.averageContribution) : Math.round(progress)}\r\n                            aria-valuemin={0}\r\n                            aria-valuemax={100}\r\n                          >\r\n                            <div\r\n                              style={{\r\n                                position: 'absolute',\r\n                                inset: 0,\r\n                                background: 'linear-gradient(90deg,#3b82f6,#6366f1,#8b5cf6)',\r\n                                width: `${picContributions ? Math.round(picContributions.averageContribution) : Math.round(progress)}%`,\r\n                                borderRadius: 10,\r\n                                transition: 'width .5s ease'\r\n                              }}\r\n                            />\r\n                          </div>\r\n                          {picContributions && (\r\n                            <div style={{ marginTop: 4, display: 'flex', flexDirection: 'column', gap: 8, width: '100%' }}>\r\n                              <small style={{ opacity: 0.8 }}>Average across all PICs (missing reports = 0%)</small>\r\n                              <div style={{ display: 'flex', gap: 6, width: '100%' }}>\r\n                                {Array.from({ length: picContributions.totalPics }).map((_, i) => (\r\n                                  <div\r\n                                    key={i}\r\n                                    style={{\r\n                                      flex: 1,\r\n                                      height: 6,\r\n                                      background:\r\n                                        i < picContributions.reportingPics\r\n                                          ? 'linear-gradient(90deg,#10b981,#4ade80)'\r\n                                          : '#334155',\r\n                                      borderRadius: 4\r\n                                    }}\r\n                                  />\r\n                                ))}\r\n                              </div>\r\n                              <div style={{ fontSize: 12, opacity: 0.7 }}>\r\n                                {picContributions.reportingPics}/{picContributions.totalPics} submitted\r\n                              </div>\r\n                            </div>\r\n                          )}\r\n                        </div> {/* end inner column */}\r\n                      </div> {/* end overall-progress card */}\r\n                    </div> {/* end progress-grid */}\r\n                    {(picContributions || (project?.pic && project.pic.length > 0)) && (\r\n                      <div\r\n                        className=\"progress-card pic-contributions\"\r\n                        style={{ background: '#fff', border: '1px solid #e2e8f0', borderRadius: 18, padding: 20, display:'flex', flexDirection:'column', gap:16, minWidth:0 }}\r\n                      >\r\n                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n                          <h3 style={{ margin: 0, fontSize: 16, fontWeight: 600, color: '#0f172a', display:'flex', alignItems:'center', gap:8 }}>\r\n                            PiC Contributions\r\n                            {picContributions && (\r\n                              <span style={{background:'#0f172a',color:'#fff',fontSize:11,padding:'4px 10px',borderRadius:20,letterSpacing:.5,fontWeight:600}}>\r\n                                Avg {Math.round(picContributions.averageContribution)}%\r\n                              </span>\r\n                            )}\r\n                          </h3>\r\n                          <FaUsers style={{ color: '#475569' }} />\r\n                        </div>\r\n                        {picContributions && picContributions.totalPics>8 && (\r\n                          <div style={{display:'flex',gap:8,flexWrap:'wrap'}}>\r\n                            <input\r\n                              type=\"text\"\r\n                              placeholder=\"Search PIC name...\"\r\n                              value={picSearch}\r\n                              onChange={e=> setPicSearch(e.target.value)}\r\n                              style={{flex:'1 1 200px',minWidth:140,background:'#f1f5f9',border:'1px solid #e2e8f0',borderRadius:8,padding:'8px 10px',fontSize:12}}\r\n                            />\r\n                            <button\r\n                              type=\"button\"\r\n                              onClick={()=> setShowAllPics(s=>!s)}\r\n                              style={{background:'#0f172a',color:'#fff',border:'none',padding:'8px 14px',borderRadius:8,fontSize:12,fontWeight:600,cursor:'pointer'}}\r\n                            >{showAllPics? 'Show Less':'Show All'}</button>\r\n                          </div>\r\n                        )}\r\n                        {!picContributions && (\r\n                          <div style={{ fontSize: 12, background: '#f1f5f9', padding: '8px 10px', borderRadius: 8, color: '#475569' }}>\r\n                            No contribution data yet.\r\n                          </div>\r\n                        )}\r\n                        {picContributions && (() => {\r\n                          const assigned = Array.isArray(project?.pic) ? project.pic : [];\r\n                          // Map existing perPic array by picId for quick lookup\r\n                          const reportedMap = new Map();\r\n                          picContributions.picContributions.forEach(p => reportedMap.set(String(p.picId), p));\r\n                          const rows = assigned.map(p => {\r\n                            const uid = String(p?._id || p.id || p);\r\n                            const existing = reportedMap.get(uid);\r\n                            return existing || { picId: uid, picName: p?.name || 'Unresolved', contribution: 0, hasReport: false };\r\n                          });\r\n                          // In case there are reports from PICs no longer assigned, append them (edge case)\r\n                          picContributions.picContributions.forEach(p => {\r\n                            if(!rows.some(r=> String(r.picId)===String(p.picId))) rows.push(p);\r\n                          });\r\n                          // Filter by search\r\n                          const term = picSearch.trim().toLowerCase();\r\n                          const filtered = term? rows.filter(r=> (r.picName||'').toLowerCase().includes(term)) : rows;\r\n                          // Sort: reported first, then contribution desc, then name\r\n                          filtered.sort((a,b)=>{\r\n                            if(a.hasReport!==b.hasReport) return a.hasReport? -1:1;\r\n                            const diff=(Number(b.contribution)||0)-(Number(a.contribution)||0);\r\n                            if(diff!==0) return diff;\r\n                            return (a.picName||'').localeCompare(b.picName||'');\r\n                          });\r\n                          const limit = showAllPics? filtered.length : 12; // show first 12 by default\r\n                          const visible = filtered.slice(0,limit);\r\n                          return (\r\n                            <div style={{display:'flex',flexDirection:'column',gap:10,minWidth:0}}>\r\n                              <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(180px,1fr))',gap:10}}>\r\n                                {visible.map((r,i)=>{ const pct=Math.round(r.contribution||0); return (\r\n                                  <div key={i} style={{display:'flex',flexDirection:'column',gap:6,background:'#f8fafc',border:'1px solid #e2e8f0',borderRadius:12,padding:'10px 12px',minWidth:0}}>\r\n                                    <div style={{display:'flex',alignItems:'center',gap:8,minWidth:0}}>\r\n                                      <div style={{width:34,height:34,borderRadius:10,background:'#0f172a',color:'#fff',display:'flex',alignItems:'center',justifyContent:'center',fontSize:14,fontWeight:600,flexShrink:0}}>\r\n                                        {(r.picName||'?').charAt(0).toUpperCase()}\r\n                                      </div>\r\n                                      <div style={{display:'flex',flexDirection:'column',minWidth:0}}>\r\n                                        <span style={{fontSize:12,fontWeight:600,color:'#0f172a',whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis',maxWidth:'100%'}} title={r.picName}>{r.picName}</span>\r\n                                        <span style={{fontSize:10,color:r.hasReport?'#10b981':'#64748b',fontWeight:500}}>{r.hasReport?'Reported':'No report'}</span>\r\n                                      </div>\r\n                                      <div style={{marginLeft:'auto',fontSize:12,fontWeight:700,color:'#0f172a'}}>{pct}%</div>\r\n                                    </div>\r\n                                    <div style={{height:6,background:'#e2e8f0',borderRadius:4,overflow:'hidden',position:'relative'}}>\r\n                                      <div style={{position:'absolute',inset:0,width:`${Math.min(100,Math.max(0,pct))}%`,background: pct>=100? 'linear-gradient(90deg,#16a34a,#4ade80)':'linear-gradient(90deg,#3b82f6,#6366f1)',transition:'width .5s',borderRadius:4}} />\r\n                                    </div>\r\n                                  </div> ); })}\r\n                              </div>\r\n                              {filtered.length>visible.length && (\r\n                                <button type=\"button\" onClick={()=> setShowAllPics(true)} style={{background:'#fff',border:'1px solid #e2e8f0',padding:'8px 12px',borderRadius:8,fontSize:12,fontWeight:600,cursor:'pointer',alignSelf:'center'}}>Show {filtered.length-visible.length} more</button>\r\n                              )}\r\n                              {showAllPics && filtered.length>12 && (\r\n                                <button type=\"button\" onClick={()=> setShowAllPics(false)} style={{background:'#fff',border:'1px solid #e2e8f0',padding:'6px 10px',borderRadius:8,fontSize:11,fontWeight:600,cursor:'pointer',alignSelf:'center'}}>Collapse</button>\r\n                              )}\r\n                              <div style={{display:'flex',justifyContent:'space-between',fontSize:11,color:'#475569',marginTop:4}}>\r\n                                <span style={{fontWeight:600}}>Reported</span>\r\n                                <span style={{fontWeight:600}}>{picContributions.reportingPics}/{picContributions.totalPics}</span>\r\n                              </div>\r\n                            </div>\r\n                          );\r\n                        })()}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  {picContributions && picContributions.picContributions.length > 0 && (\r\n                    <div className=\"individual-contributions\" style={{ marginTop: 24 }}>\r\n                      <h3 className=\"subsection-title\" style={{ fontSize: 16, fontWeight: 600, margin: '0 0 12px' }}>\r\n                        Individual PiC Contributions\r\n                      </h3>\r\n                      <div\r\n                        className=\"pic-list\"\r\n                        style={{ display: 'grid', gap: 10, gridTemplateColumns: 'repeat(auto-fit,minmax(220px,1fr))' }}\r\n                      >\r\n                        {picContributions.picContributions.map((pic, i) => (\r\n                          <div\r\n                            key={i}\r\n                            className={`pic-item ${!pic.hasReport ? 'no-report' : ''}`}\r\n                            style={{ background: '#fff', border: '1px solid #e2e8f0', borderRadius: 14, padding: 14 }}\r\n                          >\r\n                            <div style={{ fontWeight: 600 }}>{pic.picName}</div>\r\n                            {pic.lastReportDate && (\r\n                              <span style={{ fontSize: 11, color: '#64748b' }}>\r\n                                Last: {new Date(pic.lastReportDate).toLocaleDateString()}\r\n                              </span>\r\n                            )}\r\n                            <div style={{ marginTop: 8 }}>\r\n                              {pic.hasReport ? (\r\n                                <span\r\n                                  style={{\r\n                                    display: 'inline-block',\r\n                                    background: 'linear-gradient(90deg,#3b82f6,#6366f1)',\r\n                                    color: '#fff',\r\n                                    fontSize: 13,\r\n                                    padding: '4px 10px',\r\n                                    borderRadius: 8,\r\n                                    fontWeight: 600\r\n                                  }}\r\n                                >\r\n                                  {pic.contribution}%\r\n                                </span>\r\n                              ) : (\r\n                                <span\r\n                                  style={{\r\n                                    display: 'inline-block',\r\n                                    background: '#f1f5f9',\r\n                                    color: '#475569',\r\n                                    fontSize: 12,\r\n                                    padding: '4px 10px',\r\n                                    borderRadius: 8\r\n                                  }}\r\n                                >\r\n                                  No report\r\n                                </span>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                {/* Team */}\r\n                <div className=\"team-section\">\r\n                  <h2 className=\"section-title\">Project Team</h2>\r\n                  <div className=\"team-grid\">\r\n                    <div className=\"team-member\">\r\n                      <div className=\"member-avatar\">\r\n                        <FaUserTie />\r\n                      </div>\r\n                      <div className=\"member-info\">\r\n                        <h4 className=\"member-role\">Project Manager</h4>\r\n                        <p className=\"member-name\">{project?.projectmanager?.name || 'N/A'}</p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"team-member\">\r\n                      <div className=\"member-avatar\">\r\n                        <FaUsers />\r\n                      </div>\r\n                      <div className=\"member-info\">\r\n                        <h4 className=\"member-role\">Person in Charge</h4>\r\n                        <p className=\"member-name\">\r\n                          {Array.isArray(project?.pic) && project.pic.length\r\n                            ? project.pic.map(p => p?.name).filter(Boolean).join(', ')\r\n                            : 'N/A'}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"team-member\">\r\n                      <div className=\"member-avatar\">\r\n                        <FaUsers />\r\n                      </div>\r\n                      <div className=\"member-info\">\r\n                        <h4 className=\"member-role\">HR Site</h4>\r\n                        <p className=\"member-name\">\r\n                          {hrSiteNames.length\r\n                            ? hrSiteNames.join(', ')\r\n                            : (Array.isArray(project?.hrsite) && project.hrsite.length\r\n                                ? `${project.hrsite.length} assigned`\r\n                                : (role==='hrsite' ? (userName || 'You') : 'N/A'))}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"team-member\">\r\n                      <div className=\"member-avatar\">\r\n                        <FaUsers />\r\n                      </div>\r\n                      <div className=\"member-info\">\r\n                        <h4 className=\"member-role\">Staff</h4>\r\n                        <p className=\"member-name\">\r\n                          {staffNames.length\r\n                            ? staffNames.join(', ')\r\n                            : (Array.isArray(project?.staff) && project.staff.length\r\n                                ? `${project.staff.length} assigned`\r\n                                : (role==='staff' ? (userName || 'You') : 'N/A'))}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                {/* Manpower */}\r\n                <div className=\"manpower-section\">\r\n                  <h2 className=\"section-title\">Assigned Manpower</h2>\r\n                  <div className=\"manpower-content\">\r\n                    <p className=\"manpower-text\">{manpowerText}</p>\r\n                  </div>\r\n                </div>\r\n                {/* Purchase Orders */}\r\n                {purchaseOrders.length > 0 && (\r\n                  <div className=\"purchase-orders-section\">\r\n                    <h2 className=\"section-title\">Purchase Orders</h2>\r\n                    <div className=\"po-list\">\r\n                      {purchaseOrders.map(po => (\r\n                        <div key={po._id} className=\"po-item\">\r\n                          <span className=\"po-number\">PO#: {po.purchaseOrder}</span>\r\n                          <span className=\"po-amount\">{peso.format(Number(po.totalValue))}</span>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n            {/* BUDGET TAB (role restricted) */}\r\n            {activeTab === 'Budget' && ['pic','pm','am','ceo'].includes(role) && (\r\n              <div className=\"budget-tab\" style={{textAlign:'left'}}>\r\n                <h2 style={{margin:'0 0 16px', display:'flex', alignItems:'center', gap:10}}><FaMoneyBillWave /> Project Budget</h2>\r\n                <div style={{display:'grid', gap:20, gridTemplateColumns:'repeat(auto-fit,minmax(260px,1fr))'}}>\r\n                  <div style={{background:'#ffffff',border:'1px solid #e2e8f0',borderRadius:16,padding:20,position:'relative'}}>\r\n                    <h3 style={{marginTop:0,marginBottom:6,fontSize:16}}>Total Budget</h3>\r\n                    <div style={{fontSize:30,fontWeight:700,color:'#0f172a'}}>{peso.format(budgetNum||0)}</div>\r\n                    {totalPO>0 && (\r\n                      <div style={{marginTop:8,fontSize:13,color:'#475569'}}>Remaining: <b>{peso.format(Math.max(budgetNum - Number(totalPO||0),0))}</b><span style={{color:'#64748b'}}> (POs: {peso.format(totalPO)})</span></div>\r\n                    )}\r\n                    {project?.parsedBudgetTotals && Number(project?.parsedBudgetTotals?.totalAll || 0) > 0 && (\r\n                      <div style={{marginTop:18,paddingTop:14,borderTop:'1px solid #e2e8f0'}}>\r\n                        {(()=>{\r\n                          const totalDeduct = Number(project.parsedBudgetTotals.totalAll || 0);\r\n                          const original = (Number(budgetNum || 0) + totalDeduct);\r\n                          const sections = Array.isArray(project.parsedBudgetTotals.sections) ? project.parsedBudgetTotals.sections : [];\r\n                          const greenItems = Array.isArray(project.parsedBudgetTotals.greenItems) ? project.parsedBudgetTotals.greenItems : [];\r\n                          const unified = [\r\n                            ...sections.map(s => ({ code: s.letter ? (s.letter + '.') : '', title: s.title || '', amount: s.amount })),\r\n                            ...greenItems.map(g => ({ code: g.code || '', title: g.title || '', amount: g.amount }))\r\n                          ];\r\n                          return (\r\n                            <div>\r\n                              <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8,fontSize:13}}>\r\n                                <div><span style={{color:'#64748b'}}>Original:</span> <b>{peso.format(original)}</b></div>\r\n                                <div style={{textAlign:'right'}}><span style={{color:'#64748b'}}>Total Deduction:</span> <b style={{color:'#b91c1c'}}>-{peso.format(totalDeduct)}</b></div>\r\n                              </div>\r\n                              <div style={{marginTop:16}}>\r\n                                <button\r\n                                  type=\"button\"\r\n                                  onClick={()=> setShowSectionBreakdown(s=>!s)}\r\n                                  style={{\r\n                                    width:'100%',background:'#f1f5f9',border:'1px solid #e2e8f0',borderRadius:8,padding:'10px 14px',display:'flex',justifyContent:'space-between',alignItems:'center',cursor:'pointer',fontSize:13,fontWeight:600,color:'#334155'\r\n                                  }}\r\n                                >\r\n                                  <span>Budget Breakdown</span>\r\n                                  <span style={{display:'flex',alignItems:'center',gap:10}}>\r\n                                    <span style={{fontSize:11,color:'#64748b',fontWeight:500}}>{peso.format(totalDeduct)}</span>\r\n                                    <span style={{transition:'transform .25s', transform: showSectionBreakdown ? 'rotate(90deg)':'rotate(0deg)'}}>&#9656;</span>\r\n                                  </span>\r\n                                </button>\r\n                                {showSectionBreakdown && (\r\n                                  <div style={{marginTop:8,maxHeight:260,overflowY:'auto',border:'1px solid #e2e8f0',borderRadius:8}}>\r\n                                    <table style={{width:'100%',borderCollapse:'collapse',fontSize:12}}>\r\n                                      <thead>\r\n                                        <tr style={{background:'#f8fafc'}}>\r\n                                          <th style={{textAlign:'left',padding:'8px 10px',borderBottom:'1px solid #e2e8f0'}}>Item</th>\r\n                                          <th style={{textAlign:'right',padding:'8px 10px',borderBottom:'1px solid #e2e8f0'}}>Amount</th>\r\n                                        </tr>\r\n                                      </thead>\r\n                                      <tbody>\r\n                                        {unified.map((u,idx)=>(\r\n                                          <tr key={idx}>\r\n                                            <td style={{padding:'6px 10px',borderBottom:'1px solid #eef2f7'}}>{u.title}</td>\r\n                                            <td style={{padding:'6px 10px',borderBottom:'1px solid #eef2f7',textAlign:'right'}}>{peso.format(Number(u.amount||0))}</td>\r\n                                          </tr>\r\n                                        ))}\r\n                                      </tbody>\r\n                                      <tfoot>\r\n                                        <tr>\r\n                                          <td style={{padding:'8px 10px',textAlign:'right',fontWeight:700}}>Total</td>\r\n                                          <td style={{padding:'8px 10px',textAlign:'right',fontWeight:700}}>{peso.format(totalDeduct)}</td>\r\n                                        </tr>\r\n                                      </tfoot>\r\n                                    </table>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                          );\r\n                        })()}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  {budgetDocument && (\r\n                    <div style={{background:'#ffffff',border:'1px solid #e2e8f0',borderRadius:16,padding:20,display:'flex',flexDirection:'column',gap:10,position:'relative'}}>\r\n                      <h3 style={{margin:'0 0 4px',fontSize:16,display:'flex',alignItems:'center',gap:8}}>\r\n                        Budget PDF\r\n                        {project?.parsedBudgetTotals && project.parsedBudgetTotals.autoDeductEligible===false && (\r\n                          <span title=\"Parsed but not auto-deducted (low confidence)\" style={{background:'#f59e0b',color:'#3a2f00',fontSize:11,padding:'3px 8px',borderRadius:20,fontWeight:700,letterSpacing:.5}}>NOT DEDUCTED</span>\r\n                        )}\r\n                      </h3>\r\n                      <div style={{fontSize:13,color:'#475569',fontWeight:600}}>{budgetDocument.name || budgetDocument.path?.split('/').pop()}</div>\r\n                      <div style={{display:'flex',gap:8}}>\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={()=> openSignedPath(budgetDocument.path)}\r\n                          style={{background:'#0b5fff',color:'#fff',border:'none',padding:'8px 14px',borderRadius:8,fontSize:13,fontWeight:600,cursor:'pointer'}}\r\n                        >Open</button>\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={()=> openSignedPath(budgetDocument.path)}\r\n                          style={{background:'#0f172a',color:'#fff',border:'none',padding:'8px 14px',borderRadius:8,fontSize:13,fontWeight:600,cursor:'pointer'}}\r\n                        >Download</button>\r\n                      </div>\r\n                      {(budgetDocument.uploadedByName || budgetDocument.uploadedAt) && (\r\n                        <div style={{fontSize:11,color:'#64748b'}}>\r\n                          {budgetDocument.uploadedByName && <span>Uploaded by <b>{budgetDocument.uploadedByName}</b></span>}\r\n                          {budgetDocument.uploadedAt && <span style={{marginLeft:6}}>on {new Date(budgetDocument.uploadedAt).toLocaleDateString()}</span>}\r\n                        </div>\r\n                      )}\r\n                      {project?.parsedBudgetTotals?.confidenceSummary && (\r\n                        <div style={{marginTop:4,fontSize:12,color:'#64748b'}}>{project.parsedBudgetTotals.confidenceSummary}</div>\r\n                      )}\r\n                      {/* Simple spent vs original progress bar */}\r\n                      {(() => {\r\n                        if(!project?.parsedBudgetTotals) return null;\r\n                        const totalDeduct = Number(project.parsedBudgetTotals.totalAll || 0);\r\n                        const original = (Number(budgetNum || 0) + totalDeduct) || 0;\r\n                        if(!original) return null;\r\n                        const spent = original - (Number(budgetNum||0));\r\n                        const pct = Math.min(100, Math.max(0, (spent / original) * 100));\r\n                        return (\r\n                          <div style={{marginTop:10}}>\r\n                            <div style={{display:'flex',justifyContent:'space-between',fontSize:11,color:'#475569',marginBottom:4}}>\r\n                              <span>Spent: {peso.format(spent)}</span>\r\n                              <span>{pct.toFixed(1)}%</span>\r\n                            </div>\r\n                            <div style={{height:8,background:'#e2e8f0',borderRadius:6,overflow:'hidden',position:'relative'}}>\r\n                              <div style={{width:`${pct}%`,height:'100%',background:'linear-gradient(90deg,#0b5fff,#38bdf8)'}} />\r\n                            </div>\r\n                          </div>\r\n                        );\r\n                      })()}\r\n                    </div>\r\n                  )}\r\n                  {/* AM Purchase Orders */}\r\n                  <div style={{background:'#ffffff',border:'1px solid #e2e8f0',borderRadius:16,padding:20,display:'flex',flexDirection:'column',gap:16}}>\r\n                    <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>\r\n                      <h3 style={{margin:0,fontSize:16}}>Purchase Orders</h3>\r\n                      {role==='am' && (\r\n                        <form onSubmit={async e=>{ e.preventDefault(); if(!project?._id) return; const form=e.currentTarget; const files=Array.from(form.poFiles.files||[]); if(!files.length){ setPoError('Select at least one file'); return;} setPoError(''); setPoUploading(true); try { const fd=new FormData(); files.forEach(f=> fd.append('poFiles',f)); const {data}=await api.post(`/projects/${project._id}/purchase-orders/files`,fd); if(data?.purchaseOrders){ setPurchaseOrders(data.purchaseOrders); setTotalPO(data.purchaseOrders.reduce((s,p)=> s+(Number(p.amount)||0),0)); } if(typeof data?.budget!=='undefined'){ setProject(p=> ({...p,budget:data.budget,purchaseOrders:data.purchaseOrders})); } form.reset(); } catch(err){ setPoError(err?.response?.data?.message||'Upload failed'); } finally { setPoUploading(false);} }} style={{display:'flex',gap:8,alignItems:'center'}}>\r\n                          <input name=\"poFiles\" type=\"file\" multiple accept=\"application/pdf,image/*\" style={{fontSize:12}} />\r\n                          <button disabled={poUploading} style={{background:'#0f172a',color:'#fff',border:'none',padding:'8px 12px',borderRadius:8,fontSize:13,fontWeight:600,cursor:poUploading?'not-allowed':'pointer',opacity:poUploading?.6:1}}>{poUploading? 'Uploading...':'Upload Document/s'}</button>\r\n                        </form>\r\n                      )}\r\n                    </div>\r\n                    {poError && <div style={{color:'#b91c1c',fontSize:12}}>{poError}</div>}\r\n                    {purchaseOrders.length===0 ? (\r\n                      <div style={{fontSize:13,color:'#64748b'}}>No purchase orders yet.</div>\r\n                    ) : (\r\n                      <div style={{display:'flex',flexDirection:'column',gap:8,maxHeight:260,overflowY:'auto'}}>\r\n                        {purchaseOrders.map((po,i)=>(\r\n                          <div key={po._id||i} style={{display:'flex',flexDirection:'column',gap:6,padding:'8px 10px',border:'1px solid #e2e8f0',borderRadius:8,fontSize:13,background:'#f8fafc'}}>\r\n                            <div style={{display:'flex',alignItems:'center',gap:12}}>\r\n                              <button\r\n                                onClick={()=> po.path && openSignedPath(po.path)}\r\n                                style={{background:'transparent',border:'none',color:'#2563eb',cursor: po.path? 'pointer':'not-allowed',textAlign:'left',flex:1,fontSize:13,padding:0}}\r\n                                title={po.path? 'View PO file':'No file path'}\r\n                                disabled={!po.path}\r\n                              >\r\n                                {po.name || po.path?.split('/').pop() || 'PO File'}\r\n                              </button>\r\n                              {po.amount ? (\r\n                                <span style={{fontWeight:600,whiteSpace:'nowrap'}}>{peso.format(Number(po.amount)||0)}</span>\r\n                              ) : role==='am' ? (\r\n                                <form onSubmit={async e=>{ e.preventDefault(); if(!project?._id) return; const raw=poAmountInputs[po._id]||''; const amt=parseFormattedNumber(raw); if(!amt){ alert('Enter valid amount'); return;} const remainingBudget = Number(project.budget||0); if(amt>remainingBudget){ alert('Amount exceeds remaining budget'); return;} try { const {data}=await api.patch(`/projects/${project._id}/purchase-orders/${po._id}/amount`,{ amount: amt }); if(data?.purchaseOrders){ setPurchaseOrders(data.purchaseOrders); setTotalPO(data.purchaseOrders.reduce((s,p)=> s+(Number(p.amount)||0),0)); } if(typeof data?.budget!=='undefined'){ setProject(p=> ({...p,budget:data.budget,purchaseOrders:data.purchaseOrders})); } setPoAmountInputs(p=> ({...p,[po._id]:''})); } catch(err){ alert(err?.response?.data?.message||'Set amount failed'); } }} style={{display:'flex',alignItems:'center',gap:6}}>\r\n                                  <div style={{display:'flex',alignItems:'center',background:'#fff',border:'1px solid #cbd5e1',borderRadius:6,padding:'2px 6px'}}>\r\n                                    <span style={{fontSize:12,color:'#64748b',marginRight:4}}></span>\r\n                                    <input\r\n                                      name=\"amount\"\r\n                                      type=\"text\"\r\n                                      inputMode=\"decimal\"\r\n                                      value={poAmountInputs[po._id] || ''}\r\n                                      onChange={e=>{ const formatted=formatNumberWithCommas(e.target.value); setPoAmountInputs(p=> ({...p,[po._id]:formatted})); }}\r\n                                      placeholder=\"0.00\"\r\n                                      style={{width:90,padding:'2px 0',border:'none',outline:'none',fontSize:12,background:'transparent'}}\r\n                                    />\r\n                                  </div>\r\n                                  <button style={{background:'#0f172a',color:'#fff',border:'none',padding:'6px 10px',borderRadius:6,fontSize:12,fontWeight:600,cursor:'pointer'}}>Set</button>\r\n                                </form>\r\n                              ) : (\r\n                                <span style={{color:'#64748b',fontStyle:'italic'}}>Pending total</span>\r\n                              )}\r\n                              {role==='am' && (\r\n                                <button onClick={async()=>{ if(!window.confirm('Delete this PO?')) return; try { const {data}=await api.delete(`/projects/${project._id}/purchase-orders/${po._id}`); if(data?.purchaseOrders){ setPurchaseOrders(data.purchaseOrders); setTotalPO(data.purchaseOrders.reduce((s,p)=> s+(Number(p.amount)||0),0)); } if(typeof data?.budget!=='undefined'){ setProject(p=> ({...p,budget:data.budget,purchaseOrders:data.purchaseOrders})); } } catch(err){ alert(err?.response?.data?.message||'Delete failed'); } }} style={{background:'#fee2e2',color:'#b91c1c',border:'1px solid #fca5a5',padding:'6px 10px',borderRadius:6,fontSize:12,cursor:'pointer'}}>Delete</button>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                        <div style={{marginTop:4,textAlign:'right',fontSize:13}}>\r\n                          <b>Total Deducted:</b> {peso.format(totalPO)}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n            {/* DISCUSSIONS TAB */}\r\n            {activeTab === 'Discussions' && (\r\n              <div className=\"discussions-container\" style={{minHeight:'120vh',maxHeight:'calc(200vh - 300px)',display:'flex',flexDirection:'column'}}>\r\n                <div className=\"messages-list\" ref={listScrollRef} style={{flex:'1 1 auto',overflowY:'auto',paddingBottom:16}}>\r\n                  {loadingMsgs ? (\r\n                    <div className=\"loading-messages\">\r\n                      <div className=\"loading-spinner\" />\r\n                      <span>Loading discussions...</span>\r\n                    </div>\r\n                  ) : messages.length === 0 ? (\r\n                    <div className=\"empty-discussions\">\r\n                      <FaRegCommentDots />\r\n                      <h3>No discussions yet</h3>\r\n                      <p>Start a conversation about this project.</p>\r\n                    </div>\r\n                  ) : (\r\n                    messages.map(msg => {\r\n                      const mentioned = isMentioned(msg.text, userName);\r\n          return ( \r\n                        <div key={msg._id} className=\"message-item\" style={{ ...(mentioned ? mentionRowStyles.container : {}) }}>\r\n                          {mentioned && <div style={mentionRowStyles.badge}>MENTIONED</div>}\r\n                          <div className=\"message-header\">\r\n                            <div className=\"message-avatar\">{msg.userName?.charAt(0)?.toUpperCase() || '?'}</div>\r\n                            <div className=\"message-info\">\r\n                              <span className=\"message-author\">{msg.userName || 'Unknown'}</span>\r\n                              <span className=\"message-time\">\r\n                                {msg.timestamp ? new Date(msg.timestamp).toLocaleString() : ''}\r\n                              </span>\r\n                            </div>\r\n            {renderLabelBadge(msg.label)}\r\n                          </div>\r\n                          <div className=\"message-content\">\r\n                            {msg.text && (\r\n                              <p className=\"message-text\">{renderMessageText(msg.text, userName)}</p>\r\n                            )}\r\n                            {Array.isArray(msg.attachments) && msg.attachments.length > 0 && (\r\n                              <div className=\"message-attachments\">\r\n                                <div style={{display:'flex',flexWrap:'wrap',gap:16}}>\r\n                                {msg.attachments.map((att, i) => {\r\n                                  const name = att.name || extractOriginalNameFromPath(att.path);\r\n                                  const t = getFileType(name);\r\n                                  const isImage = ['JPG','JPEG','PNG','GIF','BMP','SVG'].includes(t);\r\n                                  return (\r\n                                    <div key={i} className=\"attachment-item\" style={{width:160,background:'#ffffff',border:'1px solid #e2e8f0',borderRadius:12,padding:8,boxSizing:'border-box',display:'flex',flexDirection:'column',alignItems:'center'}}>\r\n                                      <div className=\"attachment-thumbnail\" style={{cursor:isImage?'zoom-in':'pointer'}}\r\n                                        onClick={e=>{\r\n                                          e.preventDefault();\r\n                                          if(isImage){\r\n                                            setImagePreview({ src: fileSignedUrls[att.path] || att.path, name });\r\n                                          } else {\r\n                                            openSignedPath(att.path);\r\n                                          }\r\n                                        }}\r\n                                      >\r\n                                        {generateFileThumbnail(name, att.path, t, fileSignedUrls[att.path])}\r\n                                      </div>\r\n                                      <div className=\"attachment-info\" style={{marginTop:8,minHeight:42,width:'100%',textAlign:'center',display:'flex',flexDirection:'column',justifyContent:'space-between'}}>\r\n                                        <a\r\n                                          href=\"#\"\r\n                                          onClick={e => { e.preventDefault(); openSignedPath(att.path); }}\r\n                                          className=\"attachment-name\"\r\n                                          title={name}\r\n                                          style={{display:'-webkit-box',fontSize:12,overflow:'hidden',textOverflow:'ellipsis',WebkitLineClamp:2,WebkitBoxOrient:'vertical',lineHeight:'1.2em',wordBreak:'break-word',overflowWrap:'anywhere',width:'100%'}}\r\n                                        >{name}</a>\r\n                                        <span className=\"attachment-type\" style={{fontSize:10,background:'#f1f5f9',padding:'2px 6px',borderRadius:6,display:'inline-block',marginTop:4,alignSelf:'center'}}>{t}</span>\r\n                                      </div>\r\n                                    </div>\r\n                                  );\r\n                                })}\r\n                                </div>\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                          {Array.isArray(msg.replies) && msg.replies.length > 0 && (\r\n                            <div className=\"replies-container\">\r\n                              {(() => { const total = msg.replies.length; const collapsed = collapsedReplies[msg._id]; const list = (collapsed && total >=3) ? msg.replies.slice(0,2) : msg.replies; return list.map(r => {\r\n                                const rm = isMentioned(r.text, userName);\r\n                                return (\r\n                                  <div key={r._id} className=\"reply-item\" style={rm ? mentionRowStyles.container : {}}>\r\n                                    {rm && <div style={mentionRowStyles.badge}>MENTIONED</div>}\r\n                                    <div className=\"reply-header\">\r\n                                      <div className=\"reply-avatar\">{r.userName?.charAt(0)?.toUpperCase() || '?'}</div>\r\n                                      <div className=\"reply-info\">\r\n                                        <span className=\"reply-author\">{r.userName || 'Unknown'}</span>\r\n                                        <span className=\"reply-time\">\r\n                                          {r.timestamp ? new Date(r.timestamp).toLocaleString() : ''}\r\n                                        </span>\r\n                                      </div>\r\n                                    </div>\r\n                                    <div className=\"reply-content\">\r\n                                      {r.text && (\r\n                                        <p className=\"reply-text\">{renderMessageText(r.text, userName)}</p>\r\n                                      )}\r\n                                      {Array.isArray(r.attachments) && r.attachments.length > 0 && (\r\n                                        <div className=\"reply-attachments\">\r\n                                          <div style={{display:'flex',flexWrap:'wrap',gap:16}}>\r\n                                          {r.attachments.map((att, i) => {\r\n                                            const name = att.name || extractOriginalNameFromPath(att.path);\r\n                                            const t = getFileType(name);\r\n                                            const isImage = ['JPG','JPEG','PNG','GIF','BMP','SVG'].includes(t);\r\n                                            return (\r\n                                              <div key={i} className=\"attachment-item\" style={{width:160,background:'#ffffff',border:'1px solid #e2e8f0',borderRadius:12,padding:8,boxSizing:'border-box',display:'flex',flexDirection:'column',alignItems:'center'}}>\r\n                                                <div className=\"attachment-thumbnail\" style={{cursor:isImage?'zoom-in':'pointer'}}\r\n                                                  onClick={e=>{\r\n                                                    e.preventDefault();\r\n                                                    if(isImage){\r\n                                                      setImagePreview({ src: fileSignedUrls[att.path] || att.path, name });\r\n                                                    } else {\r\n                                                      openSignedPath(att.path);\r\n                                                    }\r\n                                                  }}\r\n                                                >\r\n                                                  {generateFileThumbnail(name, att.path, t, fileSignedUrls[att.path])}\r\n                                                </div>\r\n                                                <div className=\"attachment-info\" style={{marginTop:8,minHeight:42,width:'100%',textAlign:'center',display:'flex',flexDirection:'column',justifyContent:'space-between'}}>\r\n                                                  <a\r\n                                                    href=\"#\"\r\n                                                    onClick={e => { e.preventDefault(); openSignedPath(att.path); }}\r\n                                                    className=\"attachment-name\"\r\n                                                    title={name}\r\n                                                    style={{display:'-webkit-box',fontSize:12,overflow:'hidden',textOverflow:'ellipsis',WebkitLineClamp:2,WebkitBoxOrient:'vertical',lineHeight:'1.2em',wordBreak:'break-word',overflowWrap:'anywhere',width:'100%'}}\r\n                                                  >{name}</a>\r\n                                                  <span className=\"attachment-type\" style={{fontSize:10,background:'#f1f5f9',padding:'2px 6px',borderRadius:6,display:'inline-block',marginTop:4,alignSelf:'center'}}>{t}</span>\r\n                                                </div>\r\n                                              </div>\r\n                                            );\r\n                                          })}\r\n                                          </div>\r\n                                        </div>\r\n                                      )}\r\n                                    </div>\r\n                                  </div>\r\n                                );\r\n                              }); })()}\r\n                              {msg.replies.length >=3 && (\r\n                                <button\r\n                                  onClick={()=> setCollapsedReplies(p=> ({...p, [msg._id]: !p[msg._id]}))}\r\n                                  className=\"replies-toggle-btn\"\r\n                                  style={{marginTop:8,background:'transparent',border:'none',color:'#2563eb',cursor:'pointer',fontSize:13,fontWeight:600,padding:0}}\r\n                                >\r\n                                  {collapsedReplies[msg._id] ? `Show all ${msg.replies.length} replies` : 'Hide replies'}\r\n                                </button>\r\n                              )}\r\n                            </div>\r\n                          )}\r\n                          {/* Reply Composer */}\r\n                          {perms.postDiscuss && (\r\n                            <div className=\"reply-composer\" style={{marginTop:12,padding:12,borderTop:'1px solid #e2e8f0',display:'flex',gap:8,alignItems:'flex-start'}}>\r\n                              <textarea\r\n                                value={replyInputs[msg._id] || ''}\r\n                                onChange={e => setReplyInputs(p => ({ ...p, [msg._id]: e.target.value }))}\r\n                                onKeyDown={e => { if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); handlePostReply(msg._id); } }}\r\n                                placeholder=\"Write a reply...\"\r\n                                style={{flex:1,minHeight:60,resize:'vertical',fontFamily:'inherit',fontSize:14,padding:8,border:'1px solid #cbd5e1',borderRadius:8}}\r\n                              />\r\n                              <button\r\n                                onClick={() => handlePostReply(msg._id)}\r\n                                disabled={posting || !(replyInputs[msg._id]||'').trim()}\r\n                                style={{background:'linear-gradient(90deg,#3b82f6,#6366f1)',color:'#fff',border:'none',padding:'10px 16px',borderRadius:8,fontSize:14,fontWeight:600,cursor: posting || !(replyInputs[msg._id]||'').trim()? 'not-allowed':'pointer',opacity: posting || !(replyInputs[msg._id]||'').trim()? .6:1,alignSelf:'stretch'}}\r\n                              >\r\n                                {posting ? 'Posting...' : 'Reply'}\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      );\r\n                    })\r\n                  )}\r\n                </div>\r\n                <div ref={listBottomRef} />\r\n                {perms.postDiscuss && (\r\n                  <div className=\"message-composer\">\r\n                    <div\r\n                      className={`composer-area ${isDragOver ? 'drag-over' : ''}`}\r\n                      onDragOver={e => {\r\n                        e.preventDefault();\r\n                        setIsDragOver(true);\r\n                      }}\r\n                      onDragLeave={e => {\r\n                        e.preventDefault();\r\n                        setIsDragOver(false);\r\n                      }}\r\n                      onDrop={e => {\r\n                        e.preventDefault();\r\n                        setIsDragOver(false);\r\n                        if (e.dataTransfer?.files?.length) addComposerFiles(e.dataTransfer.files);\r\n                      }}\r\n                    >\r\n                      <div className=\"label-selector\">\r\n                        <select\r\n                          value={selectedLabel}\r\n                          onChange={e => setSelectedLabel(e.target.value)}\r\n                          className=\"label-dropdown\"\r\n                        >\r\n                          <option value=\"\">No Label</option>\r\n                          <option value=\"Important\">Important</option>\r\n                          <option value=\"Announcement\">Announcement</option>\r\n                          <option value=\"Update\">Update</option>\r\n                          <option value=\"Reminder\">Reminder</option>\r\n                          <option value=\"Urgent\">Urgent</option>\r\n                        </select>\r\n                      </div>\r\n                      <textarea\r\n                        ref={textareaRef}\r\n                        id=\"main-composer-textarea\"\r\n                        value={newMessage}\r\n                        onChange={handleTextareaInput}\r\n                        onKeyDown={handleKeyDownComposer}\r\n                        placeholder=\"Type your message here...\"\r\n                        className=\"composer-textarea\"\r\n                      />\r\n                      {mentionDropdown.open && mentionDropdown.activeInputId === textareaRef.current?.id && (\r\n                        <div className=\"mention-dropdown\">\r\n                          {mentionDropdown.options.map(u => (\r\n                            <div key={u._id} className=\"mention-option\" onClick={() => handleMentionSelect(u)}>\r\n                              {u.name}\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"composer-actions\">\r\n                      <div className=\"composer-left\">\r\n                        <label htmlFor=\"composer-attachments\" className=\"attachment-button\">\r\n                          <FaRegFileAlt />\r\n                          <span>Attach Files</span>\r\n                        </label>\r\n                        <input\r\n                          id=\"composer-attachments\"\r\n                          type=\"file\"\r\n                          multiple\r\n                          accept={acceptTypes}\r\n                          style={{ display: 'none' }}\r\n                          onChange={e => {\r\n                            addComposerFiles(e.target.files);\r\n                            e.target.value = '';\r\n                          }}\r\n                        />\r\n                        {composerFiles.map((f, i) => (\r\n                          <div key={i} className=\"file-preview\">\r\n                            <span> {f.name}</span>\r\n                            <button\r\n                              onClick={() => setComposerFiles(p => p.filter((_, idx) => idx !== i))}\r\n                              className=\"remove-file-btn\"\r\n                            >\r\n                              \r\n                            </button>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                      <div className=\"composer-right\">\r\n                        <button\r\n                          onClick={handlePostMessage}\r\n                          disabled={posting || (!newMessage.trim() && composerFiles.length === 0)}\r\n                          className=\"send-button\"\r\n                        >\r\n                          {posting ? 'Sending...' : 'Send Message'}\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n            {/* FILES TAB */}\r\n            {activeTab === 'Files' && (\r\n              <div className=\"files-container\">\r\n                <div className=\"files-header\">\r\n                  <div className=\"files-title-section\">\r\n                    <h2 className=\"files-title\">Project Files</h2>\r\n                    <p className=\"files-subtitle\">\r\n                      {documentsExcludingBudget && documentsExcludingBudget.length\r\n                        ? `Showing ${Math.min(\r\n                            documentsExcludingBudget.filter(d => {\r\n                              if (!fileSearchTerm) return true;\r\n                              const n =\r\n                                typeof d === 'string'\r\n                                  ? extractOriginalNameFromPath(d)\r\n                                  : d.name || extractOriginalNameFromPath(d.path);\r\n                              return n.toLowerCase().includes(fileSearchTerm.toLowerCase());\r\n                            }).length,\r\n                            5\r\n                          )} of ${documentsExcludingBudget.length} files`\r\n                        : 'Manage and organize project documents'}\r\n                    </p>\r\n                  </div>\r\n                  <div className=\"files-actions\">\r\n                    <div className=\"search-container\">\r\n                      <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search files...\"\r\n                        value={fileSearchTerm}\r\n                        onChange={e => setFileSearchTerm(e.target.value)}\r\n                        className=\"file-search-input\"\r\n                      />\r\n                    </div>\r\n                    {perms.uploadFiles && (\r\n                      <>\r\n                        <label htmlFor=\"file-upload\" className=\"upload-btn\">\r\n                          <FaRegFileAlt />\r\n                          <span>Upload Files</span>\r\n                        </label>\r\n                        <input\r\n                          id=\"file-upload\"\r\n                          type=\"file\"\r\n                          multiple\r\n                          accept=\".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.rtf,.csv,image/*\"\r\n                          style={{ display: 'none' }}\r\n                          onChange={e => {\r\n                            if (e.target.files?.length) handleFileUpload(Array.from(e.target.files));\r\n                            e.target.value = '';\r\n                          }}\r\n                        />\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                {uploading && (\r\n                  <div className=\"upload-progress\">\r\n                    <div className=\"progress-bar\">\r\n                      <div className=\"progress-fill\" style={{ width: `${uploadProgress}%` }} />\r\n                    </div>\r\n                    <span className=\"progress-text\">Uploading... {uploadProgress}%</span>\r\n                  </div>\r\n                )}\r\n                <div className=\"files-table-container\">\r\n                  {documentsExcludingBudget && documentsExcludingBudget.length ? (\r\n                    <table className=\"files-table\">\r\n                      <thead className=\"table-header\">\r\n                        <tr>\r\n                          <th className=\"header-cell file-name\">File Name</th>\r\n                          <th className=\"header-cell file-type\">Type</th>\r\n                          <th className=\"header-cell file-size\">Size</th>\r\n                          <th className=\"header-cell file-uploader\">Uploaded By</th>\r\n                          <th className=\"header-cell file-date\">Date</th>\r\n                          <th className=\"header-cell file-actions\">Actions</th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody className=\"table-body\">\r\n                        {documentsExcludingBudget\r\n                          .filter(d => {\r\n                            if (!fileSearchTerm) return true;\r\n                            const n =\r\n                              typeof d === 'string'\r\n                                ? extractOriginalNameFromPath(d)\r\n                                : d.name || extractOriginalNameFromPath(d.path);\r\n                            return n.toLowerCase().includes(fileSearchTerm.toLowerCase());\r\n                          })\r\n                          .slice(0, 5)\r\n                          .map((doc, i) => {\r\n                            const fileName =\r\n                              typeof doc === 'string'\r\n                                ? extractOriginalNameFromPath(doc)\r\n                                : doc.name || extractOriginalNameFromPath(doc.path);\r\n                            const filePath = typeof doc === 'string' ? doc : doc.path;\r\n                            const type = getFileType(fileName);\r\n                            const size = getFileSize(fileName);\r\n                            const by = typeof doc === 'string' ? 'Unknown' : doc.uploadedByName || 'Unknown';\r\n                            const at = typeof doc === 'string' ? null : doc.uploadedAt;\r\n                            return (\r\n                              <tr key={i} className=\"table-row\">\r\n                                <td className=\"table-cell file-name\">\r\n                                  <div className=\"file-info\">\r\n                                    <div className=\"file-thumbnail-container\" style={{width:160,height:110}}>\r\n                                      {generateFileThumbnail(fileName, filePath, type, fileSignedUrls[filePath])}\r\n                                    </div>\r\n                                    <span className=\"file-name-text\" title={fileName}>\r\n                                      {fileName}\r\n                                    </span>\r\n                                  </div>\r\n                                </td>\r\n                                <td className=\"table-cell file-type\">\r\n                                  <span className=\"file-type-badge\">{type}</span>\r\n                                </td>\r\n                                <td className=\"table-cell file-size\">{size}</td>\r\n                                <td className=\"table-cell file-uploader\">{by}</td>\r\n                                <td className=\"table-cell file-date\">\r\n                                  {at ? new Date(at).toLocaleDateString() : 'N/A'}\r\n                                </td>\r\n                                <td className=\"table-cell file-actions\">\r\n                                  <div className=\"action-buttons\">\r\n                                    <button\r\n                                      onClick={() => openSignedPath(filePath)}\r\n                                      className=\"action-btn download-btn\"\r\n                                      title=\"Download\"\r\n                                    >\r\n                                      <FaDownload />\r\n                                    </button>\r\n                                    {perms.deleteFiles && (\r\n                                      <button\r\n                                        onClick={() => handleDeleteFile(doc, i)}\r\n                                        className=\"action-btn delete-btn\"\r\n                                        title=\"Delete\"\r\n                                      >\r\n                                        <FaTrash />\r\n                                      </button>\r\n                                    )}\r\n                                  </div>\r\n                                </td>\r\n                              </tr>\r\n                            );\r\n                          })}\r\n                      </tbody>\r\n                    </table>\r\n                  ) : (\r\n                    <div className=\"empty-files\">\r\n                      <FaRegFileAlt />\r\n                      <h3>No files uploaded yet</h3>\r\n                      <p>Upload project documents to get started</p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            )}\r\n            {/* REPORTS TAB */}\r\n            {activeTab === 'Reports' && (\r\n              <div className=\"project-reports\" style={{ textAlign: 'left' }}>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: 12 }}>\r\n                  <h3 style={{ marginBottom: 18 }}>Project Reports</h3>\r\n                  {canUploadReport && (\r\n                    <div style={{ display:'flex', alignItems:'center', gap:12 }}>\r\n                      <label htmlFor=\"pptx-report-uploader\" style={{ cursor: reportUploading? 'not-allowed':'pointer', padding:'8px 14px', borderRadius:8, background: reportUploading? '#e2e8f0':'#ffffff', border:'1px solid #cbd5e1', fontWeight:600, fontSize:13, display:'inline-flex', alignItems:'center', gap:6 }}>\r\n                        {reportUploading ? 'Uploading' : 'Upload Report (.pptx)'}\r\n                      </label>\r\n                      <input id=\"pptx-report-uploader\" type=\"file\" accept=\".ppt,.pptx\" style={{ display:'none' }} disabled={reportUploading} onChange={e=>{ const f=e.target.files?.[0]; e.target.value=''; if(f) handleReportUpload(f); }} />\r\n                      {reportUploading && (\r\n                        <div style={{ minWidth:140 }}>\r\n                          <div style={{ height:6, background:'#e2e8f0', borderRadius:4, overflow:'hidden', marginBottom:4 }}>\r\n                            <div style={{ width: reportUploadProgress+'%', height:'100%', background:'linear-gradient(90deg,#3b82f6,#6366f1)', transition:'width .25s' }} />\r\n                          </div>\r\n                          <span style={{ fontSize:11, color:'#475569' }}>{reportUploadProgress}%</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                {reportUploadError && <div style={{ color:'#b91c1c', fontSize:12, marginBottom:10 }}>{reportUploadError}</div>}\r\n                {reports.length === 0 ? (\r\n                  <div style={{ color: '#888', fontSize: 16 }}>No reports yet.</div>\r\n                ) : (\r\n                  <div style={{ overflowX: 'auto' }}>\r\n                    <table className=\"files-table\" style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n                      <thead>\r\n                        <tr>\r\n                          <th style={{ textAlign: 'left', padding: '10px 12px', borderBottom: '1px solid #eee', background: '#fafafa' }}>\r\n                            Name\r\n                          </th>\r\n                          <th style={{ textAlign: 'left', padding: '10px 12px', borderBottom: '1px solid #eee', background: '#fafafa' }}>\r\n                            Uploaded By\r\n                          </th>\r\n                          <th style={{ textAlign: 'left', padding: '10px 12px', borderBottom: '1px solid #eee', background: '#fafafa' }}>\r\n                            Uploaded At\r\n                          </th>\r\n                          <th style={{ textAlign: 'left', padding: '10px 12px', borderBottom: '1px solid #eee', background: '#fafafa' }}>\r\n                            Status\r\n                          </th>\r\n                          <th\r\n                            style={{\r\n                              textAlign: 'left',\r\n                              padding: '10px 12px',\r\n                              borderBottom: '1px solid #eee',\r\n                              background: '#fafafa',\r\n                              width: 380\r\n                            }}\r\n                          >\r\n                            Action\r\n                          </th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        {/* Track expanded AI summary panels */}\r\n                        {reports.map(r => {\r\n                          const uploadedAt = r?.uploadedAt ? new Date(r.uploadedAt).toLocaleString() : '';\r\n                          return (\r\n                            <React.Fragment key={r._id}>\r\n                              <tr>\r\n                                <td style={{ padding: '10px 12px', borderTop: '1px solid #f1f1f1' }}>\r\n                                  <span style={{ display: 'inline-flex', alignItems: 'center' }}>\r\n                                    <FaRegFileAlt style={{ marginRight: 6 }} />\r\n                                    {r?.name || 'Report.pptx'}\r\n                                  </span>\r\n                                </td>\r\n                                <td style={{ padding: '10px 12px', borderTop: '1px solid #f1f1f1' }}>\r\n                                  {r?.uploadedByName || 'Unknown'}\r\n                                </td>\r\n                                <td style={{ padding: '10px 12px', borderTop: '1px solid #f1f1f1' }}>{uploadedAt}</td>\r\n                                <td\r\n                                  style={{\r\n                                    padding: '10px 12px',\r\n                                    borderTop: '1px solid #f1f1f1',\r\n                                    textTransform: 'capitalize'\r\n                                  }}\r\n                                >\r\n                                  {r?.status || 'pending'}\r\n                                </td>\r\n                                <td style={{ padding: '10px 12px', borderTop: '1px solid #f1f1f1' }}>\r\n                                  {r?.path ? (\r\n                                    <button\r\n                                      onClick={() => openReportSignedPath(project._id, r.path)}\r\n                                      style={{\r\n                                        marginRight: 10,\r\n                                        border: '1px solid #cbd5e1',\r\n                                        background: '#000000ff',\r\n                                        padding: '6px 12px',\r\n                                        borderRadius: 8,\r\n                                        cursor: 'pointer',\r\n                                        fontSize: 13,\r\n                                        fontWeight: 600\r\n                                      }}\r\n                                    >\r\n                                      View PPT\r\n                                    </button>\r\n                                  ) : (\r\n                                    <span style={{ color: '#94a3b8', marginRight: 10, fontSize: 12 }}>No PPT</span>\r\n                                  )}\r\n                                  {r?.pdfPath ? (\r\n                                    <button\r\n                                      onClick={() => openReportSignedPath(project._id, r.pdfPath)}\r\n                                      style={{\r\n                                        marginRight: 10,\r\n                                        border: '1px solid #cbd5e1',\r\n                                        background: 'linear-gradient(90deg,#3b82f6,#6366f1)',\r\n                                        padding: '6px 12px',\r\n                                        borderRadius: 8,\r\n                                        cursor: 'pointer',\r\n                                        fontSize: 13,\r\n                                        fontWeight: 600,\r\n                                        color: '#fff'\r\n                                      }}\r\n                                    >\r\n                                      Download AI PDF\r\n                                    </button>\r\n                                  ) : (\r\n                                    <span style={{ color: '#94a3b8', marginRight: 10, fontSize: 12 }}>No PDF</span>\r\n                                  )}\r\n                                  {/* Dropdown toggle for AI summary */}\r\n                                  <button\r\n                                    onClick={() => setOpenAiRows(prev => ({ ...prev, [r._id]: !prev?.[r._id] }))}\r\n                                    style={{\r\n                                      marginRight: 10,\r\n                                      border: '1px solid #cbd5e1',\r\n                                      background: '#ffffff',\r\n                                      padding: '6px 12px',\r\n                                      borderRadius: 8,\r\n                                      cursor: r?.ai ? 'pointer' : 'not-allowed',\r\n                                      fontSize: 13,\r\n                                      fontWeight: 600,\r\n                                      color: r?.ai ? '#0f172a' : '#94a3b8'\r\n                                    }}\r\n                                    disabled={!r?.ai}\r\n                                    title={r?.ai ? 'Show AI summary' : 'No AI summary available'}\r\n                                  >\r\n                                    {openAiRows?.[r._id] ? 'Hide Summary' : 'Show Summary'}\r\n                                  </button>\r\n                                  {canDeleteReport(r) && (\r\n                                    <button\r\n                                      onClick={() => handleDeleteReport(r._id, r.uploadedBy?._id || r.uploadedBy)}\r\n                                      style={{\r\n                                        border: '1px solid #dc2626',\r\n                                        background: '#fee2e2',\r\n                                        padding: '6px 12px',\r\n                                        borderRadius: 8,\r\n                                        cursor: 'pointer',\r\n                                        fontSize: 13,\r\n                                        fontWeight: 600,\r\n                                        color: '#b91c1c'\r\n                                      }}\r\n                                    >\r\n                                      Delete\r\n                                    </button>\r\n                                  )}\r\n                                </td>\r\n                              </tr>\r\n                              {openAiRows?.[r._id] && r?.ai && (\r\n                                <tr>\r\n                                  <td colSpan={5} style={{ background: '#f8fafc', borderTop: '1px solid #eef2f7' }}>\r\n                                    <div style={{ padding: 16 }}>\r\n                                      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                                        <h4 style={{ margin: 0 }}>AI Summary</h4>\r\n                                        <span style={{ fontStyle: 'italic', color: '#64748b', fontSize: 12 }}>AI-generated summary</span>\r\n                                      </div>\r\n                                      <div\r\n                                        style={{\r\n                                          display: 'grid',\r\n                                          gridTemplateColumns: 'repeat(auto-fit,minmax(280px,1fr))',\r\n                                          gap: 16,\r\n                                          marginTop: 12\r\n                                        }}\r\n                                      >\r\n                                        <div>\r\n                                          <b>Summary of Work Done</b>\r\n                                          <ul style={{ marginTop: 6 }}>\r\n                                            {(r.ai.summary_of_work_done || []).map((x, i) => (\r\n                                              <li key={i}>{x}</li>\r\n                                            ))}\r\n                                          </ul>\r\n                                        </div>\r\n                                        <div>\r\n                                          <b>Completed Tasks</b>\r\n                                          <ul style={{ marginTop: 6 }}>\r\n                                            {(r.ai.completed_tasks || []).map((x, i) => (\r\n                                              <li key={i}>{x}</li>\r\n                                            ))}\r\n                                          </ul>\r\n                                        </div>\r\n                                        <div>\r\n                                          <b>Critical Path (3)</b>\r\n                                          <div style={{ marginTop: 6 }}>\r\n                                            {(r.ai.critical_path_analysis || []).slice(0, 3).map((c, i) => (\r\n                                              <div key={i} style={{ marginBottom: 8 }}>\r\n                                                <b>{`${i + 1}. ${c?.path_type || 'Path ' + (i + 1)}`}</b>\r\n                                                <ul style={{ marginTop: 4, marginBottom: 4 }}>\r\n                                                  {c?.risk && (\r\n                                                    <li>\r\n                                                      <b>Risk:</b> {c.risk}\r\n                                                    </li>\r\n                                                  )}\r\n                                                  {c?.blockers?.length > 0 && (\r\n                                                    <li>\r\n                                                      <b>Blockers:</b> {c.blockers.join('; ')}\r\n                                                    </li>\r\n                                                  )}\r\n                                                  {c?.next?.length > 0 && (\r\n                                                    <li>\r\n                                                      <b>Next:</b> {c.next.join('; ')}\r\n                                                    </li>\r\n                                                  )}\r\n                                                </ul>\r\n                                              </div>\r\n                                            ))}\r\n                                          </div>\r\n                                        </div>\r\n                                        <div>\r\n                                          <b>Task Priorities</b>\r\n                                          <div style={{ marginTop: 6 }}>\r\n                                            {Array.isArray(r.ai.task_priorities) && r.ai.task_priorities.length > 0 ? (\r\n                                              <ol style={{ margin: 0, paddingLeft: 18 }}>\r\n                                                {r.ai.task_priorities.slice(0, 5).map((t, i) => {\r\n                                                  const pr = (t.priority || '').toString();\r\n                                                  const color = /high/i.test(pr)\r\n                                                    ? '#dc2626'\r\n                                                    : /medium|med/i.test(pr)\r\n                                                    ? '#ea580c'\r\n                                                    : /low/i.test(pr)\r\n                                                    ? '#0d9488'\r\n                                                    : '#334155';\r\n                                                  return (\r\n                                                    <li key={i} style={{ marginBottom: 8 }}>\r\n                                                      <div\r\n                                                        style={{\r\n                                                          fontWeight: 600,\r\n                                                          display: 'flex',\r\n                                                          alignItems: 'center',\r\n                                                          gap: 6,\r\n                                                          flexWrap: 'wrap'\r\n                                                        }}\r\n                                                      >\r\n                                                        <span\r\n                                                          style={{\r\n                                                            background: color,\r\n                                                            color: '#fff',\r\n                                                            fontSize: 11,\r\n                                                            padding: '2px 6px',\r\n                                                            borderRadius: 12\r\n                                                          }}\r\n                                                        >\r\n                                                          {pr || 'Priority'}\r\n                                                        </span>\r\n                                                        <span>{t.task || t.title || 'Untitled Task'}</span>\r\n                                                      </div>\r\n                                                      {(t.impact || t.justification) && (\r\n                                                        <ul style={{ margin: '4px 0 0', paddingLeft: 16 }}>\r\n                                                          {t.impact && (\r\n                                                            <li>\r\n                                                              <b>Impact:</b> {t.impact}\r\n                                                            </li>\r\n                                                          )}\r\n                                                          {t.justification && (\r\n                                                            <li>\r\n                                                              <b>Reason:</b> {t.justification}\r\n                                                            </li>\r\n                                                          )}\r\n                                                        </ul>\r\n                                                      )}\r\n                                                    </li>\r\n                                                  );\r\n                                                })}\r\n                                              </ol>\r\n                                            ) : (\r\n                                              <p style={{ margin: 0, color: '#64748b' }}>No prioritized tasks.</p>\r\n                                            )}\r\n                                          </div>\r\n                                        </div>\r\n                                        <div>\r\n                                          <b>PiC Performance</b>\r\n                                          <p style={{ marginTop: 6 }}>\r\n                                            {r.ai.pic_performance_evaluation?.text || 'Performance summary unavailable.'}\r\n                                          </p>\r\n                                          {typeof r.ai.pic_performance_evaluation?.score === 'number' && (\r\n                                            <p>Score: {r.ai.pic_performance_evaluation.score}/100</p>\r\n                                          )}\r\n                                          <p>\r\n                                            PiC Contribution: {(() => { const ai=r.ai||{}; const raw=Number(ai.pic_contribution_percent_raw); const legacy=Number(ai.pic_contribution_percent); const val = isFinite(raw)&&raw>=0? raw : (isFinite(legacy)&&legacy>=0? legacy : 0); return Math.round(val); })()}%\r\n                                            {r.ai?.meta_fallback_used && <span style={{marginLeft:6,fontSize:11,color:'#f97316'}} title=\"AI model fallback heuristic used\">(fallback)</span>}\r\n                                            {r.ai?.meta_duplicate_previous && <span style={{marginLeft:6,fontSize:11,color:'#64748b'}} title=\"Same PPT content as prior upload\">(duplicate)</span>}\r\n                                          </p>\r\n                                          {typeof r.ai.confidence === 'number' && (\r\n                                            <p>Model Confidence: {(r.ai.confidence * 100).toFixed(0)}%</p>\r\n                                          )}\r\n                                        </div>\r\n                                      </div>\r\n                                    </div>\r\n                                  </td>\r\n                                </tr>\r\n                              )}\r\n                            </React.Fragment>\r\n                          );\r\n                        })}\r\n                      </tbody>\r\n                    </table>\r\n                    {/* Latest AI Summary block removed per request */}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n            {activeTab === 'Attendance' && ['it','am','pm','ceo','hr','hrsite'].includes(role) && (\r\n              <div className=\"attendance-tab\" style={{textAlign:'left'}}>\r\n                <h3 style={{margin:'0 0 16px'}}>Attendance Reports</h3>\r\n                <div style={{display:'flex',gap:12,flexWrap:'wrap',alignItems:'center',marginBottom:16}}>\r\n                  <label style={{background:'#0f172a',color:'#fff',padding:'8px 14px',borderRadius:8,fontSize:14,cursor: attUploading? 'not-allowed':'pointer',opacity: attUploading? .6:1}}>\r\n                    {attUploading? 'Uploading...' : 'Upload Schedule (.xlsx)'}\r\n                    <input type=\"file\" accept=\".xls,.xlsx\" style={{display:'none'}} disabled={attUploading} onChange={async e=>{ const f=e.target.files?.[0]; if(!f||!project?._id) return; setAttError(''); setAttUploading(true); try { const fd=new FormData(); fd.append('schedule',f); await api.post(`/projects/${project._id}/attendance/upload`, fd, { headers:{ Authorization:`Bearer ${token}` } });\r\nawait loadAttendance(project._id); } catch(err){ setAttError('Upload failed'); } finally { setAttUploading(false); e.target.value=''; } }} />\r\n                  </label>\r\n                 <button\r\n  onClick={() => loadAttendance(project._id)}\r\n  style={{background:'#334155',color:'#fff',border:'none',padding:'8px 14px',borderRadius:8,cursor:'pointer'}}\r\n>\r\n  Refresh\r\n</button>\r\n                  {attError && <span style={{color:'#b91c1c',fontWeight:600}}>{attError}</span>}\r\n                </div>\r\n                {attendanceReports.length===0 ? (\r\n                  <div style={{color:'#666'}}>No attendance reports yet.</div>\r\n                ) : (\r\n                  <table className=\"files-table\" style={{width:'100%',borderCollapse:'collapse'}}>\r\n                    <thead>\r\n                      <tr>\r\n                        <th style={{textAlign:'left',padding:'8px'}}>Original File</th>\r\n                        <th style={{textAlign:'left',padding:'8px'}}>Uploaded By</th>\r\n                        <th style={{textAlign:'left',padding:'8px'}}>Generated At</th>\r\n                        <th style={{textAlign:'left',padding:'8px'}}>Actions</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      {attendanceReports.slice().reverse().map((r,i)=>(\r\n                        <tr key={i} style={{borderTop:'1px solid #eee'}}>\r\n                          <td style={{padding:'8px'}}>{r.originalName}</td>\r\n                          <td style={{padding:'8px'}}>{resolveAttendanceUploaderName(r)}</td>\r\n                          <td style={{padding:'8px'}}>{r.generatedAt? new Date(r.generatedAt).toLocaleString(): 'N/A'}</td>\r\n                          <td style={{padding:'8px',display:'flex',gap:8}}>\r\n                            <button onClick={async()=>{ try { const {data}=await api.get(`/projects/${project._id}/attendance-signed-url`,{ params:{ path:r.inputPath}, headers:{Authorization:`Bearer ${token}`}}); if(data?.signedUrl) window.open(data.signedUrl,'_blank'); } catch {} }} className=\"btn small\">View Excel</button>\r\n                            <button onClick={async()=>{ try { const {data}=await api.get(`/projects/${project._id}/attendance-signed-url`,{ params:{ path:r.outputPath}, headers:{Authorization:`Bearer ${token}`}}); if(data?.signedUrl) window.open(data.signedUrl,'_blank'); } catch {} }} className=\"btn small primary\">Download AI Attendace Report</button>\r\n                            <button onClick={async()=>{ if(!window.confirm('Delete this attendance report?')) return; try { await api.delete(`/projects/${project._id}/attendance/${r._id}`, { headers:{ Authorization:`Bearer ${token}` } });\r\nawait loadAttendance(project._id);\r\n} catch { alert('Delete failed'); } }} className=\"btn small danger\" style={{background:'#fee2e2',color:'#b91c1c'}}>Delete</button>\r\n                          </td>\r\n                        </tr>\r\n                      ))}\r\n                    </tbody>\r\n                  </table>\r\n                )}\r\n                {attendanceAI && (\r\n                  <div style={{marginTop:24,background:'#f8fafc',padding:16,border:'1px solid #e2e8f0',borderRadius:12}}>\r\n                    <h4 style={{marginTop:0}}>AI Attendance Summary</h4>\r\n                    {attendanceAI.insights && attendanceAI.insights.length>0 && (\r\n                      <ul style={{marginTop:8}}>\r\n                        {attendanceAI.insights.map((i,idx)=> <li key={idx}>{i}</li>)}\r\n                      </ul>\r\n                    )}\r\n                    {attendanceAI.top_absent && attendanceAI.top_absent.length>0 && (\r\n                      <div style={{marginTop:12}}>\r\n                        <b>Most Absent:</b>\r\n                        <ol style={{marginTop:6}}>\r\n                          {attendanceAI.top_absent.map((t,idx)=> <li key={idx}>{t.name}: {t.absent}</li>)}\r\n                        </ol>\r\n                      </div>\r\n                    )}\r\n                    {attendanceAI.average_attendance && (\r\n                      <p style={{marginTop:12}}><b>Average Attendance:</b> {attendanceAI.average_attendance}%</p>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </main>\r\n      \r\n      {/* File Delete Confirmation Modal */}\r\n      {showFileDeleteConfirm && fileToDelete && (\r\n        <div className=\"modal-overlay\">\r\n          <div className=\"modal small\">\r\n            <h3>Confirm File Deletion</h3>\r\n            \r\n            <div style={{\r\n              backgroundColor: '#fef2f2',\r\n              border: '1px solid #fecaca',\r\n              borderRadius: '8px',\r\n              padding: '12px',\r\n              marginBottom: '16px'\r\n            }}>\r\n              <div style={{display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '8px'}}>\r\n                <span style={{fontSize: '20px'}}></span>\r\n                <strong style={{color: '#dc2626'}}>File Deletion Warning</strong>\r\n              </div>\r\n              <p style={{color: '#dc2626', margin: 0, fontSize: '14px'}}>\r\n                This will permanently delete the file from the project. This action cannot be undone.\r\n              </p>\r\n            </div>\r\n\r\n            <div style={{marginBottom: '16px'}}>\r\n              <p style={{marginBottom: '8px', fontWeight: '600'}}>File Details:</p>\r\n              <div style={{backgroundColor: '#f9fafb', padding: '12px', borderRadius: '6px', fontSize: '14px'}}>\r\n                <p style={{margin: '0 0 4px 0'}}><strong>File Name:</strong> {typeof fileToDelete.doc === 'string' ? fileToDelete.doc.split('/').pop() : fileToDelete.doc.originalName || fileToDelete.doc.path?.split('/').pop() || 'Unknown'}</p>\r\n                <p style={{margin: '0 0 4px 0'}}><strong>Project:</strong> {project?.projectName || 'Unknown'}</p>\r\n                <p style={{margin: '0'}}><strong>File Path:</strong> {typeof fileToDelete.doc === 'string' ? fileToDelete.doc : fileToDelete.doc.path || 'Unknown'}</p>\r\n              </div>\r\n            </div>\r\n\r\n            <p style={{marginBottom: '16px', fontSize: '14px', lineHeight: '1.5'}}>\r\n              Are you sure you want to <strong>permanently delete</strong> this file from the project?\r\n            </p>\r\n\r\n            <div className=\"modal-actions\" style={{display:'flex',gap:'0.5rem',justifyContent:'flex-end'}}>\r\n              <button \r\n                className=\"btn\" \r\n                onClick={() => {\r\n                  setShowFileDeleteConfirm(false);\r\n                  setFileToDelete(null);\r\n                }}\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button \r\n                className=\"btn primary\" \r\n                onClick={confirmDeleteFile}\r\n                style={{backgroundColor: '#dc2626'}}\r\n              >\r\n                Yes, Delete File\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useRef, useEffect } from \"react\";\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useNotifications } from \"../context/NotificationContext\";\r\nimport { FaBell, FaCheckCircle, FaExclamationTriangle, FaTimesCircle, FaInfoCircle } from \"react-icons/fa\";\r\nimport './style/NotificationBell.css';\r\n\r\nconst NotificationBell = () => {\r\n  const {\r\n  notifications,\r\n  unread,\r\n    markAllRead,\r\n    markAsRead\r\n  } = useNotifications();\r\n  const navigate = useNavigate();\r\n\r\n  const [open, setOpen] = useState(false);\r\n  const bellRef = useRef();\r\n  // Prefer explicit 'userId' key, fallback to parsing stored 'user' JSON (keeps behavior consistent with App.js)\r\n  let userId = localStorage.getItem(\"userId\");\r\n  if (!userId) {\r\n    try {\r\n      const u = JSON.parse(localStorage.getItem('user') || 'null');\r\n      if (u && (u._id || u.id)) userId = String(u._id || u.id);\r\n    } catch {\r\n      userId = null;\r\n    }\r\n  }\r\n\r\n  // No local socket here  NotificationContext manages the socket and updates\r\n  // the shared notifications state. This component only renders the list.\r\n\r\n  useEffect(() => {\r\n    const handleClick = (e) => {\r\n      if (bellRef.current && !bellRef.current.contains(e.target)) {\r\n        setOpen(false);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClick);\r\n    return () => document.removeEventListener(\"mousedown\", handleClick);\r\n  }, []);\r\n\r\n  const iconFor = (severity, iconKey) => {\r\n    if (iconKey) {\r\n      // allow mapped custom icons later\r\n    }\r\n    switch (severity) {\r\n      case 'success': return <FaCheckCircle className=\"notif-icon success\"/>;\r\n      case 'warning': return <FaExclamationTriangle className=\"notif-icon warning\"/>;\r\n      case 'error': return <FaTimesCircle className=\"notif-icon error\"/>;\r\n      default: return <FaInfoCircle className=\"notif-icon info\"/>;\r\n    }\r\n  };\r\n\r\n  const userRole = (()=>{ try { return JSON.parse(localStorage.getItem('user')||'null')?.role || ''; } catch { return ''; } })();\r\n  const deriveFallbackUrl = (n) => {\r\n    const id = n.requestId?._id || n.requestId; // request reference (MaterialRequest or similar)\r\n    const projectId = n.projectId?._id || n.projectId; // project reference\r\n    const role = (userRole||'').toLowerCase();\r\n\r\n    const isPIC = role.includes('person in charge') || role==='pic';\r\n    const isPM = role.includes('project manager') || role==='pm';\r\n    const isAM = role.includes('area manager') || role==='am';\r\n    const isCEO = role==='ceo';\r\n    const isIT = role==='it';\r\n    const isHR = role==='hr' && !role.includes('site');\r\n    const isHRSite = role.includes('hr - site');\r\n    const isStaff = role==='staff';\r\n\r\n    const materialTypes = ['material_request_created','pending_approval','approved','denied','nudge'];\r\n    if(materialTypes.includes(n.type) && id){\r\n      if(isPIC) return `/pic/material-request/${id}`;\r\n      if(isPM) return `/pm/material-request/${id}`;\r\n      if(isAM) return `/am/material-request/${id}`;\r\n      if(isCEO) return `/ceo/material-request/${id}`;\r\n      if(isIT) return `/it/material-request/${id}`;\r\n      // HR rarely receives material request approvals; if so no dedicated route\r\n    }\r\n    // Treat these as project-context types\r\n    const projectTypes = ['discussion','reply','mention','task','system','general','manpower','project_created'];\r\n    if(projectTypes.includes(n.type) && projectId){\r\n      if(isPIC) return `/pic/${projectId}`;\r\n      if(isPM) return `/pm/viewprojects/${projectId}`;\r\n      if(isAM) return `/am/projects/${projectId}`;\r\n      if(isCEO) return `/ceo/proj/${projectId}`;\r\n      if(isIT) return `/it/projects`;\r\n      if(isHR) return `/hr/project-records/${projectId}`;\r\n      if(isHRSite) return `/hr-site/current-project`;\r\n      if(isStaff) return `/staff/current-project`;\r\n    }\r\n    // Fallback dashboards by role\r\n    if(isPIC) return '/pic';\r\n    if(isPM) return '/pm';\r\n    if(isAM) return '/am';\r\n    if(isCEO) return '/ceo/dash';\r\n    if(isIT) return '/it';\r\n    if(isHR) return '/hr/dash';\r\n    if(isHRSite) return '/hr-site';\r\n    if(isStaff) return '/staff';\r\n    return '/';\r\n  };\r\n\r\n  const clickNotification = (n) => {\r\n    if (n.status === 'unread') {\r\n      // optimistic mark read via context\r\n      if (markAsRead) markAsRead(n._id);\r\n    }\r\n    let target;\r\n  // project_created now handled by deriveFallbackUrl; override only if missing actionUrl\r\n    if (!target) target = n.actionUrl || deriveFallbackUrl(n);\r\n    if(target){\r\n      if(target.startsWith('http')) window.location.href = target;\r\n      else navigate(target);\r\n    }\r\n  };\r\n\r\n  // Exclude chat/discussion style notifications from bell\r\n  // Keep discussions/replies/mentions; suppress only real-time chat message notifications if any\r\n  const filtered = notifications.filter(n => !['chat','chat_message','message'].includes(String(n.type||'').toLowerCase()));\r\n  const filteredUnread = filtered.filter(n=> n.status==='unread').length;\r\n\r\n  // If unread derived differs from context unread (because context still counts chats) adjust markAllRead effect locally\r\n  const handleBellClick = () => {\r\n    setOpen(v=> !v);\r\n    if (filteredUnread > 0) {\r\n      // mark only filtered unread as read\r\n      filtered.filter(n=> n.status==='unread').forEach(n=> markAsRead && markAsRead(n._id));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"notif-bell-container\" ref={bellRef}>\r\n      <div\r\n        className=\"notif-bell-icon\"\r\n        onClick={handleBellClick}\r\n      >\r\n        <FaBell size={22} color=\"white\" />\r\n        {filteredUnread > 0 && <span className=\"notif-badge\">{filteredUnread}</span>}\r\n      </div>\r\n\r\n      {open && (\r\n        <div className=\"notif-popup\">\r\n          <div className=\"notif-popup-header\">\r\n            <span>Notifications</span>\r\n            {notifications.length > 0 && (\r\n              <button className=\"notif-markread-btn\" onClick={markAllRead}>\r\n                Mark all as read\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"notif-popup-list\">\r\n            {filtered.length === 0 ? (\r\n              <div className=\"notif-empty\">No notifications</div>\r\n            ) : (\r\n              filtered.slice(0, 12).map((n, i) => (\r\n                <div\r\n                  className={`notif-item rich${n.status === 'unread' ? ' unread' : ''}`}\r\n                  key={(n && n._id ? String(n._id) : `notif-${i}`) + `-${i}`}\r\n                  onClick={() => clickNotification(n)}\r\n                  role=\"button\"\r\n                  tabIndex={0}\r\n                  onKeyPress={(e)=>{ if(e.key==='Enter') clickNotification(n);} }\r\n                >\r\n                  <div className=\"notif-left\">\r\n                    {iconFor(n.severity, n.icon)}\r\n                  </div>\r\n                  <div className=\"notif-body\">\r\n                    <div className=\"notif-title-row\">\r\n                      <span className={`notif-title sev-${n.severity||'info'}`}>{n.title || 'Notification'}</span>\r\n                      {n.status==='unread' && <span className=\"badge-dot\"/>}\r\n                    </div>\r\n                    <div className=\"notif-message\">{n.message}</div>\r\n                    <div className=\"notif-meta-line\">\r\n                      <span className=\"notif-date\">{new Date(n.createdAt).toLocaleString()}</span>\r\n                      {n.projectId?.projectName && <span className=\"notif-project\">{n.projectId.projectName}</span>}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NotificationBell;","// src/utils/projectPdf.js\r\nimport jsPDF from 'jspdf';\r\nimport autoTable from 'jspdf-autotable';\r\n\r\n/* ---------- helpers ---------- */\r\nconst pesoIntl = new Intl.NumberFormat('en-PH', { style: 'currency', currency: 'PHP' });\r\nconst fmtDate = (d) => {\r\n  if (!d) return 'N/A';\r\n  const dt = new Date(d);\r\n  return Number.isNaN(dt.getTime()) ? 'N/A' : dt.toLocaleDateString();\r\n};\r\nconst sanitizeFilename = (s = '') => (s || 'Project').replace(/[\\/\\\\?%*:|\"<>]/g, '_');\r\nconst readLocation = (p) =>\r\n  p?.location?.name ? `${p.location.name}${p.location?.region ? ` (${p.location.region})` : ''}` : 'N/A';\r\n\r\nfunction readContractor(p) {\r\n  const c = p?.contractor;\r\n  if (!c) return 'N/A';\r\n  if (typeof c === 'string') return c.trim() || 'N/A';\r\n  if (Array.isArray(c)) {\r\n    const names = c\r\n      .map((x) => (typeof x === 'string' ? x : x?.name || x?.company || x?.companyName || ''))\r\n      .map((s) => (typeof s === 'string' ? s.trim() : ''))\r\n      .filter(Boolean);\r\n    return names.length ? names.join(', ') : 'N/A';\r\n  }\r\n  if (typeof c === 'object') {\r\n    for (const v of [c.name, c.company, c.companyName, c.title, c.fullName]) {\r\n      if (typeof v === 'string' && v.trim()) return v.trim();\r\n    }\r\n  }\r\n  if (typeof p?.contractorName === 'string' && p.contractorName.trim()) return p.contractorName.trim();\r\n  return 'N/A';\r\n}\r\n\r\n/* image + font utilities */\r\nfunction loadImageDataURLWithSize(url) {\r\n  return new Promise((resolve) => {\r\n    if (!url) return resolve(null);\r\n    try {\r\n      const img = new Image();\r\n      img.crossOrigin = 'anonymous';\r\n      img.onload = () => {\r\n        const c = document.createElement('canvas');\r\n        c.width = img.naturalWidth;\r\n        c.height = img.naturalHeight;\r\n        c.getContext('2d').drawImage(img, 0, 0);\r\n        resolve({ dataUrl: c.toDataURL('image/png'), w: img.naturalWidth, h: img.naturalHeight });\r\n      };\r\n      img.onerror = () => resolve(null);\r\n      img.src = url;\r\n    } catch {\r\n      resolve(null);\r\n    }\r\n  });\r\n}\r\n\r\n/* Fit (w,h) inside maxWmaxH preserving aspect ratio */\r\nfunction fitInside(w, h, maxW, maxH) {\r\n  if (!w || !h) return { w: maxW, h: maxH };\r\n  const r = Math.min(maxW / w, maxH / h);\r\n  return { w: Math.round(w * r), h: Math.round(h * r) };\r\n}\r\n\r\nasync function loadFontFromPublic(doc, fileName, family, style) {\r\n  try {\r\n    const base = process.env.PUBLIC_URL || '';\r\n    const url = `${base}/fonts/${fileName}`;\r\n    const res = await fetch(url, { cache: 'no-store' });\r\n    if (!res.ok) return false;\r\n    const buf = await res.arrayBuffer();\r\n    const b64 = btoa(String.fromCharCode(...new Uint8Array(buf)));\r\n    doc.addFileToVFS(fileName, b64);\r\n    doc.addFont(fileName, family, style);\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\nfunction fontUsable(doc, family, style = 'normal') {\r\n  try {\r\n    doc.setFont(family, style);\r\n    doc.getTextWidth('test');\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/* peso string with safe fallback */\r\nfunction makePesoText(preferPesoSign, pesoGlyphAvailable) {\r\n  return (n) => {\r\n    const txt = pesoIntl.format(Number(n || 0));\r\n    if (preferPesoSign && pesoGlyphAvailable) {\r\n      return txt.replace('PHP', '').replace(/\\s+/g, ' ');\r\n    }\r\n    return txt.replace('', 'PHP');\r\n  };\r\n}\r\n\r\n/* ---------- main ---------- */\r\nexport async function exportProjectDetails(project, opts = {}) {\r\n  const {\r\n    contextTitle = 'Project Details',\r\n    includeHrSite = true,\r\n    includeStaff = true,\r\n    includePIC = true,\r\n    includeAM = true,\r\n    includePM = true,\r\n    includeBudget = true,\r\n    includeManpower = true,\r\n    preferPesoSign = false, // set true only if your font definitely has \r\n    exportedBy = 'Unknown User',\r\n    exportDate = new Date().toLocaleString('en-US', {\r\n      year: 'numeric',\r\n      month: '2-digit',\r\n      day: '2-digit',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      second: '2-digit',\r\n      hour12: true\r\n    })\r\n  } = opts;\r\n\r\n  const doc = new jsPDF({ unit: 'pt', format: 'a4' }); // 595842\r\n\r\n  // Try to use Noto Sans from /public/fonts for better glyph coverage\r\n  const FAMILY = 'NotoSans';\r\n  const regOk = await loadFontFromPublic(doc, 'NotoSans-Regular.ttf', FAMILY, 'normal');\r\n  const boldOk = await loadFontFromPublic(doc, 'NotoSans-Bold.ttf', FAMILY, 'bold');\r\n  const canUseRegular = regOk && fontUsable(doc, FAMILY, 'normal');\r\n  const canUseBold = boldOk && fontUsable(doc, FAMILY, 'bold');\r\n\r\n  const bodyFont = canUseRegular ? FAMILY : 'helvetica';\r\n  const headStyle = canUseBold ? 'bold' : 'normal';\r\n  const pesoText = makePesoText(preferPesoSign, canUseRegular);\r\n\r\n  const marginX = 40;\r\n  let y = 36;\r\n\r\n  /* -- header: logo (kept ratio) + brand + context -- */\r\n  const logoURL = `${process.env.PUBLIC_URL || ''}/images/Fadz-logo.png`;\r\n  const logo = await loadImageDataURLWithSize(logoURL);\r\n  let titleX = marginX;\r\n\r\n  if (logo?.dataUrl) {\r\n    const targetH = 60; // increased height for larger logo\r\n    const r = (logo.w && logo.h) ? logo.w / logo.h : 1;\r\n    const targetW = Math.min(200, Math.max(100, targetH * r)); // increased width limits\r\n    doc.addImage(logo.dataUrl, 'PNG', marginX, y - 12, targetW, targetH, undefined, 'FAST');\r\n    titleX = marginX + targetW + 16; // place text after the logo with more spacing\r\n  }\r\n\r\n  doc.setFont(bodyFont, headStyle);\r\n  doc.setFontSize(20); // increased font size for better visibility\r\n  doc.setTextColor(20);\r\n  doc.text('Fadz Construction Inc.', titleX, y + 16);\r\n\r\n  doc.setFont(bodyFont, 'normal');\r\n  doc.setFontSize(12);\r\n  doc.setTextColor(90);\r\n  doc.text(String(contextTitle || ''), titleX, y + 28);\r\n\r\n  // divider\r\n  doc.setDrawColor(220);\r\n  doc.setLineWidth(1);\r\n  doc.line(marginX, y + 42, 595 - marginX, y + 42);\r\n\r\n  y += 56;\r\n\r\n  // Export information section\r\n  doc.setFont(bodyFont, 'normal');\r\n  doc.setFontSize(10);\r\n  doc.setTextColor(100, 116, 139);\r\n  doc.text(`Exported by: ${exportedBy}`, marginX, y);\r\n  doc.text(`Export Date & Time: ${exportDate}`, marginX, y + 12);\r\n  \r\n  // Add separator line\r\n  doc.setDrawColor(200, 200, 200);\r\n  doc.setLineWidth(0.5);\r\n  doc.line(marginX, y + 20, 595 - marginX, y + 20);\r\n  \r\n  y += 30;\r\n\r\n  /* -- project title + right photo (both kept ratio) -- */\r\n  doc.setTextColor(20);\r\n  doc.setFont(bodyFont, headStyle);\r\n  doc.setFontSize(16);\r\n  doc.text(String(project?.projectName || 'Untitled Project'), marginX, y);\r\n\r\n  let headerBottom = y;\r\n\r\n  const photo = await loadImageDataURLWithSize(project?.photos?.[0]);\r\n  if (photo?.dataUrl) {\r\n    const boxW = 120;\r\n    const boxH = 72;\r\n    const { w: drawW, h: drawH } = fitInside(photo.w, photo.h, boxW, boxH);\r\n    const imgX = 595 - marginX - drawW;\r\n    const imgY = y - 22 + Math.round((boxH - drawH) / 2); // vertical center in the 72pt band\r\n    doc.addImage(photo.dataUrl, 'PNG', imgX, imgY, drawW, drawH, undefined, 'FAST');\r\n    headerBottom = Math.max(headerBottom, imgY + drawH);\r\n  }\r\n\r\n  const blockGap = 16;\r\n  const detailsStartY = Math.max(y + 8, headerBottom + blockGap);\r\n\r\n  /* -- details table -- */\r\n  const detailsRows = [\r\n    ['Location', readLocation(project)],\r\n    ['Project Manager', project?.projectmanager?.name || 'N/A'],\r\n    ['Contractor', readContractor(project)],\r\n    ['Start Date', fmtDate(project?.startDate)],\r\n    ['End Date', fmtDate(project?.endDate)],\r\n    ['Status', project?.status || 'N/A'],\r\n  ];\r\n  if (includeBudget) detailsRows.splice(1, 0, ['Budget', pesoText(project?.budget)]);\r\n\r\n  autoTable(doc, {\r\n    startY: detailsStartY,\r\n    head: [['Field', 'Value']],\r\n    body: detailsRows,\r\n    styles: { font: bodyFont, fontStyle: 'normal', fontSize: 11, cellPadding: 8, halign: 'left' },\r\n    headStyles: { font: bodyFont, fontStyle: headStyle, fillColor: [25, 118, 210], textColor: 255 },\r\n    columnStyles: { 0: { cellWidth: 150 } },\r\n    theme: 'grid',\r\n    margin: { left: marginX, right: marginX },\r\n  });\r\n\r\n  /* -- staff table -- */\r\n  const staffRows = [];\r\n  if (includePM && project?.projectmanager) staffRows.push(['Project Manager', project.projectmanager.name || '']);\r\n  if (includeAM && project?.areamanager) staffRows.push(['Area Manager', project.areamanager.name || '']);\r\n  if (includePIC && Array.isArray(project?.pic)) project.pic.forEach((p) => staffRows.push(['Person in Charge', p?.name || '']));\r\n  if (includeHrSite && Array.isArray(project?.hrsite)) project.hrsite.forEach((h) => staffRows.push(['HR - Site', h?.name || '']));\r\n  if (includeStaff && Array.isArray(project?.staff)) project.staff.forEach((s) => staffRows.push(['Staff', s?.name || '']));\r\n\r\n  if (staffRows.length) {\r\n    autoTable(doc, {\r\n      startY: doc.lastAutoTable.finalY + 18,\r\n      head: [['Role', 'Name']],\r\n      body: staffRows,\r\n      styles: { font: bodyFont, fontStyle: 'normal', fontSize: 11, cellPadding: 8, halign: 'left' },\r\n      headStyles: { font: bodyFont, fontStyle: headStyle, fillColor: [76, 175, 80], textColor: 255 },\r\n      theme: 'grid',\r\n      margin: { left: marginX, right: marginX },\r\n    });\r\n  }\r\n\r\n  /* -- assigned manpower list (distinct from Staff / PIC) -- */\r\n  if (includeManpower && Array.isArray(project?.manpower) && project.manpower.length) {\r\n    const manpowerRows = project.manpower.map(mp => [mp?.name || mp?.fullName || 'Unnamed', mp?.position || mp?.role || '']);\r\n    autoTable(doc, {\r\n      startY: (doc.lastAutoTable?.finalY || detailsStartY) + 18,\r\n      head: [['Manpower Name', 'Position']],\r\n      body: manpowerRows,\r\n      styles: { font: bodyFont, fontStyle: 'normal', fontSize: 11, cellPadding: 8, halign: 'left' },\r\n      headStyles: { font: bodyFont, fontStyle: headStyle, fillColor: [33, 150, 243], textColor: 255 },\r\n      theme: 'grid',\r\n      margin: { left: marginX, right: marginX },\r\n    });\r\n  }\r\n\r\n  /* -- footer -- */\r\n  const pageCount = doc.getNumberOfPages();\r\n  doc.setFont(bodyFont, 'normal');\r\n  doc.setFontSize(9);\r\n  doc.setTextColor(120);\r\n  for (let i = 1; i <= pageCount; i++) {\r\n    doc.setPage(i);\r\n    const footerY = 842 - 24;\r\n    doc.text(`Fadz Construction Inc. - Project Details`, marginX, footerY);\r\n    const label = `Page ${i} of ${pageCount}`;\r\n    const w = doc.getTextWidth(label);\r\n    doc.text(label, 595 - marginX - w, footerY);\r\n    \r\n    // Add export info in footer\r\n    doc.setFontSize(8);\r\n    doc.setTextColor(100);\r\n    const exportInfo = `Generated on ${exportDate} by ${exportedBy}`;\r\n    const exportW = doc.getTextWidth(exportInfo);\r\n    doc.text(exportInfo, 595 - marginX - exportW, footerY - 12);\r\n  }\r\n\r\n  doc.save(`Project-${sanitizeFilename(project?.projectName)}.pdf`);\r\n}\r\n\r\nexport const generateProjectPDF = async (data) => {\r\n  const { companyName, companyLogo, exportedBy, exportDate, filters, projects } = data;\r\n\r\n  const pdf = new jsPDF('landscape', 'mm', 'a4');\r\n  pdf.setFont('helvetica');\r\n\r\n  // Load and add company logo\r\n  let logoX = 20;\r\n  let logoY = 15;\r\n  let logoWidth = 0;\r\n  let logoHeight = 0;\r\n\r\n  if (companyLogo) {\r\n    try {\r\n      const logoData = await loadImageDataURLWithSize(companyLogo);\r\n      if (logoData?.dataUrl) {\r\n        // Resize logo to fit nicely in header - increased size\r\n        const maxLogoHeight = 35;\r\n        const maxLogoWidth = 100;\r\n        const { w: logoW, h: logoH } = fitInside(logoData.w, logoData.h, maxLogoWidth, maxLogoHeight);\r\n        \r\n        logoWidth = logoW;\r\n        logoHeight = logoH;\r\n        \r\n        pdf.addImage(logoData.dataUrl, 'PNG', logoX, logoY, logoWidth, logoHeight, undefined, 'FAST');\r\n        logoX += logoWidth + 15; // Add more space after logo\r\n      }\r\n    } catch (error) {\r\n      console.warn('Failed to load company logo:', error);\r\n    }\r\n  }\r\n\r\n  // Header with company name\r\n  pdf.setFontSize(26); // increased font size\r\n  pdf.setTextColor(30, 41, 59);\r\n  pdf.text(companyName || 'Projects', logoX, logoY + 18);\r\n\r\n  // Export information\r\n  pdf.setFontSize(12);\r\n  pdf.setTextColor(100, 116, 139);\r\n  pdf.text(`Exported by: ${exportedBy || 'Unknown'}`, 20, 40);\r\n  pdf.text(`Export Date & Time: ${exportDate}`, 20, 47);\r\n\r\n  // Filters block\r\n  const hasFilters = (filters.status && filters.status !== 'all') || filters.search || filters.dateFrom || filters.dateTo;\r\n  if (hasFilters) {\r\n    pdf.setFontSize(14);\r\n    pdf.setTextColor(30, 41, 59);\r\n    pdf.text('Export Filters Applied:', 20, 60);\r\n\r\n    pdf.setFontSize(10);\r\n    pdf.setTextColor(100, 116, 139);\r\n    let filterY = 70;\r\n    \r\n    // Status filter\r\n    if (filters.status && filters.status !== 'all') {\r\n      pdf.text(` Status: ${filters.status.charAt(0).toUpperCase() + filters.status.slice(1)}`, 20, filterY); \r\n      filterY += 7;\r\n    }\r\n    \r\n    // Search filter\r\n    if (filters.search) { \r\n      pdf.text(` Search: \"${filters.search}\"`, 20, filterY); \r\n      filterY += 7; \r\n    }\r\n    \r\n    // Date range filter\r\n    if (filters.dateFrom || filters.dateTo) {\r\n      const parts = [];\r\n      if (filters.dateFrom) parts.push(`From: ${filters.dateFrom}`);\r\n      if (filters.dateTo) parts.push(`To: ${filters.dateTo}`);\r\n      pdf.text(` Date Range: ${parts.join(' - ')}`, 20, filterY); \r\n      filterY += 7;\r\n    }\r\n    \r\n    // Add a separator line\r\n    pdf.setDrawColor(200, 200, 200);\r\n    pdf.setLineWidth(0.5);\r\n    pdf.line(20, filterY + 2, 280, filterY + 2);\r\n    filterY += 10;\r\n  }\r\n\r\n  // Project count\r\n  const projectCountY = hasFilters ? 95 : 60;\r\n  pdf.setFontSize(12);\r\n  pdf.setTextColor(30, 41, 59);\r\n  pdf.text(`Total Projects: ${projects?.length || 0}`, 20, projectCountY);\r\n\r\n  // Table data\r\n  const tableData = (projects && projects.length ? projects : []).map(p => [\r\n    p.name || '',\r\n    p.area || '',\r\n    p.pm || '',\r\n    p.contractor || '',\r\n    p.timeline || '',\r\n    p.pics || '',\r\n    p.budget || ''\r\n  ]);\r\n\r\n  if (!projects || !projects.length) {\r\n    pdf.setFontSize(14);\r\n    pdf.setTextColor(150);\r\n    pdf.text('No projects match the selected filters.', 20, projectCountY + 15);\r\n  } else {\r\n    try {\r\n      autoTable(pdf, {\r\n        head: [['Project Name', 'Area', 'Project Manager', 'Contractor', 'Timeline', 'PICs', 'Budget']],\r\n        body: tableData,\r\n        startY: projectCountY + 15,\r\n        margin: { top: 20 },\r\n        styles: { fontSize: 9, cellPadding: 3, lineColor: [226, 232, 240], lineWidth: 0.1 },\r\n        headStyles: { fillColor: [30, 41, 59], textColor: [255, 255, 255], fontStyle: 'bold' },\r\n        alternateRowStyles: { fillColor: [248, 250, 252] },\r\n        columnStyles: {\r\n          0: { cellWidth: 40 },\r\n          1: { cellWidth: 30 },\r\n          2: { cellWidth: 35 },\r\n          3: { cellWidth: 35 },\r\n          4: { cellWidth: 35 },\r\n          5: { cellWidth: 40 },\r\n          6: { cellWidth: 25 },\r\n        },\r\n        didDrawPage: function () {\r\n          pdf.setFontSize(10);\r\n          pdf.setTextColor(100, 116, 139);\r\n          pdf.text(`Page ${pdf.internal.getCurrentPageInfo().pageNumber}`, pdf.internal.pageSize.width - 30, pdf.internal.pageSize.height - 10);\r\n        }\r\n      });\r\n    } catch (err) {\r\n      console.error('autoTable error', err);\r\n      pdf.setFontSize(12);\r\n      pdf.setTextColor(200, 30, 30);\r\n      pdf.text('Failed to render table (autoTable error).', 20, 100);\r\n    }\r\n  }\r\n\r\n  // Footer\r\n  const pageCount = pdf.internal.getNumberOfPages();\r\n  for (let i = 1; i <= pageCount; i++) {\r\n    pdf.setPage(i);\r\n    pdf.setFontSize(8);\r\n    pdf.setTextColor(100, 116, 139);\r\n    pdf.text(`${companyName} - Project Export`, 20, pdf.internal.pageSize.height - 10);\r\n    pdf.text(`Generated on ${exportDate} by ${exportedBy}`, pdf.internal.pageSize.width - 80, pdf.internal.pageSize.height - 10);\r\n  }\r\n\r\n  pdf.save(`projects_export_${String(exportDate).replace(/\\//g, '-')}.pdf`);\r\n};\r\n","// src/components/AreaChat.jsx\r\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\r\nimport './AreaChatAvatars.css';\r\nimport AppHeader from '../layout/AppHeader';\r\nimport { Link, useNavigate, useParams } from 'react-router-dom';\r\nimport {\r\n  FaUsers, FaPaperPlane, FaTachometerAlt, FaComments, FaBoxes,\r\n  FaClipboardList, FaChartBar, FaProjectDiagram, FaReply, FaShare, FaTrash,\r\n  FaSearch, FaTimes, FaArrowUp, FaArrowDown, FaEllipsisH, FaCalendarAlt, FaEye, FaExchangeAlt, FaMapMarkerAlt, FaSignOutAlt, FaUserPlus\r\n} from 'react-icons/fa';\r\nimport { io } from 'socket.io-client';\r\nimport EmojiPicker from 'emoji-picker-react';\r\nimport api, { API_BASE_URL } from '../../api/axiosInstance';\r\nimport { SOCKET_URL, SOCKET_PATH } from '../../utils/socketConfig';\r\nimport '../style/am_style/AreaChat.css';\r\n\r\n// Map role/baseSegment to its navigation links so reused chat shows correct menu.\r\nconst NAV_CONFIG = {\r\n  am: [\r\n    { to: '/am', icon: FaTachometerAlt, label: 'Dashboard' },\r\n    { to: '/am/chat', icon: FaComments, label: 'Chat', activeMatch: /^\\/am\\/chat/ },\r\n    { to: '/am/matreq', icon: FaBoxes, label: 'Material' },\r\n    { to: '/am/manpower-requests', icon: FaUsers, label: 'Manpower' },\r\n    { to: '/am/viewproj', icon: FaProjectDiagram, label: 'Projects' },\r\n    { to: '/logs', icon: FaClipboardList, label: 'Logs' },\r\n    { to: '/reports', icon: FaChartBar, label: 'Reports' },\r\n  ],\r\n  pm: [\r\n    { to: '/pm/chat', icon: FaComments, label: 'Chat', activeMatch: /^\\/pm\\/chat/ },\r\n    { to: '/pm/request/placeholder', icon: FaBoxes, label: 'Material', activeMatch: /^\\/pm\\/request/ },\r\n    { to: '/pm/manpower-list', icon: FaUsers, label: 'Manpower', activeMatch: /^\\/pm\\/manpower/ },\r\n    { toDynamic: (pid)=> pid ? `/pm/viewprojects/${pid}` : null, icon: FaProjectDiagram, label: 'View Project', activeMatch: /^\\/pm\\/viewprojects/ },\r\n    { to: '/pm/daily-logs', icon: FaClipboardList, label: 'Logs', activeMatch: /^\\/pm\\/daily-logs(?!-list)/ },\r\n    { toDynamic: (pid)=> pid ? `/pm/progress-report/${pid}` : null, icon: FaChartBar, label: 'Reports', activeMatch: /^\\/pm\\/progress-report/ },\r\n    { to: '/pm/daily-logs-list', icon: FaCalendarAlt, label: 'Daily Logs', activeMatch: /^\\/pm\\/daily-logs-list/ },\r\n  ],\r\n  pic: [\r\n    { to: '/pic', icon: FaTachometerAlt, label: 'Dashboard', activeMatch: /^\\/pic(?!\\/)/ },\r\n    { to: '/pic/chat', icon: FaComments, label: 'Chat', activeMatch: /^\\/pic\\/chat/ },\r\n    { to: '/pic/requests', icon: FaClipboardList, label: 'Requests', activeMatch: /^\\/pic\\/requests/ },\r\n    { toDynamic: (pid) => pid ? `/pic/${pid}` : null, icon: FaEye, label: 'View Project', activeMatch: /^\\/pic\\/(?!chat|projects|requests)([a-f0-9]{24})$/ },\r\n    { to: '/pic/projects', icon: FaProjectDiagram, label: 'My Projects', activeMatch: /^\\/pic\\/projects/ },\r\n  ],\r\n  it: [\r\n  { to: '/it', icon: FaTachometerAlt, label: 'Dashboard', activeMatch: /^\\/it(?!\\/.+)/ },\r\n  { to: '/it/chat', icon: FaComments, label: 'Chat', activeMatch: /^\\/it\\/chat/ },\r\n  { to: '/it/material-list', icon: FaBoxes, label: 'Materials', activeMatch: /^\\/it\\/material-list/ },\r\n  { to: '/it/manpower-list', icon: FaUsers, label: 'Manpower', activeMatch: /^\\/it\\/manpower-list/ },\r\n  { to: '/it/auditlogs', icon: FaClipboardList, label: 'Audit Logs', activeMatch: /^\\/it\\/auditlogs/ },\r\n  ],\r\n  ceo: [\r\n    { to: '/ceo/dash', icon: FaTachometerAlt, label: 'Dashboard', activeMatch: /^\\/ceo\\/dash/ },\r\n    { to: '/ceo/chat', icon: FaComments, label: 'Chat', activeMatch: /^\\/ceo\\/chat/ },\r\n    { to: '/ceo/manpower-requests', icon: FaUsers, label: 'Manpower', activeMatch: /^\\/ceo\\/manpower-requests/ },\r\n    { to: '/ceo/proj', icon: FaProjectDiagram, label: 'Projects', activeMatch: /^\\/ceo\\/proj/ },\r\n    { to: '/ceo/material-list', icon: FaBoxes, label: 'Materials', activeMatch: /^\\/ceo\\/material-list/ },\r\n    { to: '/ceo/audit-logs', icon: FaClipboardList, label: 'Audit Logs', activeMatch: /^\\/ceo\\/audit-logs/ },\r\n    { to: '/reports', icon: FaChartBar, label: 'Reports', activeMatch: /^\\/reports/ },\r\n    // Areas & Projects toggle button omitted here (requires dashboard-only sidebar logic)\r\n  ],\r\n  hr: [\r\n    { to: '/hr', icon: FaTachometerAlt, label: 'Dashboard', activeMatch: /^\\/hr(?!\\/.+)/ },\r\n    { to: '/hr/chat', icon: FaComments, label: 'Chat', activeMatch: /^\\/hr\\/chat/ },\r\n    { to: '/hr/mlist', icon: FaUsers, label: 'Manpower', activeMatch: /^\\/hr\\/mlist/ },\r\n    { to: '/hr/movement', icon: FaExchangeAlt, label: 'Movement', activeMatch: /^\\/hr\\/movement/ },\r\n    { to: '/hr/project-records', icon: FaProjectDiagram, label: 'Projects', activeMatch: /^\\/hr\\/project-records/ },\r\n    { to: '/hr/attendance', icon: FaCalendarAlt, label: 'Attendance', activeMatch: /^\\/hr\\/attendance/ },\r\n  ],\r\n  staff: [\r\n    { to: '/staff/current-project', icon: FaProjectDiagram, label: 'Project', activeMatch: /^\\/staff\\/current-project/ },\r\n    { to: '/staff/chat', icon: FaComments, label: 'Chat', activeMatch: /^\\/staff\\/chat/ },\r\n    { to: '/staff/all-projects', icon: FaProjectDiagram, label: 'My Projects', activeMatch: /^\\/staff\\/all-projects/ },\r\n  ],\r\n  'hr-site': [\r\n    { to: '/hr-site/current-project', icon: FaProjectDiagram, label: 'Project', activeMatch: /^\\/hr-site\\/current-project/ },\r\n    { to: '/hr-site/chat', icon: FaComments, label: 'Chat', activeMatch: /^\\/hr-site\\/chat/ },\r\n    { to: '/hr-site/all-projects', icon: FaProjectDiagram, label: 'My Projects', activeMatch: /^\\/hr-site\\/all-projects/ },\r\n    { to: '/hr-site/attendance-report', icon: FaClipboardList, label: 'Attendance', activeMatch: /^\\/hr-site\\/attendance-report/ },\r\n  ],\r\n};\r\n\r\n// Socket base and path are centralized in utils/socketConfig\r\n\r\n// Generic chat component now parameterized by baseSegment so other roles reuse it safely.\r\nconst AreaChat = ({ baseSegment = 'am' }) => {\r\n  const navigate   = useNavigate();\r\n  const { chatId } = useParams();\r\n\r\n  const token    = localStorage.getItem('token');\r\n  const user     = JSON.parse(localStorage.getItem('user') || '{}');\r\n  const userId   = user?._id;\r\n  const userName = user?.name || 'Z';\r\n  const userRole = user?.role || '';\r\n\r\n  const headers = useMemo(() => ({ Authorization: `Bearer ${token}` }), [token]);\r\n\r\n  const socket = useRef(null);\r\n  const selectedChatIdRef = useRef(null);\r\n  const messagesEndRef = useRef(null);\r\n  // monotonic sequence for ordering tie-breaks (newer updates always larger)\r\n  const seqRef = useRef(0);\r\n\r\n  // Sidebar\r\n  const [chatList, setChatList] = useState([]);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [searchResults, setSearchResults] = useState([]);\r\n\r\n  // Conversation\r\n  const [selectedChat, setSelectedChat] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [newMessage, setNewMessage] = useState('');\r\n  // per-chat drafts so typing in one chat doesn't appear in another\r\n  const [drafts, setDrafts] = useState({}); // { [chatId]: text }\r\n  const [pendingFiles, setPendingFiles] = useState([]); // < NEW\r\n  const [loadingMessages, setLoadingMessages] = useState(false);\r\n\r\n  // UI\r\n  const [showEmojiPicker, setShowEmojiPicker] = useState(false);\r\n  const [showInfoSidebar, setShowInfoSidebar] = useState(false);\r\n  const [showInfoTab, setShowInfoTab] = useState('media');\r\n  const [profileMenuOpen, setProfileMenuOpen] = useState(false);\r\n  const [showSeenDetails, setShowSeenDetails] = useState(null);\r\n  const [isHeaderCollapsed, setIsHeaderCollapsed] = useState(false);\r\n  const [showScrollToBottom, setShowScrollToBottom] = useState(false);\r\n  // Message-level features (search, reply, forward, delete)\r\n  const [messageSearch, setMessageSearch] = useState('');\r\n  const [searchMatches, setSearchMatches] = useState([]); // indices of matching messages\r\n  const [searchIndex, setSearchIndex] = useState(0);\r\n  const [replyTo, setReplyTo] = useState(null); // message object being replied to\r\n  const [showForwardModal, setShowForwardModal] = useState(false);\r\n  const [forwardMessage, setForwardMessage] = useState(null);\r\n  const [forwardTargets, setForwardTargets] = useState([]); // array of { type:'chat'|'user', id }\r\n  const [forwardUsers, setForwardUsers] = useState([]); // all users for search\r\n  const [forwardSearch, setForwardSearch] = useState('');\r\n  const [actionMenu, setActionMenu] = useState({ open: false, msgId: null, x: 0, y: 0 });\r\n\r\n  // Group modal\r\n  const [showGroupModal, setShowGroupModal] = useState(false);\r\n  const [groupName, setGroupName] = useState('');\r\n  const [availableUsers, setAvailableUsers] = useState([]);\r\n  const [filteredUsers, setFilteredUsers] = useState([]);\r\n  const [userSearch, setUserSearch] = useState('');\r\n  // Keep a just-created (empty) group at the very top until it gets its first message\r\n  const [pinnedNewChatId, setPinnedNewChatId] = useState(null);\r\n  // (Restored) group creation member selection\r\n  const [selectedUsers, setSelectedUsers] = useState([]);\r\n  // Group name editing\r\n  const [editingGroupName, setEditingGroupName] = useState(false);\r\n  const [newGroupName, setNewGroupName] = useState('');\r\n  // Add members modal\r\n  const [showAddMembers, setShowAddMembers] = useState(false);\r\n  const [availableMembers, setAvailableMembers] = useState([]);\r\n  const [selectedNewMembers, setSelectedNewMembers] = useState([]);\r\n  const [addMembersSearch, setAddMembersSearch] = useState('');\r\n  // collapse/expand members list (only for group chats)\r\n  const [showMembersList, setShowMembersList] = useState(false);\r\n  // media viewer (lightbox)\r\n  const [showMediaViewer, setShowMediaViewer] = useState(false);\r\n  const [mediaViewerIndex, setMediaViewerIndex] = useState(0);\r\n  // For Project Manager & PIC conditional nav items (project-dependent)\r\n  const [pmProjectId, setPmProjectId] = useState(null);\r\n  const [picProjectId, setPicProjectId] = useState(null);\r\n  // Track which long messages are expanded (to avoid truncation)\r\n  const [expandedLongMessages, setExpandedLongMessages] = useState(new Set());\r\n  // Real-time presence (Set of userIds online) and per-chat last read timestamps\r\n  const [onlineUsers, setOnlineUsers] = useState(new Set());\r\n  const [lastRead, setLastRead] = useState({}); // { chatId: epochMs }\r\n\r\n  // Hydrate persisted read markers (so navigating away & back keeps chats read)\r\n  useEffect(() => {\r\n    try {\r\n      const stored = JSON.parse(localStorage.getItem('chatLastRead') || '{}');\r\n      if (stored && typeof stored === 'object') setLastRead(stored);\r\n    } catch {}\r\n  }, []);\r\n\r\n  // helper: consistent display name for a user\r\n  function getDisplayName(u) {\r\n    return u?.name || `${u?.firstname || ''} ${u?.lastname || ''}`.trim() || u?.email || '';\r\n  }\r\n\r\n  const toggleExpandLong = (id) => {\r\n    setExpandedLongMessages(prev => {\r\n      const next = new Set(prev);\r\n      if (next.has(id)) next.delete(id); else next.add(id);\r\n      return next;\r\n    });\r\n  };\r\n  const mediaImages = useMemo(() => (\r\n    messages\r\n      .flatMap(m => m.attachments || [])\r\n      .filter(a => a && a.mime && a.mime.startsWith('image/') && a.url)\r\n  ), [messages]);\r\n  \r\n  // Filtered list for Add Members modal (non-destructive filtering)\r\n  const filteredAvailableMembers = useMemo(() => {\r\n    if (!addMembersSearch.trim()) return availableMembers;\r\n    const q = addMembersSearch.trim().toLowerCase();\r\n    return availableMembers.filter(u => getDisplayName(u).toLowerCase().includes(q));\r\n  }, [availableMembers, addMembersSearch]);\r\n  // Map for quick lookup of an image attachment's index within mediaImages (by URL)\r\n  const mediaImageIndexByUrl = useMemo(() => {\r\n    const map = new Map();\r\n    mediaImages.forEach((img, idx) => { if (img?.url) map.set(img.url, idx); });\r\n    return map;\r\n  }, [mediaImages]);\r\n  const openMediaViewer = (idx) => { setMediaViewerIndex(idx); setShowMediaViewer(true); };\r\n  const closeMediaViewer = () => setShowMediaViewer(false);\r\n  const navMedia = (dir) => {\r\n    setMediaViewerIndex(i => {\r\n      if (!mediaImages.length) return 0;\r\n      return (i + dir + mediaImages.length) % mediaImages.length;\r\n    });\r\n  };\r\n  useEffect(() => {\r\n    if (!showMediaViewer) return;\r\n    const handler = (e) => {\r\n      if (e.key === 'Escape') closeMediaViewer();\r\n      if (e.key === 'ArrowRight') navMedia(1);\r\n      if (e.key === 'ArrowLeft') navMedia(-1);\r\n    };\r\n    window.addEventListener('keydown', handler);\r\n    return () => window.removeEventListener('keydown', handler);\r\n  }, [showMediaViewer, mediaImages.length]);\r\n\r\n  // Load minimal project info for PM & PIC to show conditional nav links similar to their dashboards\r\n  useEffect(() => {\r\n    if (baseSegment !== 'pm' && baseSegment !== 'pic') return;\r\n    (async () => {\r\n      try {\r\n        if (baseSegment === 'pm') {\r\n          const { data } = await api.get('/projects?limit=1', { headers });\r\n          if (Array.isArray(data) && data.length) {\r\n            const first = data[0];\r\n            setPmProjectId(first._id || first.id || null);\r\n          }\r\n        } else if (baseSegment === 'pic' && userId) {\r\n          // Mirror PicDash: /projects/by-user-status?userId=...&role=pic&status=Ongoing\r\n          const { data } = await api.get(`/projects/by-user-status?userId=${userId}&role=pic&status=Ongoing`, { headers });\r\n            if (Array.isArray(data) && data.length) {\r\n              const first = data[0];\r\n              setPicProjectId(first._id || first.id || null);\r\n            }\r\n        }\r\n      } catch { /* ignore */ }\r\n    })();\r\n  }, [baseSegment, headers, userId]);\r\n\r\n  // Consistent ordering helper: newest lastMessage (with fallbacks) first, plus pin logic\r\n  const sortChatList = (list) => {\r\n    // A chat only counts as having a real last message if it has: non-empty content OR attachments OR a sender id.\r\n    const hasRealLastMessage = (c) => {\r\n      const lm = c?.lastMessage;\r\n      // For group chats we want even an \"empty\" synthetic placeholder (no content/attachments/sender)\r\n      // to count so ordering uses its timestamp and places it among active chats.\r\n      if (c?.isGroup) {\r\n        if (!lm) return true; // no lastMessage yet (we may synthesize elsewhere) -> include\r\n        const hasContentG = typeof lm.content === 'string' && lm.content.trim().length > 0;\r\n        const hasAttG = Array.isArray(lm.attachments) && lm.attachments.length > 0;\r\n        const hasSenderG = !!lm.sender;\r\n        // If it's still empty placeholder, still treat as real for ordering.\r\n        if (!hasContentG && !hasAttG && !hasSenderG) return true;\r\n        return true; // normal non-empty group message\r\n      }\r\n      // Direct chats: only count if there is a meaningful lastMessage\r\n      if (!lm) return false;\r\n      const hasContent = typeof lm.content === 'string' && lm.content.trim().length > 0;\r\n      const hasAttachments = Array.isArray(lm.attachments) && lm.attachments.length > 0;\r\n      const hasSender = !!lm.sender;\r\n      return hasContent || hasAttachments || hasSender;\r\n    };\r\n    const getTs = (c) => {\r\n      // Prefer a precomputed numeric timestamp for reliable ordering\r\n      if (c?.lastMessage?.tsNum) return c.lastMessage.tsNum;\r\n      // For empty group chats (no lastMessage) use createdAt so they sort by creation time.\r\n      if (!c?.lastMessage && c?.isGroup) {\r\n        const created = c.createdAt || c.updatedAt;\r\n        if (created) {\r\n          const num = typeof created === 'number' ? created : Date.parse(created);\r\n          return isNaN(num) ? 0 : num;\r\n        }\r\n      }\r\n      let t = c?.lastMessage?.timestamp || c?.lastMessage?.createdAt || c?.lastMessage?.updatedAt || c?.updatedAt || c?.createdAt;\r\n      if (!t && c?._id && /^[a-f0-9]{24}$/.test(c._id)) {\r\n        t = parseInt(c._id.substring(0,8),16) * 1000;\r\n      }\r\n      if (!t) return 0;\r\n      if (typeof t === 'number') return t;\r\n      const n = Date.parse(t);\r\n      return isNaN(n) ? 0 : n;\r\n    };\r\n    // Updated priority:\r\n    // - Chats with a real lastMessage OR (empty group chats) participate in chronological ordering.\r\n    // - Empty direct chats (no lastMessage) stay at the bottom in original order.\r\n    const withIndex = [...(list || [])].map((c, idx) => ({ c, idx }));\r\n    let sorted = withIndex.sort((a, b) => {\r\n      const aHas = hasRealLastMessage(a.c);\r\n      const bHas = hasRealLastMessage(b.c);\r\n      if (aHas && !bHas) return -1;\r\n      if (!aHas && bHas) return 1;\r\n      if (!aHas && !bHas) return a.idx - b.idx; // both empty non-group (DM) chats\r\n      // both have lastMessage -> original ordering logic\r\n      const diff = getTs(b.c) - getTs(a.c);\r\n      if (diff !== 0) return diff;\r\n      const sa = a.c?.lastMessage?.seq || 0;\r\n      const sb = b.c?.lastMessage?.seq || 0;\r\n  if (sb !== sa) return sb - sa;\r\n  // Final deterministic fallback: group chats before direct if otherwise identical\r\n  if (a.c.isGroup && !b.c.isGroup) return -1;\r\n  if (!a.c.isGroup && b.c.isGroup) return 1;\r\n  return 0;\r\n    }).map(x => x.c);\r\n    if (pinnedNewChatId) {\r\n      const idx = sorted.findIndex(c => c._id === pinnedNewChatId);\r\n      if (idx > -1) {\r\n        const pinned = sorted[idx];\r\n        if (!pinned.lastMessage) {\r\n          // Now that empty chats no longer float to top automatically, we also remove special pinning behavior.\r\n          // Leave it in place only if you still want manual pin; otherwise just clear the pin state.\r\n          // So we simply keep order and clear pin.\r\n          sorted = sorted; // no-op\r\n          setPinnedNewChatId(null);\r\n        } else {\r\n          setPinnedNewChatId(null);\r\n        }\r\n      } else {\r\n        setPinnedNewChatId(null);\r\n      }\r\n    }\r\n    return sorted;\r\n  };\r\n\r\n  // reloadChats defined once (see below after socket setup)\r\n\r\n  // Unpin when first message arrives (extra safeguard)\r\n  useEffect(() => {\r\n    if (!pinnedNewChatId) return;\r\n    const pinned = chatList.find(c => c._id === pinnedNewChatId);\r\n    if (pinned && pinned.lastMessage) setPinnedNewChatId(null);\r\n  }, [chatList, pinnedNewChatId]);\r\n\r\n  // collapse header when a chat opens\r\n  useEffect(() => { setIsHeaderCollapsed(!!selectedChat); }, [selectedChat]);\r\n\r\n  // guard\r\n  useEffect(() => { if (!token || !userId) navigate('/'); }, [navigate, token, userId]);\r\n\r\n  // close profile menu on outside click\r\n  useEffect(() => {\r\n    const handler = (e) => { if (!e.target.closest('.user-profile')) setProfileMenuOpen(false); };\r\n    document.addEventListener('click', handler);\r\n    return () => document.removeEventListener('click', handler);\r\n  }, []);\r\n  // Close message action menu on outside/Escape\r\n  useEffect(() => {\r\n    const onDocClick = (e) => { if (!e.target.closest('.msg-action-trigger') && !e.target.closest('.msg-action-popover')) setActionMenu(m => m.open ? { ...m, open:false } : m); };\r\n    const onKey = (e) => { if (e.key === 'Escape') setActionMenu(m => m.open ? { ...m, open:false } : m); };\r\n    document.addEventListener('click', onDocClick);\r\n    document.addEventListener('keydown', onKey);\r\n    return () => { document.removeEventListener('click', onDocClick); document.removeEventListener('keydown', onKey); };\r\n  }, []);\r\n\r\n  // helpers (getDisplayName moved above for earlier usage)\r\n  // Show seconds so chats ordered within the same minute are distinguishable\r\n  const formatTime = (ts) => {\r\n    if (!ts) return '';\r\n    const d = new Date(ts);\r\n  const now = new Date();\r\n  const sameDay = d.getFullYear() === now.getFullYear() && d.getMonth() === now.getMonth() && d.getDate() === now.getDate();\r\n  const timeStr = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });\r\n  if (sameDay) return timeStr;\r\n  // Include short date + time (no seconds if you prefer, but keep seconds for consistency)\r\n  const dateStr = d.toLocaleDateString([], { month: 'short', day: 'numeric' });\r\n  // If different year add year\r\n  const addYear = d.getFullYear() !== now.getFullYear() ? ' ' + d.getFullYear() : '';\r\n  return `${dateStr}${addYear} ${timeStr}`;\r\n  };\r\n\r\n  const getSeenDisplayNames = (seenArray) => {\r\n    if (!seenArray?.length) return [];\r\n    return seenArray.map(s => {\r\n      const user = chatList.find(c => c.users.some(u => u._id === s.userId))?.users.find(u => u._id === s.userId);\r\n      return getDisplayName(user);\r\n    }).filter(Boolean);\r\n  };\r\n  // Merge incoming messages with existing, dedupe by _id and sort by timestamp\r\n  const mergeMessages = (oldMsgs = [], newMsgs = []) => {\r\n    const map = new Map();\r\n    (oldMsgs || []).forEach(m => { if (m && m._id) map.set(String(m._id), m); });\r\n    (newMsgs || []).forEach(m => { if (m && m._id) map.set(String(m._id), m); });\r\n    const arr = Array.from(map.values());\r\n    arr.sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));\r\n    return arr;\r\n  };\r\n\r\n  const dedupedMessages = React.useMemo(() => {\r\n    const seen = new Set();\r\n    return (messages || []).filter(m => {\r\n      const id = String(m && m._id);\r\n      if (!id) return false;\r\n      if (seen.has(id)) return false;\r\n      seen.add(id);\r\n      return true;\r\n    });\r\n  }, [messages]);\r\n  // Helper: derive display name & initials for a message sender\r\n  const getMessageSenderUser = (msg) => {\r\n    if (!selectedChat) return null;\r\n    const sid = msg.senderId || (msg.isOwn ? userId : msg.senderId);\r\n    if (!sid) return null;\r\n    return (selectedChat.users || []).find(u => u._id === sid) || null;\r\n  };\r\n  const getInitials = (name='') => {\r\n    const parts = name.trim().split(/\\s+/).filter(Boolean).slice(0,2);\r\n    if(!parts.length) return 'U';\r\n    return parts.map(p=>p.charAt(0).toUpperCase()).join('');\r\n  };\r\n  // --- In-chat search helpers ---\r\n  const escapeRegExp = (s='') => s.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n  const highlightMessage = (text='') => {\r\n    if (!messageSearch.trim()) return text;\r\n    try {\r\n      const re = new RegExp(`(${escapeRegExp(messageSearch.trim())})`, 'gi');\r\n      return text.replace(re, '<mark class=\"msg-hit\">$1</mark>');\r\n    } catch { return text; }\r\n  };\r\n  useEffect(() => {\r\n    if (!messageSearch.trim()) { setSearchMatches([]); setSearchIndex(0); return; }\r\n    const q = messageSearch.trim().toLowerCase();\r\n    const matches = dedupedMessages\r\n      .map((m,i) => ({ i, content: (m.content||'').toLowerCase() }))\r\n      .filter(x => x.content.includes(q))\r\n      .map(x => x.i);\r\n    setSearchMatches(matches);\r\n    setSearchIndex(0);\r\n    if (matches.length) {\r\n      setTimeout(() => {\r\n        const el = document.querySelector(`[data-msg-index=\"${matches[0]}\"]`);\r\n        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n      }, 50);\r\n    }\r\n  }, [messageSearch, dedupedMessages]);\r\n  const gotoMatch = (dir) => {\r\n    if (!searchMatches.length) return;\r\n    setSearchIndex(i => {\r\n      const next = (i + dir + searchMatches.length) % searchMatches.length;\r\n      const idx = searchMatches[next];\r\n      setTimeout(() => {\r\n        const el = document.querySelector(`[data-msg-index=\"${idx}\"]`);\r\n        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n      }, 30);\r\n      return next;\r\n    });\r\n  };\r\n  const getGroupSeenDisplay = (names) => {\r\n    const first = names.map(n => n.split(' ')[0]);\r\n    if (first.length <= 1) return first[0] || '';\r\n    if (first.length === 2) return `${first[0]} and ${first[1]}`;\r\n    if (first.length === 3) return `${first[0]}, ${first[1]} and ${first[2]}`;\r\n    return `${first[0]}, ${first[1]} and ${first.length - 2} others`;\r\n  };\r\n\r\n  // SOCKET  single connection\r\n  useEffect(() => {\r\n    if (!userId) return;\r\n\r\n    if (socket.current) { socket.current.disconnect(); socket.current = null; }\r\n    socket.current = io(SOCKET_URL, {\r\n      path: SOCKET_PATH, withCredentials: true,\r\n      transports: ['websocket', 'polling'], auth: { userId }\r\n    });\r\n\r\n    // Diagnostics for production connection issues\r\n    socket.current.on('connect_error', (err) => {\r\n      // If websocket failed first, allow engine.io to fallback to polling automatically; log once\r\n      console.warn('[socket] connect_error', SOCKET_URL, err?.message);\r\n    });\r\n    socket.current.on('error', (err) => {\r\n      console.warn('[socket] error', err);\r\n    });\r\n    socket.current.on('reconnect_attempt', (n) => {\r\n      // ensure both transports remain allowed\r\n      try { socket.current.io.opts.transports = ['websocket','polling']; } catch {}\r\n      if (n === 1) console.info('[socket] reconnect attempt');\r\n    });\r\n    socket.current.on('reconnect_failed', () => {\r\n      console.error('[socket] reconnect failed');\r\n    });\r\n\r\n  // Helper: normalize an incoming socket message so that we don't display\r\n  // raw attachment URLs (e.g. signed Supabase URLs) as the text content\r\n  // when the user only sent files/images with no accompanying message.\r\n  const normalizeIncoming = (msg) => {\r\n    let text = (msg.content ?? msg.message ?? msg.fileUrl ?? '') || '';\r\n    const attachments = Array.isArray(msg.attachments) ? msg.attachments : [];\r\n    if (attachments.length) {\r\n      const urls = attachments.map(a => a && a.url).filter(Boolean);\r\n      // If the text exactly equals one of the attachment URLs, drop it.\r\n      if (urls.includes(text)) text = '';\r\n      // If text looks like a long signed URL and every attachment url is contained inside it, drop it.\r\n      if (/^https?:\\/\\//.test(text) && urls.some(u => text.startsWith(u.split('?')[0]))) {\r\n        text = '';\r\n      }\r\n      // Some backends may echo a temporary placeholder like \"Sending X attachment(s)\"\r\n      if (/^Sending \\d+ attachment\\(s\\)$/.test(text)) text = '';\r\n    }\r\n    return { text, attachments };\r\n  };\r\n\r\n  const onReceive = (msg) => {\r\n      const { text, attachments } = normalizeIncoming(msg);\r\n      // update list preview + reorder\r\n      console.log('Debug: onReceive message', msg);\r\n      const tsNum = typeof msg.timestamp === 'number' ? msg.timestamp : (msg.timestamp ? Date.parse(msg.timestamp) : Date.now());\r\n      setChatList(list => {\r\n        let found = false;\r\n        const updated = list.map(c => {\r\n          if (c._id !== msg.conversation) return c;\r\n          found = true;\r\n          // Build preview content with richer attachment indicator (image vs files)\r\n          let content = text;\r\n          if (!content && attachments.length) {\r\n            const allImages = attachments.every(a => (a?.mimetype||'').startsWith('image/'));\r\n            const count = attachments.length;\r\n            content = allImages ? (count === 1 ? ' Photo' : ` ${count} Photos`) : (count === 1 ? ' Attachment' : ` ${count} Files`);\r\n          }\r\n          return { ...c, lastMessage: { content, timestamp: msg.timestamp || tsNum, tsNum, seq: ++seqRef.current, attachments, sender: msg.sender } };\r\n        });\r\n        if (!found) return list; // chat not yet in list (will be added by chatCreated event)\r\n        return sortChatList(updated);\r\n      });\r\n\r\n      // show in open chat\r\n      if (selectedChatIdRef.current === msg.conversation) {\r\n        setMessages(ms => {\r\n          const filtered = ms.filter(m => {\r\n            if (!String(m._id).startsWith('tmp-')) return true;\r\n            if (!m.isOwn) return true;\r\n            // If server message is from self, drop the temp placeholder\r\n            if (msg.sender === userId) return false;\r\n            // Or if placeholder content matches server text\r\n            if (m.content === (msg.content || '')) return false;\r\n            // Or if placeholder said \"Sending X attachment(s)\" and real message has attachments\r\n            if (/^Sending \\d+ attachment\\(s\\)$/.test(m.content) && (attachments.length > 0)) return false;\r\n            return true;\r\n          });\r\n\r\n          return [...filtered, {\r\n            _id: msg._id,\r\n            content: text,\r\n            timestamp: msg.timestamp,\r\n            isOwn: msg.sender === userId,\r\n            reactions: [],\r\n            seen: [],\r\n            attachments,\r\n            replyTo: msg.replyTo || null,\r\n            forwardOf: msg.forwardOf || null,\r\n            senderId: msg.sender || msg.senderId || null,\r\n          }];\r\n        });\r\n\r\n        if (msg.sender !== userId) {\r\n          if (socket.current && socket.current.connected) socket.current.emit('messageSeen', { messageId: msg._id, userId });\r\n          else if (socket.current && socket.current.once) socket.current.once('connect', () => socket.current.emit('messageSeen', { messageId: msg._id, userId }));\r\n        }\r\n      }\r\n    };\r\n\r\n    const onSeen = ({ messageId, userId: seenBy, timestamp }) => {\r\n      setMessages(ms => ms.map(m => m._id === messageId ? { ...m, seen: [...(m.seen || []), { userId: seenBy, timestamp }] } : m));\r\n    };\r\n\r\n    const onChatUpdated = ({ chatId: cId, lastMessage }) => {\r\n      const ts = (typeof lastMessage?.timestamp === 'number' ? lastMessage.timestamp : Date.parse(lastMessage?.timestamp)) || Date.now();\r\n      setChatList(list => sortChatList(list.map(c => {\r\n        if (c._id !== cId) return c;\r\n        const prevSeen = c.lastMessage?.seen || [];\r\n        const mergedSeen = lastMessage?.seen ? lastMessage.seen : prevSeen;\r\n        return { ...c, lastMessage: { ...lastMessage, seen: mergedSeen, tsNum: ts, seq: ++seqRef.current } };\r\n      })));\r\n    };\r\n\r\n    const onMembersUpdated = ({ chatId: cid, users, name }) => {\r\n      setChatList(list => list.map(c => c._id === cid ? { ...c, users: users || c.users, name: name || c.name } : c));\r\n      setSelectedChat(prev => prev && prev._id === cid ? { ...prev, users: users || prev.users, name: name || prev.name } : prev);\r\n    };\r\n    const onChatCreated = (chatObj) => {\r\n      if (!chatObj || !chatObj._id) return;\r\n      if (!(chatObj.users || []).some(u => u._id === userId)) return; // only if I'm a member\r\n      const raw = chatObj.lastMessage?.timestamp || chatObj.lastMessage?.createdAt || chatObj.lastMessage?.updatedAt;\r\n      let num = typeof raw === 'number' ? raw : (raw ? Date.parse(raw) : 0);\r\n      chatObj = chatObj.lastMessage ? { ...chatObj, lastMessage: { ...chatObj.lastMessage, tsNum: num, seq: ++seqRef.current } } : chatObj;\r\n      // If no lastMessage yet and NOT a group, don't insert (hide empty 1-1). Allow empty groups to appear.\r\n      if (!chatObj.lastMessage && !chatObj.isGroup) return;\r\n      // For empty group chats add synthetic timestamp based on createdAt/_id for ordering\r\n      if (!chatObj.lastMessage && chatObj.isGroup) {\r\n        let created = chatObj.createdAt || chatObj.updatedAt;\r\n        if (!created && /^[a-f0-9]{24}$/.test(chatObj._id)) {\r\n          created = new Date(parseInt(chatObj._id.substring(0,8),16) * 1000).toISOString();\r\n        }\r\n        let tsNum = 0;\r\n        if (created) {\r\n          tsNum = typeof created === 'number' ? created : Date.parse(created) || 0;\r\n        }\r\n        chatObj = { ...chatObj, lastMessage: { content: '', timestamp: created, tsNum, seq: ++seqRef.current, sender: null, attachments: [], seen: [] } };\r\n      }\r\n    setChatList(list => sortChatList([chatObj, ...list.filter(c => c._id !== chatObj._id)]));\r\n    };\r\n\r\n    const onReaction = ({ messageId, reactions }) => {\r\n      setMessages(ms => ms.map(m => m._id === messageId ? { ...m, reactions } : m));\r\n    };\r\n\r\n    socket.current.on('receiveMessage', onReceive);\r\n    socket.current.on('messageSeen', onSeen);\r\n    socket.current.on('chatUpdated', onChatUpdated);\r\n  socket.current.on('messageReaction', onReaction);\r\n  socket.current.on('chatMembersUpdated', onMembersUpdated);\r\n  socket.current.on('chatCreated', onChatCreated);\r\n\r\n    // Presence + read receipt listeners\r\n    socket.current.on('presenceSnapshot', (ids=[]) => {\r\n      try { setOnlineUsers(new Set(ids.map(String))); } catch {}\r\n    });\r\n    socket.current.on('userOnline', (id) => { if(!id) return; setOnlineUsers(prev => { const n=new Set(prev); n.add(String(id)); return n; }); });\r\n    socket.current.on('userOffline', (id) => { if(!id) return; setOnlineUsers(prev => { const n=new Set(prev); n.delete(String(id)); return n; }); });\r\n    socket.current.on('chatReadReceipt', ({ chatId, timestamp }) => {\r\n      if (chatId && timestamp) setLastRead(lr => ({ ...lr, [chatId]: timestamp }));\r\n    });\r\n    // Request initial presence data\r\n    try { socket.current.emit('getPresence'); } catch {}\r\n\r\n    return () => {\r\n      socket.current.off('receiveMessage', onReceive);\r\n      socket.current.off('messageSeen', onSeen);\r\n      socket.current.off('chatUpdated', onChatUpdated);\r\n  socket.current.off('messageReaction', onReaction);\r\n  socket.current.off('chatMembersUpdated', onMembersUpdated);\r\n  socket.current.off('chatCreated', onChatCreated);\r\n  socket.current.off('presenceSnapshot');\r\n  socket.current.off('userOnline');\r\n  socket.current.off('userOffline');\r\n  socket.current.off('chatReadReceipt');\r\n      socket.current.disconnect();\r\n    };\r\n  }, [userId]);\r\n\r\n  // keep current chat id for handlers\r\n  useEffect(() => { selectedChatIdRef.current = selectedChat?._id || null; }, [selectedChat?._id]);\r\n\r\n  // autoscroll\r\n  useEffect(() => { if (messagesEndRef.current) messagesEndRef.current.scrollIntoView({ behavior: 'smooth' }); }, [messages, selectedChat]);\r\n  const scrollToBottom = () => { if (messagesEndRef.current) messagesEndRef.current.scrollIntoView({ behavior: 'smooth' }); };\r\n\r\n  // show/hide scroll to bottom\r\n  useEffect(() => {\r\n    const el = document.querySelector('.modern-chat-main');\r\n    if (!el) return;\r\n    const onScroll = () => {\r\n      const { scrollTop, scrollHeight, clientHeight } = el;\r\n      setShowScrollToBottom(scrollHeight - scrollTop - clientHeight >= 20);\r\n    };\r\n    el.addEventListener('scroll', onScroll);\r\n    return () => el.removeEventListener('scroll', onScroll);\r\n  }, [selectedChat]);\r\n\r\n  // load chats\r\n  const reloadChats = async () => {\r\n    try {\r\n      const { data } = await api.get('/chats', { headers });\r\n      const withTs = (data || []).map(c => {\r\n        if (c?.lastMessage) {\r\n          const lm = c.lastMessage;\r\n          const raw = lm.timestamp || lm.createdAt || lm.updatedAt;\r\n          let num = typeof raw === 'number' ? raw : (raw ? Date.parse(raw) : 0);\r\n          if (!num) num = 0;\r\n          let content = lm.content || '';\r\n          if ((!content || /^https?:\\/\\//.test(content)) && Array.isArray(lm.attachments) && lm.attachments.length) {\r\n            const allImages = lm.attachments.every(a => (a?.mimetype||'').startsWith('image/'));\r\n            const count = lm.attachments.length;\r\n            if (allImages) content = count === 1 ? ' Photo' : ` ${count} Photos`;\r\n            else content = count === 1 ? ' Attachment' : ` ${count} Files`;\r\n          }\r\n          return { ...c, lastMessage: { ...lm, content, tsNum: num, attachments: lm.attachments || [] } };\r\n        }\r\n        // No lastMessage: if it's a group, synthesize one so ordering treats creation as activity\r\n        if (c?.isGroup) {\r\n          let created = c.createdAt || c.updatedAt;\r\n          if (!created && /^[a-f0-9]{24}$/.test(c._id || '')) {\r\n            created = new Date(parseInt(c._id.substring(0,8),16) * 1000).toISOString();\r\n          }\r\n          let tsNum = 0;\r\n          if (created) {\r\n            tsNum = typeof created === 'number' ? created : (Date.parse(created) || 0);\r\n          }\r\n          if (!tsNum) tsNum = Date.now(); // fallback ensure it floats\r\n          return { ...c, lastMessage: { content: '', timestamp: created || new Date().toISOString(), tsNum, seq: ++seqRef.current, sender: null, attachments: [], seen: [] } };\r\n        }\r\n        return c;\r\n      });\r\n      // Visible chats: include all groups (even empty) and only DMs with a real lastMessage\r\n      const visible = withTs.filter(c => {\r\n        if (c.isGroup) return true;\r\n        const lm = c.lastMessage;\r\n        if (!lm) return false;\r\n        const hasContent = typeof lm.content === 'string' && lm.content.trim().length > 0;\r\n        const hasAttachments = Array.isArray(lm.attachments) && lm.attachments.length > 0;\r\n        const hasSender = !!lm.sender;\r\n        return hasContent || hasAttachments || hasSender;\r\n      });\r\n      setChatList(sortChatList(visible));\r\n    } catch { setChatList([]); }\r\n  };\r\n  useEffect(() => { if (token) reloadChats(); }, [token, headers]);\r\n\r\n  // auto-select from URL\r\n  useEffect(() => {\r\n    if (!chatId || chatList.length === 0) return;\r\n    const c = chatList.find(ch => ch._id === chatId);\r\n    if (c) setSelectedChat(c);\r\n  }, [chatId, chatList]);\r\n\r\n  // join + fetch messages\r\n  useEffect(() => {\r\n    if (!selectedChat) return;\r\n    const chatIdCurrent = selectedChat._id;\r\n    socket.current.emit('joinChat', chatIdCurrent);\r\n    // Clear immediately to avoid briefly showing previous chat's messages\r\n    setMessages([]);\r\n\r\n    let cancelled = false;\r\n    (async () => {\r\n      try {\r\n        setLoadingMessages(true);\r\n        const { data } = await api.get(`/messages/${chatIdCurrent}`, { headers });\r\n        if (cancelled) return; // stale fetch guard\r\n        if (!selectedChat || selectedChat._id !== chatIdCurrent) return; // chat switched\r\n        const norm = (data || []).map(m => ({\r\n          _id: m._id,\r\n          content: (m.message ?? m.content ?? m.fileUrl ?? '') || '',\r\n          timestamp: m.createdAt,\r\n          isOwn: m.senderId === userId,\r\n          reactions: m.reactions || [],\r\n          seen: m.seen || [],\r\n          attachments: m.attachments || [],\r\n          replyTo: m.replyTo || null,\r\n          forwardOf: m.forwardOf || null,\r\n          senderId: m.senderId || (m.sender && m.sender._id) || null,\r\n        }));\r\n        setMessages(() => norm);\r\n        norm.filter(m => !m.isOwn).forEach(m => {\r\n          if (socket.current && socket.current.connected) socket.current.emit('messageSeen', { messageId: m._id, userId });\r\n          else if (socket.current && socket.current.once) socket.current.once('connect', () => socket.current.emit('messageSeen', { messageId: m._id, userId }));\r\n        });\r\n      } finally {\r\n        if (!cancelled) {\r\n          setLoadingMessages(false);\r\n          setTimeout(() => scrollToBottom(), 100);\r\n        }\r\n      }\r\n    })();\r\n\r\n    return () => {\r\n      cancelled = true;\r\n      socket.current.emit('leaveChat', chatIdCurrent);\r\n    };\r\n  }, [selectedChat?._id, userId, headers]);\r\n\r\n  // search (debounced)\r\n  useEffect(() => {\r\n    const id = setTimeout(async () => {\r\n      const q = searchQuery.trim().toLowerCase();\r\n      if (!q) return setSearchResults([]);\r\n      try {\r\n        // Fetch all users once per search (backend already auth-protected)\r\n        const { data: allUsers } = await api.get('/users', { headers });\r\n        const users = Array.isArray(allUsers) ? allUsers : [];\r\n\r\n        // Existing chats that match (group or direct)\r\n        const matchedChats = chatList.filter(c => c.isGroup ? (c.name || '').toLowerCase().includes(q)\r\n          : getDisplayName(c.users.find(u => u._id !== userId)).toLowerCase().includes(q));\r\n\r\n        // All users matching query (by name/email) regardless of existing chat\r\n        const regex = new RegExp(q, 'i');\r\n        const matchedUsers = users.filter(u => regex.test(u.name || '') || regex.test(u.email || ''));\r\n\r\n        // Combine: keep matched chats as-is; add matched users (mark type:'user') if no existing 1-1 chat with them\r\n        const results = [...matchedChats];\r\n        matchedUsers.forEach(u => {\r\n          const alreadyDirect = chatList.some(c => !c.isGroup && c.users.some(x => x._id === u._id));\r\n          if (!alreadyDirect) results.push({ ...u, type: 'user' });\r\n        });\r\n\r\n        setSearchResults(results);\r\n      } catch (e) {\r\n        setSearchResults([]);\r\n      }\r\n    }, 300);\r\n    return () => clearTimeout(id);\r\n  }, [searchQuery, chatList, userId, headers]);\r\n\r\n  // group modal lists\r\n  useEffect(() => {\r\n    if (!showGroupModal) return;\r\n    (async () => {\r\n      try {\r\n        const { data } = await api.get('/users?limit=100', { headers });\r\n        setAvailableUsers(data || []); setFilteredUsers(data || []);\r\n      } catch { setAvailableUsers([]); setFilteredUsers([]); }\r\n    })();\r\n  }, [showGroupModal, headers]);\r\n\r\n  useEffect(() => {\r\n    if (showAddMembers && selectedChat?.isGroup) loadAvailableMembers();\r\n  }, [showAddMembers, selectedChat]);\r\n\r\n  // Load users when forward modal opens\r\n  useEffect(() => {\r\n    if (!showForwardModal) return;\r\n    (async () => {\r\n      try {\r\n        const { data } = await api.get('/users?limit=500', { headers });\r\n        setForwardUsers(Array.isArray(data) ? data : []);\r\n      } catch { setForwardUsers([]); }\r\n      setForwardSearch('');\r\n    })();\r\n  }, [showForwardModal, headers]);\r\n  // Unified forward list (chats + users without existing DM). We filter by search across names.\r\n  const unifiedForwardList = useMemo(() => {\r\n    // Build base chat entries\r\n    const chats = chatList\r\n      .filter(c => c._id !== selectedChat?._id) // exclude current chat\r\n      .map(c => ({\r\n        key: `chat-${c._id}`,\r\n        type: 'chat',\r\n        id: c._id,\r\n        name: c.isGroup ? c.name : getDisplayName(c.users.find(u => u._id !== userId)),\r\n        isGroup: c.isGroup\r\n      }));\r\n    // Users not already represented by a direct chat with me\r\n    const userEntries = forwardUsers\r\n      .filter(u => u._id !== userId)\r\n      .filter(u => !chatList.some(c => !c.isGroup && c.users.some(x => x._id === u._id) && c.users.some(x => x._id === userId)))\r\n      .map(u => ({\r\n        key: `user-${u._id}`,\r\n        type: 'user',\r\n        id: u._id,\r\n        name: getDisplayName(u),\r\n        isGroup: false\r\n      }));\r\n    const all = [...chats, ...userEntries];\r\n    const q = forwardSearch.trim().toLowerCase();\r\n    if (!q) return all;\r\n    return all.filter(e => (e.name || '').toLowerCase().includes(q));\r\n  }, [chatList, forwardUsers, forwardSearch, selectedChat, userId]);\r\n  const toggleForwardTarget = (target) => {\r\n    setForwardTargets(prev => prev.some(t => t.type === target.type && t.id === target.id)\r\n      ? prev.filter(t => !(t.type === target.type && t.id === target.id))\r\n      : [...prev, target]);\r\n  };\r\n\r\n  // actions\r\n  const openChat = async (item) => {\r\n    // persist current draft before switching (if any content or files)\r\n    if (selectedChat && selectedChat._id) {\r\n      setDrafts(prev => {\r\n        if (!newMessage && (!pendingFiles || pendingFiles.length === 0)) return prev;\r\n        return { ...prev, [selectedChat._id]: newMessage };\r\n      });\r\n    }\r\n    let chatToOpen = item;\r\n    if (item.type === 'user') {\r\n      const { data: dm } = await api.post('/chats', { users: [userId, item._id] }, { headers });\r\n      chatToOpen = dm;\r\n      await reloadChats();\r\n    }\r\n    setSelectedChat(chatToOpen);\r\n    setNewMessage(drafts[chatToOpen._id] || '');\r\n    setSearchQuery(''); setSearchResults([]); setPendingFiles([]);\r\n  navigate(`/${baseSegment}/chat/${chatToOpen._id}`);\r\n  // Mark read locally & notify server\r\n  const lmTs = (chatToOpen?.lastMessage && (Date.parse(chatToOpen.lastMessage.timestamp) || chatToOpen.lastMessage.tsNum || Date.now())) || Date.now();\r\n  setLastRead(prev => ({ ...prev, [chatToOpen._id]: lmTs }));\r\n  try {\r\n    const existing = JSON.parse(localStorage.getItem('chatLastRead') || '{}');\r\n    existing[chatToOpen._id] = lmTs;\r\n    localStorage.setItem('chatLastRead', JSON.stringify(existing));\r\n  } catch {}\r\n  // Optimistically add current user to lastMessage.seen so unread clears instantly\r\n  setChatList(prev => prev.map(c => {\r\n    if (c._id === chatToOpen._id) {\r\n      if (c.lastMessage) {\r\n        const seen = (c.lastMessage.seen || []).map(String);\r\n        if (!seen.includes(String(userId))) {\r\n          return { ...c, lastMessage: { ...c.lastMessage, seen: [...c.lastMessage.seen || [], userId] } };\r\n        }\r\n      }\r\n    }\r\n    return c;\r\n  }));\r\n  // Also patch selectedChat state so its header (if any) reflects seen\r\n  setSelectedChat(sc => {\r\n    if (!sc || sc._id !== chatToOpen._id) return sc;\r\n    if (!sc.lastMessage) return sc;\r\n    const seen = (sc.lastMessage.seen || []).map(String);\r\n    if (seen.includes(String(userId))) return sc;\r\n    return { ...sc, lastMessage: { ...sc.lastMessage, seen: [...sc.lastMessage.seen || [], userId] } };\r\n  });\r\n  try { socket.current && socket.current.emit('markChatRead', { chatId: chatToOpen._id, timestamp: lmTs }); } catch {}\r\n  // rely on server markChatRead to update lastMessage.seen\r\n  // Dispatch global event so AppHeader (or others) can refresh unread badge immediately\r\n  try { window.dispatchEvent(new CustomEvent('chatUnreadChanged', { detail: { chatId: chatToOpen._id, action: 'read' } })); } catch {}\r\n  };\r\n\r\n  // SEND  text + files (multipart) with optimistic temp message\r\n  const sendMessage = async () => {\r\n    const content = (newMessage || '').trim();\r\n    if (!content && pendingFiles.length === 0) return;\r\n    if (!selectedChat) return;\r\n\r\n    const filesNow = pendingFiles;\r\n    setNewMessage('');\r\n    setPendingFiles([]);\r\n    // remove stored draft after sending\r\n    setDrafts(prev => {\r\n      if (!selectedChat?._id) return prev;\r\n      const c = { ...prev }; delete c[selectedChat._id]; return c;\r\n    });\r\n\r\n    const tempId = `tmp-${Date.now()}-${Math.random()}`;\r\n    setMessages(ms => mergeMessages(ms, [{\r\n      _id: tempId,\r\n      content: content || (filesNow.length ? `Sending ${filesNow.length} attachment(s)` : ''),\r\n      timestamp: Date.now(),\r\n      isOwn: true,\r\n      reactions: [],\r\n      seen: [],\r\n      attachments: [], // real attachments come via socket\r\n      replyTo: replyTo ? replyTo._id : null,\r\n    }]));\r\n\r\n    // Optimistic sidebar preview + reorder\r\n    const optimisticTs = Date.now();\r\n    setChatList(list => sortChatList(list.map(c => c._id === selectedChat._id ? {\r\n      ...c,\r\n      lastMessage: { content: content || (filesNow.length ? ' Attachment' : ''), timestamp: optimisticTs, tsNum: optimisticTs, seq: ++seqRef.current, sender: userId, seen: [] }\r\n    } : c)));\r\n\r\n    try {\r\n      const fd = new FormData();\r\n      fd.append('conversation', selectedChat._id);\r\n  if (content) fd.append('content', content);\r\n  if (replyTo) fd.append('replyTo', replyTo._id);\r\n      filesNow.forEach(f => fd.append('files', f));\r\n      await api.post('/messages', fd, { headers: { ...headers, 'Content-Type': 'multipart/form-data' } });\r\n      // fetch fresh messages to ensure attachments (signed URLs) are present immediately\r\n        try {\r\n          const { data: fresh } = await api.get(`/messages/${selectedChat._id}`, { headers });\r\n          const norm = (fresh || []).map(m => ({\r\n            _id: m._id,\r\n            content: m.message || '',\r\n            timestamp: m.createdAt,\r\n            isOwn: m.senderId === userId,\r\n            reactions: m.reactions || [],\r\n            seen: m.seen || [],\r\n            attachments: m.attachments || [],\r\n    replyTo: m.replyTo || null,\r\n    forwardOf: m.forwardOf || null,\r\n  senderId: m.senderId || (m.sender && m.sender._id) || null,\r\n          }));\r\n          // After sending we want the server's canonical set (with attachment URLs).\r\n          // Replace the current messages for this chat with the normalized server result.\r\n      setMessages(() => norm);\r\n      setReplyTo(null);\r\n        } catch (e) {\r\n        // ignore fetch error; socket will deliver the message\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to send:', err);\r\n      setMessages(ms => ms.filter(m => m._id !== tempId));\r\n      setPendingFiles(prev => [...filesNow, ...prev]);\r\n      setNewMessage(content);\r\n    }\r\n  };\r\n\r\n  const toggleReaction = async (msg, emoji) => {\r\n    const getUid = (r) => (typeof r.userId === 'string' ? r.userId : r.userId?._id);\r\n    const mine = msg.reactions.find(r => getUid(r) === userId);\r\n    if (mine && mine.emoji === emoji) {\r\n      await api.delete(`/messages/${msg._id}/reactions`, { data: { userId, emoji }, headers });\r\n    } else {\r\n      if (mine) await api.delete(`/messages/${msg._id}/reactions`, { data: { userId, emoji: mine.emoji }, headers });\r\n      await api.post(`/messages/${msg._id}/reactions`, { userId, emoji }, { headers });\r\n    }\r\n  };\r\n\r\n  const handleKeyDown = (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } };\r\n  const handleLogout = () => { localStorage.clear(); navigate('/'); };\r\n\r\n  const handleUserSearch = (e) => {\r\n    const q = e.target.value.toLowerCase();\r\n    setUserSearch(q);\r\n    setFilteredUsers(availableUsers.filter(u => getDisplayName(u).toLowerCase().includes(q)));\r\n  };\r\n  const toggleSelectUser = (id) => setSelectedUsers(s => s.includes(id) ? s.filter(x => x !== id) : [...s, id]);\r\n  const createGroup = async () => {\r\n    const members = [userId, ...selectedUsers];\r\n    const { data: newChat } = await api.post('/chats', { name: groupName, users: members, isGroup: true }, { headers });\r\n    // Inject synthetic lastMessage if backend returns none\r\n    let enriched = newChat;\r\n    if (enriched && !enriched.lastMessage) {\r\n      let created = enriched.createdAt || enriched.updatedAt;\r\n      if (!created && /^[a-f0-9]{24}$/.test(enriched._id || '')) {\r\n        created = new Date(parseInt(enriched._id.substring(0,8),16) * 1000).toISOString();\r\n      }\r\n      let tsNum = 0;\r\n      if (created) tsNum = typeof created === 'number' ? created : (Date.parse(created) || 0);\r\n      if (!tsNum) tsNum = Date.now();\r\n      enriched = { ...enriched, lastMessage: { content: '', timestamp: created || new Date().toISOString(), tsNum, seq: ++seqRef.current, sender: null, attachments: [], seen: [] } };\r\n    }\r\n    // Optimistically add to list at correct sorted position\r\n    setChatList(list => sortChatList([enriched, ...list.filter(c => c._id !== enriched._id)]));\r\n    setShowGroupModal(false); setGroupName(''); setUserSearch(''); setSelectedUsers([]);\r\n    setSelectedChat(enriched); navigate(`/${baseSegment}/chat/${enriched._id}`);\r\n    // Refresh from server (keeps order but ensures any server-side fields are present)\r\n    reloadChats();\r\n  };\r\n\r\n  const startEditGroupName = () => { setNewGroupName(selectedChat.name); setEditingGroupName(true); };\r\n  const saveGroupName = async () => {\r\n    if (!newGroupName.trim() || newGroupName === selectedChat.name) { setEditingGroupName(false); return; }\r\n    try {\r\n      await api.put(`/chats/${selectedChat._id}`, { name: newGroupName.trim() }, { headers });\r\n      setSelectedChat(prev => ({ ...prev, name: newGroupName.trim() }));\r\n      await reloadChats();\r\n      setEditingGroupName(false);\r\n    } catch (e) { console.error(e); }\r\n  };\r\n  const cancelEditGroupName = () => { setEditingGroupName(false); setNewGroupName(''); };\r\n\r\n  const loadAvailableMembers = async () => {\r\n    try {\r\n      const { data } = await api.get('/users?limit=100', { headers });\r\n      const currentIds = selectedChat.users.map(u => u._id);\r\n      setAvailableMembers((data || []).filter(u => !currentIds.includes(u._id)));\r\n      setSelectedNewMembers([]);\r\n    } catch (e) { console.error(e); }\r\n  };\r\n  const addMembersToGroup = async () => {\r\n    if (!selectedNewMembers.length) return;\r\n    try {\r\n      const updatedUsers = [...selectedChat.users.map(u => u._id), ...selectedNewMembers];\r\n      try {\r\n        await api.put(`/chats/${selectedChat._id}`, { users: updatedUsers }, { headers });\r\n      } catch (err) {\r\n        if (err?.response?.status === 403) {\r\n          alert(err.response.data?.error || 'You are not allowed to add members.');\r\n          return;\r\n        }\r\n        throw err;\r\n      }\r\n      // Optimistic local update (avoid extra GET that can race with server)\r\n      setSelectedChat(prev => prev ? { ...prev, users: Array.from(new Set([...prev.users.map(u => u._id ? u._id : u), ...selectedNewMembers]))\r\n        .map(id => prev.users.find(u => u._id === id) || { _id: id, name: '' }) } : prev);\r\n      await reloadChats();\r\n      setShowAddMembers(false); setSelectedNewMembers([]);\r\n    } catch (e) {\r\n      console.error('Add members failed:', e);\r\n    }\r\n  };\r\n  const removeMemberFromGroup = async (memberId) => {\r\n    if (!selectedChat?.isGroup) return;\r\n    if (memberId === userId) return; // don't remove self via this button\r\n    // Prevent rapid double-clicks causing duplicate requests\r\n    if (removeMemberFromGroup._busy) return;\r\n    removeMemberFromGroup._busy = true;\r\n    try {\r\n      let removed = false;\r\n      try {\r\n        const { data } = await api.post(`/chats/${selectedChat._id}/remove-member`, { memberId }, { headers });\r\n        if (data?.chat) { setSelectedChat(data.chat); removed = true; }\r\n        else removed = true; // assume success if no error thrown\r\n      } catch (err) {\r\n        // Only fallback if explicit 403 from remove-member (lack of creator rights)  otherwise rethrow\r\n        if (err?.response?.status === 403) {\r\n          try {\r\n            const remaining = selectedChat.users.filter(u => u._id !== memberId).map(u => u._id);\r\n            await api.put(`/chats/${selectedChat._id}`, { users: remaining }, { headers });\r\n            removed = true;\r\n          } catch (putErr) {\r\n            throw putErr; // surface final failure\r\n          }\r\n        } else {\r\n          throw err;\r\n        }\r\n      }\r\n      if (removed) {\r\n        // Locally filter out the removed member to avoid a GET that may 403 during propagation\r\n        setSelectedChat(prev => prev ? { ...prev, users: prev.users.filter(u => u._id !== memberId) } : prev);\r\n        await reloadChats();\r\n      }\r\n    } catch (e) {\r\n      if (e?.response?.status === 403) {\r\n        // Only show if we truly failed to remove\r\n        alert(e.response.data?.error || 'You are not allowed to remove members from this group.');\r\n      }\r\n      console.error('Remove member failed:', e);\r\n    } finally {\r\n      removeMemberFromGroup._busy = false;\r\n    }\r\n  };\r\n\r\n  // Leave group (reassign creator handled server-side)\r\n  const handleLeaveGroup = async () => {\r\n    if (!selectedChat?.isGroup) return;\r\n    const ok = window.confirm('Leave this group chat?');\r\n    if (!ok) return;\r\n    try {\r\n      await api.post(`/chats/${selectedChat._id}/leave`, {}, { headers });\r\n      // Remove from local list and clear selection\r\n      setChatList(list => list.filter(c => c._id !== selectedChat._id));\r\n      setSelectedChat(null);\r\n      navigate(`/${baseSegment}/chat`);\r\n    } catch (e) {\r\n      alert(e?.response?.data?.error || 'Failed to leave group');\r\n    }\r\n  };\r\n\r\n  const activeList = searchQuery.trim() ? searchResults : chatList;\r\n  // Derive unique members for selected group chat (avoid duplicates / missing _id entries inflating count)\r\n  const uniqueMembers = useMemo(() => {\r\n    if (!selectedChat?.isGroup) return [];\r\n    return (selectedChat.users || []).reduce((acc, curr) => {\r\n      if (!curr?._id) return acc; // skip invalid\r\n      if (!acc.map.has(curr._id)) { acc.map.set(curr._id, true); acc.list.push(curr); }\r\n      return acc;\r\n    }, { map: new Map(), list: [] }).list;\r\n  }, [selectedChat]);\r\n\r\n  return (\r\n    <>\r\n    <div className=\"area-chat-wrapper\">\r\n      {/* GROUP MODAL */}\r\n      {showGroupModal && (\r\n        <div className=\"modal-overlay\">\r\n          <div className=\"modal\">\r\n            <h3>Create Group Chat</h3>\r\n            <label>Group Name</label>\r\n            <input className=\"modal-input\" placeholder=\"Enter a group name\" value={groupName} onChange={(e) => setGroupName(e.target.value)} />\r\n            <label>Search users</label>\r\n            <input className=\"modal-input\" placeholder=\"Search for users\" value={userSearch} onChange={handleUserSearch} />\r\n            <div className=\"user-list\">\r\n              {filteredUsers.map((u, i) => (\r\n                <label key={`${u._id}-${i}`} className=\"user-item\">\r\n                  <input type=\"checkbox\" checked={selectedUsers.includes(u._id)} onChange={() => toggleSelectUser(u._id)} />\r\n                  {getDisplayName(u)}\r\n                </label>\r\n              ))}\r\n            </div>\r\n            <div className=\"modal-buttons\">\r\n              <button className=\"btn-create\" onClick={createGroup} disabled={!groupName || !selectedUsers.length}>Create</button>\r\n              <button className=\"btn-cancel\" onClick={() => setShowGroupModal(false)}>Cancel</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {/* FORWARD MODAL */}\r\n      {showForwardModal && (\r\n        <div className=\"modal-overlay\">\r\n          <div className=\"modal\" style={{ maxWidth:420 }}>\r\n            <h3>Forward Message</h3>\r\n            <div style={{ fontSize:12, marginBottom:8, opacity:.7 }}>Select chats or users</div>\r\n            <input\r\n              style={{ width:'100%', marginBottom:8, padding:'6px 8px', border:'1px solid #d1d5db', borderRadius:6, fontSize:13 }}\r\n              placeholder=\"Search users...\"\r\n              value={forwardSearch}\r\n              onChange={(e)=>setForwardSearch(e.target.value)}\r\n            />\r\n            <div className=\"user-list\" style={{ maxHeight:260, overflowY:'auto', display:'flex', flexDirection:'column', gap:4 }}>\r\n              {unifiedForwardList.map(entry => {\r\n                const checked = forwardTargets.some(t => t.type===entry.type && t.id===entry.id);\r\n                return (\r\n                  <label key={entry.key} className=\"user-item\" style={{ display:'flex', alignItems:'center', gap:6 }}>\r\n                    <input type=\"checkbox\" checked={checked} onChange={()=>toggleForwardTarget({ type:entry.type, id:entry.id })} />\r\n                    <span style={{ fontSize:12 }}>\r\n                      {entry.isGroup && ' '}{entry.name}\r\n                      {entry.type === 'user' && !entry.isGroup && ' '}\r\n                    </span>\r\n                  </label>\r\n                );\r\n              })}\r\n              {unifiedForwardList.length === 0 && (\r\n                <div style={{ fontSize:12, opacity:.5 }}>No results</div>\r\n              )}\r\n            </div>\r\n            <div className=\"modal-buttons\">\r\n              <button className=\"btn-create\" disabled={!forwardTargets.length} onClick={() => {\r\n                if (!forwardMessage) return;\r\n                const run = async () => {\r\n                  try {\r\n                    const chatIds = new Set();\r\n                    // Resolve user targets to (existing or new) DM chats\r\n                    for (const t of forwardTargets) {\r\n                      if (t.type === 'chat') { chatIds.add(t.id); continue; }\r\n                      if (t.type === 'user') {\r\n                        let existing = chatList.find(c => !c.isGroup && c.users.some(u => u._id === t.id) && c.users.some(u => u._id === userId));\r\n                        if (!existing) {\r\n                          try { const { data: dm } = await api.post('/chats', { users:[userId, t.id] }, { headers }); existing = dm; } catch {}\r\n                        }\r\n                        if (existing?._id) chatIds.add(existing._id);\r\n                      }\r\n                    }\r\n                    for (const cid of Array.from(chatIds)) {\r\n                      const atts = Array.isArray(forwardMessage.attachments) ? forwardMessage.attachments : [];\r\n                      if (atts.length) {\r\n                        const fd = new FormData();\r\n                        fd.append('conversation', cid);\r\n                        if (forwardMessage.content) fd.append('content', forwardMessage.content);\r\n                        fd.append('forwardOf', forwardMessage._id);\r\n                        for (const att of atts) {\r\n                          if (!att?.url) continue;\r\n                          try {\r\n                            const res = await fetch(att.url);\r\n                            const blob = await res.blob();\r\n                            const nameGuess = att.name || att.url.split('?')[0].split('/').pop() || 'attachment';\r\n                            const file = new File([blob], nameGuess, { type: blob.type || att.mime || 'application/octet-stream' });\r\n                            fd.append('files', file);\r\n                          } catch {}\r\n                        }\r\n                        await api.post('/messages', fd, { headers: { ...headers, 'Content-Type': 'multipart/form-data' } });\r\n                      } else {\r\n                        await api.post('/messages', { conversation: cid, content: forwardMessage.content, forwardOf: forwardMessage._id }, { headers });\r\n                      }\r\n                    }\r\n                    setShowForwardModal(false); setForwardMessage(null); setForwardTargets([]);\r\n                    if (!Array.from(chatIds).includes(selectedChat?._id)) reloadChats();\r\n                  } catch { alert('Forward failed'); }\r\n                };\r\n                run();\r\n              }}>Forward ({forwardTargets.length})</button>\r\n              <button className=\"btn-cancel\" onClick={() => { setShowForwardModal(false); setForwardMessage(null); setForwardTargets([]); }}>Cancel</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {/* Context action popover */}\r\n      {actionMenu.open && (\r\n        <div\r\n          className=\"msg-action-popover\"\r\n          style={{ position:'fixed', top: actionMenu.y - 10, left: actionMenu.x, transform:'translate(-50%, -100%)', background:'#18191a', color:'#e4e6eb', padding:'6px 0', borderRadius:12, minWidth:140, boxShadow:'0 8px 24px rgba(0,0,0,.4)', zIndex:2000, fontSize:13 }}\r\n        >\r\n          <div style={{ position:'absolute', bottom:-6, left:'50%', transform:'translateX(-50%)', width:0, height:0, borderLeft:'6px solid transparent', borderRight:'6px solid transparent', borderTop:'6px solid #18191a' }} />\r\n          {(() => {\r\n            const msg = messages.find(m => m._id === actionMenu.msgId);\r\n            if (!msg) return null;\r\n            const close = () => setActionMenu(m => ({ ...m, open:false }));\r\n            return (\r\n              <>\r\n                {msg.isOwn && (\r\n                  <button className=\"popover-item\" onClick={()=>{ close(); if(window.confirm('Unsend this message?')) api.delete(`/messages/${msg._id}`, { headers }).then(()=> setMessages(ms=>ms.filter(m=>m._id!==msg._id))); }}>\r\n                    Unsend\r\n                  </button>\r\n                )}\r\n                <button className=\"popover-item\" onClick={()=>{ close(); setForwardMessage(msg); setForwardTargets([]); setShowForwardModal(true); }}>\r\n                  Forward\r\n                </button>\r\n              </>\r\n            );\r\n          })()}\r\n        </div>\r\n      )}\r\n\r\n  {/* Unified header; for HR pass explicit nav to avoid blanks during migration */}\r\n  <AppHeader \r\n    roleSegment={baseSegment === 'hr' ? 'hr' : baseSegment}\r\n    overrideNav={baseSegment === 'hr' ? [\r\n      { to: '/hr/dash', label: 'Dashboard', icon: <FaTachometerAlt/>, match: '/hr/dash' },\r\n      { to: '/hr/chat', label: 'Chat', icon: <FaComments/>, match: '/hr/chat' },\r\n      { to: '/hr/mlist', label: 'Manpower', icon: <FaUsers/>, match: '/hr/mlist' },\r\n      { to: '/hr/movement', label: 'Movement', icon: <FaExchangeAlt/>, match: '/hr/movement' },\r\n      { to: '/hr/project-records', label: 'Projects', icon: <FaProjectDiagram/>, match: '/hr/project-records' },\r\n      { to: '/hr/attendance', label: 'Attendance', icon: <FaCalendarAlt/>, match: '/hr/attendance' }\r\n    ] : undefined}\r\n  />\r\n\r\n      {/* BODY */}\r\n      <div className=\"area-chat-content\">\r\n        {/* SIDEBAR */}\r\n        <div className=\"modern-sidebar\">\r\n          <div className=\"modern-sidebar-header\">\r\n            <div className=\"header-top\">\r\n              <h2>Chats</h2>\r\n              <button className=\"group-chat-btn modern-new-group-btn\" onClick={() => setShowGroupModal(true)}>+ New Group</button>\r\n            </div>\r\n            <input className=\"modern-search-input\" placeholder=\"Search chats or users\" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} />\r\n          </div>\r\n          <div className=\"modern-chat-list\">\r\n            {(searchQuery.trim() ? searchResults : chatList).length === 0 ? (\r\n              <div className=\"modern-no-chats\">No chats found.</div>\r\n            ) : (\r\n              (searchQuery.trim() ? searchResults : chatList).map((item) => {\r\n                const isUser = item.type === 'user';\r\n                const isGroup = item.isGroup;\r\n                const other = isGroup ? null : item.users?.find(u => u._id !== userId) || {};\r\n                const name = isUser ? getDisplayName(item) : isGroup ? item.name : getDisplayName(other);\r\n                // Improved preview logic: prioritize last message content, then last non-system message, else empty\r\n                let preview = '';\r\n                if (item.lastMessage?.content) {\r\n                  preview = item.lastMessage.content;\r\n                } else if (Array.isArray(item.messages) && item.messages.length) {\r\n                  const lastUserMsg = [...item.messages].reverse().find(m => !m.system && m.content);\r\n                  preview = lastUserMsg?.content || '';\r\n                }\r\n                // Attachment indicator if no text OR last event is attachments\r\n                const lastAttachments = item.lastMessage?.attachments || (Array.isArray(item.messages) ? [...item.messages].reverse().find(m=>Array.isArray(m.attachments)&&m.attachments.length)?.attachments : []);\r\n                if ((!preview || /^https?:\\/\\//.test(preview)) && lastAttachments && lastAttachments.length) {\r\n                  // Determine if all attachments are images\r\n                  const allImages = lastAttachments.every(a => (a?.mimetype||'').startsWith('image/'));\r\n                  if (allImages) {\r\n                    const count = lastAttachments.length;\r\n                    preview = count === 1 ? ' Photo' : ` ${count} Photos`;\r\n                  } else {\r\n                    const count = lastAttachments.length;\r\n                    const fileWord = count === 1 ? 'File' : 'Files';\r\n                    preview = count === 1 ? ' Attachment' : ` ${count} ${fileWord}`;\r\n                  }\r\n                }\r\n                if (!preview) preview = '(no messages yet)';\r\n\r\n                // Sender prefix (show who sent last message). For own message show \"You:\".\r\n                let senderPrefix = '';\r\n                if (item.lastMessage && (preview !== '(no messages yet)')) {\r\n                  const rawSender = item.lastMessage.sender;\r\n                  const senderId = typeof rawSender === 'string' ? rawSender : (rawSender && rawSender._id);\r\n                  if (senderId) {\r\n                    if (String(senderId) === String(userId)) {\r\n                      senderPrefix = 'You: ';\r\n                    } else {\r\n                      // find sender in chat users list\r\n                      const senderUser = (item.users || []).find(u => u._id === senderId);\r\n                      if (senderUser) {\r\n                        const disp = getDisplayName(senderUser) || '';\r\n                        senderPrefix = (disp.split(' ')[0] || disp) + ': ';\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n\r\n                preview = senderPrefix + preview;\r\n                preview = preview.length > 60 ? preview.slice(0,57) + '' : preview;\r\n                const timeStr = item.lastMessage?.timestamp ? formatTime(item.lastMessage.timestamp) : '';\r\n                // Determine unread: lastMessage exists and either (a) current user not in seen array OR (b) lastMessage.sender not current user and timestamp newer than a stored read marker (if provided)\r\n                const lastMsg = item.lastMessage;\r\n                const seenArr = Array.isArray(lastMsg?.seen) ? lastMsg.seen : [];\r\n                // Unread: lastMessage exists, not by me, and (a) I haven't seen or (b) its timestamp newer than stored lastRead\r\n                let isUnread = false;\r\n                if (lastMsg && lastMsg.sender !== userId) {\r\n                  const hasSeenArr = seenArr.map(s=>String(s.userId||s._id||s)).includes(String(userId));\r\n                  const lmTime = (typeof lastMsg.timestamp === 'number' ? lastMsg.timestamp : (lastMsg.timestamp ? Date.parse(lastMsg.timestamp) : lastMsg.tsNum)) || 0;\r\n                  const lr = lastRead[item._id] || 0;\r\n                  if (lr && lmTime <= lr) {\r\n                    isUnread = false;\r\n                  } else {\r\n                    isUnread = (!hasSeenArr) || (lmTime > lr);\r\n                  }\r\n                }\r\n                // Highlight brand new chats (no messages yet) as 'new'\r\n                const isNewChat = !lastMsg;\r\n                // Presence: assume for 1-1 chat we can check other.online || other.isOnline; for groups show nothing for now\r\n                const isOnline = !isGroup && other && onlineUsers.has(String(other._id));\r\n                return (\r\n                  <div\r\n                    key={item._id}\r\n                    className={`modern-chat-item ${selectedChat?._id === item._id ? 'active' : ''} ${isUnread ? 'unread' : ''} ${isNewChat ? 'new-chat' : ''}`}\r\n                    onClick={() => openChat(item)}\r\n                    style={isUnread ? { background:'#eff6ff' } : undefined}\r\n                  >\r\n                    <div className=\"modern-chat-avatar\" style={{ position:'relative' }}>\r\n                      {isGroup ? <FaUsers /> : name.charAt(0).toUpperCase()}\r\n                      {!isGroup && (\r\n                        <span\r\n                          className=\"presence-dot\"\r\n                          style={{\r\n                            position:'absolute',\r\n                            bottom: -2,\r\n                            right: -2,\r\n                            width:10,\r\n                            height:10,\r\n                            borderRadius:'50%',\r\n                            background: isOnline ? '#10b981' : '#9ca3af',\r\n                            border:'2px solid #fff',\r\n                            boxSizing:'content-box'\r\n                          }}\r\n                          title={isOnline ? 'Online' : 'Offline'}\r\n                        />\r\n                      )}\r\n                    </div>\r\n                    <div className=\"modern-chat-info\">\r\n                      <div className=\"modern-chat-name\" style={isUnread ? { fontWeight:600 } : undefined}>\r\n                        {name}\r\n                        {isNewChat && <span style={{ marginLeft:6, fontSize:10, background:'#2563eb', color:'#fff', padding:'2px 6px', borderRadius:12 }}>NEW</span>}\r\n                      </div>\r\n                      <div className=\"modern-chat-preview\" style={isUnread ? { fontWeight:500, color:'#1e3a8a' } : undefined}>{preview}</div>\r\n                    </div>\r\n                    {timeStr && <div className=\"modern-chat-time\" style={isUnread ? { fontWeight:600 } : undefined}>{timeStr}</div>}\r\n                    {isUnread && <div style={{ width:8, height:8, borderRadius:'50%', background:'#2563eb', marginLeft:8 }} />}\r\n                  </div>\r\n                );\r\n              })\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* CHAT WINDOW */}\r\n        <div className=\"modern-chat-section\">\r\n          <div className=\"modern-chat-wrapper\">\r\n            <div className=\"modern-chat-main\">\r\n              {!selectedChat ? (\r\n                <div className=\"modern-no-chat-selected\">Select a chat to start messaging</div>\r\n              ) : (\r\n                <>\r\n                  <div className=\"modern-chat-header\">\r\n                    <div className=\"modern-chat-header-left\">\r\n                      <div className=\"modern-chat-header-avatar\">\r\n                        {selectedChat.isGroup\r\n                          ? <FaUsers />\r\n                          : getDisplayName(selectedChat.users.find(u => u._id !== userId)).charAt(0).toUpperCase()}\r\n                      </div>\r\n                      <div className=\"modern-chat-header-info\">\r\n                        <h3>{selectedChat.isGroup ? selectedChat.name : getDisplayName(selectedChat.users.find(u => u._id !== userId))}</h3>\r\n                        <div className=\"message-search-inline\" style={{ display:'flex', gap:4, alignItems:'center', marginTop:4 }}>\r\n                          <div style={{ position:'relative', display:'flex', alignItems:'center', background:'#f1f3f6', borderRadius:16, padding:'2px 6px' }}>\r\n                            <FaSearch style={{ fontSize:12, opacity:.6 }} />\r\n                            <input\r\n                              style={{ border:'none', outline:'none', background:'transparent', fontSize:12, padding:'2px 4px', width:140 }}\r\n                              placeholder=\"Search in chat\"\r\n                              value={messageSearch}\r\n                              onChange={(e)=>setMessageSearch(e.target.value)}\r\n                            />\r\n                            {messageSearch && <FaTimes style={{ cursor:'pointer', fontSize:12, opacity:.6 }} onClick={()=>setMessageSearch('')} />}\r\n                          </div>\r\n                          {messageSearch && (\r\n                            <div style={{ display:'flex', gap:4, alignItems:'center' }}>\r\n                              <button disabled={!searchMatches.length} onClick={()=>gotoMatch(-1)} className=\"mini-nav-btn\" title=\"Previous\"><FaArrowUp /></button>\r\n                              <button disabled={!searchMatches.length} onClick={()=>gotoMatch(1)} className=\"mini-nav-btn\" title=\"Next\"><FaArrowDown /></button>\r\n                              <span style={{ fontSize:11, opacity:.7 }}>{searchMatches.length ? (searchIndex+1) : 0}/{searchMatches.length}</span>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <button className=\"modern-info-btn\" onClick={() => setShowInfoSidebar(s => !s)}>i</button>\r\n                  </div>\r\n\r\n                  {/* Reply banner relocated to input container for consistency */}\r\n\r\n                  {/* Messages */}\r\n                  <div className=\"modern-chat-messages\">\r\n                    {loadingMessages ? (\r\n                      <div className=\"messages-loading\">Loading messages</div>\r\n              ) : (\r\n                // filter out messages that have no visible content to avoid blank bubbles\r\n                dedupedMessages\r\n                  .filter(m => {\r\n                    // Only render if there is actual visible content (text or attachments).\r\n                    // Avoid showing blank bubbles that only have metadata (seen/reactions).\r\n                    const hasText = typeof m.content === 'string' && m.content.trim().length > 0;\r\n                    const hasAttachments = Array.isArray(m.attachments) && m.attachments.length > 0;\r\n                    return hasText || hasAttachments;\r\n                  })\r\n                  .map((msg, idx) => {\r\n                        // Determine if we need to show sender name (group chats, not own message, and previous message different sender)\r\n                        let showSenderName = false;\r\n                        let senderName = '';\r\n                        if (selectedChat.isGroup && !msg.isOwn) {\r\n                          const prev = dedupedMessages[idx - 1];\r\n                          const prevSender = prev ? (prev.senderId || (prev.isOwn ? userId : prev.senderId)) : null;\r\n                          const thisSender = msg.senderId || (msg.isOwn ? userId : msg.senderId);\r\n                          showSenderName = !prev || prevSender !== thisSender;\r\n                          if (msg.senderId) {\r\n                            // find user in chat list or selectedChat users\r\n                            const u = (selectedChat.users || []).find(u => u._id === msg.senderId);\r\n                            if (u) senderName = getDisplayName(u);\r\n                          }\r\n                          if (!senderName && msg.forwardOf && msg.forwardOf?.senderId) {\r\n                            const u2 = (selectedChat.users || []).find(u => u._id === msg.forwardOf.senderId);\r\n                            if (u2) senderName = getDisplayName(u2);\r\n                          }\r\n                        }\r\n                        const senderUser = getMessageSenderUser(msg);\r\n                        if(!senderName && senderUser) senderName = getDisplayName(senderUser);\r\n                        const initials = getInitials(senderName || (msg.isOwn ? userName : 'User'));\r\n                        // Avatar should appear only on the LAST message of a consecutive block\r\n                        const prevMsg = dedupedMessages[idx - 1];\r\n                        const nextMsg = dedupedMessages[idx + 1];\r\n                        const prevSenderSame = prevMsg && (prevMsg.senderId || (prevMsg.isOwn? userId: prevMsg.senderId)) === (msg.senderId || (msg.isOwn? userId: msg.senderId));\r\n                        const nextSenderSame = nextMsg && (nextMsg.senderId || (nextMsg.isOwn? userId: nextMsg.senderId)) === (msg.senderId || (msg.isOwn? userId: msg.senderId));\r\n                        // collapseAvatar true means we hide it here (not last in block)\r\n                        const collapseAvatar = nextSenderSame;\r\n                        const isOnline = senderUser && onlineUsers instanceof Set && onlineUsers.has(senderUser._id);\r\n                        const counts = msg.reactions.reduce((a, r) => { a[r.emoji] = (a[r.emoji] || 0) + 1; return a; }, {});\r\n                        const isLastOwn = msg.isOwn && idx === messages.length - 1;\r\n                        const seenByRecipient = isLastOwn && msg.seen?.length > 0;\r\n                        const seenNames = getSeenDisplayNames(msg.seen);\r\n                        const hasSeen = msg.seen?.length > 0;\r\n                        const isMostRecentSeen = hasSeen && (() => {\r\n                          if (!selectedChat.isGroup) return isLastOwn;\r\n                          const later = messages.slice(idx + 1);\r\n                          return !later.some(l => {\r\n                            if (!l.seen?.length) return false;\r\n                            const laterIds = l.seen.map(s => s.userId);\r\n                            const ids = msg.seen.map(s => s.userId);\r\n                            return ids.every(id => laterIds.includes(id));\r\n                          });\r\n                        })();\r\n\r\n                        const rawText = (msg.content || '').replace(/<[^>]+>/g,'');\r\n                        const hasSpaces = /\\s/.test(rawText);\r\n                        const isVeryLongUnbroken = rawText.length > 120 && !hasSpaces; // continuous string\r\n                        const bubbleMax = isVeryLongUnbroken ? 420 : 560; // narrower for unbroken\r\n                        return (\r\n                          <div key={`${String(msg._id)}-${idx}`} data-msg-index={idx} className={`modern-message-wrapper ${msg.isOwn ? 'own' : 'other'} ${searchMatches.includes(idx) ? 'search-hit' : ''}`}>\r\n                            <div className=\"msg-bubble-outer\">\r\n                              {!collapseAvatar ? (\r\n                                <div className={`msg-avatar-wrapper${isOnline ? ' presence-online':''}`}>\r\n                                  <div className={`msg-avatar${isOnline ? ' presence-online':''}`} aria-label={senderName}>{initials}</div>\r\n                                </div>\r\n                              ) : (\r\n                                <div className=\"msg-collapsed-spacer\" />\r\n                              )}\r\n                              <div className=\"msg-bubble-stack\">\r\n                                {showSenderName && senderName && selectedChat.isGroup && (\r\n                                  <div className={`group-sender-outside ${msg.isOwn ? 'own' : 'other'}`}>{senderName}</div>\r\n                                )}\r\n              <div className={`modern-message ${msg.isOwn ? 'own' : 'other'}`}\r\n                style={{ maxWidth: isVeryLongUnbroken ? 'min(64ch, 88%)' : 'min(88ch, 92%)', width:'fit-content', wordBreak: isVeryLongUnbroken ? 'break-all' : 'break-word', overflowWrap:'anywhere' }}>\r\n                                  <div className=\"modern-message-content\">\r\n                                {/* Forward label */}\r\n                                {msg.forwardOf && <div className=\"forward-label\" style={{ fontSize:10, opacity:.6, marginBottom:2 }}>Forwarded</div>}\r\n                                {/* Reply reference */}\r\n                                {msg.replyTo && (\r\n                                  <div className=\"reply-ref\" onClick={()=>{ const el = document.querySelector(`[data-reply-id='${msg.replyTo}']`) || document.querySelector(`[data-msg-index='${dedupedMessages.findIndex(m=>m._id===msg.replyTo)}']`); if(el) el.scrollIntoView({behavior:'smooth', block:'center'}); }} style={{ cursor:'pointer', background:'rgba(0,0,0,0.05)', borderLeft:'3px solid #4a68d4', padding:'4px 6px', borderRadius:4, fontSize:11, marginBottom:4 }}>\r\n                                    {(dedupedMessages.find(r => r._id === msg.replyTo)?.content || '[Original message]')?.slice(0,120)}\r\n                                  </div>\r\n                                )}\r\n                                {/* Text with highlight */}\r\n                                {msg.content && <div className=\"msg-text\" dangerouslySetInnerHTML={{ __html: highlightMessage(msg.content) }} />}\r\n\r\n                                {/* Attachments */}\r\n                                {Array.isArray(msg.attachments) && msg.attachments.length > 0 && (\r\n                                  <div className=\"msg-attachments\">\r\n                                    {msg.attachments.map((a, i) => {\r\n                                      const mime = a.mime || '';\r\n                                      const isImg = mime.startsWith('image/');\r\n                                      const isVid = mime.startsWith('video/');\r\n                                      const isAud = mime.startsWith('audio/');\r\n                                      const href  = a.url;\r\n\r\n                                        if (isImg) {\r\n                                          if (href) {\r\n                                            const idxInViewer = mediaImageIndexByUrl.get(href);\r\n                                            return (\r\n                                              <button\r\n                                                key={i}\r\n                                                type=\"button\"\r\n                                                className=\"att-link img\"\r\n                                                onClick={() => { if (typeof idxInViewer === 'number') openMediaViewer(idxInViewer); }}\r\n                                                style={{ border:'none', background:'transparent', padding:0, cursor:'pointer' }}\r\n                                              >\r\n                                                <img src={href} alt={a.name} className=\"att-image\" />\r\n                                              </button>\r\n                                            );\r\n                                          }\r\n                                          return <div key={i} className=\"att-placeholder\">Image (loading){a.name ? `: ${a.name}` : ''}</div>;\r\n                                        }\r\n                                        if (isVid) return (\r\n                                          href ? <div key={i} className=\"att-video\"><video src={href} controls /></div>\r\n                                              : <div key={i} className=\"att-placeholder\">Video (loading){a.name ? `: ${a.name}` : ''}</div>\r\n                                        );\r\n                                        if (isAud) return (\r\n                                          href ? <div key={i} className=\"att-audio\"><audio src={href} controls /></div>\r\n                                              : <div key={i} className=\"att-placeholder\">Audio (loading){a.name ? `: ${a.name}` : ''}</div>\r\n                                        );\r\n                                        return (\r\n                                          <a\r\n                                            key={i}\r\n                                            href={href || '#'}\r\n                                            download\r\n                                            target=\"_blank\"\r\n                                            rel=\"noopener noreferrer\"\r\n                                            className=\"att-doc\"\r\n                                          > <span style={{ overflow:'hidden', textOverflow:'ellipsis' }}>{a.name || 'File'}</span></a>\r\n                                        );\r\n                                    })}\r\n                                  </div>\r\n                                )}\r\n\r\n                                {/* Removed single-check seen tick per request */}\r\n                                  </div>\r\n\r\n                                  <div className=\"modern-message-time-row\">\r\n                                    <span className=\"msg-ts\">{formatTime(msg.timestamp)}</span>\r\n                                  </div>\r\n                                  {(selectedChat.isGroup ? (msg.seen?.length>0) : isMostRecentSeen) && (\r\n                                    <div className=\"message-seen-info below-ts\">\r\n                                      {selectedChat.isGroup ? (\r\n                                        (()=>{\r\n                                          const maxInline = 2;\r\n                                          const inline = seenNames.slice(0,maxInline);\r\n                                          const remainder = seenNames.length - inline.length;\r\n                                          return (\r\n                                            <button\r\n                                              type=\"button\"\r\n                                              className={`seen-indicator group-seen ${msg.isOwn ? 'own':'other'} seen-inline`}\r\n                                              onClick={() => setShowSeenDetails(showSeenDetails === msg._id ? null : msg._id)}\r\n                                              title={seenNames.length? `Seen by ${seenNames.join(', ')}` : 'No viewers yet'}\r\n                                            >\r\n                                              <span className=\"eye-icon\" aria-hidden=\"true\"></span>\r\n                                              {seenNames.length===0 && <span>Unseen</span>}\r\n                                              {seenNames.length>0 && (\r\n                                                <span className=\"seen-names-text\">\r\n                                                  {inline.join(', ')}{remainder>0 && ` +${remainder}`}\r\n                                                </span>\r\n                                              )}\r\n                                            </button>\r\n                                          );\r\n                                        })()\r\n                                      ) : (\r\n                                        <span className=\"seen-indicator dm-seen seen-inline\"><span className=\"eye-icon\" aria-hidden=\"true\"></span> Seen</span>\r\n                                      )}\r\n                                      {selectedChat.isGroup && showSeenDetails === msg._id && (\r\n                                        <div className=\"seen-details-tooltip\">\r\n                                          <div className=\"seen-users-list scrollable\">\r\n                                            {seenNames.map((name, index) => (\r\n                                              <div key={index} className=\"seen-user\">\r\n                                                <span className=\"seen-user-name\">{name}</span>\r\n                                              </div>\r\n                                            ))}\r\n                                            {!seenNames.length && (\r\n                                              <div className=\"seen-user\" style={{ opacity:.6 }}>No viewers yet</div>\r\n                                            )}\r\n                                          </div>\r\n                                        </div>\r\n                                      )}\r\n                                    </div>\r\n                                  )}\r\n\r\n                                  <div className=\"reactions-bar\">\r\n                                {Object.entries(counts).map(([e, c]) => {\r\n                                  const hasReacted = msg.reactions.some(r => (typeof r.userId === 'string' ? r.userId : r.userId?._id) === userId && r.emoji === e);\r\n                                  return (\r\n                                    <button key={e} className={`reaction-pill ${hasReacted ? 'reacted' : ''}`} onClick={() => toggleReaction(msg, e)} title={`${e} ${c > 1 ? `(${c})` : ''}`}>\r\n                                      <span className=\"reaction-emoji\">{e}</span>{c > 1 && <span className=\"reaction-count\">{c}</span>}\r\n                                    </button>\r\n                                  );\r\n                                })}\r\n                                  </div>\r\n\r\n                                  {/* Removed legacy hover-reactions-bar to avoid duplicate emoji palette (now using floating layer) */}\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                            {/* Floating outside toolbars (Messenger-style) */}\r\n                            <div className={`msg-floating-layer ${msg.isOwn ? 'own' : 'other'}`}>\r\n                              <div className=\"msg-reaction-palette\">\r\n                                {['','','','','',''].map(em => (\r\n                                  <button key={em} className=\"react-quick\" onClick={()=>toggleReaction(msg, em)} title={em}>{em}</button>\r\n                                ))}\r\n                              </div>\r\n                              <div className=\"msg-float-actions\">\r\n                                <button className=\"float-act-btn\" title=\"Reply\" onClick={()=>setReplyTo(msg)}><FaReply /></button>\r\n                                <button className=\"float-act-btn msg-action-trigger\" title=\"More\" onClick={(e)=>{ e.stopPropagation(); const rect=e.currentTarget.getBoundingClientRect(); setActionMenu({ open:true, msgId: msg._id, x: rect.left + rect.width/2, y: rect.top }); }}><FaEllipsisH /></button>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        );\r\n                      })\r\n                    )}\r\n                    <div ref={messagesEndRef} />\r\n                  </div>\r\n\r\n                  {/* Scroll-to-bottom */}\r\n                  {showScrollToBottom && (\r\n                    <button className=\"scroll-to-bottom-btn\" onClick={scrollToBottom} title=\"Scroll to latest messages\"></button>\r\n                  )}\r\n\r\n                  {/* INPUT */}\r\n                  <div className=\"modern-message-input-container\">\r\n                    {replyTo && (\r\n                      <div className=\"reply-banner\">\r\n                        Replying to: <strong>{(replyTo.content||'').slice(0,80) || '[attachment]'}</strong>\r\n                        <button className=\"reply-cancel\" onClick={()=>setReplyTo(null)}></button>\r\n                      </div>\r\n                    )}\r\n                    <div className=\"modern-input-wrapper\">\r\n                      {/* Attach */}\r\n                      <label className=\"modern-attach-btn\">\r\n                        <img src={require('../../assets/images/attach.png')} className=\"attach-icon\" alt=\"attach\" />\r\n                        <input\r\n                          type=\"file\"\r\n                          hidden\r\n                          multiple\r\n                          accept=\"image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.csv\"\r\n                          onChange={(e) => {\r\n                            const arr = Array.from(e.target.files || []);\r\n                            if (arr.length) setPendingFiles(prev => [...prev, ...arr]);\r\n                            e.target.value = '';\r\n                          }}\r\n                        />\r\n                      </label>\r\n\r\n                      {/* Pending previews */}\r\n                      {pendingFiles.length > 0 && (\r\n                        <div className=\"pending-previews\">\r\n                          {pendingFiles.map((f, i) => {\r\n                            const isImg = f.type.startsWith('image/');\r\n                            const isVid = f.type.startsWith('video/');\r\n                            const isAud = f.type.startsWith('audio/');\r\n                            return (\r\n                              <div key={`${f.name}-${i}`} className=\"pending-item\">\r\n                                {isImg && <img src={URL.createObjectURL(f)} alt={f.name} className=\"pending-thumb\" />}\r\n                                {isVid && <video src={URL.createObjectURL(f)} className=\"pending-thumb\" muted />}\r\n                                {isAud && <span className=\"pending-chip\"> {f.name}</span>}\r\n                                {!isImg && !isVid && !isAud && <span className=\"pending-chip\"> {f.name}</span>}\r\n                                <button className=\"remove-pending\" onClick={() => setPendingFiles(p => p.filter((_, idx) => idx !== i))}></button>\r\n                              </div>\r\n                            );\r\n                          })}\r\n                        </div>\r\n                      )}\r\n\r\n                      {/* Text */}\r\n                      <input\r\n                        className=\"modern-chat-input\"\r\n                        placeholder=\"Type your message here\"\r\n                        value={newMessage}\r\n                        onChange={(e) => {\r\n                          const val = e.target.value;\r\n                          setNewMessage(val);\r\n                          if (selectedChat && selectedChat._id) {\r\n                            setDrafts(prev => ({ ...prev, [selectedChat._id]: val }));\r\n                          }\r\n                        }}\r\n                        onKeyDown={handleKeyDown}\r\n                        onPaste={async (e) => {\r\n                          try {\r\n                            const items = e.clipboardData?.items || [];\r\n                            const files = [];\r\n                            for (const it of items) {\r\n                              if (it.kind === 'file' && it.type.startsWith('image/')) {\r\n                                const f = it.getAsFile();\r\n                                if (f) files.push(f);\r\n                              }\r\n                            }\r\n                            // If no file items but there is a textual image URL, attempt fetch & convert\r\n                            if (!files.length) {\r\n                              const text = e.clipboardData.getData('text/plain');\r\n                              if (text && /^https?:\\/\\//i.test(text) && /(\\.png|\\.jpe?g|\\.gif|\\.webp|\\.bmp|\\.svg)(\\?|#|$)/i.test(text)) {\r\n                                try {\r\n                                  const resp = await fetch(text, { mode: 'cors' });\r\n                                  const blob = await resp.blob();\r\n                                  if (blob && blob.type.startsWith('image/')) {\r\n                                    const fname = 'pasted-' + Date.now() + (blob.type === 'image/png' ? '.png' : '.img');\r\n                                    const file = new File([blob], fname, { type: blob.type });\r\n                                    files.push(file);\r\n                                  }\r\n                                } catch { /* ignore */ }\r\n                              }\r\n                            }\r\n                            if (files.length) {\r\n                              e.preventDefault();\r\n                              setPendingFiles(prev => [...prev, ...files]);\r\n                            }\r\n                          } catch { /* ignore */ }\r\n                        }}\r\n                      />\r\n\r\n                      {/* Emoji */}\r\n                      <button className=\"modern-emoji-btn\" onClick={() => setShowEmojiPicker(p => !p)}></button>\r\n                      {showEmojiPicker && (\r\n                        <div className=\"modern-emoji-picker\">\r\n                          {/* emoji-picker-react v4 passes (emojiData, event); use first param */}\r\n                          <EmojiPicker\r\n                            emojiStyle=\"native\"\r\n                            onEmojiClick={(emojiData) => setNewMessage(m => (m || '') + (emojiData?.emoji || ''))}\r\n                            height={360}\r\n                            width={300}\r\n                          />\r\n                        </div>\r\n                      )}\r\n\r\n                      {/* Send */}\r\n                      <button className=\"modern-send-btn\" onClick={sendMessage} disabled={!newMessage.trim() && pendingFiles.length === 0}>\r\n                        <FaPaperPlane />\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </>\r\n              )}\r\n            </div>\r\n\r\n            {/* INFO SIDEBAR */}\r\n            {showInfoSidebar && selectedChat && (\r\n              <div className=\"modern-contact-info\">\r\n                <div className=\"messenger-header\">\r\n                  <button className=\"close-details-btn\" onClick={() => setShowInfoSidebar(false)}></button>\r\n                  <h3>Chat Details</h3>\r\n                </div>\r\n\r\n                <div className=\"messenger-content\">\r\n                  <div className=\"profile-section\">\r\n                    <div className=\"profile-avatar-large\">\r\n                      {selectedChat.isGroup ? <FaUsers /> : getDisplayName(selectedChat.users.find(u => u._id !== userId)).charAt(0).toUpperCase()}\r\n                    </div>\r\n                    <div className=\"profile-info-large\">\r\n                      {editingGroupName ? (\r\n                        <div className=\"edit-name-container\">\r\n                          <input type=\"text\" value={newGroupName} onChange={(e) => setNewGroupName(e.target.value)} className=\"edit-name-input\" autoFocus />\r\n                          <div className=\"edit-name-actions\">\r\n                            <button className=\"save-name-btn\" onClick={saveGroupName}>Save</button>\r\n                            <button className=\"cancel-name-btn\" onClick={cancelEditGroupName}>Cancel</button>\r\n                          </div>\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"name-container\">\r\n                          <h4>{selectedChat.isGroup ? selectedChat.name : getDisplayName(selectedChat.users.find(u => u._id !== userId))}</h4>\r\n                          {selectedChat.isGroup && (\r\n                            <div className=\"edit-name-wrapper\">\r\n                              <button className=\"edit-name-btn\" onClick={startEditGroupName}><span>Edit</span></button>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      )}\r\n                      <p className=\"chat-type\">{selectedChat.isGroup ? 'Group Chat' : 'Direct Message'}</p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"actions-section\">\r\n                    {selectedChat.isGroup && (\r\n                      <>\r\n                        <button className=\"action-btn add-members-btn\" onClick={() => setShowAddMembers(true)}>\r\n                          <FaUserPlus />\r\n                        </button>\r\n                        <button className=\"action-btn leave-btn\" onClick={handleLeaveGroup}>\r\n                          <FaSignOutAlt />\r\n                        </button>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div className=\"details-section\">\r\n                    <h5>Details</h5>\r\n                    {selectedChat.isGroup ? (\r\n                      <>\r\n                        <div className=\"detail-item\"><span className=\"detail-label\">Group Name</span><span className=\"detail-value\">{selectedChat.name}</span></div>\r\n                        <div className=\"detail-item\"><span className=\"detail-label\">Members</span><span className=\"detail-value\">{uniqueMembers.length} people</span></div>\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <div className=\"detail-item\"><span className=\"detail-label\">Name</span><span className=\"detail-value\">{getDisplayName(selectedChat.users.find(u => u._id !== userId))}</span></div>\r\n                        <div className=\"detail-item\"><span className=\"detail-label\">Email</span><span className=\"detail-value\">{selectedChat.users.find(u => u._id !== userId)?.email}</span></div>\r\n                      </>\r\n                    )}\r\n\r\n                    {/* Media / Files tabs */}\r\n                    <div style={{ marginTop: 12 }}>\r\n                      <div className=\"info-tab-buttons\">\r\n                        <button className={showInfoTab === 'media' ? 'active' : ''} onClick={() => setShowInfoTab('media')}>Media</button>\r\n                        <button className={showInfoTab === 'files' ? 'active' : ''} onClick={() => setShowInfoTab('files')}>Files</button>\r\n                      </div>\r\n\r\n                      {showInfoTab === 'media' && (\r\n                        <div className=\"info-media-grid\" style={{ maxHeight:200, overflowY:'auto', display:'flex', flexWrap:'wrap', gap:6, paddingTop:6 }}>\r\n                          {mediaImages.map((a,i) => (\r\n                            <div key={i} className=\"info-media-item\" style={{ width:60, height:60, overflow:'hidden', borderRadius:4, cursor:'pointer', background:'#f8f9fa', border:'1px solid #e5e7eb' }} onClick={() => openMediaViewer(i)}>\r\n                              <img src={a.url} alt={a.name} style={{ width:'100%', height:'100%', objectFit:'cover' }} />\r\n                            </div>\r\n                          ))}\r\n                          {mediaImages.length === 0 && <div style={{ fontSize:12, opacity:0.6 }}>No images</div>}\r\n                        </div>\r\n                      )}\r\n\r\n                      {showInfoTab === 'files' && (\r\n                        <div className=\"info-files-list\" style={{ maxHeight:200, overflowY:'auto', display:'flex', flexDirection:'column', gap:4, paddingTop:6 }}>\r\n                          {messages.flatMap(m => (m.attachments || [])).filter(a => !(a.mime && a.mime.startsWith('image/'))).map((a, i) => (\r\n                            <a key={i} href={a.url} download style={{ textDecoration: 'none', color: '#0b5fff', fontSize:12, background:'#f8f9fa', padding:'4px 6px', borderRadius:6, border:'1px solid #e5e7eb' }}> {a.name}</a>\r\n                          ))}\r\n                          {messages.flatMap(m => (m.attachments || [])).filter(a => !(a.mime && a.mime.startsWith('image/'))).length === 0 && (\r\n                            <div style={{ fontSize:12, opacity:.6 }}>No files</div>\r\n                          )}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {selectedChat.isGroup && (\r\n                    <div className=\"members-section\">\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"members-header-toggle\"\r\n                        onClick={() => setShowMembersList(s => !s)}\r\n                        style={{\r\n                          display: 'flex', alignItems: 'center', justifyContent: 'space-between',\r\n                          width: '100%', background: 'transparent', border: 'none', padding: '6px 0',\r\n                          cursor: 'pointer', fontSize: 14, fontWeight: 600, color: '#222',\r\n                          borderBottom: '1px solid rgba(0,0,0,0.08)', marginTop: 12\r\n                        }}\r\n                      >\r\n                        <span style={{ display:'flex', alignItems:'center', gap:6 }}>\r\n                          <span style={{ letterSpacing: '.5px' }}>Members</span>\r\n                          <span style={{ fontSize:11, background:'#e5e7eb', padding:'2px 6px', borderRadius:12, color:'#111' }}>{uniqueMembers.length}</span>\r\n                        </span>\r\n                        <span style={{ fontSize: 12, opacity:.7 }}>{showMembersList ? '' : ''}</span>\r\n                      </button>\r\n                      {showMembersList && (\r\n                        <div className=\"members-list\">\r\n                          {(() => {\r\n                            return uniqueMembers.map((u, i) => {\r\n                              const isCreator = selectedChat.creator && (selectedChat.creator === u._id || selectedChat.creator?._id === u._id);\r\n                              return (\r\n                                <div key={`${u._id}-${i}`} className=\"member-item\">\r\n                                  <div className=\"member-avatar\">{getDisplayName(u).charAt(0).toUpperCase()}</div>\r\n                                  <div className=\"member-info\">\r\n                                    <span className=\"member-name\">{getDisplayName(u)}</span>\r\n                                    {u._id === userId && <span className=\"member-badge\">You</span>}\r\n                                    {isCreator && <span className=\"member-badge admin\">Admin</span>}\r\n                                  </div>\r\n                                  {u._id !== userId && (selectedChat.creator === userId || selectedChat.creator?._id === userId || selectedChat.users?.[0]?._id === userId) && (\r\n                                    <button className=\"remove-member-btn\" onClick={() => removeMemberFromGroup(u._id)} title=\"Remove member\"></button>\r\n                                  )}\r\n                                </div>\r\n                              );\r\n                            });\r\n                          })()}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Add Members Modal */}\r\n                {showAddMembers && (\r\n                  <div className=\"add-members-modal\">\r\n                    <div className=\"modal-header add-members-header\" style={{ display:'flex', flexDirection:'column', gap:8 }}>\r\n                      <div style={{ display:'flex', alignItems:'center', gap:12 }}>\r\n                        <h4 style={{ flex:1, margin:0 }}>Add Members</h4>\r\n                        <button className=\"close-modal-btn\" onClick={() => setShowAddMembers(false)} aria-label=\"Close\"></button>\r\n                      </div>\r\n                      <div className=\"search-row\" style={{ width:'100%' }}>\r\n                        <input\r\n                          type=\"text\"\r\n                          placeholder=\"Search users...\"\r\n                          className=\"search-input\"\r\n                          value={addMembersSearch}\r\n                          onChange={(e) => setAddMembersSearch(e.target.value)}\r\n                          style={{ width:'100%' }}\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"modal-content\">\r\n                      <div className=\"users-list\">\r\n                        {filteredAvailableMembers.map((u, i) => (\r\n                          <label key={`${u._id}-${i}`} className=\"user-checkbox-item\">\r\n                            <input\r\n                              type=\"checkbox\"\r\n                              checked={selectedNewMembers.includes(u._id)}\r\n                              onChange={() => {\r\n                                setSelectedNewMembers(prev =>\r\n                                  prev.includes(u._id) ? prev.filter(id => id !== u._id) : [...prev, u._id]\r\n                                );\r\n                              }}\r\n                            />\r\n                            <div className=\"user-avatar\">{getDisplayName(u).charAt(0).toUpperCase()}</div>\r\n                            <span className=\"user-name\">{getDisplayName(u)}</span>\r\n                          </label>\r\n                        ))}\r\n                        {filteredAvailableMembers.length === 0 && (\r\n                          <div style={{ fontSize:12, opacity:.6, padding:'4px 2px' }}>No users found.</div>\r\n                        )}\r\n                      </div>\r\n                      <div className=\"modal-actions\">\r\n                        <button className=\"add-members-submit-btn\" onClick={addMembersToGroup} disabled={selectedNewMembers.length === 0}>\r\n                          Add {selectedNewMembers.length} member{selectedNewMembers.length !== 1 ? 's' : ''}\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    {showMediaViewer && mediaImages[mediaViewerIndex] && (\r\n      <div className=\"media-viewer-overlay\" onClick={closeMediaViewer} style={{ position:'fixed', inset:0, background:'rgba(0,0,0,0.85)', zIndex:9999, display:'flex', alignItems:'center', justifyContent:'center', flexDirection:'column' }}>\r\n        <div style={{ position:'absolute', top:12, right:20, display:'flex', gap:12 }}>\r\n          <button onClick={(e) => { e.stopPropagation(); closeMediaViewer(); }} style={{ background:'rgba(255,255,255,0.15)', color:'#fff', border:'none', fontSize:24, width:44, height:44, borderRadius:'50%', cursor:'pointer' }}></button>\r\n        </div>\r\n        <button onClick={(e) => { e.stopPropagation(); navMedia(-1); }} style={{ position:'absolute', left:10, background:'rgba(255,255,255,0.15)', color:'#fff', border:'none', fontSize:32, width:48, height:72, borderRadius:6, cursor:'pointer' }}></button>\r\n        <img src={mediaImages[mediaViewerIndex].url} alt={mediaImages[mediaViewerIndex].name || 'Image'} onClick={(e) => e.stopPropagation()} style={{ maxWidth:'90%', maxHeight:'85%', objectFit:'contain', boxShadow:'0 0 12px rgba(0,0,0,0.6)', borderRadius:8 }} />\r\n        <button onClick={(e) => { e.stopPropagation(); navMedia(1); }} style={{ position:'absolute', right:10, background:'rgba(255,255,255,0.15)', color:'#fff', border:'none', fontSize:32, width:48, height:72, borderRadius:6, cursor:'pointer' }}></button>\r\n        <div style={{ marginTop:12, color:'#eee', fontSize:13 }} onClick={(e) => e.stopPropagation()}>{(mediaViewerIndex+1)} / {mediaImages.length} {mediaImages[mediaViewerIndex].name ? ' '+mediaImages[mediaViewerIndex].name : ''}</div>\r\n      </div>\r\n    )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AreaChat;\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { Link, useLocation, useNavigate } from 'react-router-dom';\r\nimport NotificationBell from '../NotificationBell';\r\nimport { FaTachometerAlt, FaComments, FaClipboardList, FaEye, FaProjectDiagram, FaBoxes, FaUsers, FaClipboardList as FaLogs, FaChartBar, FaExchangeAlt, FaCalendarAlt } from 'react-icons/fa';\r\nimport '../style/pic_style/PicHeader.css'; // reuse base styles\r\nimport api, { API_BASE_URL } from '../../api/axiosInstance';\r\nimport { SOCKET_URL, SOCKET_PATH } from '../../utils/socketConfig';\r\nimport { io } from 'socket.io-client';\r\n\r\n/**\r\n * Generic multi-role header modeled after PicHeader.\r\n * Props:\r\n *  - roleSegment: 'pic' | 'pm' | 'am' | 'ceo' | 'it' | ... (used for nav config)\r\n *  - extraRight: node (inserts before user menu)\r\n *  - extraLeft: node (inserts before logo on the left)\r\n *  - below: node (renders bar below header)\r\n *  - overrideNav: array to fully override nav items\r\n */\r\nconst ROLE_NAV = {\r\n  pic: (ctx)=> {\r\n    const ap = ctx.activeProject; return [\r\n      { to:'/pic', label:'Dashboard', icon:<FaTachometerAlt/>, match:'/pic' },\r\n      { to:'/pic/chat', label:'Chat', icon:<FaComments/>, match:'/pic/chat' },\r\n      { to:'/pic/requests', label:'Requests', icon:<FaClipboardList/>, match:'/pic/requests' },\r\n      ap && { to:`/pic/${ap._id}`, label:'View Project', icon:<FaEye/>, match:'/pic/'+ap?._id },\r\n      { to:'/pic/projects', label:'My Projects', icon:<FaProjectDiagram/>, match:'/pic/projects' }\r\n    ].filter(Boolean);\r\n  },\r\n  pm: (ctx)=> {\r\n    const ap = ctx.activeProject; return [\r\n      { to:'/pm', label:'Dashboard', icon:<FaTachometerAlt/>, match:'/pm' },\r\n      { to:'/pm/chat', label:'Chat', icon:<FaComments/>, match:'/pm/chat' },\r\n      ap && { to:'/pm/request/'+ap._id, label:'Material', icon:<FaBoxes/>, match:'/pm/request' },\r\n      { to:'/pm/manpower-list', label:'Manpower', icon:<FaUsers/>, match:'/pm/manpower-list' },\r\n  ap && { to:`/pm/viewprojects/${ap._id}`, label:'View Project', icon:<FaEye/>, match:'/pm/viewprojects/'+ap._id },\r\n  { to:'/pm/projects', label:'Projects', icon:<FaProjectDiagram/>, match:'/pm/projects' },\r\n    ].filter(Boolean);\r\n  },\r\n  am: (ctx)=> {\r\n    return [\r\n      { to:'/am', label:'Dashboard', icon:<FaTachometerAlt/>, match:'/am' },\r\n      { to:'/am/chat', label:'Chat', icon:<FaComments/>, match:'/am/chat' },\r\n      { to:'/am/matreq', label:'Material', icon:<FaBoxes/>, match:'/am/matreq' },\r\n      { to:'/am/viewproj', label:'Projects', icon:<FaProjectDiagram/>, match:'/am/viewproj' },\r\n    ];\r\n  },\r\n  ceo: ()=> [\r\n    { to:'/ceo/dash', label:'Dashboard', icon:<FaTachometerAlt/>, match:'/ceo/dash' },\r\n    { to:'/ceo/chat', label:'Chat', icon:<FaComments/>, match:'/ceo/chat' },\r\n    { to:'/ceo/manpower-requests', label:'Manpower', icon:<FaUsers/>, match:'/ceo/manpower-requests' },\r\n    { to:'/ceo/proj', label:'Projects', icon:<FaProjectDiagram/>, match:'/ceo/proj' },\r\n    { to:'/ceo/material-list', label:'Materials', icon:<FaBoxes/>, match:'/ceo/material-list' },\r\n    { to:'/ceo/audit-logs', label:'Audit Logs', icon:<FaClipboardList/>, match:'/ceo/audit-logs' },\r\n  ],\r\n  it: ()=> [\r\n    { to:'/it', label:'Dashboard', icon:<FaTachometerAlt/>, match:'/it' },\r\n    { to:'/it/chat', label:'Chat', icon:<FaComments/>, match:'/it/chat' },\r\n    { to:'/it/material-list', label:'Materials', icon:<FaBoxes/>, match:'/it/material-list' },\r\n    { to:'/it/manpower-list', label:'Manpower', icon:<FaUsers/>, match:'/it/manpower-list' },\r\n    { to:'/it/auditlogs', label:'Audit Logs', icon:<FaClipboardList/>, match:'/it/auditlogs' },\r\n  { to:'/it/projects', label:'Projects', icon:<FaProjectDiagram/>, match:'/it/projects' },\r\n  ],\r\n  staff: ()=> [\r\n    { to:'/staff', label:'Project', icon:<FaEye/>, match:'/staff' },\r\n    { to:'/staff/chat', label:'Chat', icon:<FaComments/>, match:'/staff/chat' },\r\n    { to:'/staff/all-projects', label:'My Projects', icon:<FaProjectDiagram/>, match:'/staff/all-projects' }\r\n  ],\r\n  hrsite: ()=> [\r\n    { to:'/hr-site/current-project', label:'Project', icon:<FaEye/>, match:'/hr-site/current-project' },\r\n    { to:'/hr-site/chat', label:'Chat', icon:<FaComments/>, match:'/hr-site/chat' },\r\n    { to:'/hr-site/all-projects', label:'My Projects', icon:<FaProjectDiagram/>, match:'/hr-site/all-projects' },\r\n  ],\r\n  hr: ()=> [\r\n    { to:'/hr/dash', label:'Dashboard', icon:<FaTachometerAlt/>, match:'/hr/dash' },\r\n    { to:'/hr/chat', label:'Chat', icon:<FaComments/>, match:'/hr/chat' },\r\n    { to:'/hr/mlist', label:'Manpower', icon:<FaUsers/>, match:'/hr/mlist' },\r\n    { to:'/hr/movement', label:'Movement', icon:<FaExchangeAlt/>, match:'/hr/movement' },\r\n    { to:'/hr/project-records', label:'Projects', icon:<FaProjectDiagram/>, match:'/hr/project-records' },\r\n    { to:'/hr/attendance', label:'Attendance', icon:<FaCalendarAlt/>, match:'/hr/attendance' }\r\n  ]\r\n};\r\n\r\nconst AppHeader = ({ roleSegment='pic', extraRight, extraLeft, overrideNav, showBelow=false, below, onLogout }) => {\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const stored = localStorage.getItem('user');\r\n  const user = stored? JSON.parse(stored) : null;\r\n  const userName = user?.name || 'User';\r\n  const roleName = (user?.role || user?.userType || user?.position || user?.designation || roleSegment).toString();\r\n  const [profileMenuOpen, setProfileMenuOpen] = useState(false);\r\n  const [activeProject, setActiveProject] = useState(null);\r\n  const [unreadChats, setUnreadChats] = useState(0);\r\n  const [socketRef, setSocketRef] = useState(null);\r\n\r\n  // Resolve Socket.IO base (reuse logic similar to AreaChat)\r\n  // Use centralized socket config\r\n\r\n  // lightweight socket just for chatUpdated events (avoid duplicating full AreaChat logic)\r\n  useEffect(()=>{\r\n    const token = localStorage.getItem('token');\r\n    let s;\r\n    try {\r\n      s = io(SOCKET_URL, { path: SOCKET_PATH, transports:['websocket','polling'], auth:{ userId: user?._id } });\r\n      setSocketRef(s);\r\n    } catch {}\r\n    const handle = (payload) => {\r\n      if(!payload || !payload.chatId) return; // just refetch counts lazily\r\n      fetchUnread();\r\n    };\r\n    if (s) s.on('chatUpdated', handle);\r\n    return ()=>{ if (s) { s.off('chatUpdated', handle); s.disconnect(); } };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [user?._id]);\r\n\r\n  const fetchUnread = async () => {\r\n    try {\r\n      const { data } = await api.get('/chats');\r\n      const uid = user?._id;\r\n      const count = (data||[]).filter(c => {\r\n        if(!c.lastMessage) return false;\r\n        if(String(c.lastMessage.sender) === String(uid)) return false;\r\n        const seen = (c.lastMessage.seen||[]).map(String);\r\n        return !seen.includes(String(uid));\r\n      }).length;\r\n      setUnreadChats(count);\r\n    } catch { setUnreadChats(0); }\r\n  };\r\n\r\n  useEffect(()=>{ fetchUnread(); }, []);\r\n\r\n  // Window focus tracking for title badge\r\n  const baseTitleRef = useRef(typeof document !== 'undefined' ? document.title : 'FadzTrack');\r\n  const [windowFocused, setWindowFocused] = useState(true);\r\n  useEffect(() => {\r\n    const onFocus = () => setWindowFocused(true);\r\n    const onBlur  = () => setWindowFocused(false);\r\n    window.addEventListener('focus', onFocus);\r\n    window.addEventListener('blur', onBlur);\r\n    return () => {\r\n      window.removeEventListener('focus', onFocus);\r\n      window.removeEventListener('blur', onBlur);\r\n    };\r\n  }, []);\r\n\r\n  // Update tab title with unread count when unfocused\r\n  useEffect(() => {\r\n    try {\r\n      const base = baseTitleRef.current || 'FadzTrack';\r\n      if (!windowFocused && unreadChats > 0) {\r\n        const n = unreadChats > 99 ? '99+' : String(unreadChats);\r\n        document.title = `(${n}) ${base}`;\r\n      } else {\r\n        document.title = base;\r\n      }\r\n    } catch {}\r\n  }, [unreadChats, windowFocused]);\r\n\r\n  // React immediately to local optimistic unread changes from AreaChat (custom event)\r\n  useEffect(()=>{\r\n    const handler = (e)=>{ if(e?.detail?.action==='read') fetchUnread(); };\r\n    window.addEventListener('chatUnreadChanged', handler);\r\n    return ()=> window.removeEventListener('chatUnreadChanged', handler);\r\n  },[]);\r\n\r\n  // fetch active project for roles that need it (pic/pm)\r\n  useEffect(()=>{\r\n    let ignore=false; if(!user?._id) return;\r\n    if(roleSegment==='pic'){\r\n      api.get(`/projects/by-user-status?userId=${user._id}&role=pic&status=Ongoing`).then(({data})=>{ if(!ignore) setActiveProject(data?.[0]||null); }).catch(()=>!ignore&&setActiveProject(null));\r\n    } else if(roleSegment==='pm') {\r\n      // backend expects field name 'projectmanager' (not 'pm') for querying\r\n      api.get(`/projects/by-user-status?userId=${user._id}&role=projectmanager&status=Ongoing`).then(({data})=>{ if(!ignore) setActiveProject(data?.[0]||null); }).catch(()=>!ignore&&setActiveProject(null));\r\n    }\r\n    return ()=>{ ignore=true; };\r\n  },[roleSegment,user?._id]);\r\n\r\n  // Listen for completion events (localStorage flag set by ProjectView) and refetch\r\n  useEffect(()=>{\r\n    function handleStorage(e){\r\n      try {\r\n        if(e && e.key && e.key!=='activeProjectInvalidated') return;\r\n        const flag = localStorage.getItem('activeProjectInvalidated');\r\n        if(flag==='1'){\r\n          // refetch depending on role\r\n          if(roleSegment==='pm'){\r\n            api.get(`/projects/by-user-status?userId=${user._id}&role=projectmanager&status=Ongoing`).then(({data})=>{ setActiveProject(data?.[0]||null); localStorage.removeItem('activeProjectInvalidated'); });\r\n          } else if(roleSegment==='pic'){\r\n            api.get(`/projects/by-user-status?userId=${user._id}&role=pic&status=Ongoing`).then(({data})=>{ setActiveProject(data?.[0]||null); localStorage.removeItem('activeProjectInvalidated'); });\r\n          }\r\n        }\r\n      } catch {}\r\n    }\r\n    window.addEventListener('storage', handleStorage);\r\n    // Also poll every 60s in case storage event missed\r\n    const poll = setInterval(()=> handleStorage({key:'activeProjectInvalidated'}),60000);\r\n    return ()=>{ window.removeEventListener('storage', handleStorage); clearInterval(poll); };\r\n  },[roleSegment,user?._id]);\r\n\r\n  useEffect(()=>{ const off=e=>{ if(!e.target.closest('.profile-menu-container')) setProfileMenuOpen(false); }; document.addEventListener('click', off); return ()=>document.removeEventListener('click', off); },[]);\r\n\r\n  const logout=()=>{ \r\n    if(onLogout){ onLogout(); return; }\r\n    localStorage.removeItem('token'); \r\n    localStorage.removeItem('user'); \r\n    window.dispatchEvent(new Event('storage'));\r\n    navigate('/'); \r\n  };\r\n\r\n  const ctx = { activeProject };\r\n  // Normalize roleSegment (support aliases like 'hr-site' -> 'hrsite')\r\n  const normalizedRole = ROLE_NAV[roleSegment] ? roleSegment : roleSegment.replace(/-/g,'');\r\n  let navItems = overrideNav || (ROLE_NAV[normalizedRole] ? ROLE_NAV[normalizedRole](ctx) : []);\r\n\r\n  return (\r\n    <>\r\n      <header className=\"pic-header pp-navbar\">\r\n        <div className=\"pp-left\">\r\n          {extraLeft}\r\n          <img src={require('../../assets/images/FadzLogo1.png')} alt=\"FadzTrack\" className=\"pp-logo\" />\r\n          <span className=\"pp-brand\">FadzTrack</span>\r\n          <nav className=\"pp-nav\">\r\n            {navItems.map(item=>{\r\n              const isRoot = ['/pic','/pm','/am','/ceo','/it','/staff','/hr-site'].includes(item.match);\r\n              const path = location.pathname.replace(/\\/$/,'');\r\n              const match = item.match.replace(/\\/$/,'');\r\n              // Special case: PIC new material request route (/pic/projects/:id/request) should highlight 'Requests'\r\n              const picMatReq = /^\\/pic\\/projects\\/[^/]+\\/request(\\/|$)?/.test(path);\r\n              let active = path === match || (!isRoot && path.startsWith(match + '/'));\r\n              if(picMatReq){\r\n                if(/\\/pic\\/requests$/.test(match) && item.label==='Requests') active = true; // force Requests active\r\n                if(/\\/pic\\/projects$/.test(match) && item.label==='My Projects') active = false; // prevent My Projects active\r\n              }\r\n              const isChat = /\\/chat$/.test(item.to);\r\n              return <Link key={item.to} to={item.to} className={`pp-link${active?' active':''}`}>{item.icon}<span>{item.label}</span>{isChat && unreadChats>0 && <span className=\"chat-unread-badge\">{unreadChats>99?'99+':unreadChats}</span>}</Link>;\r\n            })}\r\n          </nav>\r\n        </div>\r\n        <div className=\"pp-right\">\r\n          <NotificationBell />\r\n          {extraRight}\r\n          <div className=\"pp-user profile-menu-container\" onClick={()=>setProfileMenuOpen(o=>!o)}>\r\n            <div className=\"pp-avatar\">{userName[0]?.toUpperCase()||'U'}</div>\r\n            <div className=\"pp-user-text\"><span className=\"pp-username\">{userName}</span><span className=\"pp-role\">{roleName}</span></div>\r\n            {profileMenuOpen && <div className=\"pp-dropdown\"><button onClick={logout}>Logout</button></div>}\r\n          </div>\r\n        </div>\r\n      </header>\r\n  {showBelow && below && <div className=\"pic-header-below\">{below}</div>}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AppHeader;\r\n"],"names":["extractOriginalNameFromPath","path","base","split","pop","underscore","indexOf","length","slice","m","match","getFileType","fileName","_fileName$split$pop","pdf","doc","docx","xls","xlsx","ppt","pptx","txt","rtf","csv","jpg","jpeg","png","gif","bmp","svg","toLowerCase","async","openSignedPath","data","api","get","concat","encodeURIComponent","url","signedUrl","window","open","_unused","alert","openReportSignedPath","projectId","Error","params","e","console","error","generateFileThumbnail","filePath","fileType","baseTileStyle","width","height","overflow","borderRadius","position","display","alignItems","justifyContent","background","boxShadow","includes","_jsx","className","style","children","src","alt","objectFit","fontSize","lineHeight","color","map","PDF","DOC","DOCX","XLS","XLSX","PPT","PPTX","TXT","RTF","CSV","FILE","s","_jsxs","_objectSpread","flexDirection","marginTop","fontWeight","letterSpacing","renderMessageText","text","arguments","undefined","me","slug","trim","replace","re","RegExp","parts","p","i","React","padding","isMentioned","peso","Intl","NumberFormat","currency","mentionRowStyles","container","border","badge","top","right","roleConfigs","pic","label","permissions","image","statusToggle","uploadFiles","deleteFiles","postDiscuss","pm","am","ceo","hr","it","staff","hrsite","ProjectView","props","_document$body$datase","_project$photos","_project$projectmanag","_project$parsedBudget","_budgetDocument$path","_project$parsedBudget2","_textareaRef$current","_fileToDelete$doc$pat","role","navItems","permissionsOverride","navPathOverrides","useUnifiedHeader","useUnifiedHeaderProp","id","useParams","navigate","useNavigate","location","useLocation","token","localStorage","getItem","roleCfg","perms","basePath","viewProjectPathMap","progressReportPathMap","dailyLogsPathMap","defaultNav","to","icon","FaTachometerAlt","FaComments","FaBoxes","FaUsersNav","FaProjectDiagram","active","FaMoneyBillWave","FaClipboardList","FaChartBar","FaCalendarAltNav","item","nav","userRef","useRef","current","JSON","parse","_unused3","user","userId","_id","userName","useState","name","profileMenuOpen","setProfileMenuOpen","isHeaderCollapsed","setIsHeaderCollapsed","project","setProject","activeTab","setActiveTab","status","setStatus","progress","setProgress","loading","setLoading","picContributions","setPicContributions","purchaseOrders","setPurchaseOrders","totalPO","setTotalPO","poUploading","setPoUploading","poError","setPoError","poAmountInputs","setPoAmountInputs","messages","setMessages","loadingMsgs","setLoadingMsgs","newMessage","setNewMessage","collapsedReplies","setCollapsedReplies","replyInputs","setReplyInputs","posting","setPosting","composerFiles","setComposerFiles","isDragOver","setIsDragOver","selectedLabel","setSelectedLabel","listScrollRef","listBottomRef","textareaRef","uploading","setUploading","uploadProgress","setUploadProgress","uploadError","setUploadError","imageUploading","setImageUploading","imageUploadProgress","setImageUploadProgress","imageUploadError","setImageUploadError","mentionDropdown","setMentionDropdown","options","query","left","activeInputId","projectUsers","setProjectUsers","fileSignedUrls","setFileSignedUrls","fileSearchTerm","setFileSearchTerm","reports","setReports","reportUploading","setReportUploading","reportUploadProgress","setReportUploadProgress","reportUploadError","setReportUploadError","attendanceReports","setAttendanceReports","attUploading","setAttUploading","attError","setAttError","attendanceAI","setAttendanceAI","showCompleteConfirm","setShowCompleteConfirm","showEstimatedMaterial","setShowEstimatedMaterial","showSectionBreakdown","setShowSectionBreakdown","imagePreview","setImagePreview","useEffect","onKey","key","addEventListener","removeEventListener","statusUpdating","setStatusUpdating","openAiRows","setOpenAiRows","picSearch","setPicSearch","showAllPics","setShowAllPics","showFileDeleteConfirm","setShowFileDeleteConfirm","fileToDelete","setFileToDelete","loadAttendance","socketRef","joinedProjectRef","onScroll","pageYOffset","document","documentElement","scrollTop","cancelled","first","Array","isArray","_unused4","_unused5","list","reduce","Number","amount","controller","AbortController","headers","Authorization","signal","then","res","sort","a","b","Date","timestamp","catch","finally","abort","prev","next","changed","forEach","replies","fetchReports","pid","info","sorted","uploadedAt","byUser","Map","rep","uploadedBy","uploadedByName","has","set","distinct","values","vals","r","_ai$completed_tasks","_ai$summary_of_work_d","ai","raw","pic_contribution_percent_raw","legacy","pic_contribution_percent","isFinite","done","completed_tasks","total","summary_of_work_done","filter","v","totalAssigned","sumContrib","headcountAvgRaw","headcountClamped","Math","min","max","toFixed","debug","reportedPICs","perPic","chosen","picId","picName","contribution","round","hasReport","lastReportDate","fallbackUsed","meta_fallback_used","duplicate","meta_duplicate_previous","averageContribution","totalPics","reportingPics","pendingPics","assignedPics","completionPreconditionsMet","docCount","documents","reportCount","allPics100","requiredCount","every","handleToggleStatus","_res$data","newStatus","patch","setItem","dispatchEvent","Event","_unused6","_e$response","_e$response$data","msg","response","message","int","setInterval","clearInterval","requestAnimationFrame","scrollIntoView","scrollHeight","all","push","_m$replies","attachments","signed","files","imgs","f","out","_unused2","fetchSignedUrlsForImages","_unused7","_unused8","close","target","closest","emit","_unused9","disconnect","_unused0","_unused1","socket","io","SOCKET_ORIGIN","SOCKET_PATH","transports","auth","hNew","String","mid","some","hReply","msgId","reply","hReports","d","CustomEvent","detail","_unused10","on","off","_unused11","handlePostMessage","fd","FormData","append","post","_unused12","handlePostReply","_unused13","addComposerFiles","from","canUploadReport","canDeleteReport","report","_report$uploadedBy","ownerId","justCreated","state","showFlash","setShowFlash","t","setTimeout","clearTimeout","resolveAttendanceUploaderName","_r$uploadedBy","_r$uploader","_r$user","uploaderName","generatedByName","readName","obj","k","email","nestedName","uploader","candidateId","generatedBy","uploadedById","uploaderId","find","u","fullName","displayName","tail","reps","latest","ai_summary","summary","_unused16","rootRoleClass","contractor","cRaw","contractorName","names","x","company","companyName","title","Boolean","join","readContractor","contractorType","budgetDocument","documentsExcludingBudget","require","projectMissing","onClick","cursor","start","startDate","toLocaleDateString","end","endDate","locationLabel","loc","region","manpowerText","manpower","mp","budgetNum","budget","remaining","resolveUserNames","arr","pu","hrSiteNames","staffNames","labelColorMap","Important","bg","fg","Announcement","Update","Reminder","Urgent","renderLabelBadge","marginLeft","gap","body","dataset","appHeaderMounted","AppHeader","roleSegment","o","charAt","toUpperCase","handleLogout","removeItem","n","Link","NotificationBell","inset","zIndex","maxWidth","maxHeight","textAlign","stopPropagation","margin","projectName","photos","type","accept","onChange","startsWith","size","onUploadProgress","pe","loaded","photoUrl","_unused17","value","htmlFor","FaCamera","_Fragment","disabled","borderColor","marginBottom","backgroundColor","FaCheckCircle","FaClock","FaRegListAlt","FaRegCommentDots","FaRegFileAlt","exportDateTime","toLocaleString","year","month","day","hour","minute","second","hour12","exportProjectDetails","contextTitle","exportedBy","exportDate","FaDownload","format","FaCalendarAlt","FaMapMarkerAlt","FaBuilding","gridTemplateColumns","opacity","WebkitBackgroundClip","alignSelf","minWidth","transition","_","flex","FaUsers","flexWrap","placeholder","assigned","reportedMap","rows","uid","term","filtered","diff","localeCompare","limit","visible","pct","flexShrink","whiteSpace","textOverflow","FaUserTie","projectmanager","po","purchaseOrder","totalValue","parsedBudgetTotals","totalAll","paddingTop","borderTop","totalDeduct","original","sections","greenItems","unified","code","letter","g","transform","overflowY","borderCollapse","borderBottom","idx","autoDeductEligible","confidenceSummary","spent","onSubmit","preventDefault","form","currentTarget","poFiles","reset","err","_err$response","_err$response$data","multiple","_po$path","amt","parseFloat","parseFormattedNumber","_err$response2","_err$response2$data","marginRight","inputMode","formatted","numStr","cleaned","withCommas","dec","formatNumberWithCommas","outline","fontStyle","confirm","delete","_err$response3","_err$response3$data","minHeight","ref","paddingBottom","_msg$userName","_msg$userName$charAt","mentioned","att","isImage","boxSizing","href","WebkitLineClamp","WebkitBoxOrient","wordBreak","overflowWrap","_r$userName","_r$userName$charAt","rm","onKeyDown","shiftKey","resize","fontFamily","onDragOver","onDragLeave","onDrop","_e$dataTransfer","_e$dataTransfer$files","dataTransfer","caret","selectionStart","up","exec","q","opts","val","before","index","after","mention","focus","selectionEnd","handleMentionSelect","_e$target$files","_res$data2","pr","_unused14","handleFileUpload","by","at","handleDeleteFile","FaTrash","_e$target$files2","file","test","tick","_e$response2","_e$response2$data","handleReportUpload","overflowX","_r$ai$pic_performance","_r$ai$pic_performance2","_r$ai","_r$ai2","textTransform","pdfPath","_r$uploadedBy2","reportId","_e$response3","_e$response3$data","handleDeleteReport","colSpan","critical_path_analysis","c","_c$blockers","_c$next","path_type","risk","blockers","task_priorities","paddingLeft","priority","toString","task","impact","justification","pic_performance_evaluation","score","confidence","_e$target$files3","reverse","originalName","generatedAt","inputPath","_unused18","outputPath","_unused19","_unused20","insights","top_absent","absent","average_attendance","_unused15","notifications","unread","markAllRead","markAsRead","useNotifications","setOpen","bellRef","handleClick","contains","iconFor","severity","iconKey","FaExclamationTriangle","FaTimesCircle","FaInfoCircle","userRole","_JSON$parse","clickNotification","actionUrl","_n$requestId","_n$projectId","requestId","isPIC","isPM","isAM","isCEO","isIT","isHR","isHRSite","isStaff","deriveFallbackUrl","filteredUnread","handleBellClick","FaBell","_n$projectId2","tabIndex","onKeyPress","createdAt","pesoIntl","fmtDate","dt","isNaN","getTime","sanitizeFilename","readLocation","_p$location","_p$location2","loadImageDataURLWithSize","Promise","resolve","img","Image","crossOrigin","onload","createElement","naturalWidth","naturalHeight","getContext","drawImage","dataUrl","toDataURL","w","h","onerror","fitInside","maxW","maxH","loadFontFromPublic","family","fetch","cache","ok","buf","arrayBuffer","b64","btoa","fromCharCode","Uint8Array","addFileToVFS","addFont","fontUsable","setFont","getTextWidth","includeHrSite","includeStaff","includePIC","includeAM","includePM","includeBudget","includeManpower","preferPesoSign","jsPDF","unit","FAMILY","regOk","boldOk","canUseRegular","bodyFont","headStyle","pesoText","pesoGlyphAvailable","makePesoText","marginX","y","logoURL","logo","titleX","targetH","targetW","addImage","setFontSize","setTextColor","setDrawColor","setLineWidth","line","headerBottom","photo","boxW","boxH","drawW","drawH","imgX","imgY","detailsStartY","detailsRows","splice","autoTable","startY","head","styles","font","cellPadding","halign","headStyles","fillColor","textColor","columnStyles","cellWidth","theme","staffRows","areamanager","lastAutoTable","finalY","_doc$lastAutoTable","manpowerRows","pageCount","getNumberOfPages","setPage","footerY","exportInfo","exportW","save","generateProjectPDF","companyLogo","filters","projects","logoX","logoWidth","logoHeight","logoData","maxLogoHeight","maxLogoWidth","logoW","logoH","warn","logoY","hasFilters","search","dateFrom","dateTo","filterY","projectCountY","tableData","area","timeline","pics","lineColor","lineWidth","alternateRowStyles","didDrawPage","internal","getCurrentPageInfo","pageNumber","pageSize","FaEye","FaExchangeAlt","_ref","_selectedChat$users$f","baseSegment","chatId","useMemo","selectedChatIdRef","messagesEndRef","seqRef","chatList","setChatList","searchQuery","setSearchQuery","searchResults","setSearchResults","selectedChat","setSelectedChat","drafts","setDrafts","pendingFiles","setPendingFiles","loadingMessages","setLoadingMessages","showEmojiPicker","setShowEmojiPicker","showInfoSidebar","setShowInfoSidebar","showInfoTab","setShowInfoTab","showSeenDetails","setShowSeenDetails","showScrollToBottom","setShowScrollToBottom","messageSearch","setMessageSearch","searchMatches","setSearchMatches","searchIndex","setSearchIndex","replyTo","setReplyTo","showForwardModal","setShowForwardModal","forwardMessage","setForwardMessage","forwardTargets","setForwardTargets","forwardUsers","setForwardUsers","forwardSearch","setForwardSearch","actionMenu","setActionMenu","showGroupModal","setShowGroupModal","groupName","setGroupName","availableUsers","setAvailableUsers","filteredUsers","setFilteredUsers","userSearch","setUserSearch","pinnedNewChatId","setPinnedNewChatId","selectedUsers","setSelectedUsers","editingGroupName","setEditingGroupName","newGroupName","setNewGroupName","showAddMembers","setShowAddMembers","availableMembers","setAvailableMembers","selectedNewMembers","setSelectedNewMembers","addMembersSearch","setAddMembersSearch","showMembersList","setShowMembersList","showMediaViewer","setShowMediaViewer","mediaViewerIndex","setMediaViewerIndex","pmProjectId","setPmProjectId","picProjectId","setPicProjectId","expandedLongMessages","setExpandedLongMessages","Set","onlineUsers","setOnlineUsers","lastRead","setLastRead","getDisplayName","firstname","lastname","stored","mediaImages","flatMap","mime","filteredAvailableMembers","mediaImageIndexByUrl","openMediaViewer","closeMediaViewer","navMedia","dir","handler","sortChatList","hasRealLastMessage","lm","lastMessage","isGroup","content","sender","hasContent","hasAttachments","hasSender","getTs","_c$lastMessage","_c$lastMessage2","_c$lastMessage3","_c$lastMessage4","tsNum","created","updatedAt","num","parseInt","substring","_a$c","_a$c$lastMessage","_b$c","_b$c$lastMessage","aHas","bHas","sa","seq","sb","findIndex","pinned","onDocClick","formatTime","ts","now","sameDay","getFullYear","getMonth","getDate","timeStr","toLocaleTimeString","dateStr","addYear","dedupedMessages","seen","add","highlightMessage","escapeRegExp","matches","el","querySelector","behavior","block","gotoMatch","SOCKET_URL","withCredentials","onReceive","_ref2","_ref3","_msg$content","fileUrl","urls","normalizeIncoming","log","found","updated","conversation","allImages","mimetype","count","ms","isOwn","reactions","forwardOf","senderId","connected","messageId","once","onSeen","_ref4","seenBy","onChatUpdated","_ref5","cId","_c$lastMessage5","prevSeen","mergedSeen","onMembersUpdated","_ref6","cid","users","onChatCreated","chatObj","_chatObj$lastMessage","_chatObj$lastMessage2","_chatObj$lastMessage3","toISOString","onReaction","_ref7","ids","_ref8","lr","scrollToBottom","clientHeight","reloadChats","ch","chatIdCurrent","norm","_ref9","_ref0","_m$message","allUsers","matchedChats","regex","matchedUsers","results","loadAvailableMembers","unifiedForwardList","sendMessage","filesNow","tempId","random","oldMsgs","newMsgs","mergeMessages","optimisticTs","fresh","toggleReaction","emoji","mine","_r$userId","getUid","currentIds","removeMemberFromGroup","memberId","_busy","removed","chat","put","putErr","uniqueMembers","acc","curr","checked","toggleSelectUser","members","newChat","enriched","entry","toggleForwardTarget","chatIds","_existing","existing","dm","atts","blob","nameGuess","File","run","bottom","borderLeft","borderRight","overrideNav","_item$users","_item$lastMessage","_item$lastMessage2","_reverse$find","_item$lastMessage3","isUser","other","preview","lastUserMsg","system","lastAttachments","fileWord","senderPrefix","rawSender","senderUser","disp","lastMsg","seenArr","isUnread","hasSeenArr","lmTime","isNewChat","isOnline","_chatToOpen","chatToOpen","lmTs","stringify","sc","action","openChat","FaSearch","FaTimes","FaArrowUp","FaArrowDown","hasText","_msg$seen","_msg$seen2","_ref1","_dedupedMessages$find","_msg$seen3","showSenderName","senderName","_msg$forwardOf","prevSender","thisSender","u2","sid","getMessageSenderUser","initials","getInitials","prevMsg","nextMsg","collapseAvatar","counts","isLastOwn","seenNames","seenArray","_chatList$find","isMostRecentSeen","l","_l$seen","laterIds","rawText","hasSpaces","isVeryLongUnbroken","dangerouslySetInnerHTML","__html","isImg","isVid","isAud","idxInViewer","controls","download","rel","inline","remainder","Object","entries","_ref10","hasReacted","_r$userId2","em","FaReply","rect","getBoundingClientRect","FaEllipsisH","hidden","URL","createObjectURL","muted","onPaste","_e$clipboardData","items","clipboardData","kind","getAsFile","getData","resp","mode","fname","EmojiPicker","emojiStyle","onEmojiClick","emojiData","FaPaperPlane","autoFocus","cancelEditGroupName","startEditGroupName","FaUserPlus","FaSignOutAlt","textDecoration","_selectedChat$creator","_selectedChat$creator2","_selectedChat$users","_selectedChat$users$","isCreator","creator","updatedUsers","ROLE_NAV","ctx","ap","activeProject","_userName$","extraRight","extraLeft","showBelow","below","onLogout","roleName","userType","designation","setActiveProject","unreadChats","setUnreadChats","setSocketRef","handle","payload","fetchUnread","baseTitleRef","windowFocused","setWindowFocused","onFocus","onBlur","_e$detail","ignore","handleStorage","poll","normalizedRole","isRoot","pathname","picMatReq","isChat","logout"],"sourceRoot":""}
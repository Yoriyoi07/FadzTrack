"use strict";(self.webpackChunkfadz_web_frontend=self.webpackChunkfadz_web_frontend||[]).push([[233],{655:(e,a,s)=>{s.r(a),s.d(a,{default:()=>v});var t=s(9379),n=s(5043),r=s(108),i=s(2291),l=s(7734),c=s(2185),o=s(6026),d=s(6150),m=s(8643),p=s(3216),h=s(5475),u=(s(4905),s(411)),j=s(8818),x=s(3204),g=s(579);const v=()=>{var e;const a=(0,p.Zp)(),s=(0,n.useRef)(null);if(null===s.current){const e=localStorage.getItem("user");s.current=e?JSON.parse(e):null}const v=s.current,N=null!==(e=null===v||void 0===v?void 0:v._id)&&void 0!==e?e:null,[f,b]=(0,n.useState)((null===v||void 0===v?void 0:v.name)||""),[y,w]=(0,n.useState)((null===v||void 0===v?void 0:v.role)||""),[A,k]=(0,n.useState)(!1),[C,S]=(0,n.useState)([]),[_,D]=(0,n.useState)([]),[P,q]=(0,n.useState)([]),[R,M]=(0,n.useState)(!0),[L,E]=(0,n.useState)([]),[I,z]=(0,n.useState)([]),[F,B]=(0,n.useState)(null),[T,U]=(0,n.useState)([]),[O,G]=(0,n.useState)({}),[H,V]=(0,n.useState)({totalProjects:0,activeProjects:0,completedProjects:0,pendingRequests:0,totalEngineers:0,averageProgress:0}),[Z,J]=(0,n.useState)({});(0,n.useEffect)((()=>{if(!N)return void a("/");let e=!0;const s=new AbortController,n=async a=>{try{Q(!0);const{data:n}=await u.Ay.get("/projects",{signal:s.signal});if(!e)return;D(n);const r=n.filter((e=>a.some((a=>{var s;return a._id===((null===(s=e.location)||void 0===s?void 0:s._id)||e.location)})))),i={},l=await Promise.all(r.map((async e=>{try{const c=Array.isArray(e.pic)?e.pic.length:0;let o=0,d=null,m=0,p=c,h=[];try{const{data:t}=await u.Ay.get("/projects/".concat(e._id,"/reports"),{signal:s.signal}),n=(null===t||void 0===t?void 0:t.reports)||[];if(n.length){var a;const e=[...n].sort(((e,a)=>new Date(a.uploadedAt||0)-new Date(e.uploadedAt||0)));d=(null===(a=e[0])||void 0===a?void 0:a.uploadedAt)||null;const s=new Map;for(const a of e){const e=a.uploadedBy||a.uploadedByName||a._id;s.has(e)||s.set(e,a)}const t=[...s.values()],r=t.map((e=>{const a=(null===e||void 0===e?void 0:e.ai)||{},s=Number(a.pic_contribution_percent_raw),t=Number(a.pic_contribution_percent);return isFinite(s)&&s>=0?s:isFinite(t)&&t>=0?t:NaN})).filter((e=>isFinite(e)&&e>=0));if(r.length){const e=r.reduce(((e,a)=>e+a),0);o=c>0?e/c:0}m=t.length,p=c>0?Math.max(0,c-m):0,h=t.map((e=>{const a=(null===e||void 0===e?void 0:e.ai)||{},s=Number(a.pic_contribution_percent_raw),t=Number(a.pic_contribution_percent),n=isFinite(s)&&s>=0?s:isFinite(t)&&t>=0?t:0;return{picId:e.uploadedBy||e._id,picName:e.uploadedByName||"Unknown",contribution:Math.round(n),hasReport:!0,lastReportDate:e.uploadedAt||null}}))}}catch(r){}if(0===o)try{const{data:a}=await u.Ay.get("/daily-reports/project/".concat(e._id,"/pic-contributions"),{signal:s.signal});if(a){var n;if(!d){const e=(a.picContributions||[]).filter((e=>e.lastReportDate)).map((e=>new Date(e.lastReportDate))).sort(((e,a)=>a-e))[0];d=e?e.toISOString():d}a.averageContribution&&(o=a.averageContribution),m||(m=a.reportingPics||0),c&&p===c&&(p=null!==(n=a.pendingPics)&&void 0!==n?n:p),h.length||(h=(a.picContributions||[]).map((e=>({picId:e.picId,picName:e.picName,contribution:Math.round(e.contribution||0),hasReport:!!e.lastReportDate,lastReportDate:e.lastReportDate||null}))))}}catch(l){}const j=Math.min(100,Math.max(0,Math.round(o)));return i[e._id]={averageContribution:j,totalPics:c,reportingPics:m,pendingPics:p,picContributions:h},(0,t.A)((0,t.A)({},e),{},{progress:[{name:"Completed",value:j}],latestDate:d})}catch(c){return(0,t.A)((0,t.A)({},e),{},{progress:[{name:"Completed",value:0}],latestDate:null})}})));if(!e)return;J(i),S(l)}catch(n){console.error("Error fetching projects:",n)}finally{e&&(Q(!1),M(!1))}},r=async a=>{try{const{data:a}=await u.Ay.get("/requests",{signal:s.signal});if(!e)return;E(Array.isArray(a)?a:[]),B(null)}catch(n){var t;if(!e)return;401===(null===n||void 0===n||null===(t=n.response)||void 0===t?void 0:t.status)?B("Session expired. Please log in again."):"CanceledError"!==n.name&&B("Error loading material requests")}};return(async()=>{const a=await(async()=>{try{const{data:e}=await u.Ay.get("/users/".concat(N,"/locations"),{signal:s.signal});return Array.isArray(e)?e:[]}catch(e){return[]}})();e&&(U(a),await Promise.all([n(a),r()]))})(),()=>{e=!1,s.abort()}}),[a,N]),(0,n.useEffect)((()=>{if(_.length){const e=e=>{if(!e)return null;const a=e.location;return a?"string"===typeof a?a:"object"===typeof a&&(a._id||a.id)||null:null},a=_.filter((e=>{var a,s;const t="object"===typeof e.areamanager?(null===(a=e.areamanager)||void 0===a?void 0:a._id)||(null===(s=e.areamanager)||void 0===s?void 0:s.id):e.areamanager;return!!t&&(String(t)===String(N)&&!e.isDeleted)})).map((a=>{var s;const n=e(a),r=T.find((e=>e._id===n))||null;return(0,t.A)((0,t.A)({},a),{},{location:r?(0,t.A)({},r):{name:"Unknown Location",region:""},name:a.projectName,engineer:(null===(s=a.projectmanager)||void 0===s?void 0:s.name)||"Not Assigned"})}));q(a)}}),[_,N]),(0,n.useEffect)((()=>{const e=e=>{var a;const s=null===e||void 0===e||null===(a=e.detail)||void 0===a?void 0:a.projectId;s&&(async()=>{try{const{data:e}=await u.Ay.get("/projects/".concat(s,"/reports")),a=(null===e||void 0===e?void 0:e.reports)||[];if(!a.length)return;const n=[...a].sort(((e,a)=>new Date(a.uploadedAt||0)-new Date(e.uploadedAt||0))),r=new Map;for(const s of n){const e=s.uploadedBy||s.uploadedByName||s._id;r.has(e)||r.set(e,s)}const i=[...r.values()],l=i.map((e=>{const a=e.ai||{},s=Number(a.pic_contribution_percent_raw),t=Number(a.pic_contribution_percent);return isFinite(s)&&s>=0?s:isFinite(t)&&t>=0?t:NaN})).filter((e=>isFinite(e)&&e>=0));let c=0;l.length&&(c=l.reduce(((e,a)=>e+a),0)/l.length);const o=_.find((e=>String(e._id)===String(s))),d=Array.isArray(null===o||void 0===o?void 0:o.pic)?o.pic.length:0,m=i.length,p=d>0?Math.max(0,d-m):0,h=i.map((e=>{const a=e.ai||{},s=Number(a.pic_contribution_percent_raw),t=Number(a.pic_contribution_percent),n=isFinite(s)&&s>=0?s:isFinite(t)&&t>=0?t:0;return{picId:e.uploadedBy||e._id,picName:e.uploadedByName||"Unknown",contribution:Math.round(n),hasReport:!0,lastReportDate:e.uploadedAt||null}}));J((e=>(0,t.A)((0,t.A)({},e),{},{[s]:{averageContribution:Math.min(100,Math.max(0,Math.round(c))),totalPics:d,reportingPics:m,pendingPics:p,picContributions:h}})))}catch(e){}})()};return window.addEventListener("projectReportsUpdated",e),()=>window.removeEventListener("projectReportsUpdated",e)}),[_]),(0,n.useEffect)((()=>{if(P.length>0){const e=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toString().replace(/[\s_-]+/g," ").trim().toLowerCase()},a=P,s=P.length;let t=0,n=0;for(const l of a){const a=e(l.status||"");a&&(/(completed|complete|finished|done)/.test(a)?n+=1:(/(ongoing|on going|in progress)/.test(a)||"active"===a)&&(t+=1))}const r=new Set(P.map((e=>e.engineer))).size,i=C.length>0?C.reduce(((e,a)=>{const s=a.progress.find((e=>"Completed"===e.name));return e+(s?s.value:0)}),0)/C.length:0;V({totalProjects:s,activeProjects:t,completedProjects:n,pendingRequests:I.length,totalEngineers:r,averageProgress:Math.round(i)})}}),[P,I,C]),(0,n.useEffect)((()=>{if(!L.length)return void z([]);const e=L.filter((e=>{var a,s,t;if(!e||!e.project)return!1;const n=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/\s+/g," ").trim().toUpperCase()}(e.status||"");if(!(n.includes("PENDING AM")||n.includes("PENDING AREA MANAGER")))return!1;let r=(null===(a=e.project)||void 0===a||null===(s=a.location)||void 0===s?void 0:s._id)||("string"===typeof(null===(t=e.project)||void 0===t?void 0:t.location)?e.project.location:null);if(!r){var i;const a=e.project._id||e.project.id||e.project,s=P.find((e=>e._id===a));s&&(r=(null===(i=s.location)||void 0===i?void 0:i._id)||s.location)}return!!r&&T.some((e=>e._id===r))}));z(e)}),[L,T,P]);const W=()=>{k(!A)},X=P.reduce(((e,a)=>{var s;const t=(null===(s=a.location)||void 0===s?void 0:s._id)||"unknown";var n,r;e[t]||(e[t]={name:(null===(n=a.location)||void 0===n?void 0:n.name)||"Unknown Location",region:(null===(r=a.location)||void 0===r?void 0:r.region)||"",projects:[]});return e[t].projects.push(a),e}),{}),[$,K]=(0,n.useState)([]),[Y,Q]=(0,n.useState)(!1);(0,n.useEffect)((()=>{if(!P.length)return void K([]);const e=P.filter((e=>!function(){return/completed|complete|finished|done/i.test((arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/[\s_-]+/g," ").trim())}(e.status||""))).map((e=>{var a;const s=Z[e._id];if(s){var t;const a=s.averageContribution||s.fallbackProgress||0,n=s.totalPics||0,r=s.reportingPics||0,i=s.pendingPics||0;let l="ontrack";i>0&&n>1?l="pending":a<50&&(l="regressing");const c=(s.picContributions||[]).filter((e=>e.lastReportDate)).map((e=>new Date(e.lastReportDate))).sort(((e,a)=>a-e))[0]||null;c&&Date.now()-c.getTime()>2592e5&&(l="stale");const o=(s.picContributions||[]).map((e=>e.hasReport?e.picName:"".concat(e.picName," (pending)")));return{projectId:e._id,projectName:e.name,pm:e.engineer,area:(null===(t=e.location)||void 0===t?void 0:t.name)||"Unknown Area",progress:a,totalPics:n,latestDate:c,status:l,waitingForAll:i>0&&n>1,picNames:o,reportingPics:r,pendingPics:i}}return{projectId:e._id,projectName:e.name,pm:e.engineer,area:(null===(a=e.location)||void 0===a?void 0:a.name)||"Unknown Area",progress:0,totalPics:0,latestDate:null,status:"stale",waitingForAll:!1,picNames:[],reportingPics:0,pendingPics:0}}));e.sort(((e,a)=>e.latestDate||a.latestDate?e.latestDate?a.latestDate?new Date(a.latestDate)-new Date(e.latestDate):-1:1:0)),K(e)}),[P,Z]);const ee=(e,a)=>{const s=(null===e||void 0===e?void 0:e.toLowerCase())||"";if(s.includes("rejected"))return"rejected";switch(a){case"placed":return s.includes("pending pm")||s.includes("project manager")?"completed one-step-behind":(s.includes("pending am")||s.includes("area manager")||s.includes("approved")||s.includes("received"),"completed");case"pm":if(s.includes("rejected pm")||s.includes("pm rejected"))return"rejected";if(s.includes("pending pm")||s.includes("project manager"))return"pending";if(s.includes("pending am")||s.includes("area manager"))return"completed one-step-behind";if(s.includes("approved")||s.includes("received"))return"completed";break;case"am":if(s.includes("rejected am")||s.includes("am rejected"))return"rejected";if(s.includes("pending am")||s.includes("area manager"))return"pending";if(s.includes("approved"))return"completed one-step-behind";if(s.includes("received"))return"completed";break;case"done":if(s.includes("received"))return"completed"}return""};return R?(0,g.jsxs)("div",{className:"loading-container",children:[(0,g.jsx)("div",{className:"loading-spinner"}),(0,g.jsx)("p",{children:"Loading dashboard data..."})]}):(0,g.jsxs)("div",{className:"am-dashboard dashboard-container",children:[(0,g.jsx)(j.A,{roleSegment:"am",extraLeft:(0,g.jsx)("button",{className:"sidebar-toggle-btn am-header-toggle",onClick:W,"aria-label":A?"Close areas & projects panel":"Open areas & projects panel",children:(0,g.jsx)(x.OXb,{})})}),(0,g.jsxs)("main",{className:"dashboard-main blueprint-bg",children:[(0,g.jsxs)("div",{className:"areas-projects-sidebar ".concat(A?"open":""),children:[(0,g.jsxs)("div",{className:"sidebar-header",children:[(0,g.jsxs)("h3",{children:[(0,g.jsx)(x.G5b,{className:"hdr-ico"})," Areas & Projects"]}),(0,g.jsx)("button",{className:"close-sidebar-btn",onClick:W,children:(0,g.jsx)(x._Jj,{})})]}),(0,g.jsxs)("div",{className:"areas-projects-card",children:[(0,g.jsx)("div",{className:"card-header",children:(0,g.jsx)("button",{className:"add-project-btn",onClick:()=>a("/am/addproj"),children:"Add Project"})}),(0,g.jsx)("div",{className:"areas-list",children:Object.entries(X).map((e=>{let[a,s]=e;return(0,g.jsxs)("div",{className:"area-item",children:[(0,g.jsxs)("div",{className:"area-header",children:[(0,g.jsxs)("div",{className:"area-info",children:[(0,g.jsx)(x.vq8,{className:"area-icon"}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h4",{children:s.name}),(0,g.jsx)("p",{children:s.region})]})]}),(0,g.jsxs)("div",{className:"area-stats",children:[(0,g.jsxs)("span",{className:"project-count",children:[s.projects.length," projects"]}),(0,g.jsx)("button",{className:"expand-btn",onClick:()=>G((e=>(0,t.A)((0,t.A)({},e),{},{[a]:!e[a]}))),children:O[a]?(0,g.jsx)(x.Ucs,{}):(0,g.jsx)(x.Vr3,{})})]})]}),O[a]&&(0,g.jsx)("div",{className:"projects-list",children:s.projects.map((e=>(0,g.jsxs)(h.N_,{to:"/am/projects/".concat(e._id),className:"project-item",children:[(0,g.jsx)(x.yd7,{className:"project-icon"}),(0,g.jsxs)("div",{className:"project-info",children:[(0,g.jsx)("h5",{children:e.name}),(0,g.jsx)("p",{children:e.engineer})]}),(0,g.jsx)(x.Z0P,{className:"arrow-icon"})]},e._id)))})]},a)}))})]})]}),A&&(0,g.jsx)("div",{className:"sidebar-overlay",onClick:W}),(0,g.jsx)("div",{className:"dashboard-content",children:(0,g.jsxs)("div",{className:"dashboard-grid",children:[(0,g.jsxs)("div",{className:"dashboard-card am-welcome-card",children:[(0,g.jsxs)("div",{className:"welcome-content",children:[(0,g.jsxs)("h2",{className:"welcome-title",children:["Welcome back, ",f,"! \ud83d\udc4b"]}),(0,g.jsx)("p",{className:"welcome-subtitle",children:"Here's what's happening with your areas today"})]}),(0,g.jsxs)("div",{className:"welcome-stats",children:[(0,g.jsxs)(h.N_,{to:"/am/viewproj",className:"stat-item stat-link","aria-label":"Go to Projects",children:[(0,g.jsx)("span",{className:"stat-number",children:P.length}),(0,g.jsx)("span",{className:"stat-label",children:"Total Projects"})]}),(0,g.jsxs)(h.N_,{to:"/am/viewproj",className:"stat-item stat-link","aria-label":"Go to Projects",children:[(0,g.jsx)("span",{className:"stat-number",children:T.length}),(0,g.jsx)("span",{className:"stat-label",children:"Areas Managed"})]})]}),(0,g.jsxs)("div",{className:"kpi-strip",children:[(0,g.jsxs)(h.N_,{to:"/am/matreq",className:"kpi","aria-label":"Pending material requests",children:[(0,g.jsx)("div",{className:"kpi-ico",children:(0,g.jsx)(x.H5e,{})}),(0,g.jsxs)("div",{className:"kpi-body",children:[(0,g.jsx)("div",{className:"kpi-title",children:"Pending Requests"}),(0,g.jsx)("div",{className:"kpi-value",children:I.length})]})]}),(0,g.jsxs)(h.N_,{to:"/am/viewproj",className:"kpi","aria-label":"Active projects",children:[(0,g.jsx)("div",{className:"kpi-ico",children:(0,g.jsx)(x.yd7,{})}),(0,g.jsxs)("div",{className:"kpi-body",children:[(0,g.jsx)("div",{className:"kpi-title",children:"Active Projects"}),(0,g.jsx)("div",{className:"kpi-value",children:H.activeProjects})]})]}),(0,g.jsxs)(h.N_,{to:"/am/viewproj",className:"kpi","aria-label":"Average progress",children:[(0,g.jsx)("div",{className:"kpi-ico",children:(0,g.jsx)(x.v$b,{})}),(0,g.jsxs)("div",{className:"kpi-body",children:[(0,g.jsx)("div",{className:"kpi-title",children:"Avg. Progress"}),(0,g.jsxs)("div",{className:"kpi-value",children:[H.averageProgress,"%"]})]})]})]}),(0,g.jsx)("div",{className:"hero-art","aria-hidden":"true",style:{backgroundImage:"radial-gradient(ellipse at 65% 35%, rgba(255,255,255,0.18), transparent 55%), url(".concat("","/images/illustration-construction-site.png)")}})]}),(0,g.jsxs)("div",{className:"dashboard-card project-metrics-card",children:[(0,g.jsxs)("div",{className:"card-header",children:[(0,g.jsxs)("h3",{children:[(0,g.jsx)(x.v$b,{})," Project Progress"]}),(0,g.jsx)("span",{className:"metrics-subtitle",children:"Based on latest PIC reports"})]}),(0,g.jsx)("div",{className:"project-metrics-container",children:Y?(0,g.jsxs)("div",{className:"metrics-loading",children:[(0,g.jsx)("div",{className:"loading-spinner"}),(0,g.jsx)("span",{children:"Loading project metrics..."})]}):0===$.length?(0,g.jsxs)("div",{className:"metrics-empty",children:[(0,g.jsx)(x.v$b,{}),(0,g.jsx)("span",{children:"No project metrics available"}),(0,g.jsx)("p",{children:"Reports need to be submitted to see progress"})]}):(0,g.jsx)("div",{className:"project-metrics-scroll",children:$.map((e=>(0,g.jsxs)(h.N_,{to:"/am/projects/".concat(e.projectId),className:"project-metric-item project-metric-link",style:{textDecoration:"none"},"aria-label":"View project ".concat(e.projectName),children:[(0,g.jsxs)("div",{className:"metric-header",children:[(0,g.jsxs)("div",{className:"metric-project-info",children:[(0,g.jsx)("h4",{className:"metric-project-name",children:e.projectName}),(0,g.jsxs)("p",{className:"metric-project-details",children:[(0,g.jsx)("span",{className:"metric-pm",children:e.pm}),(0,g.jsx)("span",{className:"metric-area",children:e.area})]})]}),(0,g.jsx)("div",{className:"metric-progress-circle",children:(0,g.jsxs)("div",{className:"progress-ring",children:[(0,g.jsxs)("svg",{width:"60",height:"60",children:[(0,g.jsx)("circle",{cx:"30",cy:"30",r:"25",stroke:"#e2e8f0",strokeWidth:"4",fill:"transparent"}),(0,g.jsx)("circle",{cx:"30",cy:"30",r:"25",stroke:e.progress>=80?"#10B981":e.progress>=50?"#3B82F6":"#F59E0B",strokeWidth:"4",fill:"transparent",strokeDasharray:"".concat(2*Math.PI*25),strokeDashoffset:"".concat(2*Math.PI*25*(1-e.progress/100)),strokeLinecap:"round",transform:"rotate(-90 30 30)"})]}),(0,g.jsx)("div",{className:"progress-text",children:(0,g.jsxs)("span",{className:"progress-percentage",children:[e.progress,"%"]})})]})})]}),(0,g.jsxs)("div",{className:"metric-footer",children:[(0,g.jsxs)("div",{className:"metric-stats",children:[(0,g.jsxs)("span",{className:"metric-stat",children:[(0,g.jsx)(x.YXz,{}),e.totalPics," PICs"]}),(0,g.jsxs)("span",{className:"metric-stat",children:[(0,g.jsx)(x.bfZ,{}),e.latestDate?new Date(e.latestDate).toLocaleDateString():"\u2014"]})]}),(0,g.jsxs)("div",{className:"metric-badges",style:{marginTop:8,display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(90px,1fr))",gap:6,fontSize:11},children:[(0,g.jsxs)("div",{style:{background:"#f1f5f9",padding:"6px 8px",borderRadius:6,display:"flex",flexDirection:"column",gap:2},children:[(0,g.jsx)("span",{style:{opacity:.6},children:"Progress"}),(0,g.jsxs)("strong",{children:[e.progress,"%"]})]}),(0,g.jsxs)("div",{style:{background:"#f1f5f9",padding:"6px 8px",borderRadius:6,display:"flex",flexDirection:"column",gap:2},children:[(0,g.jsx)("span",{style:{opacity:.6},children:"Reported"}),(0,g.jsxs)("strong",{children:[e.reportingPics,"/",e.totalPics||0]})]}),(0,g.jsxs)("div",{style:{background:"#f1f5f9",padding:"6px 8px",borderRadius:6,display:"flex",flexDirection:"column",gap:2},children:[(0,g.jsx)("span",{style:{opacity:.6},children:"Pending PICs"}),(0,g.jsx)("strong",{children:e.pendingPics})]}),(0,g.jsxs)("div",{style:{background:(()=>{const a=e.waitingForAll?"Waiting":e.status;switch(null===a||void 0===a?void 0:a.toLowerCase()){case"completed":case"done":case"finished":return"#ecfdf5";case"ontrack":case"on track":case"in progress":case"active":case"ongoing":return"#eff6ff";case"pending":case"waiting":return"#fffbeb";case"regressing":case"delayed":case"behind":return"#fef2f2";case"on hold":case"paused":return"#f3e8ff";default:return"#f1f5f9"}})(),border:(()=>{const a=e.waitingForAll?"Waiting":e.status;switch(null===a||void 0===a?void 0:a.toLowerCase()){case"completed":case"done":case"finished":return"1px solid #bbf7d0";case"ontrack":case"on track":case"in progress":case"active":case"ongoing":return"1px solid #dbeafe";case"pending":case"waiting":return"1px solid #fed7aa";case"regressing":case"delayed":case"behind":return"1px solid #fecaca";case"on hold":case"paused":return"1px solid #e9d5ff";default:return"1px solid #e2e8f0"}})(),padding:"6px 8px",borderRadius:6,display:"flex",flexDirection:"column",gap:2},children:[(0,g.jsx)("span",{style:{opacity:.6},children:"Status"}),(0,g.jsx)("strong",{style:{textTransform:"capitalize",color:(()=>{const a=e.waitingForAll?"Waiting":e.status;switch(null===a||void 0===a?void 0:a.toLowerCase()){case"completed":case"done":case"finished":return"#059669";case"ontrack":case"on track":case"in progress":case"active":case"ongoing":return"#1d4ed8";case"pending":case"waiting":return"#d97706";case"regressing":case"delayed":case"behind":return"#dc2626";case"on hold":case"paused":return"#7c3aed";default:return"#374151"}})()},children:e.waitingForAll?"Waiting":e.status})]}),(0,g.jsxs)("div",{style:{background:"#f1f5f9",padding:"6px 8px",borderRadius:6,display:"flex",flexDirection:"column",gap:2},children:[(0,g.jsx)("span",{style:{opacity:.6},children:"Last Report"}),(0,g.jsx)("strong",{children:e.latestDate?new Date(e.latestDate).toLocaleDateString():"\u2014"})]})]}),(0,g.jsx)("div",{className:"metric-mini-chart",style:{marginTop:10,background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:8,padding:"4px 6px"},children:(a=>{const s=((null===(a=Z[e.projectId])||void 0===a?void 0:a.picContributions)||[]).filter((e=>e.hasReport)).map((e=>({name:e.picName.length>6?e.picName.slice(0,6)+"\u2026":e.picName,value:e.contribution||0})));return s.length?(0,g.jsx)(r.u,{width:"100%",height:90,children:(0,g.jsxs)(i.E,{data:s,margin:{top:4,right:4,left:0,bottom:0},children:[(0,g.jsx)(l.d,{strokeDasharray:"3 3",vertical:!1,stroke:"#e2e8f0"}),(0,g.jsx)(c.W,{dataKey:"name",tick:{fontSize:9},axisLine:!1,tickLine:!1}),(0,g.jsx)(o.h,{hide:!0,domain:[0,100]}),(0,g.jsx)(d.m,{cursor:{fill:"rgba(0,0,0,0.04)"},formatter:e=>[e+"%","Contribution"]}),(0,g.jsx)(m.y,{dataKey:"value",radius:[4,4,0,0],fill:"#3B82F6"})]})}):(0,g.jsx)("div",{style:{fontSize:11,opacity:.6,textAlign:"center",padding:"6px 0"},children:"No PIC reports yet"})})()})]})]},e.projectId)))})})]}),(0,g.jsxs)("div",{className:"dashboard-card requests-card",children:[(0,g.jsxs)("div",{className:"card-header",children:[(0,g.jsxs)("h3",{className:"card-title",children:[(0,g.jsx)(x.dv1,{})," Material Requests"]}),(0,g.jsxs)("div",{className:"requests-summary",children:[(0,g.jsxs)("span",{className:"pending-count",children:[I.length," Pending"]}),(0,g.jsxs)(h.N_,{to:"/am/matreq",className:"view-all-link",children:["View All ",(0,g.jsx)(x.Z0P,{})]})]})]}),(0,g.jsx)("div",{className:"requests-content",children:F?(0,g.jsxs)("div",{className:"error-state",children:[(0,g.jsx)(x.BS8,{}),(0,g.jsx)("span",{children:F})]}):0===L.length?(0,g.jsxs)("div",{className:"empty-state",children:[(0,g.jsx)(x.H5e,{}),(0,g.jsx)("span",{children:"No material requests found"}),(0,g.jsx)("p",{children:"All requests have been processed or none are pending"})]}):(0,g.jsx)("div",{className:"requests-list",children:L.sort(((e,a)=>{const s=(e.status||"").replace(/\s+/g," ").trim().toUpperCase(),t=(a.status||"").replace(/\s+/g," ").trim().toUpperCase(),n="PENDING AM"===s||"PENDING AREA MANAGER"===s,r="PENDING AM"===t||"PENDING AREA MANAGER"===t;return n&&!r?-1:!n&&r?1:new Date(a.createdAt)-new Date(e.createdAt)})).map((e=>{var a,s,t;const n=(e.status||"").replace(/\s+/g," ").trim().toUpperCase(),r="PENDING AM"===n||"PENDING AREA MANAGER"===n;return(0,g.jsxs)(h.N_,{to:"/am/material-request/".concat(e._id),className:"request-item-new-layout ".concat(r?"pending-for-user":""),style:{textDecoration:"none"},children:[(0,g.jsxs)("div",{className:"request-left-section",children:[(0,g.jsx)("div",{className:"request-icon-new",children:(0,g.jsx)(x.H5e,{})}),(0,g.jsxs)("div",{className:"request-details-new",children:[(0,g.jsx)("h4",{className:"request-title-new",children:null===(a=e.materials)||void 0===a?void 0:a.map((e=>"".concat(e.materialName," (").concat(e.quantity,")"))).join(", ")}),(0,g.jsxs)("div",{className:"request-meta-new",children:[(0,g.jsx)("span",{className:"request-project-new",children:null===(s=e.project)||void 0===s?void 0:s.projectName}),(0,g.jsx)("span",{className:"request-date-new",children:new Date(e.createdAt).toLocaleDateString()})]})]})]}),(0,g.jsx)("div",{className:"request-center-section",children:(0,g.jsxs)("div",{className:"tracking-timeline-new",children:[(0,g.jsxs)("div",{className:"timeline-step-new ".concat(ee(e.status,"placed")),children:[(0,g.jsx)("div",{className:"timeline-icon-new",children:(0,g.jsx)(x.A7C,{})}),(0,g.jsx)("span",{className:"timeline-label-new",children:"Placed"})]}),(0,g.jsx)("div",{className:"timeline-connector-new ".concat(["Pending PM","Pending AM","Approved","Received","PENDING PROJECT MANAGER"].includes(e.status)?"completed":"")}),(0,g.jsxs)("div",{className:"timeline-step-new ".concat(ee(e.status,"pm")),children:[(0,g.jsx)("div",{className:"timeline-icon-new",children:(0,g.jsx)(x.p7b,{})}),(0,g.jsx)("span",{className:"timeline-label-new",children:"PM"})]}),(0,g.jsx)("div",{className:"timeline-connector-new ".concat(["Pending AM","Approved","Received","PENDING AREA MANAGER"].includes(e.status)?"completed":"")}),(0,g.jsxs)("div",{className:"timeline-step-new ".concat(ee(e.status,"am")),children:[(0,g.jsx)("div",{className:"timeline-icon-new",children:(0,g.jsx)(x.ymh,{})}),(0,g.jsx)("span",{className:"timeline-label-new",children:"AM"})]}),(0,g.jsx)("div",{className:"timeline-connector-new ".concat(["Approved","Received"].includes(e.status)?"completed":"")}),(0,g.jsxs)("div",{className:"timeline-step-new ".concat(ee(e.status,"done")),children:[(0,g.jsx)("div",{className:"timeline-icon-new",children:(0,g.jsx)(x.A7C,{})}),(0,g.jsx)("span",{className:"timeline-label-new",children:"Done"})]})]})}),(0,g.jsx)("div",{className:"request-right-section",children:(0,g.jsx)("div",{className:"request-status-new",children:(0,g.jsx)("span",{className:"status-text-new ".concat(null===(t=e.status)||void 0===t?void 0:t.replace(/\s/g,"").toLowerCase()),children:e.status})})})]},e._id)}))})})]})]})})]})]})}},1116:(e,a,s)=>{s.r(a),s.d(a,{default:()=>c});var t=s(9379),n=(s(5043),s(1245)),r=s(3216),i=s(8818),l=s(579);function c(){const{id:e}=(0,r.g)(),a={"View Project":"/am/projects/".concat(e),Reports:"/am/progress-report/".concat(e)};return(0,l.jsx)(n.A,{role:"am",useUnifiedHeader:!0,navPathOverrides:(0,t.A)((0,t.A)({},{dashboard:"/am",projects:"/am/viewproj",chat:"/am/chat",materials:"/am/matreq",manpower:"/am/manpower-requests"}),a),customHeader:(0,l.jsx)(i.A,{roleSegment:"am"})})}},1254:()=>{},2291:(e,a,s)=>{s.d(a,{E:()=>c});var t=s(8420),n=s(8643),r=s(2185),i=s(6026),l=s(3831),c=(0,t.gu)({chartName:"BarChart",GraphicalChild:n.y,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:r.W},{axisType:"yAxis",AxisComp:i.h}],formatAxisMap:l.pr})},2443:(e,a,s)=>{s.r(a),s.d(a,{default:()=>c});var t=s(5043),n=s(5475),r=s(4801),i=s(3204),l=s(579);const c=()=>{const[e,a]=(0,t.useState)("Alveo Sanctuary"),[c,o]=(0,t.useState)(!1),d="Zandro",m=e=>{console.log("Downloading report ".concat(e))};return(0,l.jsxs)("div",{className:"area-dash head",children:[(0,l.jsxs)("header",{className:"header",children:[(0,l.jsxs)("div",{className:"logo-container",children:[(0,l.jsx)("img",{src:s(8370),alt:"FadzTrack Logo",className:"logo-img"}),(0,l.jsx)("h1",{className:"brand-name",children:"FadzTrack"})]}),(0,l.jsxs)("nav",{className:"nav-menu",children:[(0,l.jsxs)(n.N_,{to:"/am",className:"nav-link",children:[(0,l.jsx)(i.$BV,{})," Dashboard"]}),(0,l.jsxs)(n.N_,{to:"/am/chat",className:"nav-link",children:[(0,l.jsx)(i.uN,{})," Chat"]}),(0,l.jsxs)(n.N_,{to:"/am/matreq",className:"nav-link",children:[(0,l.jsx)(i.H5e,{})," Material"]}),(0,l.jsxs)(n.N_,{to:"/am/manpower-requests",className:"nav-link",children:[(0,l.jsx)(i.YXz,{})," Manpower"]}),(0,l.jsxs)(n.N_,{to:"/am/viewproj",className:"nav-link",children:[(0,l.jsx)(i.yd7,{})," Projects"]}),(0,l.jsxs)(n.N_,{to:"/logs",className:"nav-link",children:[(0,l.jsx)(i.kkc,{})," Logs"]}),(0,l.jsxs)(n.N_,{to:"/reports",className:"nav-link",children:[(0,l.jsx)(i.v$b,{})," Reports"]})]}),(0,l.jsxs)("div",{className:"profile-menu-container",style:{display:"flex",alignItems:"center",gap:18},children:[(0,l.jsx)(r.A,{}),(0,l.jsx)("div",{className:"profile-circle",onClick:()=>o(!c),children:d?d.charAt(0).toUpperCase():"Z"}),c&&(0,l.jsx)("div",{className:"profile-menu",children:(0,l.jsx)("button",{onClick:()=>{console.log("Logout")},children:"Logout"})})]})]}),(0,l.jsx)("div",{className:"progress-report-container",children:(0,l.jsxs)("div",{className:"progress-report-content",children:[(0,l.jsxs)("div",{className:"report-header",children:[(0,l.jsxs)("h1",{className:"report-title",children:["Progress Report",(0,l.jsx)("span",{className:"dropdown-arrow",children:"\u2304"})]}),(0,l.jsx)("div",{className:"filter-section",children:(0,l.jsxs)("div",{className:"filter-group",children:[(0,l.jsx)("button",{className:"filter-btn active",children:"All"}),(0,l.jsxs)("div",{className:"location-dropdown",children:[(0,l.jsx)("select",{value:e,onChange:e=>a(e.target.value),className:"location-select",children:["All","Alveo Sanctuary","BGC Hotel","Makati Central"].map((e=>(0,l.jsx)("option",{value:e,children:e},e)))}),(0,l.jsx)("span",{className:"dropdown-arrow",children:"\u2304"})]})]})})]}),(0,l.jsxs)("div",{className:"reports-section",children:[(0,l.jsx)("h2",{className:"section-title",children:"Recent Progress Report"}),(0,l.jsxs)("div",{className:"reports-table",children:[(0,l.jsxs)("div",{className:"table-header",children:[(0,l.jsx)("div",{className:"header-cell",children:"Report Period"}),(0,l.jsx)("div",{className:"header-cell",children:"File"}),(0,l.jsx)("div",{className:"header-cell"}),(0,l.jsx)("div",{className:"header-cell",children:"Submitted"}),(0,l.jsx)("div",{className:"header-cell",children:"Location"})]}),[{id:1,period:"Apr 1 - Apr 14, 2025",file:"Progress Report.docx",submitted:"4/10/24 11:59pm",location:"Alveo Sanctuary"}].map((e=>(0,l.jsxs)("div",{className:"table-row",children:[(0,l.jsx)("div",{className:"table-cell",children:e.period}),(0,l.jsx)("div",{className:"table-cell",children:e.file}),(0,l.jsx)("div",{className:"table-cell",children:(0,l.jsx)("button",{className:"download-btn",onClick:()=>m(e.id),children:"\ud83d\udcc4 Download"})}),(0,l.jsx)("div",{className:"table-cell",children:e.submitted}),(0,l.jsx)("div",{className:"table-cell",children:e.location})]},e.id)))]})]}),(0,l.jsxs)("div",{className:"reports-section",children:[(0,l.jsx)("h2",{className:"section-title",children:"Previous Progress Reports"}),(0,l.jsxs)("div",{className:"reports-table",children:[(0,l.jsxs)("div",{className:"table-header",children:[(0,l.jsx)("div",{className:"header-cell",children:"Report Period"}),(0,l.jsx)("div",{className:"header-cell",children:"File"}),(0,l.jsx)("div",{className:"header-cell"}),(0,l.jsx)("div",{className:"header-cell",children:"Submitted"}),(0,l.jsx)("div",{className:"header-cell",children:"Location"})]}),[{id:4,period:"Apr 1 - Apr 14, 2025",file:"Progress Report.docx",submitted:"4/10/24 11:59pm",location:"Alveo Sanctuary"}].map((e=>(0,l.jsxs)("div",{className:"table-row",children:[(0,l.jsx)("div",{className:"table-cell",children:e.period}),(0,l.jsx)("div",{className:"table-cell",children:e.file}),(0,l.jsx)("div",{className:"table-cell",children:(0,l.jsx)("button",{className:"download-btn",onClick:()=>m(e.id),children:"\ud83d\udcc4 Download"})}),(0,l.jsx)("div",{className:"table-cell",children:e.submitted}),(0,l.jsx)("div",{className:"table-cell",children:e.location})]},e.id)))]})]}),(0,l.jsx)("div",{className:"back-button-container",children:(0,l.jsx)("button",{className:"back-btn",onClick:()=>{console.log("Navigate back")},children:"Back"})})]})})]})}},2498:(e,a,s)=>{s.r(a),s.d(a,{default:()=>d});var t=s(5043),n=s(3216),r=s(5475),i=s(411),l=s(4801),c=s(3204),o=s(579);function d(){var e,a,d;const m=(0,n.Zp)(),{id:p}=(0,n.g)(),h="undefined"!==typeof window?localStorage.getItem("user"):null,u=h?JSON.parse(h):null,[j,x]=(0,t.useState)(!1),[g,v]=(0,t.useState)(null),[N,f]=(0,t.useState)(!0),[b,y]=(0,t.useState)(!1),[w,A]=(0,t.useState)(!1),[k,C]=(0,t.useState)([]),[S,_]=(0,t.useState)([]),[D,P]=(0,t.useState)((()=>null!==u&&void 0!==u&&u.name?u.name:"ALECK")),[q,R]=(0,t.useState)((null===u||void 0===u?void 0:u.area)||""),[M,L]=(0,t.useState)("");(0,t.useEffect)((()=>{E()}),[p]);const E=async()=>{f(!0);try{var e;const{data:a}=await i.Ay.get("/manpower-requests/".concat(p));v(a||null),L((null===a||void 0===a||null===(e=a.project)||void 0===e?void 0:e._id)||""),R((e=>e||(null===u||void 0===u?void 0:u.area)||""))}catch(a){console.error("Failed to fetch request:",a),v(null)}finally{f(!1)}};(0,t.useEffect)((()=>{if(!g)return;(async()=>{try{const{data:e}=await i.Ay.get("/manpower-requests/inactive"),a=Array.isArray(e)?e:[],s=(g.manpowers||[]).map((e=>e.type)),t=a.filter((e=>s.includes(e.position)));_(t)}catch(e){console.error("\u274c Error fetching inactive manpowers:",e),_([])}})()}),[g]),(0,t.useEffect)((()=>{const e=e=>{e.target.closest(".profile-menu-container")||x(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[]);return N?(0,o.jsx)("div",{className:"fadztrack-main",children:(0,o.jsx)("div",{className:"fadztrack-card",children:"Loading..."})}):g?(0,o.jsxs)("div",{className:"fadztrack-app",children:[(0,o.jsxs)("header",{className:"header",children:[(0,o.jsxs)("div",{className:"logo-container",children:[(0,o.jsx)("img",{src:s(8370),alt:"FadzTrack Logo",className:"logo-img"}),(0,o.jsx)("h1",{className:"brand-name",children:"FadzTrack"})]}),(0,o.jsxs)("nav",{className:"nav-menu",children:[(0,o.jsxs)(r.N_,{to:"/am",className:"nav-link",children:[(0,o.jsx)(c.$BV,{})," Dashboard"]}),(0,o.jsxs)(r.N_,{to:"/am/chat",className:"nav-link",children:[(0,o.jsx)(c.uN,{})," Chat"]}),(0,o.jsxs)(r.N_,{to:"/am/matreq",className:"nav-link",children:[(0,o.jsx)(c.H5e,{})," Material"]}),(0,o.jsxs)(r.N_,{to:"/am/manpower-requests",className:"nav-link",children:[(0,o.jsx)(c.YXz,{})," Manpower"]}),(0,o.jsxs)(r.N_,{to:"/am/viewproj",className:"nav-link",children:[(0,o.jsx)(c.yd7,{})," Projects"]}),(0,o.jsxs)(r.N_,{to:"/logs",className:"nav-link",children:[(0,o.jsx)(c.kkc,{})," Logs"]}),(0,o.jsxs)(r.N_,{to:"/reports",className:"nav-link",children:[(0,o.jsx)(c.v$b,{})," Reports"]})]}),(0,o.jsxs)("div",{className:"profile-menu-container",style:{display:"flex",alignItems:"center",gap:18},children:[(0,o.jsx)(l.A,{}),(0,o.jsx)("div",{className:"profile-circle",onClick:()=>x(!j),children:D?D.charAt(0).toUpperCase():"Z"}),j&&(0,o.jsx)("div",{className:"profile-menu",children:(0,o.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),m("/")},children:"Logout"})})]})]}),(0,o.jsx)("div",{className:"fadztrack-main",children:(0,o.jsxs)("div",{className:"fadztrack-card details-card",children:[(0,o.jsx)("div",{style:{textAlign:"center"},children:(0,o.jsxs)("h1",{className:"fadztrack-title",style:{textAlign:"center"},children:["Request for ",g.manpowers.map((e=>"".concat(e.quantity," ").concat(e.type))).join(", ")]})}),(0,o.jsxs)("p",{className:"fadztrack-subtitle",children:[null===(e=g.project)||void 0===e?void 0:e.projectName," | Engr. ",null===(a=g.createdBy)||void 0===a?void 0:a.name]}),(0,o.jsxs)("div",{className:"fadztrack-form-row center-row",children:[(0,o.jsxs)("div",{className:"fadztrack-form-group",children:[(0,o.jsx)("label",{children:(0,o.jsx)("b",{children:"Target Acquisition Date:"})}),(0,o.jsx)("div",{children:new Date(g.acquisitionDate).toLocaleDateString()})]}),(0,o.jsxs)("div",{className:"fadztrack-form-group",children:[(0,o.jsx)("label",{children:(0,o.jsx)("b",{children:"Duration:"})}),(0,o.jsxs)("div",{children:[g.duration," day(s)"]})]})]}),(0,o.jsxs)("div",{className:"fadztrack-summary-section",children:[(0,o.jsx)("label",{children:(0,o.jsx)("b",{children:"Request Summary"})}),(0,o.jsx)("div",{className:"fadztrack-summary-box",children:(g.manpowers||[]).map(((e,a)=>(0,o.jsxs)("div",{children:[e.quantity," ",e.type]},a)))})]}),b&&"Approved"!==g.status?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"fadztrack-form-row",children:[(0,o.jsxs)("div",{className:"fadztrack-form-group",children:[(0,o.jsx)("label",{children:"Select Area"}),(0,o.jsxs)("select",{className:"fadztrack-select",value:q,onChange:e=>R(e.target.value),children:[(0,o.jsx)("option",{value:"",children:"Select Area"}),(0,o.jsx)("option",{value:"Batangas",children:"Batangas"}),(0,o.jsx)("option",{value:"Laguna",children:"Laguna"}),(0,o.jsx)("option",{value:"Makati",children:"Makati"})]})]}),(0,o.jsxs)("div",{className:"fadztrack-form-group",children:[(0,o.jsx)("label",{children:"Project"}),(0,o.jsx)("input",{className:"fadztrack-select",value:(null===(d=g.project)||void 0===d?void 0:d.projectName)||"",readOnly:!0})]})]}),(0,o.jsxs)("div",{className:"fadztrack-form-group",children:[(0,o.jsx)("label",{children:"Select Manpower"}),(null===g||void 0===g?void 0:g.manpowers)&&g.manpowers.length>0&&(0,o.jsxs)("div",{style:{marginBottom:"8px",fontSize:"0.9rem",color:"#666"},children:["Requested types: ",g.manpowers.map((e=>"".concat(e.type," (").concat(e.quantity,")"))).join(", ")]}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,o.jsxs)("select",{defaultValue:"",onChange:e=>(e=>{const a=S.find((a=>a._id===e));a&&(k.some((a=>a._id===e))||C((e=>[...e,a])))})(e.target.value),className:"fadztrack-select",style:{flex:1},children:[(0,o.jsx)("option",{value:"",children:0===S.length?"No matching manpower available":"Select Manpower"}),S.filter((e=>!k.some((a=>a._id===e._id)))).map((e=>(0,o.jsxs)("option",{value:e._id,children:[e.name," (",e.position,")"]},e._id)))]}),(0,o.jsx)("button",{type:"button",className:"fadztrack-button",style:{padding:"8px 14px",fontSize:14},onClick:()=>alert("Use dropdown to select manpower.\nRepeat for additional manpower."),children:"+"})]})]}),k.length>0&&(0,o.jsxs)("div",{className:"fadztrack-form-group",children:[(0,o.jsx)("label",{children:"Manpower to Lend"}),(0,o.jsx)("div",{className:"fadztrack-select",style:{minHeight:50,padding:10,display:"flex",flexWrap:"wrap",gap:"8px"},children:k.map((e=>(0,o.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",background:"#dceafe",color:"#1d4ed8",padding:"6px 12px",borderRadius:"20px",fontSize:"0.95rem"},children:[e.name," (",e.position,")",(0,o.jsx)("button",{onClick:()=>{return a=e._id,void C((e=>e.filter((e=>e._id!==a))));var a},style:{background:"none",border:"none",marginLeft:8,color:"#1e3a8a",fontWeight:"bold",fontSize:"1rem",cursor:"pointer",lineHeight:"1"},title:"Remove",children:"\xd7"})]},e._id)))})]}),(0,o.jsxs)("div",{className:"fadztrack-buttons",style:{marginTop:32},children:[(0,o.jsx)("button",{className:"fadztrack-button",onClick:()=>{b?y(!1):m("/am/manpower-requests")},disabled:w,children:"Back"}),(0,o.jsx)("button",{className:"fadztrack-button review-btn",onClick:async()=>{if(q&&M&&0!==k.length){A(!0);try{await i.Ay.put("/manpower-requests/".concat(p,"/approve"),{approvedBy:(null===u||void 0===u?void 0:u.name)||"",status:"Approved",area:q,project:M,manpowerProvided:k.map((e=>e._id))}),alert("\u2705 Request Approved!"),y(!1),E()}catch(s){var e,a;console.error(s),alert((null===s||void 0===s||null===(e=s.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||"\u274c Failed to approve request.")}finally{A(!1)}}else alert("Fill all required fields.")},disabled:w,children:w?"Processing...":"Provide Manpower"})]})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"fadztrack-summary-section",children:[(0,o.jsx)("label",{className:"fadztrack-summary-label",children:(0,o.jsx)("b",{children:"Request Description"})}),(0,o.jsx)("div",{className:"fadztrack-summary-description",children:g.description})]}),"Approved"!==g.status&&(0,o.jsxs)("div",{style:{display:"flex",marginTop:32,gap:24,justifyContent:"center"},children:[(0,o.jsx)("button",{className:"fadztrack-button",style:{background:"#c0392b"},onClick:async()=>{if(window.confirm("Confirm Rejection?\n\nRejecting this request will remove this from your list of Other's Request.")){A(!0);try{await i.Ay.put("/manpower-requests/".concat(p),{status:"Rejected"}),alert("Request rejected successfully. It has been removed from your list."),m("/am/manpower-requests")}catch(s){var e,a;console.error(s),alert((null===s||void 0===s||null===(e=s.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||"Failed to reject request.")}finally{A(!1)}}},disabled:w,children:"Reject Request"}),(0,o.jsx)("button",{className:"fadztrack-button review-btn",onClick:()=>y(!0),children:"Review Request"})]}),"Approved"===g.status&&(0,o.jsx)("div",{style:{marginTop:32,textAlign:"center",fontWeight:"bold",color:"#189d38"},children:g.returnDate?(0,o.jsxs)(o.Fragment,{children:["Request fulfilled, manpower set to return on:",(0,o.jsx)("span",{style:{color:"#2079c4",marginLeft:6},children:new Date(g.returnDate).toLocaleDateString("en-CA")})]}):"Manpower Request Approved"})]})]})})]}):(0,o.jsx)("div",{className:"fadztrack-main",children:(0,o.jsx)("div",{className:"fadztrack-card",children:"Request not found or failed to load."})})}},2739:()=>{},3159:(e,a,s)=>{s.r(a),s.d(a,{default:()=>r});s(5043);var t=s(5111),n=s(579);const r=()=>(0,n.jsx)(t.A,{role:"Area Manager",fetchUrl:"/requests/mine",detailLinkBase:"/am/material-request",rootClass:"am-request-list",headerTitle:"AM Material Requests",headerSubtitle:"Approve validated requests and monitor delivery"})},3394:(e,a,s)=>{s.r(a),s.d(a,{default:()=>m});var t=s(9379),n=s(5043),r=s(3216),i=s(5475),l=s(411),c=s(4801),o=s(3204),d=s(579);const m=()=>{const e=(0,r.Zp)(),[a,m]=(0,n.useState)(!1),p=JSON.parse(localStorage.getItem("user")||"{}"),[h,u]=(0,n.useState)([]),[j,x]=(0,n.useState)(!0),[g,v]=(0,n.useState)(""),[N,f]=(0,n.useState)("All"),[b]=(0,n.useState)(""),[y,w]=(0,n.useState)(1),[A,k]=(0,n.useState)((null===p||void 0===p?void 0:p.name)||"ALECK"),[C,S]=(0,n.useState)([]),[_,D]=(0,n.useState)([]),[P,q]=(0,n.useState)([]),[R,M]=(0,n.useState)({}),[L,E]=(0,n.useState)([]),[I]=(0,n.useState)([{id:1,name:"Rychea Miralles",initial:"R",message:"Hello Good Morning po! As...",color:"#4A6AA5"},{id:2,name:"Third Castellar",initial:"T",message:"Hello Good Morning po! As...",color:"#2E7D32"},{id:3,name:"Zenarose Miranda",initial:"Z",message:"Hello Good Morning po! As...",color:"#9C27B0"}]);(0,n.useEffect)((()=>{if(!localStorage.getItem("token"))return v("Session expired. Please log in."),void x(!1);l.Ay.get("/manpower-requests").then((e=>{u(Array.isArray(e.data)?e.data:[]),x(!1),v("")})).catch((e=>{!e.response||403!==e.response.status&&401!==e.response.status?v("Failed to load requests"):v("Session expired or unauthorized. Please login."),u([]),x(!1)}))}),[]),(0,n.useEffect)((()=>{p._id&&(async()=>{try{const{data:e}=await l.Ay.get("/users/".concat(p._id,"/locations"));S(e);const{data:a}=await l.Ay.get("/projects");D(a);const{data:s}=await l.Ay.get("/manpower-requests");E(s.filter((a=>"Pending AM"===a.status&&a.project&&e.some((e=>{var s;return e._id===((null===(s=a.project.location)||void 0===s?void 0:s._id)||a.project.location)})))))}catch(e){S([]),D([]),E([])}})()}),[p._id]),(0,n.useEffect)((()=>{C.length&&_.length&&q(_.filter((e=>C.some((a=>{var s;return a._id===((null===(s=e.location)||void 0===s?void 0:s._id)||e.location)})))).map((e=>{var a;const s=C.find((a=>{var s;return a._id===((null===(s=e.location)||void 0===s?void 0:s._id)||e.location)}));return(0,t.A)((0,t.A)({},e),{},{location:s?(0,t.A)({},s):{name:"Unknown Location",region:""},name:e.projectName,engineer:(null===(a=e.projectmanager)||void 0===a?void 0:a.name)||"Not Assigned"})})))}),[C,_]),(0,n.useEffect)((()=>{const e=e=>{e.target.closest(".profile-menu-container")||m(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[]);const z=P.reduce(((e,a)=>{var s;const t=(null===(s=a.location)||void 0===s?void 0:s._id)||"unknown";var n,r;e[t]||(e[t]={name:(null===(n=a.location)||void 0===n?void 0:n.name)||"Unknown Location",region:(null===(r=a.location)||void 0===r?void 0:r.region)||"",projects:[]});return e[t].projects.push(a),e}),{}),F=h.filter((e=>{var a,s;const t=(e.status||"").toLowerCase(),n="All"===N||"Pending"===N&&t.includes("pending")||"Approved"===N&&t.includes("approved")||"Cancelled"===N&&(t.includes("denied")||t.includes("cancel")),r=[e.manpowers&&e.manpowers.map((e=>e.type)).join(", "),e.description,null===(a=e.createdBy)||void 0===a?void 0:a.name,null===(s=e.project)||void 0===s?void 0:s.projectName].join(" ").toLowerCase(),i=!b||r.includes(b.toLowerCase());return n&&i})),B=Math.ceil(F.length/5),T=5*(y-1),U=F.slice(T,T+5);return(0,d.jsxs)("div",{children:[(0,d.jsxs)("header",{className:"header",children:[(0,d.jsxs)("div",{className:"logo-container",children:[(0,d.jsx)("img",{src:s(8370),alt:"FadzTrack Logo",className:"logo-img"}),(0,d.jsx)("h1",{className:"brand-name",children:"FadzTrack"})]}),(0,d.jsxs)("nav",{className:"nav-menu",children:[(0,d.jsxs)(i.N_,{to:"/am",className:"nav-link",children:[(0,d.jsx)(o.$BV,{})," Dashboard"]}),(0,d.jsxs)(i.N_,{to:"/am/chat",className:"nav-link",children:[(0,d.jsx)(o.uN,{})," Chat"]}),(0,d.jsxs)(i.N_,{to:"/am/matreq",className:"nav-link",children:[(0,d.jsx)(o.H5e,{})," Material"]}),(0,d.jsxs)(i.N_,{to:"/am/manpower-requests",className:"nav-link",children:[(0,d.jsx)(o.YXz,{})," Manpower"]}),(0,d.jsxs)(i.N_,{to:"/am/viewproj",className:"nav-link",children:[(0,d.jsx)(o.yd7,{})," Projects"]}),(0,d.jsxs)(i.N_,{to:"/logs",className:"nav-link",children:[(0,d.jsx)(o.kkc,{})," Logs"]}),(0,d.jsxs)(i.N_,{to:"/reports",className:"nav-link",children:[(0,d.jsx)(o.v$b,{})," Reports"]})]}),(0,d.jsxs)("div",{className:"profile-menu-container",style:{display:"flex",alignItems:"center",gap:18},children:[(0,d.jsx)(c.A,{}),(0,d.jsx)("div",{className:"profile-circle",onClick:()=>m(!a),children:A?A.charAt(0).toUpperCase():"Z"}),a&&(0,d.jsx)("div",{className:"profile-menu",children:(0,d.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),e("/")},children:"Logout"})})]})]}),(0,d.jsxs)("div",{className:"area-dash dashboard-layout",children:[(0,d.jsxs)("div",{className:"area-dash sidebar",children:[(0,d.jsx)("h2",{children:"Dashboard"}),(0,d.jsx)("button",{className:"area-dash add-project-btn",onClick:()=>e("/am/addproj"),children:"Add New Project"}),(0,d.jsx)("div",{className:"area-dash location-folders",children:Object.entries(z).map((e=>{let[a,s]=e;return(0,d.jsxs)("div",{className:"area-dash location-folder",children:[(0,d.jsxs)("div",{className:"area-dash location-header",onClick:()=>M((e=>(0,t.A)((0,t.A)({},e),{},{[a]:!e[a]}))),children:[(0,d.jsxs)("div",{className:"area-dash folder-icon",children:[(0,d.jsx)("span",{className:"area-dash folder-arrow ".concat(R[a]?"expanded":""),children:"\u25b6"}),(0,d.jsx)("span",{className:"area-dash folder-icon-img",children:"\ud83d\udcc1"})]}),(0,d.jsxs)("div",{className:"area-dash location-info",children:[(0,d.jsx)("div",{className:"area-dash location-name",children:s.name}),(0,d.jsx)("div",{className:"area-dash location-region",children:s.region})]}),(0,d.jsx)("div",{className:"area-dash project-count",children:s.projects.length})]}),R[a]&&(0,d.jsx)("div",{className:"area-dash projects-list",children:s.projects.map((e=>(0,d.jsxs)(i.N_,{to:"/am/projects/".concat(e._id),className:"area-dash project-item",children:[(0,d.jsxs)("div",{className:"area-dash project-icon",children:[(0,d.jsx)("span",{className:"area-dash icon",children:"\ud83c\udfd7\ufe0f"}),(0,d.jsx)("div",{className:"area-dash icon-bg"})]}),(0,d.jsxs)("div",{className:"area-dash project-info",children:[(0,d.jsx)("div",{className:"area-dash project-name",children:e.name}),(0,d.jsx)("div",{className:"area-dash project-engineer",children:e.engineer})]})]},e._id)))})]},a)}))})]}),(0,d.jsx)("main",{className:"main-content",style:{flex:1,minHeight:"100vh"},children:(0,d.jsxs)("div",{className:"requests-container",children:[(0,d.jsxs)("div",{className:"requests-header",children:[(0,d.jsx)("h2",{className:"page-title",children:"Manpower Requests"}),(0,d.jsx)("div",{className:"filter-tabs",children:["All","Pending","Approved","Cancelled"].map((e=>(0,d.jsx)("button",{className:"filter-tab ".concat(N===e?"active":""),onClick:()=>f(e),children:e},e)))})]}),(0,d.jsx)("div",{className:"requests-list",children:j?(0,d.jsx)("div",{children:"Loading requests..."}):g?(0,d.jsx)("div",{style:{color:"red",marginBottom:20},children:g}):0===U.length?(0,d.jsx)("div",{className:"no-requests",children:(0,d.jsx)("p",{children:"No manpower requests found matching your criteria."})}):U.map((e=>{var a,s;return(0,d.jsxs)(i.N_,{to:"/am/manpower-requests/".concat(e._id),className:"request-item",style:{textDecoration:"none",color:"inherit"},children:[(0,d.jsx)("div",{className:"request-icon",children:"\ud83d\udc77"}),(0,d.jsxs)("div",{className:"request-details",children:[(0,d.jsx)("h3",{className:"request-title",children:e.manpowers&&e.manpowers.length>0?e.manpowers.map((e=>"".concat(e.quantity," ").concat(e.type))).join(", "):"Manpower Request"}),(0,d.jsx)("p",{className:"request-description",children:e.description})]}),(0,d.jsxs)("div",{className:"request-meta",children:[(0,d.jsx)("div",{className:"request-author",children:(null===(a=e.createdBy)||void 0===a?void 0:a.name)||"Unknown"}),(0,d.jsx)("div",{className:"request-project",children:(null===(s=e.project)||void 0===s?void 0:s.projectName)||"-"}),(0,d.jsx)("div",{className:"request-date",children:e.acquisitionDate?new Date(e.acquisitionDate).toLocaleDateString():""})]}),(0,d.jsx)("div",{className:"request-actions",children:(0,d.jsx)("span",{className:"status-badge ".concat((e.status||"").replace(/\s/g,"").toLowerCase()),children:e.status})})]},e._id)}))}),(0,d.jsxs)("div",{className:"pagination",children:[(0,d.jsxs)("span",{className:"pagination-info",children:["Showing ",T+1," to ",Math.min(T+5,F.length)," of ",F.length," entries."]}),(0,d.jsxs)("div",{className:"pagination-controls",children:[(0,d.jsx)("button",{className:"pagination-btn",onClick:()=>w((e=>Math.max(e-1,1))),disabled:1===y,children:"<"}),Array.from({length:B},((e,a)=>a+1)).map((e=>(0,d.jsx)("button",{className:"pagination-btn ".concat(e===y?"active":""),onClick:()=>w(e),children:e},e))),(0,d.jsx)("button",{className:"pagination-btn",onClick:()=>w((e=>Math.min(e+1,B))),disabled:y===B,children:">"})]})]})]})}),(0,d.jsxs)("div",{className:"area-dash right-sidebar",children:[(0,d.jsxs)("div",{className:"area-dash pending-requests-section",children:[(0,d.jsxs)("div",{className:"area-dash section-header",children:[(0,d.jsx)("h2",{children:"Pending Manpower Requests"}),(0,d.jsx)(i.N_,{to:"/am/manpower-requests",className:"area-dash view-all-btn",children:"View All"})]}),(0,d.jsx)("div",{className:"area-dash pending-requests-list",children:0===L.length?(0,d.jsx)("div",{className:"area-dash no-requests",children:"No pending manpower requests"}):L.slice(0,3).map((e=>{var a,s;return(0,d.jsxs)(i.N_,{to:"/am/manpower-requests/".concat(e._id),className:"area-dash pending-request-item",children:[(0,d.jsx)("div",{className:"area-dash request-icon",children:"\ud83d\udc77"}),(0,d.jsxs)("div",{className:"area-dash request-details",children:[(0,d.jsx)("h3",{className:"area-dash request-title",children:null===(a=e.manpowers)||void 0===a?void 0:a.map((e=>"".concat(e.quantity," ").concat(e.type))).join(", ")}),(0,d.jsx)("p",{className:"area-dash request-description",children:e.description}),(0,d.jsxs)("div",{className:"area-dash request-meta",children:[(0,d.jsx)("span",{className:"area-dash request-project",children:null===(s=e.project)||void 0===s?void 0:s.projectName}),(0,d.jsxs)("span",{className:"area-dash request-date",children:["Requested: ",new Date(e.acquisitionDate).toLocaleDateString()]})]})]}),(0,d.jsx)("div",{className:"area-dash request-status",children:(0,d.jsx)("span",{className:"area-dash status-badge pending",children:"Pending AM Approval"})})]},e._id)}))})]}),(0,d.jsxs)("div",{className:"area-dash chats-section",children:[(0,d.jsx)("h3",{children:"Chats"}),(0,d.jsx)("div",{className:"area-dash chats-list",children:I.map((e=>(0,d.jsxs)("div",{className:"area-dash chat-item",children:[(0,d.jsx)("div",{className:"area-dash chat-avatar",style:{backgroundColor:e.color},children:e.initial}),(0,d.jsxs)("div",{className:"area-dash chat-details",children:[(0,d.jsx)("div",{className:"area-dash chat-name",children:e.name}),(0,d.jsx)("div",{className:"area-dash chat-message",children:e.message})]})]},e.id)))})]})]})]})]})}},3589:(e,a,s)=>{s.r(a),s.d(a,{default:()=>p});var t=s(9379),n=s(5043),r=s(7488),i=s(3216),l=(s(4905),s(5766)),c=s.n(l),o=s(411),d=s(8818),m=s(579);const p=()=>{const e=(0,i.Zp)(),a=localStorage.getItem("user"),s=a?JSON.parse(a):null,l=null===s||void 0===s?void 0:s._id,[p,h]=(0,n.useState)([]),[u,j]=(0,n.useState)([]),[x,g]=(0,n.useState)((null===s||void 0===s?void 0:s.name)||"ALECK"),[v,N]=(0,n.useState)([]),[f,b]=(0,n.useState)([]),[y,w]=(0,n.useState)([]),[A,k]=(0,n.useState)([]),[C,S]=(0,n.useState)(""),[_,D]=(0,n.useState)([]),[P,q]=(0,n.useState)([]),[R,M]=(0,n.useState)([]),[L,E]=(0,n.useState)(""),[I,z]=(0,n.useState)([]),[F,B]=(0,n.useState)([]),[T,U]=(0,n.useState)([]),[O,G]=(0,n.useState)(""),[H,V]=(0,n.useState)([]),[Z,J]=(0,n.useState)([]),[W,X]=(0,n.useState)(""),[$,K]=(0,n.useState)([]),[Y,Q]=(0,n.useState)([]),[ee,ae]=(0,n.useState)(""),[se,te]=(0,n.useState)([]),[ne,re]=(0,n.useState)(!1),[ie,le]=(0,n.useState)(!1),[ce,oe]=(0,n.useState)(!1),[de,me]=(0,n.useState)(!1),[pe,he]=(0,n.useState)({projectName:"",pic:[],staff:[],hrsite:[],contractor:"FADZ",contractorType:"Contractor",budget:"",location:"",startDate:"",endDate:"",manpower:[],projectmanager:"",areamanager:l||""}),[ue,je]=(0,n.useState)("");(0,n.useEffect)((()=>{he((e=>(0,t.A)((0,t.A)({},e),{},{areamanager:l||""})))}),[l]),(0,n.useEffect)((()=>{he((e=>e.contractor?e:(0,t.A)((0,t.A)({},e),{},{contractor:"FADZ"})))}),[]),(0,n.useEffect)((()=>{(async()=>{try{const e=await o.Ay.get("/users/unassigned-pms");N(Array.isArray(e.data)?e.data:e.data.data||[]);const a=await o.Ay.get("/projects/unassigned-pics");b(a.data||[]),w(a.data||[]);const s=await o.Ay.get("/projects/unassigned-staff");D(s.data||[]),q(s.data||[]);const t=await o.Ay.get("/projects/unassigned-hrsite");z(t.data||[]),B(t.data||[]);const n=await o.Ay.get("/manpower/unassigned");J(n.data),K(n.data)}catch(e){console.error("Failed to fetch users:",e)}})()}),[]);const xe=y.filter((e=>!A.some((a=>a._id===e._id))&&e.name.toLowerCase().includes(C.toLowerCase()))),ge=P.filter((e=>!R.some((a=>a._id===e._id))&&e.name.toLowerCase().includes(L.toLowerCase()))),ve=F.filter((e=>!T.some((a=>a._id===e._id))&&e.name.toLowerCase().includes(O.toLowerCase()))),Ne=e=>{const a=new Map;return e.forEach((e=>{e&&e._id&&a.set(e._id,e)})),Array.from(a.values())};(0,n.useEffect)((()=>{l&&o.Ay.get("/users/".concat(l,"/locations")).then((e=>V(e.data))).catch((()=>V([])))}),[l]),(0,n.useEffect)((()=>{he((e=>(0,t.A)((0,t.A)({},e),{},{manpower:Y.map((e=>e._id))})))}),[Y]);const fe=e=>{const{name:a,value:s}=e.target;"budget"!==a&&he((e=>(0,t.A)((0,t.A)({},e),{},{[a]:s})))};(0,n.useEffect)((()=>{if(""===pe.budget)return void je("");const e=String(pe.budget).split("."),a=(e[0]||"0").replace(/\B(?=(\d{3})+(?!\d))/g,",")+(e[1]?"."+e[1]:"");a!==ue&&je(a)}),[pe.budget]);const be=e=>{if(!e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return"".concat((e/Math.pow(1024,a)).toFixed(0===a?0:1)," ").concat(["B","KB","MB","GB"][a])},ye=(0,n.useCallback)((e=>{if(!e)return;const a=Array.from(e);te((e=>[...e,...a]))}),[]),we=(0,n.useCallback)((e=>{if(!e)return;const a=Array.from(e);h((e=>[...e,...a]))}),[]),Ae=(0,n.useCallback)((e=>{if(!e)return;const a=Array.from(e).filter((e=>"application/pdf"===e.type));a.length&&j((e=>{const s=new Set(e.map((e=>"".concat(e.name,"|").concat(e.size)))),t=[...e];return a.forEach((e=>{const a="".concat(e.name,"|").concat(e.size);s.has(a)||t.push(e)})),t}))}),[]),ke=$.filter((e=>!(!e.name.toLowerCase().includes(W.toLowerCase())&&!e.position.toLowerCase().includes(W.toLowerCase()))&&!Y.some((a=>a._id===e._id)))),[Ce,Se]=(0,n.useState)(!1);(0,n.useEffect)((()=>{if(!de)return;const e=e=>{"Escape"===e.key&&me(!1)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[de]);const[_e,De]=(0,n.useState)((()=>{try{const e=localStorage.getItem("mp_collapsed");return e?JSON.parse(e):{}}catch(e){return{}}})),Pe=(0,n.useMemo)((()=>{const e={};ke.forEach((a=>{const s=(a.position||"Unspecified").trim();e[s]||(e[s]={position:s,list:[],total:0}),e[s].list.push(a)}));const a={};return $.forEach((e=>{const s=(e.position||"Unspecified").trim();a[s]=(a[s]||0)+1})),Object.values(e).map((e=>(0,t.A)((0,t.A)({},e),{},{total:a[e.position]||e.list.length}))).sort(((e,a)=>e.position.localeCompare(a.position)))}),[ke,$]),[qe,Re]=(0,n.useState)((()=>{try{const e=localStorage.getItem("mp_visible_counts");return e?JSON.parse(e):{}}catch(e){return{}}})),Me=(e,a)=>Math.min(qe[e]||25,a),Le=(0,n.useMemo)((()=>{if(!Y.length)return[];const e={};return Y.forEach((a=>{const s=(a.position||"Unspecified").trim();e[s]||(e[s]=[]),e[s].push(a)})),Object.keys(e).sort(((e,a)=>e.localeCompare(a))).map((a=>({position:a,list:e[a].sort(((e,a)=>e.name.localeCompare(a.name)))})))}),[Y]);return(0,m.jsxs)("div",{children:[(0,m.jsx)(d.A,{roleSegment:"am",onLogout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),e("/")}}),(0,m.jsx)("main",{className:"area-addproj-main-content",children:(0,m.jsxs)("div",{className:"area-addproj-form-container",children:[(0,m.jsx)("h2",{className:"area-addproj-page-title",children:"Add New Project"}),(0,m.jsxs)("form",{onSubmit:async a=>{if(a.preventDefault(),Ce)return;if(!pe.projectName.trim())return void r.oR.error("Project name is required.");if(!pe.contractor.trim())return void r.oR.error("Contractor is required.");if(!pe.contractorType)return void r.oR.error("Contractor Type is required.");if(!pe.budget)return void r.oR.error("Budget is required.");if(!pe.location)return void r.oR.error("Location is required.");if(!pe.startDate||!pe.endDate)return void r.oR.error("Please select both start and end dates.");if(!pe.projectmanager)return void r.oR.error("Project Manager is required.");if(!pe.pic.length)return void r.oR.error("At least one PIC must be assigned.");if(!pe.manpower.length)return void r.oR.error("At least one manpower entry must be assigned.");if(!u.length)return void r.oR.error("A Budget PDF is required.");if(new Date(pe.endDate)<new Date(pe.startDate))return void r.oR.error("End date cannot be before start date.");Se(!0);const s=localStorage.getItem("user"),n=s?JSON.parse(s):null,i=null===n||void 0===n?void 0:n._id,l=new FormData;Object.entries((0,t.A)((0,t.A)({},pe),{},{areamanager:i})).forEach((e=>{let[a,s]=e;Array.isArray(s)?s.forEach((e=>l.append(a,e))):l.append(a,s)})),se.forEach((e=>l.append("photos",e))),p.forEach((e=>l.append("documents",e))),u.forEach((e=>l.append("budgetPdf",e)));try{const{data:a}=await o.Ay.post("/projects",l,{headers:{"Content-Type":"multipart/form-data"}});a&&a._id?e("/am/projects/".concat(a._id),{state:{justCreated:!0,projectName:a.projectName}}):e("/am")}catch(d){var c;const e=null===(c=d.response)||void 0===c?void 0:c.data;r.oR.error((null===e||void 0===e?void 0:e.message)||(null===e||void 0===e?void 0:e.error)||"Failed to add project"),console.error("\u274c Submission error:",d)}finally{Se(!1)}},className:"area-addproj-project-form",children:[(0,m.jsxs)("div",{className:"section-card meta-card",children:[(0,m.jsxs)("div",{className:"section-card-header",children:[(0,m.jsx)("h3",{children:"Project Details"}),(0,m.jsx)("span",{className:"section-hint",children:"Core information"})]}),(0,m.jsxs)("div",{className:"area-addproj-field-grid",children:[(0,m.jsxs)("div",{className:"area-addproj-form-group grid-span-2",children:[(0,m.jsx)("label",{htmlFor:"projectName",children:"Project Name"}),(0,m.jsx)("input",{type:"text",id:"projectName",name:"projectName",placeholder:"Enter project name",value:pe.projectName,onChange:fe,required:!0})]}),(0,m.jsxs)("div",{className:"area-addproj-form-group",children:[(0,m.jsx)("label",{htmlFor:"contractorType",children:"Contractor Type"}),(0,m.jsxs)("select",{id:"contractorType",name:"contractorType",value:pe.contractorType,onChange:fe,required:!0,children:[(0,m.jsx)("option",{value:"Contractor",children:"Contractor"}),(0,m.jsx)("option",{value:"Sub Contractor",children:"Sub Contractor"})]})]}),(0,m.jsxs)("div",{className:"area-addproj-form-group",children:[(0,m.jsx)("label",{htmlFor:"contractor",children:"Contractor Name"}),(0,m.jsx)("input",{type:"text",id:"contractor",name:"contractor",value:pe.contractor||"FADZ",readOnly:!0,disabled:!0,style:{background:"#f1f5f9",cursor:"not-allowed",fontWeight:600}})]}),(0,m.jsxs)("div",{className:"area-addproj-form-group",children:[(0,m.jsx)("label",{htmlFor:"projectmanager",children:"Project Manager"}),(0,m.jsxs)("select",{id:"projectmanager",name:"projectmanager",value:pe.projectmanager,onChange:fe,required:!0,children:[(0,m.jsx)("option",{value:"",children:"-- Select Project Manager --"}),v.map((e=>(0,m.jsx)("option",{value:e._id,children:e.name},e._id)))]})]}),(0,m.jsxs)("div",{className:"area-addproj-form-group",children:[(0,m.jsx)("label",{htmlFor:"budget",children:"Budget"}),(0,m.jsxs)("div",{className:"currency-field",children:[(0,m.jsx)("span",{style:{fontSize:14,color:"#64748b",marginRight:4},children:"\u20b1"}),(0,m.jsx)("input",{type:"text",id:"budget",name:"budget",inputMode:"decimal",placeholder:"0.00",value:ue,onChange:e=>{let a=e.target.value||"";a=a.replace(/[^0-9.]/g,"");const s=a.split(".");s.length>2&&(a=s[0]+"."+s.slice(1).join(""));const[n,r]=a.split("."),i=(n||"").slice(0,15),l=i.replace(/^0+(\d)/,"$1").replace(/\B(?=(\d{3})+(?!\d))/g,","),c="string"===typeof r?r.slice(0,2):void 0,o=void 0!==c&&c.length>0?"".concat(l,".").concat(c):l;je(o);const d=void 0!==c&&c.length>0?"".concat(i,".").concat(c):i;he((e=>(0,t.A)((0,t.A)({},e),{},{budget:d})))},style:{flex:1,border:"none",outline:"none",background:"transparent"},required:!0})]})]}),(0,m.jsxs)("div",{className:"area-addproj-form-group",children:[(0,m.jsx)("label",{htmlFor:"location",children:"Location"}),(0,m.jsxs)("select",{id:"location",name:"location",value:pe.location,onChange:fe,required:!0,children:[(0,m.jsx)("option",{value:"",children:"-- Select Location --"}),H.map((e=>(0,m.jsxs)("option",{value:e._id,children:[e.name," (",e.region,")"]},e._id)))]})]}),(0,m.jsxs)("div",{className:"area-addproj-form-group",children:[(0,m.jsx)("label",{htmlFor:"startDate",children:"Start Date"}),(0,m.jsx)("input",{type:"date",id:"startDate",name:"startDate",value:pe.startDate,onChange:fe,required:!0})]}),(0,m.jsxs)("div",{className:"area-addproj-form-group",children:[(0,m.jsx)("label",{htmlFor:"endDate",children:"End Date"}),(0,m.jsx)("input",{type:"date",id:"endDate",name:"endDate",value:pe.endDate,onChange:fe,required:!0,min:pe.startDate})]})]})]}),(0,m.jsxs)("div",{className:"section-card assignments-wrapper",role:"group","aria-label":"Assign PIC, Staff and HR",children:[(0,m.jsxs)("div",{className:"section-card-header",children:[(0,m.jsx)("h3",{children:"Team Roles"}),(0,m.jsx)("span",{className:"section-hint",children:"Assign PIC / Staff / HR"})]}),(0,m.jsxs)("div",{className:"assign-sections-grid",children:[(0,m.jsxs)("section",{className:"assign-card","aria-labelledby":"pic-heading",children:[(0,m.jsxs)("header",{className:"assign-card-header",children:[(0,m.jsxs)("h4",{id:"pic-heading",children:["Person In Charge ",(0,m.jsx)("span",{className:"count-chip",children:A.length})]}),(0,m.jsxs)("div",{className:"muted",style:{display:"flex",alignItems:"center",gap:8},children:[(0,m.jsx)("span",{children:"Select & add"}),A.length>0&&(0,m.jsx)("button",{type:"button",onClick:()=>{A.length&&(w((e=>Ne([...e,...A]))),k([]),he((e=>(0,t.A)((0,t.A)({},e),{},{pic:[]}))))},className:"clear-btn",style:{background:"transparent",border:"1px solid #ccc",padding:"2px 6px",borderRadius:4,cursor:"pointer",fontSize:12},children:"Clear All"})]})]}),(0,m.jsxs)("div",{className:"assign-body",children:[(0,m.jsx)("div",{className:"search-row",children:(0,m.jsx)("input",{placeholder:"Search PIC",value:C,onChange:e=>S(e.target.value)})}),(0,m.jsxs)("div",{className:"role-dual-grid","aria-label":"PIC selection lists",children:[(0,m.jsxs)("ul",{className:"available-list","aria-label":"Available PICs",children:[xe.slice(0,60).map((e=>(0,m.jsx)("li",{children:(0,m.jsxs)("button",{type:"button",onClick:()=>(e=>{A.some((a=>a._id===e._id))||(k((a=>[...a,e])),w((a=>a.filter((a=>a._id!==e._id)))),he((a=>(0,t.A)((0,t.A)({},a),{},{pic:[...a.pic,e._id]}))))})(e),title:"Add PIC",children:[(0,m.jsx)("span",{className:"avatar-sm",children:e.name.charAt(0)}),(0,m.jsx)("span",{className:"label-text",children:e.name}),(0,m.jsx)("span",{className:"plus",children:"+"})]})},e._id))),0===xe.length&&(0,m.jsx)("li",{className:"empty",children:"No matches"})]}),(0,m.jsxs)("div",{className:"assigned-list-wrapper",children:[(0,m.jsx)("div",{className:"assigned-subheader",children:"Selected"}),(0,m.jsxs)("ul",{className:"assigned-list styled","aria-label":"Assigned PICs",children:[0===A.length&&(0,m.jsx)("li",{className:"empty",style:{textAlign:"center"},children:"None"}),A.map((e=>(0,m.jsx)("li",{children:(0,m.jsxs)("div",{className:"assigned-row-card",children:[(0,m.jsxs)("div",{className:"assigned-row-main",children:[(0,m.jsx)("span",{className:"avatar-sm alt",children:e.name.charAt(0)}),(0,m.jsx)("span",{className:"label-text",children:e.name})]}),(0,m.jsx)("button",{type:"button",className:"remove-pill",onClick:()=>(e=>{w((a=>[...a,e])),k((a=>a.filter((a=>a._id!==e._id)))),he((a=>(0,t.A)((0,t.A)({},a),{},{pic:a.pic.filter((a=>a!==e._id))})))})(e),"aria-label":"Remove ".concat(e.name),children:"\u2715"})]})},e._id)))]})]})]})]})]}),(0,m.jsxs)("section",{className:"assign-card","aria-labelledby":"staff-heading",children:[(0,m.jsxs)("header",{className:"assign-card-header",children:[(0,m.jsxs)("h4",{id:"staff-heading",children:["Staff ",(0,m.jsx)("span",{className:"count-chip",children:R.length})]}),(0,m.jsxs)("div",{className:"muted",style:{display:"flex",alignItems:"center",gap:8},children:[(0,m.jsx)("span",{children:"Support roles"}),R.length>0&&(0,m.jsx)("button",{type:"button",onClick:()=>{R.length&&(q((e=>Ne([...e,...R]))),M([]),he((e=>(0,t.A)((0,t.A)({},e),{},{staff:[]}))))},className:"clear-btn",style:{background:"transparent",border:"1px solid #ccc",padding:"2px 6px",borderRadius:4,cursor:"pointer",fontSize:12},children:"Clear All"})]})]}),(0,m.jsxs)("div",{className:"assign-body",children:[(0,m.jsx)("div",{className:"search-row",children:(0,m.jsx)("input",{placeholder:"Search Staff",value:L,onChange:e=>E(e.target.value)})}),(0,m.jsxs)("div",{className:"role-dual-grid","aria-label":"Staff selection lists",children:[(0,m.jsxs)("ul",{className:"available-list","aria-label":"Available Staff",children:[ge.slice(0,60).map((e=>(0,m.jsx)("li",{children:(0,m.jsxs)("button",{type:"button",onClick:()=>(e=>{R.some((a=>a._id===e._id))||(M((a=>[...a,e])),q((a=>a.filter((a=>a._id!==e._id)))),he((a=>(0,t.A)((0,t.A)({},a),{},{staff:[...a.staff||[],e._id]}))))})(e),children:[(0,m.jsx)("span",{className:"avatar-sm",children:e.name.charAt(0)}),(0,m.jsx)("span",{className:"label-text",children:e.name}),(0,m.jsx)("span",{className:"plus",children:"+"})]})},e._id))),0===ge.length&&(0,m.jsx)("li",{className:"empty",children:"No matches"})]}),(0,m.jsxs)("div",{className:"assigned-list-wrapper",children:[(0,m.jsx)("div",{className:"assigned-subheader",children:"Selected"}),(0,m.jsxs)("ul",{className:"assigned-list styled","aria-label":"Assigned Staff",children:[0===R.length&&(0,m.jsx)("li",{className:"empty",style:{textAlign:"center"},children:"None"}),R.map((e=>(0,m.jsx)("li",{children:(0,m.jsxs)("div",{className:"assigned-row-card",children:[(0,m.jsxs)("div",{className:"assigned-row-main",children:[(0,m.jsx)("span",{className:"avatar-sm alt",children:e.name.charAt(0)}),(0,m.jsx)("span",{className:"label-text",children:e.name})]}),(0,m.jsx)("button",{type:"button",className:"remove-pill",onClick:()=>(e=>{q((a=>[...a,e])),M((a=>a.filter((a=>a._id!==e._id)))),he((a=>(0,t.A)((0,t.A)({},a),{},{staff:(a.staff||[]).filter((a=>a!==e._id))})))})(e),"aria-label":"Remove ".concat(e.name),children:"\u2715"})]})},e._id)))]})]})]})]})]}),(0,m.jsxs)("section",{className:"assign-card","aria-labelledby":"hr-heading",children:[(0,m.jsxs)("header",{className:"assign-card-header",children:[(0,m.jsxs)("h4",{id:"hr-heading",children:["HR - Site ",(0,m.jsx)("span",{className:"count-chip",children:T.length})]}),(0,m.jsxs)("div",{className:"muted",style:{display:"flex",alignItems:"center",gap:8},children:[(0,m.jsx)("span",{children:"Site HR"}),T.length>0&&(0,m.jsx)("button",{type:"button",onClick:()=>{T.length&&(B((e=>Ne([...e,...T]))),U([]),he((e=>(0,t.A)((0,t.A)({},e),{},{hrsite:[]}))))},className:"clear-btn",style:{background:"transparent",border:"1px solid #ccc",padding:"2px 6px",borderRadius:4,cursor:"pointer",fontSize:12},children:"Clear All"})]})]}),(0,m.jsxs)("div",{className:"assign-body",children:[(0,m.jsx)("div",{className:"search-row",children:(0,m.jsx)("input",{placeholder:"Search HR - Site",value:O,onChange:e=>G(e.target.value)})}),(0,m.jsxs)("div",{className:"role-dual-grid","aria-label":"HR selection lists",children:[(0,m.jsxs)("ul",{className:"available-list","aria-label":"Available HR",children:[ve.slice(0,60).map((e=>(0,m.jsx)("li",{children:(0,m.jsxs)("button",{type:"button",onClick:()=>(e=>{T.some((a=>a._id===e._id))||(U((a=>[...a,e])),B((a=>a.filter((a=>a._id!==e._id)))),he((a=>(0,t.A)((0,t.A)({},a),{},{hrsite:[...a.hrsite||[],e._id]}))))})(e),children:[(0,m.jsx)("span",{className:"avatar-sm",children:e.name.charAt(0)}),(0,m.jsx)("span",{className:"label-text",children:e.name}),(0,m.jsx)("span",{className:"plus",children:"+"})]})},e._id))),0===ve.length&&(0,m.jsx)("li",{className:"empty",children:"No matches"})]}),(0,m.jsxs)("div",{className:"assigned-list-wrapper",children:[(0,m.jsx)("div",{className:"assigned-subheader",children:"Selected"}),(0,m.jsxs)("ul",{className:"assigned-list styled","aria-label":"Assigned HR",children:[0===T.length&&(0,m.jsx)("li",{className:"empty",style:{textAlign:"center"},children:"None"}),T.map((e=>(0,m.jsx)("li",{children:(0,m.jsxs)("div",{className:"assigned-row-card",children:[(0,m.jsxs)("div",{className:"assigned-row-main",children:[(0,m.jsx)("span",{className:"avatar-sm alt",children:e.name.charAt(0)}),(0,m.jsx)("span",{className:"label-text",children:e.name})]}),(0,m.jsx)("button",{type:"button",className:"remove-pill",onClick:()=>(e=>{B((a=>[...a,e])),U((a=>a.filter((a=>a._id!==e._id)))),he((a=>(0,t.A)((0,t.A)({},a),{},{hrsite:(a.hrsite||[]).filter((a=>a!==e._id))})))})(e),"aria-label":"Remove ".concat(e.name),children:"\u2715"})]})},e._id)))]})]})]})]})]})]}),(0,m.jsxs)("aside",{className:"summary-panel","aria-label":"Selection Summary",children:[(0,m.jsx)("h4",{children:"Summary"}),(0,m.jsxs)("ul",{className:"summary-list",children:[(0,m.jsxs)("li",{children:[(0,m.jsx)("strong",{children:"PICs:"})," ",A.length]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("strong",{children:"Staff:"})," ",R.length]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("strong",{children:"HR:"})," ",T.length]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("strong",{children:"Manpower:"})," ",Y.length]})]}),(0,m.jsxs)("div",{className:"summary-mini",children:[[...A,...R,...T].slice(0,9).map((e=>(0,m.jsx)("span",{className:"mini-avatar",title:e.name,children:e.name.charAt(0)},e._id))),Y.slice(0,6).map((e=>(0,m.jsx)("span",{className:"mini-avatar alt",title:e.name,children:e.name.charAt(0)},e._id)))]}),(0,m.jsx)("p",{className:"summary-note",children:"Review assigned people before submitting."})]})]}),(0,m.jsxs)("section",{className:"manpower-section section-card","aria-labelledby":"manpower-heading",children:[(0,m.jsxs)("header",{className:"assign-card-header compact",children:[(0,m.jsxs)("h4",{id:"manpower-heading",children:["Manpower ",(0,m.jsx)("span",{className:"count-chip",children:Y.length})]}),(0,m.jsxs)("div",{className:"manpower-tools",children:[(0,m.jsx)("input",{type:"text",placeholder:"Search manpower by name or position",value:W,onChange:e=>X(e.target.value)}),Y.length>0&&(0,m.jsx)("button",{type:"button",onClick:()=>{Y.length&&(K((e=>{const a=[...e,...Y],s=new Set;return a.filter((e=>!s.has(e._id)&&(s.add(e._id),!0)))})),Q([]))},className:"clear-btn",style:{marginLeft:6,background:"transparent",border:"1px solid #ccc",padding:"4px 8px",borderRadius:4,cursor:"pointer",fontSize:12},children:"Clear All"}),(0,m.jsxs)("div",{className:"csv-uploader",children:[(0,m.jsx)("input",{id:"csvUpload",type:"file",accept:".csv",style:{display:"none"},onChange:e=>{ae("");const a=e.target.files[0];a&&c().parse(a,{header:!0,skipEmptyLines:!0,complete:async e=>{const a=e.data,s=e.errors;if(s.length>0)return void ae("CSV Upload Error: ".concat(s[0].message));if(0===a.length)return void ae("No data found in CSV file.");const t=[],n=[],i=[],l=[],c=[],o=new Set,d=new Map;if($.forEach((e=>{const a="".concat(e.name.trim().toLowerCase(),"|").concat(e.position.trim().toLowerCase());d.has(a)||d.set(a,e)})),a.forEach(((e,a)=>{const s=(e.Name||e.name||"").trim(),r=(e.Position||e.position||"").trim();if(!s||!r)return void l.push("Row ".concat(a+1));const m="".concat(s.toLowerCase(),"|").concat(r.toLowerCase());if(o.has(m))return void n.push("Row ".concat(a+1));o.add(m);if(Y.find((e=>e.name.trim().toLowerCase()===s.toLowerCase()&&e.position.trim().toLowerCase()===r.toLowerCase())))return void i.push("".concat(s," - ").concat(r));const p=d.get(m);p?(c.push(p),d.delete(m)):t.push("".concat(s," - ").concat(r))})),c.length){Q((e=>[...e,...c]));const e=new Set(c.map((e=>e._id)));K((a=>a.filter((a=>!e.has(a._id))))),r.oR.success("Quick-assigned ".concat(c.length," manpower").concat(t.length?" (".concat(t.length," not found)"):"","."))}else ae("No matches found in CSV for existing unassigned manpower.");const m=[];l.length&&m.push("Invalid rows: ".concat(l.join(", "))),n.length&&m.push("Duplicate rows: ".concat(n.join(", "))),i.length&&m.push("Already selected: ".concat(i.slice(0,10).join("; ")).concat(i.length>10?"\u2026":"")),t.length&&c.length&&m.push("Not found: ".concat(t.slice(0,10).join("; ")).concat(t.length>10?"\u2026":"")),m.length?ae(m.join(" | ")):c.length&&ae("")},error:e=>{console.error("CSV Parsing Error:",e),ae("Error parsing CSV file. Please ensure it is a valid CSV and try again.")}})}}),(0,m.jsx)("button",{type:"button",onClick:()=>document.getElementById("csvUpload").click(),className:"area-addproj-csv-upload-btn small",children:"CSV"}),(0,m.jsx)("button",{type:"button",onClick:()=>me(!0),className:"area-addproj-csv-upload-btn small",style:{marginLeft:"5px",backgroundColor:"#17a2b8",borderColor:"#17a2b8",position:"relative"},title:"CSV Format Guide",children:"?"})]})]})]}),ee&&(0,m.jsx)("div",{className:"area-addproj-manpower-error",style:{marginTop:4},children:ee}),(0,m.jsxs)("div",{className:"manpower-grid",children:[(0,m.jsxs)("ul",{className:"available-list tall","aria-label":"Available Manpower",children:[0===Pe.length&&(0,m.jsx)("div",{style:{fontSize:12,color:"#666",padding:"4px 0"},children:"No manpower found."}),(0,m.jsx)("div",{className:"grouped-manpower-scroll",children:Pe.map((e=>(0,m.jsxs)("div",{className:"mp-group-card",children:[(0,m.jsx)("header",{className:"mp-group-card-header",children:(0,m.jsxs)("button",{type:"button",onClick:()=>{return a=e.position,De((e=>{const s=(0,t.A)((0,t.A)({},e),{},{[a]:!e[a]});try{localStorage.setItem("mp_collapsed",JSON.stringify(s))}catch(n){}return s}));var a},"aria-expanded":!_e[e.position],className:"mp-group-toggle",children:[(0,m.jsx)("span",{className:"mp-group-title-text",children:e.position}),(0,m.jsxs)("span",{className:"mp-group-count-pill",children:[e.list.length," / ",e.total]}),(0,m.jsx)("span",{className:"mp-group-caret ".concat(_e[e.position]?"collapsed":""),children:"\u25be"})]})}),!_e[e.position]&&(0,m.jsxs)("ul",{className:"mp-group-people","aria-label":"".concat(e.position," manpower"),children:[e.list.slice(0,Me(e.position,e.list.length)).map((e=>(0,m.jsx)("li",{children:(0,m.jsxs)("button",{type:"button",className:"mp-person-row",onClick:()=>(e=>{Q((a=>a.some((a=>a._id===e._id))?a:[...a,e])),K((a=>a.filter((a=>a._id!==e._id))))})(e),title:"Assign",children:[(0,m.jsx)("span",{className:"avatar-sm",children:e.name.charAt(0)}),(0,m.jsxs)("span",{className:"label-text",children:[e.name,(0,m.jsxs)("em",{children:[" \u2014 ",e.position]})]}),(0,m.jsx)("span",{className:"plus",children:"+"})]})},e._id))),Me(e.position,e.list.length)<e.list.length&&(0,m.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:4},children:[(0,m.jsxs)("button",{type:"button",className:"show-more-btn",onClick:()=>{return a=e.position,s=e.list.length,Re((e=>{const n=Math.min((e[a]||25)+25,s),r=(0,t.A)((0,t.A)({},e),{},{[a]:n});try{localStorage.setItem("mp_visible_counts",JSON.stringify(r))}catch(i){}return r}));var a,s},children:["Load More (+",Math.min(25,e.list.length-Me(e.position,e.list.length)),")"]}),(0,m.jsxs)("button",{type:"button",className:"show-more-btn",onClick:()=>{return a=e.position,s=e.list.length,Re((e=>{const n=(0,t.A)((0,t.A)({},e),{},{[a]:s});try{localStorage.setItem("mp_visible_counts",JSON.stringify(n))}catch(r){}return n}));var a,s},children:["Show All (",e.list.length,")"]})]})]})]},e.position)))})]}),(0,m.jsxs)("div",{className:"assigned-groups","aria-label":"Assigned Manpower Groups",children:[0===Le.length&&(0,m.jsx)("div",{className:"placeholder",style:{padding:"4px 6px"},children:"None assigned yet"}),Le.map((e=>(0,m.jsxs)("div",{className:"assigned-group-card",children:[(0,m.jsxs)("div",{className:"assigned-group-title",children:[e.position," ",(0,m.jsx)("span",{className:"mp-group-count-pill",children:e.list.length})]}),(0,m.jsx)("ul",{className:"assigned-group-people","aria-label":"Assigned ".concat(e.position),children:e.list.map((e=>(0,m.jsx)("li",{children:(0,m.jsxs)("button",{type:"button",onClick:()=>(e=>{K((a=>a.some((a=>a._id===e._id))?a:[...a,e])),Q((a=>a.filter((a=>a._id!==e._id))))})(e),title:"Remove",children:[(0,m.jsx)("span",{className:"avatar-sm",children:e.name.charAt(0)}),(0,m.jsxs)("span",{className:"label-text",children:[e.name,(0,m.jsxs)("em",{children:[" \u2014 ",e.position]})]}),(0,m.jsx)("span",{className:"remove-x","aria-label":"Remove ".concat(e.name),children:"\xd7"})]})},e._id)))})]},e.position)))]})]})]}),(0,m.jsxs)("div",{className:"section-card media-card",children:[(0,m.jsxs)("div",{className:"section-card-header",children:[(0,m.jsx)("h3",{children:"Assets"}),(0,m.jsx)("span",{className:"section-hint",children:"Photos & Documents"})]}),(0,m.jsxs)("div",{className:"upload-grid",children:[(0,m.jsxs)("div",{className:"uploader-block",children:[(0,m.jsx)("h5",{children:"Project Photos"}),(0,m.jsxs)("div",{className:"dropzone ".concat(ne?"drag":""),onDragOver:e=>{e.preventDefault(),re(!0)},onDragLeave:e=>{e.preventDefault(),re(!1)},onDrop:e=>{e.preventDefault(),re(!1),ye(e.dataTransfer.files)},onClick:()=>document.getElementById("photoInput").click(),children:[(0,m.jsx)("input",{id:"photoInput",type:"file",accept:"image/*",multiple:!0,style:{display:"none"},onChange:e=>{ye(e.target.files)}}),(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Click or Drag & Drop"})," images here"]}),(0,m.jsx)("span",{className:"hint",children:"PNG, JPG up to 5MB each"})]}),se.length>0&&(0,m.jsx)("div",{className:"thumbs-grid",children:se.map(((e,a)=>(0,m.jsxs)("div",{className:"thumb",children:[(0,m.jsx)("img",{src:URL.createObjectURL(e),alt:e.name}),(0,m.jsx)("button",{type:"button",className:"remove",onClick:()=>{return e=a,void te((a=>a.filter(((a,s)=>s!==e))));var e},"aria-label":"Remove photo",children:"\xd7"})]},a)))})]}),(0,m.jsxs)("div",{className:"uploader-block",children:[(0,m.jsx)("h5",{children:"Project Documents"}),(0,m.jsxs)("div",{className:"dropzone ".concat(ie?"drag":""),onDragOver:e=>{e.preventDefault(),le(!0)},onDragLeave:e=>{e.preventDefault(),le(!1)},onDrop:e=>{e.preventDefault(),le(!1),we(e.dataTransfer.files)},onClick:()=>document.getElementById("docInput").click(),children:[(0,m.jsx)("input",{id:"docInput",type:"file",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.csv,.zip",multiple:!0,style:{display:"none"},onChange:e=>{we(e.target.files)}}),(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Click or Drag & Drop"})," files here"]}),(0,m.jsx)("span",{className:"hint",children:"Docs, Sheets, Slides, PDF, CSV, ZIP"})]}),p.length>0&&(0,m.jsx)("ul",{className:"doc-list",children:p.map(((e,a)=>(0,m.jsxs)("li",{className:"doc-item",children:[(0,m.jsx)("span",{className:"ext-pill",children:(e.name.split(".").pop()||"").substring(0,4).toUpperCase()}),(0,m.jsx)("span",{className:"doc-name",title:e.name,children:e.name}),(0,m.jsx)("span",{className:"size",children:be(e.size)}),(0,m.jsx)("button",{type:"button",className:"remove",onClick:()=>{return e=a,void h((a=>a.filter(((a,s)=>s!==e))));var e},"aria-label":"Remove document",children:"\xd7"})]},a)))})]}),(0,m.jsxs)("div",{className:"uploader-block",children:[(0,m.jsx)("h5",{children:"Budget PDF(s)"}),(0,m.jsxs)("div",{className:"dropzone ".concat(ce?"drag":""),onDragOver:e=>{e.preventDefault(),oe(!0)},onDragLeave:e=>{e.preventDefault(),oe(!1)},onDrop:e=>{e.preventDefault(),oe(!1),Ae(e.dataTransfer.files)},onClick:()=>document.getElementById("budgetPdfInput").click(),children:[(0,m.jsx)("input",{id:"budgetPdfInput",type:"file",accept:"application/pdf",multiple:!0,style:{display:"none"},onChange:e=>{Ae(e.target.files)}}),(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Click or Drag & Drop"})," budget PDFs here"]}),(0,m.jsx)("span",{className:"hint",children:"PDF only \u2022 First file parsed for auto budget deduction"})]}),u.length>0&&(0,m.jsx)("ul",{className:"doc-list",children:u.map(((e,a)=>(0,m.jsxs)("li",{className:"doc-item",children:[(0,m.jsx)("span",{className:"ext-pill",children:"PDF"}),(0,m.jsx)("span",{className:"doc-name",title:e.name,children:e.name}),(0,m.jsx)("span",{className:"size",children:be(e.size)}),(0,m.jsx)("button",{type:"button",className:"remove",onClick:()=>{return e=a,void j((a=>a.filter(((a,s)=>s!==e))));var e},"aria-label":"Remove budget PDF",children:"\xd7"})]},e.name+a)))}),(0,m.jsxs)("small",{style:{display:"block",marginTop:4},children:[u.length||0," budget PDF",1===u.length?"":"s"," selected"]})]})]})]}),(0,m.jsx)("div",{className:"area-addproj-form-row area-addproj-submit-row",children:(0,m.jsx)("button",{type:"submit",className:"area-addproj-submit-button",disabled:Ce,children:Ce?"Submitting...":"Add Project"})})]})]})}),de&&(0,m.jsx)("div",{className:"aa-modal-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"csv-help-title",children:(0,m.jsxs)("div",{className:"aa-modal",role:"document",children:[(0,m.jsx)("div",{className:"aa-modal-header",children:(0,m.jsx)("h3",{id:"csv-help-title",children:"CSV Quick Assign Format"})}),(0,m.jsxs)("div",{className:"aa-modal-body",children:[(0,m.jsxs)("p",{children:["This will ",(0,m.jsx)("strong",{children:"MATCH"})," existing unassigned manpower already in the system and add them to this project. It will ",(0,m.jsx)("strong",{children:"NOT"})," create new manpower."]}),(0,m.jsx)("p",{style:{marginTop:12,marginBottom:4,fontWeight:600,fontSize:13},children:"Required columns (case-insensitive):"}),(0,m.jsxs)("ul",{style:{marginTop:0,marginLeft:18,fontSize:13},children:[(0,m.jsx)("li",{children:"Name"}),(0,m.jsx)("li",{children:"Position"})]}),(0,m.jsx)("p",{style:{marginTop:12,marginBottom:4,fontWeight:600,fontSize:13},children:"Rules:"}),(0,m.jsxs)("ul",{style:{marginTop:0,marginLeft:18,fontSize:13,lineHeight:1.4},children:[(0,m.jsxs)("li",{children:["Each (Name, Position) pair must exactly match an existing ",(0,m.jsx)("em",{children:"unassigned"})," manpower record."]}),(0,m.jsx)("li",{children:"Duplicates inside the CSV are ignored (first wins)."}),(0,m.jsx)("li",{children:"Rows with missing name or position are skipped."}),(0,m.jsx)("li",{children:"Extra columns are ignored."})]}),(0,m.jsx)("p",{style:{marginTop:14,marginBottom:4,fontWeight:600,fontSize:13},children:"Example:"}),(0,m.jsx)("pre",{style:{background:"#0f172a",color:"#f1f5f9",padding:"10px 12px",borderRadius:8,fontSize:12,overflowX:"auto"},children:"Name,Position John Doe,Engineer Jane Smith,Manager Mike Johnson,Technician"})]}),(0,m.jsx)("div",{className:"aa-modal-footer",children:(0,m.jsx)("button",{type:"button",onClick:()=>me(!1),className:"aa-btn-primary",autoFocus:!0,children:"Close"})})]})})]})}},4085:(e,a,s)=>{s.r(a),s.d(a,{default:()=>o});var t=s(5043),n=s(3216),r=s(411),i=s(8818),l=(s(1254),s(2739),s(3204)),c=s(579);const o=()=>{const e=(0,n.Zp)(),[a,s]=(0,t.useState)([]),[o,d]=(0,t.useState)(!0),[m,p]=(0,t.useState)(""),[h,u]=(0,t.useState)("all"),[j,x]=(0,t.useState)("grid"),[g,v]=(0,t.useState)(""),N=(0,t.useDeferredValue)(g),[f,b]=(0,t.useState)("name"),[y,w]=(0,t.useState)("asc"),[A,k]=(0,t.useState)(1),[C,S]=(0,t.useState)(12),_=localStorage.getItem("user"),D=_?JSON.parse(_):null,P=null===D||void 0===D?void 0:D._id;(0,t.useEffect)((()=>{let e=!0;return(async()=>{try{const{data:a}=await r.Ay.get("/projects");if(!e)return;s(Array.isArray(a)?a:[])}catch(a){e&&p("Failed to fetch projects")}finally{e&&d(!1)}})(),()=>{e=!1}}),[]);const q=(0,t.useMemo)((()=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:2})),[]),R=e=>e?new Date(e).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"",M=(0,t.useMemo)((()=>P?a.filter((e=>{if(!e.areamanager)return!1;if("object"===typeof e.areamanager){const a=e.areamanager._id||e.areamanager.id;return a&&String(a)===String(P)}return"string"===typeof e.areamanager&&String(e.areamanager)===String(P)})):[]),[a,P]),L=(0,t.useMemo)((()=>{const e=N.trim().toLowerCase();return M.filter((e=>{const a=(e.status||"").toLowerCase();return"completed"===h?"completed"===a:"ongoing"===h?["ongoing","on going"].includes(a):"pending"!==h||["pending","not started"].includes(a)})).filter((a=>{var s,t;return!e||[a.projectName,null===(s=a.location)||void 0===s?void 0:s.name,null===(t=a.projectmanager)||void 0===t?void 0:t.name,a.contractor].some((a=>(a||"").toLowerCase().includes(e)))})).sort(((e,a)=>{const s=e=>{var a,s;switch(f){case"location":return(null===(a=e.location)||void 0===a?void 0:a.name)||"";case"manager":return(null===(s=e.projectmanager)||void 0===s?void 0:s.name)||"";case"status":return e.status||"";case"startDate":return e.startDate?new Date(e.startDate).getTime():0;default:return e.projectName||""}},t=s(e),n=s(a);return t===n?0:(t>n?1:-1)*("asc"===y?1:-1)}))}),[M,h,N,f,y]);(0,t.useEffect)((()=>{k(1)}),[h,N,f,y]);const E=L.length,I=Math.max(1,Math.ceil(E/C)),z=Math.min(A,I),F=(0,t.useMemo)((()=>L.slice((z-1)*C,z*C)),[L,z,C]),B=(0,t.useMemo)((()=>({total:M.length,ongoing:M.filter((e=>["ongoing","on going"].includes((e.status||"").toLowerCase()))).length,completed:M.filter((e=>"completed"===(e.status||"").toLowerCase())).length,pending:M.filter((e=>["pending","not started"].includes((e.status||"").toLowerCase()))).length})),[M]),T=e=>{let{n:a=8}=e;return(0,c.jsx)("div",{className:"projects-display ".concat(j),children:Array.from({length:a}).map(((e,a)=>(0,c.jsxs)("div",{className:"project-card skeleton",children:[(0,c.jsx)("div",{className:"project-image-wrapper shimmer"}),(0,c.jsxs)("div",{className:"project-content",children:[(0,c.jsx)("div",{className:"skeleton-line w60"}),(0,c.jsx)("div",{className:"skeleton-line w40"}),(0,c.jsx)("div",{className:"skeleton-line w80"}),(0,c.jsx)("div",{className:"skeleton-line w50"})]})]},a)))})};return(0,c.jsxs)("div",{className:"dashboard-container no-inner-scroll am-projects-page",children:[(0,c.jsx)(i.A,{roleSegment:"am"}),(0,c.jsx)("main",{className:"dashboard-main auto-height",children:(0,c.jsxs)("div",{className:"projects-container projects-light",children:[(0,c.jsxs)("div",{className:"page-header enhanced",children:[(0,c.jsxs)("div",{className:"page-title-section",children:[(0,c.jsx)("h1",{className:"page-title",children:"My Projects"}),(0,c.jsx)("p",{className:"page-subtitle",children:"Manage and monitor your portfolio"})]}),(0,c.jsxs)("div",{className:"page-actions",children:[(0,c.jsxs)("button",{className:"add-project-btn",onClick:()=>e("/am/addproj"),"aria-label":"Add Project",children:[(0,c.jsx)(l.yd7,{}),(0,c.jsx)("span",{children:"Add Project"})]}),(0,c.jsxs)("div",{className:"search-container",children:[(0,c.jsx)(l.KSO,{className:"search-icon"}),(0,c.jsx)("input",{value:g,onChange:e=>v(e.target.value),placeholder:"Search by name, location, manager...",className:"search-input"})]}),(0,c.jsxs)("div",{className:"view-mode-container",children:[(0,c.jsx)("button",{"aria-label":"Grid view",className:"view-mode-btn ".concat("grid"===j?"active":""),onClick:()=>x("grid"),children:(0,c.jsx)(l.QJV,{})}),(0,c.jsx)("button",{"aria-label":"List view",className:"view-mode-btn ".concat("list"===j?"active":""),onClick:()=>x("list"),children:(0,c.jsx)(l.svy,{})})]}),(0,c.jsxs)("div",{className:"sort-container",children:[(0,c.jsxs)("select",{value:f,onChange:e=>b(e.target.value),className:"sort-select",children:[(0,c.jsx)("option",{value:"name",children:"Name"}),(0,c.jsx)("option",{value:"location",children:"Location"}),(0,c.jsx)("option",{value:"manager",children:"Manager"}),(0,c.jsx)("option",{value:"status",children:"Status"}),(0,c.jsx)("option",{value:"startDate",children:"Start Date"})]}),(0,c.jsx)("button",{"aria-label":"Toggle sort order",className:"sort-order-btn",onClick:()=>w((e=>"asc"===e?"desc":"asc")),children:"asc"===y?(0,c.jsx)(l.Ucs,{}):(0,c.jsx)(l.Vr3,{})})]})]})]}),(0,c.jsxs)("div",{className:"filter-bar below-header",children:[(0,c.jsxs)("button",{className:"filter-chip ".concat("all"===h?"active":""),onClick:()=>u("all"),children:["All ",(0,c.jsx)("span",{className:"badge",children:B.total})]}),(0,c.jsxs)("button",{className:"filter-chip ".concat("ongoing"===h?"active":""),onClick:()=>u("ongoing"),children:["Ongoing ",(0,c.jsx)("span",{className:"badge",children:B.ongoing})]}),(0,c.jsxs)("button",{className:"filter-chip ".concat("completed"===h?"active":""),onClick:()=>u("completed"),children:["Completed ",(0,c.jsx)("span",{className:"badge",children:B.completed})]}),(0,c.jsxs)("button",{className:"filter-chip ".concat("pending"===h?"active":""),onClick:()=>u("pending"),children:["Pending ",(0,c.jsx)("span",{className:"badge",children:B.pending})]})]}),m&&(0,c.jsxs)("div",{className:"error-state compact",children:[(0,c.jsx)(l.w_X,{}),(0,c.jsx)("span",{children:m})]}),o&&!m&&(0,c.jsx)(T,{n:8}),!o&&!m&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"projects-display ".concat(j),children:[0===F.length&&(0,c.jsxs)("div",{className:"empty-state full",children:[(0,c.jsx)(l.yd7,{size:42}),(0,c.jsx)("h3",{children:"No projects found"}),(0,c.jsx)("p",{children:g||"all"!==h?"Adjust search text, filters or sorting.":"No projects assigned yet."})]}),F.map((a=>{var s,t,n;const r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const a=e.toLowerCase();return"completed"===a?{color:"#10B981",Icon:l.A7C,label:"Completed"}:["ongoing","on going"].includes(a)?{color:"#3B82F6",Icon:l.w_X,label:"Ongoing"}:["pending","not started"].includes(a)?{color:"#F59E0B",Icon:l.w_X,label:"Pending"}:{color:"#6B7280",Icon:l.w_X,label:e||"Unknown"}}(a.status);return(0,c.jsxs)("div",{className:"project-card ".concat(j),onClick:()=>e("/am/projects/".concat(a._id)),role:"button",tabIndex:0,onKeyDown:s=>{"Enter"===s.key&&e("/am/projects/".concat(a._id))},children:[(0,c.jsxs)("div",{className:"project-image-wrapper",children:[(0,c.jsx)("img",{loading:"lazy",src:(null===(s=a.photos)||void 0===s?void 0:s[0])||"https://placehold.co/640x360?text=No+Photo",alt:a.projectName,className:"project-image"}),(0,c.jsxs)("div",{className:"status-badge",style:{backgroundColor:r.color},children:[(0,c.jsx)(r.Icon,{size:12}),(0,c.jsx)("span",{children:r.label})]})]}),(0,c.jsxs)("div",{className:"project-content",children:[(0,c.jsx)("h3",{className:"project-name clamp",children:a.projectName||"Untitled"}),(0,c.jsxs)("div",{className:"project-location",children:[(0,c.jsx)(l.vq8,{}),(0,c.jsx)("span",{children:(null===(t=a.location)||void 0===t?void 0:t.name)||"No Location"})]}),(0,c.jsxs)("ul",{className:"meta-list",children:[(0,c.jsxs)("li",{children:[(0,c.jsx)(l.p7b,{}),(0,c.jsx)("span",{children:(null===(n=a.projectmanager)||void 0===n?void 0:n.name)||"Unassigned"})]}),(0,c.jsxs)("li",{children:[(0,c.jsx)(l.ymh,{}),(0,c.jsx)("span",{children:a.contractor||"No Contractor"})]}),(0,c.jsxs)("li",{children:[(0,c.jsx)(l.bfZ,{}),(0,c.jsx)("span",{children:a.startDate&&a.endDate?"".concat(R(a.startDate)," - ").concat(R(a.endDate)):a.startDate?R(a.startDate):"No timeline"})]}),(0,c.jsxs)("li",{children:[(0,c.jsx)(l.YXz,{}),(0,c.jsx)("span",{children:Array.isArray(a.manpower)&&a.manpower.length>0?"".concat(a.manpower.length," manpower"):"No manpower"})]}),a.budget&&(0,c.jsxs)("li",{children:[(0,c.jsx)(l.MxO,{}),(0,c.jsx)("span",{children:q.format(a.budget)})]})]})]})]},a._id)}))]}),F.length>0&&(0,c.jsxs)("div",{className:"pagination-bar",children:[(0,c.jsxs)("div",{className:"pagination-left",children:[(0,c.jsxs)("span",{className:"pagination-info",children:["Showing ",(z-1)*C+1,"-",Math.min(z*C,E)," of ",E]}),(0,c.jsxs)("label",{className:"page-size-select-label",children:[(0,c.jsx)("span",{children:"Per page:"}),(0,c.jsx)("select",{value:C,onChange:e=>{S(parseInt(e.target.value)||12),k(1)},className:"page-size-select",children:[6,12,18,24,36].map((e=>(0,c.jsx)("option",{value:e,children:e},e)))})]})]}),(0,c.jsxs)("div",{className:"pagination-pages",children:[(0,c.jsx)("button",{disabled:1===z,onClick:()=>k((e=>Math.max(1,e-1))),className:"page-btn","aria-label":"Previous page",children:"\u2039"}),Array.from({length:I}).slice(0,I).map(((e,a)=>{const s=a+1;return 1===s||s===I||Math.abs(s-z)<=1?(0,c.jsx)("button",{className:"page-btn ".concat(s===z?"active":""),onClick:()=>k(s),"aria-current":s===z?"page":void 0,children:s},s):2===s&&z>3?(0,c.jsx)("span",{className:"ellipsis",children:"\u2026"},"start-ellipsis"):s===I-1&&z<I-2?(0,c.jsx)("span",{className:"ellipsis",children:"\u2026"},"end-ellipsis"):null})),(0,c.jsx)("button",{disabled:z===I,onClick:()=>k((e=>Math.min(I,e+1))),className:"page-btn","aria-label":"Next page",children:"\u203a"})]})]})]})]})})]})}},4905:()=>{},6356:(e,a,s)=>{s.r(a),s.d(a,{default:()=>i});s(5043);var t=s(3182),n=s(3204),r=(s(7508),s(579));n.$BV,n.uN,n.H5e,n.YXz,n.yd7,n.kkc;const i=()=>(0,r.jsx)(t.A,{role:"Area Manager",rootClass:"am-request-detail",headerTitle:"Material Request Detail",headerSubtitle:"Approve or review final status"})}}]);
//# sourceMappingURL=am.4f62e822.chunk.js.map